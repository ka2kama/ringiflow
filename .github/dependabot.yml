# Dependabot 依存関係自動更新設定
#
# =============================================================================
# 概要
# =============================================================================
# Dependabot は依存関係の更新を自動で検出し、PR を作成する GitHub の機能。
# セキュリティ脆弱性の修正や、依存ライブラリの最新化を自動化する。
#
# =============================================================================
# 設計判断
# =============================================================================
#
# スケジュール: 週次（月曜日）
# - 毎日だと PR が多すぎてノイズになる
# - 月次だと脆弱性対応が遅れるリスクがある
# - 週次は妥当なバランス。月曜日に PR が作成され、週内でレビュー・マージできる
#
# open-pull-requests-limit: 5
# - 同時に開ける PR 数の上限
# - 多すぎると CI 負荷が増加し、レビューが追いつかない
# - 5 件は 1 週間でレビュー可能な現実的な数
#
# labels による分類
# - "dependencies": 全ての依存更新に共通のラベル（フィルタリング用）
# - "rust"/"elm"/"ci": エコシステム別のラベル（担当者の振り分け用）
#
# =============================================================================
# 対象エコシステム
# =============================================================================
#
# 1. Cargo (Rust)
#    - ワークスペースルートの Cargo.toml/Cargo.lock を監視
#    - apps/api, packages/* の全 Rust クレートが対象
#
# 2. npm (Elm/Vite)
#    - apps/web/package.json を監視
#    - Elm コンパイラ、elm-format、Vite 等のビルドツールが対象
#    - Elm パッケージ（elm.json）は Dependabot 非対応のため手動管理
#
# 3. GitHub Actions
#    - .github/workflows/*.yml 内の uses: を監視
#    - actions/checkout, dtolnay/rust-toolchain 等のアクションが対象
#
# =============================================================================

version: 2
updates:
  # ---------------------------------------------------------------------------
  # Rust (Cargo)
  # ---------------------------------------------------------------------------
  # ワークスペース全体の Cargo 依存を管理。
  # Cargo.lock の更新 PR が作成される。
  - package-ecosystem: "cargo"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "rust"

  # ---------------------------------------------------------------------------
  # npm (Elm/Vite)
  # ---------------------------------------------------------------------------
  # apps/web の npm 依存を管理。
  # pnpm-lock.yaml の更新 PR が作成される。
  #
  # 注意: Elm パッケージ（elm.json の dependencies）は Dependabot 非対応。
  # elm-json や手動での更新が必要。
  - package-ecosystem: "npm"
    directory: "/apps/web"
    schedule:
      interval: "weekly"
      day: "monday"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "elm"

  # ---------------------------------------------------------------------------
  # GitHub Actions
  # ---------------------------------------------------------------------------
  # ワークフローで使用するアクションのバージョンを管理。
  # セキュリティ修正や新機能を取り込むために重要。
  #
  # 対象例:
  # - actions/checkout@v4
  # - dtolnay/rust-toolchain@stable
  # - dorny/paths-filter@v3
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "ci"
