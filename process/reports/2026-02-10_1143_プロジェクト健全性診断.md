# プロジェクト健全性診断（2026-02-10）

## 概要

`/assess` スキル初回実行による全 3 軸診断のスナップショット。

## 📋 診断結果

### 🔭 Discovery（攻め）

**現在の Phase**: Phase 1（MVP）— 機能的に完了
**Phase 進捗**: Phase 1 の完了基準をすべて達成済み。現在は Phase 1→2 間の品質改善・リファクタリング期

Phase 1 完了基準の達成状況:

| 基準 | 状態 |
|------|------|
| ユーザーがログインできる | ✅ 実装済み |
| ワークフローを申請できる | ✅ 実装済み |
| 承認者がタスク一覧から案件を確認できる | ✅ 実装済み |
| 承認/却下ができ、フローが完了する | ✅ 実装済み |
| ダッシュボードに統計が表示される | ✅ 実装済み |

#### 未実装の主要機能

| 機能 | Phase | 要件ID | 学習価値 | 備考 |
|------|-------|--------|---------|------|
| マルチテナント（RLS） | 2 | CORE-03 | 高 | PostgreSQL RLS は新しい学習領域 |
| ワークフローデザイナー | 2 | WF-001, WFD-001〜005 | 高 | GUI ベースのフロー設計 |
| 複数ステップ承認 | 2 | WF-002 | 中 | 現在の1段階承認を拡張 |
| 差し戻し | 2 | WF-103 | 中 | 状態遷移の複雑化 |
| 通知（メール） | 2 | NOTIFY-001 | 中 | AWS SES 連携 |
| ドキュメント管理 | 2 | DOC-001, DOC-003 | 中 | AWS S3 連携 |
| SSO（OIDC/SAML） | 3 | AUTH-002, AUTH-003 | 高 | 外部 IdP 連携 |
| MFA（TOTP） | 3 | AUTH-004 | 高 | セキュリティ強化 |
| イベントソーシング/CQRS | 4 | OPS-10 | 高 | アーキテクチャ刷新 |

設計書の実装状態マーカー: 18 箇所（すべて Phase 3-4 予定）

機能仕様書: 2 ファイル（ADR-040 で導入されたばかり）

---

### 📊 Delivery（実行）

**バックログ**: オープン 14 件（enhancement: 4, idea: 3, documentation: 1, ラベルなし: 4, 複合ラベル: 2）
**消化ペース**: 直近 30 日で 100 件以上クローズ
**停滞**: 0 件（30 日以上未更新の Issue なし）

#### オープン Issue の内訳

| カテゴリ | Issue | 概要 |
|---------|-------|------|
| リファクタリング | #290 | 500 行超ファイルの分割 |
| リファクタリング | #379 | UseCase テストの Mock リポジトリ共通化 |
| リファクタリング | #378 | Infra 層の Row→Entity 変換コード共通化 |
| リファクタリング | #377 | BFF Client のレスポンスハンドリング共通化 |
| テスト | #128 | Playwright E2E テスト導入 |
| インフラ | #274 | Lightsail デモ環境の認証設定 |
| インフラ | #276 | Lightsail IPv6→dual-stack 切替 |
| 設計検討 | #123 | 内部 API の仕様管理方式（gRPC 等） |
| 設計検討 | #137 | API 仕様と実装の整合性担保 |
| ドキュメント | #323 | docs/ ディレクトリ番号の見直し |
| アイデア | #380 | AI に PO 的視点を導入 |
| アイデア | #302 | ルール・ドキュメントの定期棚卸し |
| アイデア | #136 | シードデータのマイグレーション分離 |
| リポジトリ整理 | #104 | 汎用技術ノートを専用リポジトリに分離 |

#### 所見

直近 30 日で 100 件超クローズは高い消化率。ただしプロセス改善・ドキュメント整備・テスト改善が中心で、新規機能（Feature）の比率は低い。

---

### 🛡️ Sustainability（守り）

#### コード健全性

- **大型ファイル（500 行超）: 16 件**（#290 で Issue 化済み）
  - `usecase/workflow/command.rs` — 1696 行（最大）
  - `Page/Workflow/New.elm` — 1115 行
  - `handler/auth.rs`（BFF）— 985 行
  - `handler/workflow.rs`（Core）— 780 行
  - `handler/workflow.rs`（BFF）— 754 行
  - 他 11 ファイル
- **TODO/FIXME: 2 件**（frontend のみ）
  - `Page/Home.elm:114` — KPI カードのデザイン実装
  - `Page/Workflow/New.elm:691` — 保存→申請の連続処理
- **未使用依存: 0 件**

#### ドキュメント整合性

- 未実装マーカー: 18 箇所（すべて Phase 3-4 予定、正常）
- ADR 総数: 40 件
- 改善記録（今月）: 33 件

#### 依存関係

- Rust outdated: `cargo outdated` 未インストール（スキップ）
- Frontend outdated: 出力なし（最新の可能性）
- セキュリティ脆弱性: `cargo audit` 未インストール（スキップ）

#### テスト

| カテゴリ | ファイル数 |
|---------|----------|
| バックエンド統合テスト（Rust） | 8 |
| フロントエンドテスト（Elm） | 19 |
| API テスト（Hurl） | 20 |

#### プロセス

| 指標 | 今月（2月） | 先月（1月） |
|------|-----------|-----------|
| 改善記録 | 33 件 | 12 件 |
| セッションログ | 51 件 | 85 件 |

---

### 🎯 推奨アクション

| 優先度 | カテゴリ | アクション | 根拠 |
|--------|---------|---------|------|
| High | Maintain | #290: 500 行超ファイルの分割を優先 | 16 ファイルが閾値超過、最大 1696 行 |
| High | Maintain | `cargo outdated` と `cargo audit` をインストール | セキュリティ脆弱性が検出不能な状態 |
| High | Improve | Feature と Maintain のバランスを回復 | 100 件超クローズのうち Feature 比率が低い |
| Medium | Feature | Phase 2 の計画策定を開始（マルチテナント RLS を最初の候補） | Phase 1 完了済み |
| Medium | Maintain | #379, #378, #377: コード共通化 | 構造品質の向上 |
| Medium | Improve | E2E テスト（#128）を Phase 2 開始前に導入検討 | リグレッション検知基盤 |
| Low | Maintain | TODO コメント 2 件の対応 | 長期放置のリスクは低い |
| Low | Improve | #323: ドキュメント番号体系の見直し | ドキュメント整理 |

## 総合所見

プロジェクトは Phase 1 完了後の品質改善期にある。プロセス成熟度は非常に高い（ADR 40 件、改善記録 33 件/月）。最大のリスクは大型ファイル（16 件、最大 1696 行）。戦略的には、品質改善への投資が十分に行われたので、Feature 開発（Phase 2）への比率を上げるタイミング。
