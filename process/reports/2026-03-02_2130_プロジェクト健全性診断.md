# プロジェクト健全性診断（2026-03-02）

## 概要

`/assess` スキルによる月次診断。対象期間: 2026-02-01 〜 2026-02-28。前回診断（2026-02-13）からの差分・トレンドを含む。

## 前回比トレンド

| 指標 | 2/13 | 3/2 | 変化 |
|------|------|-----|------|
| Phase | Phase 2-3 実質完了 | Phase 2-4 実質完了、Phase 2-5 進行中 | Phase 2-4, 2-5 に大幅進展 |
| オープン Issue | 18 | 16 | -2 |
| 停滞 Issue（30日超） | 0 | 0 | → |
| 大型ファイル（500行超） | 16 | 34 | +18 |
| TODO/FIXME | 3 | 4 | +1 |
| 未使用依存 | 0 | 0 | → |
| ADR | 44 | 60 | +16 |
| 改善記録（2月） | 43 | 100 | +57（月末集計） |
| セッションログ（2月） | 92 | 261 | +169 |
| バックエンド統合テスト | 18 | 25 | +7 |
| API テスト（Hurl） | 26 | 42 | +16 |
| E2E テスト | 3 | 8 | +5 |

主な変化:
- Phase 2-4（ワークフローデザイナー）の実装が進み、E2E テスト・API テストが大幅に拡充
- Phase 2-5（通知 + ドキュメント管理）のバックエンド基盤が実装された（ドキュメント管理、フォルダ管理、S3 連携、通知ログ）
- 大型ファイルが 16 → 34 に倍増（Phase 2-4 のデザイナー UI とドキュメント管理ハンドラが主因）
- ADR が +16 件増加し、設計判断の形式知化が継続している
- 改善記録が月間 100 件に到達し、プロセス改善サイクルが活発

---

## 🔭 Discovery（攻め）

### 現在の Phase: Phase 2（機能拡張）

**Phase 進捗**:

| サブフェーズ | 状態 | 根拠 |
|-------------|------|------|
| Phase 2-1: マルチテナント RLS | ✅ 完了 | ロードマップの完了基準が全チェック済み |
| Phase 2-2: ユーザー管理 + 監査ログ | 🟡 実質完了（ロードマップ未更新） | E2E テスト（user-management.spec.ts）、API テスト（user/, role/, audit_log/）、統合テスト（user_repository, role_repository, audit_log_repository）が存在 |
| Phase 2-3: 複数ステップ承認 + 差し戻し + コメント | 🟡 実質完了（ロードマップ未更新） | E2E テスト（approval, rejection, request-changes）、API テスト（multi_step_approve, request_changes_step, comments）が存在 |
| Phase 2-4: ワークフローデザイナー | 🟡 実質完了（ロードマップ未更新） | E2E テスト（designer-workflow-flow, workflow-definition-management）、API テスト（create/update/delete/validate definition）、Designer.elm（1965行）が存在 |
| Phase 2-5: 通知 + ドキュメント管理 | 🔵 進行中 | Epic #406 がオープン。バックエンド基盤（document/folder リポジトリ、S3 連携、notification_log）は実装済み。未完了 Story: #879（SES 連携）、#884（ファイル添付）、#885（フロントエンド）、#886（テナント退会削除 + Terraform） |

**重要な発見**: ロードマップ（`docs/40_詳細設計書/00_実装ロードマップ.md`）の Phase 2-2〜2-4 の完了基準がすべて未チェックだが、テストカバレッジから判断すると実質的に完了している。ロードマップの更新が必要。

### 未実装の主要機能

| 機能 | Phase | 要件 ID | 学習価値 | 備考 |
|------|-------|---------|---------|------|
| メール通知（SES 連携） | 2-5 | NOTIFY-001 | 中 | Story #879。AWS SES 連携パターン |
| ワークフロー申請ファイル添付 | 2-5 | DOC-001 | 中 | Story #884。署名付き URL パターン |
| ドキュメント管理フロントエンド | 2-5 | DOC-003 | 中 | Story #885。バックエンドは実装済み |
| テナント退会削除対応 + Terraform | 2-5 | — | 中 | Story #886。S3 ドキュメント削除 |
| SSO（OIDC/SAML） | 3 | AUTH-002/003 | 高 | 外部 IdP 連携 |
| MFA | 3 | AUTH-004 | 中 | TOTP 二要素認証 |
| 条件分岐・並列承認 | 3 | WF-002/003 | 高 | ワークフローエンジン拡張 |
| SLA・自動エスカレーション | 3 | WF-005 | 高 | タイマー駆動の状態遷移、分散ロック |
| リアルタイム更新（WebSocket/SSE） | 4 | OPS-10 | 高 | Pub/Sub、Elm Ports 統合 |
| イベントソーシング + CQRS | 4 | OPS-10 | 高 | Event Store、結果整合性 |

### 推奨: 次に取り組む機能候補

1. Phase 2-5 の残り Story（#879, #884, #885, #886）の完了 — Phase 2 全体の完了に必要。バックエンド基盤は実装済みで、残りは連携・フロントエンド・インフラ
2. Phase 3 の SSO/MFA — 学習価値が高く、エンタープライズ機能の基盤。Phase 2 完了後の次ステップ

---

## 📊 Delivery（実行）

**バックログ**: オープン 16 件
- type:epic: 1（#406 Phase 2-5）
- type:story: 4（#879, #884, #885, #886 — すべて Phase 2-5）
- enhancement: 2（#683, #123）
- process: 2（#990, #848）
- idea: 3（#136, #389, #302）
- priority:low: 5、priority:medium: 1、ラベルなし: 3

**消化ペース**: 直近 30 日で 351+ 件クローズ（非常に高い開発速度）

**停滞**: 0 件（30日以上未更新なし）

### 注意が必要な Issue

| Issue | 状態 | 理由 |
|-------|------|------|
| #757 main ブランチの保護設定と Merge Queue | ラベルなし | 優先度未設定。セキュリティ観点で検討が必要 |
| #790 チェックボックス検証プロセスのスキル定義への組み込み | ラベルなし | 優先度未設定。プロセス改善系 |
| #915 Demo 環境のデータストア定期リセットとメンテナンス画面 | ラベルなし | 優先度未設定。インフラ系 |

---

## 🛡️ Sustainability（守り）

### コード健全性

- 大型ファイル（500行超）: 34 件（前回比 +18）
  - 1000行超のファイル:
    - `frontend/src/Page/WorkflowDefinition/Designer.elm`: 1965 行
    - `frontend/src/Page/Workflow/Detail.elm`: 1479 行
    - `backend/crates/domain/src/workflow/instance.rs`: 1392 行
    - `backend/apps/core-service/src/handler/document.rs`: 1390 行
    - `frontend/src/Page/Workflow/New.elm`: 1099 行
    - `backend/apps/core-service/src/usecase/workflow/command/decision/approve.rs`: 1052 行
- TODO/FIXME: 4 件（すべて domain 層の FIXME — 引数過多の改善予定）
  - `domain/src/folder.rs`: 2 件
  - `domain/src/document.rs`: 2 件
- 未使用依存: 0 件

### ドキュメント整合性

- 未実装マーカー: 31 箇所
  - 基本設計書: 14 箇所（主に Phase 4）
  - 詳細設計書: 17 箇所（Phase 2-4, 2-5, 3, 4）
  - 注意: `15_ワークフローデザイナー設計.md` が「未実装（Phase 2-4）」だが、実際には実装済み
- ADR 総数: 60 件（前回比 +16）
  - ADR 番号 047 に重複あり（2ファイルが同じ番号を使用）
- 改善記録（2月）: 100 件（前回比 +57。前回は 2/13 時点の中間値）
- README 鮮度: 2 件の乖離
  - 改善記録件数: README「93」→ 実数 110（+17 件の乖離）
  - ルールファイル数: README「23」→ 実数 26（+3 件の乖離）

### 依存関係

- Rust outdated: 0 件（全依存が最新）
- Frontend outdated: 0 件
- セキュリティ脆弱性: 0 件（`cargo deny check advisories` パス）

### テスト

- バックエンド統合テストファイル: 25 件（前回比 +7）
- API テストファイル（Hurl）: 42 件（前回比 +16）
- E2E テストファイル: 8 件（前回比 +5）

### プロセス

- 改善記録（2月）: 100 件（前回比 +57）
- セッションログ（2月）: 261 件（前回比 +169）
- 改善記録（3月）: 0 件（月初）
- セッションログ（3月）: 1 件

---

## 🎯 推奨アクション

| 優先度 | カテゴリ | アクション | 根拠 |
|--------|---------|---------|------|
| High | Improve | ロードマップの Phase 2-2〜2-4 完了基準を更新し、設計書の未実装マーカーを実態に合わせて更新する | ロードマップと実態が大幅に乖離。Phase 2-5 着手の前提条件の正確な把握に必要 |
| High | Maintain | 大型ファイル（1000行超）の分割を計画する。特に `Designer.elm`（1965行）、`Workflow/Detail.elm`（1479行）、`document.rs`（1390行） | 前回 16 件→34 件に倍増。1000行超が 6 件存在し、保守性に影響 |
| Medium | Feature | Phase 2-5 の残り Story（#879, #884, #885, #886）を完了させて Phase 2 を締める | Phase 2 のバックエンド基盤は完成しており、残りは連携・UI・インフラ |
| Medium | Improve | ADR 番号 047 の重複を解消する（片方をリナンバー） | ADR 命名規則の一貫性。参照時の混乱を防止 |
| Medium | Improve | README の数値を更新する（改善記録 93→110、ルールファイル 23→26） | 外部への情報提供が不正確 |
| Low | Improve | 優先度未設定の Issue（#757, #790, #915）にラベルを付与する | `/next` がラベルで優先度を判断するため |
| Low | Maintain | domain 層の FIXME 4 件（folder.rs, document.rs の引数過多）を解消する | 技術的負債。引数を値オブジェクトにまとめるリファクタリング |

---

## セルフレビュー記録

| ループ | 観点 | 修正内容 |
|-------|------|---------|
| 1回目 | データ正確性 | Phase 2-2〜2-4 の実装状態を、テストカバレッジ（E2E/API/統合テスト）の存在から「実質完了」と判定。ロードマップのチェックボックスだけでは過小評価になるため修正。ADR 番号 047 の重複を検出し追記 |
| 1回目 | 推奨の根拠 | 大型ファイル増加の推奨を「計画」に留めた（分割自体は別 Issue で管理すべき）。ロードマップ更新を High に引き上げた（実態との乖離が Phase 2-5 の作業判断に影響するため） |
