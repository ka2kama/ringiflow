# 設計ブラッシュアップループの形式知化

## 発生日時

2026-02-06

## 概要

Issue #267（ダッシュボードカードのナビゲーション）の設計フェーズで、初版の計画に複数のギャップが存在していたが、ブラッシュアップループを3回繰り返すことで全て解決できた。このプロセスを形式知化して今後の Issue にも適用可能にした。

## 事象

1. 初版の計画を作成 → ユーザーからギャップの洗い出しが不十分ではないかと指摘
2. ループ1: `Url.Parser.Query` の標準ライブラリ活用、Task API のフィルタ不要を発見
3. ループ2: `Iso8601.toTime` の利用可能性、`Nav.replaceUrl` の挙動を検証
4. ループ3: 6つの未定義・未決定ギャップを発見・解決（`completedTodayParser` 未定義、`applyFilter` の `Time.now` 矛盾、フィルタ優先順位、UI 仕様、`Url.Builder` 活用、ドロップダウン連動）
5. 設計判断が6個 → 10個に増加し、全ての挙動が一意に確定

## 根本原因

1. 既存の `zoom-rhythm.md` は「ギャップがゼロになるまでループする」と抽象的に記述していたが、具体的な手法（何をどう探すか）が記載されていなかった
2. 計画ファイルにループの記録を残す仕組みがなかったため、設計の思考過程が不可視だった
3. 「1回の俯瞰で全ギャップを発見できる」という暗黙の前提があったが、実際には複数回のループが必要

## 対策

`zoom-rhythm.md` に「設計ブラッシュアップループ」セクションを追加:

1. ループの具体プロセス（6ステップ）を定義
2. ギャップ発見の観点（6カテゴリ）を定義
3. 完了基準を明示（3つの客観的基準）
4. 計画ファイルの必須要素にブラッシュアップループの記録を追加

## 学び

- 設計は1回で完成しない。**複数回のブラッシュアップを経ることを前提とすべき**
- ギャップ発見には体系的な観点（未定義、曖昧、競合、状態漏れ、アーキテクチャ矛盾、車輪の再発明）が有効
- ループ記録は単なるドキュメントではなく、設計品質の証跡
- 設計を詰め切った場合、実装中の変化は「調整」レベルで済む

## 関連

- [俯瞰・実装リズム](../../.claude/rules/zoom-rhythm.md)
- [設計フェーズにおける理想駆動の省略](./2026-02-05_2335_設計フェーズにおける理想駆動の省略.md)
- [自己検証ループの自動実行欠如](./2026-02-05_2100_自己検証ループの自動実行欠如.md)

## 分類

- カテゴリ: 単一パス検証
- 失敗タイプ: プロセスギャップ
- 問題の性質: プロセス的

## 検証（対策実行後に追記）

- 実施日: 2026-02-07
- 対策の実行状況: 実行済み
- 効果: `.claude/rules/zoom-rhythm.md` に「設計ブラッシュアップループ」セクションを追加。具体プロセス（6ステップ）、ギャップ発見の観点（6カテゴリ）、完了基準（3つの客観的基準）、ループ記録テンプレートが定義された。これにより設計段階の品質が構造的に担保されるようになった。以降の全計画ファイルでループ記録が実施されており、対策の効果が確認できる。
- 備考: なし
