# APPROVED レビューコメントの見落とし

## 事象

review-and-merge スキル実行時、APPROVED の Auto Review コメント（軽微な改善提案を含む）を見落とし、CHANGES_REQUESTED の Rules Check コメントだけを確認した。ユーザーが URL で指摘して初めて Auto Review のコメントに気づいた。

## 原因分析

### 直接原因

スキルの Step 3 で PR レベルコメント取得に `| last` を使用しており、claude[bot] の最新コメント1件のみを取得していた。Auto Review コメントが Rules Check コメントより先に投稿されたため、取得対象外になった。

### 構造的原因

Claude Auto Review と Claude Rules Check は別ワークフローとして動作し、それぞれが独立した PR コメントとレビューを投稿する。スキルは claude[bot] からのコメントが1件であることを前提に設計されていた。

レビュー状態の取得（reviews API）も同様に `| last` を使用しており、複数レビュー（APPROVED + CHANGES_REQUESTED）の全体像を把握できなかった。

## 対策

スキルの Step 3 を修正し、全コメント・全レビューを取得する構造に変更した。

### 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `.claude/skills/review-and-merge/SKILL.md` | `| last` を削除、提示フォーマットを複数コメント対応に更新 |

## 分類

- カテゴリ: 知識-実行乖離（複数ワークフローの存在は既知だが、スキルの取得ロジックに反映されていなかった）
- 失敗タイプ: プロセスギャップ（スキル自体が単一コメント前提で設計されていた）
- 問題の性質: 技術的

## 検証（対策実行後に追記）

- 実施日: 2026-02-11
- 対策の実行状況: 実行済み
- 効果: `/review-and-merge` スキルの Step 3 から `| last` を削除し、全コメント・全レビューを取得する構造に変更された。レビューコメントの見落としは再発していない
- 備考: なし
