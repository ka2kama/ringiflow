# 往復のリズムが機能しない構造的原因

## 事象

zoom-rhythm.md の「往復のリズム」セクションが実装中に機能していなかった。

セッションログの実装セクションは「やったことの列挙」になっており、TDD Refactor で視点を上げた痕跡がない。改善記録には「実装中に俯瞰していれば防げた」インシデントが複数ある（OpenAPI 仕様突合漏れ、E2E 視点欠如、YAGNI 拡大解釈など）。

一方、同じ zoom-rhythm.md 内のブラッシュアップループは計画ファイル全件で実施記録があり、強く機能している。

## 原因分析

### 直接原因

往復のリズムは「視点を上げろ」「発見を言語化せよ」という**抽象的な行動規範**であり、AI エージェントにとって実行可能な指示になっていなかった。

### 構造的原因: ブラッシュアップループとの対比

ブラッシュアップループが機能する理由を分析すると、3つの要素が揃っている:

| 要素 | ブラッシュアップループ | 往復のリズム |
|------|---------------------|-------------|
| 明確なトリガー | 計画初版完成後 | 「Refactor ステップで」（曖昧） |
| 構造的な強制力 | 成果物要件（計画ファイルに記載必須） | なし |
| 観測可能な成果物 | ループ記録テーブル | なし |

往復のリズムは3つとも欠けていた。

### 根本原因: 行動規範と成果物要件の区別

ルールが機能するかどうかの分水嶺は「成果物要件化」にある。

- 行動規範（「〜すべき」）: 守っても守らなくても外から見えない → 機能しない
- 成果物要件（「〜が記載されていること」）: 欠落が構造的に検出可能 → 機能する

### Want の分析

Want: Ready for Review 時点の最終品質を最大限高めたい。

品質には「守り」（欠陥除去、マイナス→ゼロ）と「攻め」（改善機会の統合、ゼロ→プラス）がある。

- 守り: ブラッシュアップループ（設計段階）+ 品質チェックリスト（RfR）で概ねカバー済み
- 攻め: 実装中に「こっちの方がいい」と気づく機会をキャプチャする仕組みがなかった

品質チェックリストに既に「品質向上の最終確認（ゼロ→プラス）」の観点（シンプルさ、型の活用、責務の明確さ）があるが、RfR でしか適用されていなかった。問題は原則の不在ではなく、**適用タイミングが遅すぎる**こと。

## 対策

TDD Refactor ステップを「きれいにする」から「設計を改善する」に再定義し、**設計原則レンズ**を導入した。

### 設計原則レンズ

品質チェックリストの「ゼロ→プラス」と同一の設計原則を、Refactor ステップに移植:

| タイミング | レンズ | 由来 |
|-----------|--------|------|
| 毎 Refactor | Simple Design（意図・重複・最小性） | Kent Beck の Simple Design rules |
| モジュール/関数完成時 | SRP・DIP・型の活用 | SOLID 原則 |
| Phase 完了時 | 全レンズ + 品質チェックリスト | 区切りでの全体俯瞰 |

発見があった場合のみ判断ログに記録する。

### 変更したファイル

- `docs/60_手順書/04_開発フロー/02_TDD開発フロー.md`: Refactor セクションに設計原則レンズを追加
- `.claude/rules/zoom-rhythm.md`: 往復のリズムセクションを具体化、品質を守る二つの砦の図を更新
- `CLAUDE.md`: 俯瞰テーブルを設計原則レンズへの参照に更新

### パターン

ブラッシュアップループの成功パターンを実装フェーズに転写:

- 抽象 → 具体: 「視点を上げろ」→「この問いに答えろ」
- 曖昧なトリガー → 明確なトリガー: 「Refactor で」→「毎 Refactor / モジュール完成時 / Phase 完了時」
- 記録なし → 発見時のみ記録: ノイズなく、かつ可視化される

## 分類

- カテゴリ: 知識-実行乖離（往復のリズムの知識は存在したが、実行フローに組み込まれていなかった）
- 失敗タイプ: プロセスギャップ（プロセス自体が抽象的すぎた）
- 問題の性質: プロセス的

## 検証（対策実行後に追記）

- 実施日: 2026-02-09
- 対策の実行状況: 実行済み
- 効果: `docs/60_手順書/04_開発フロー/02_TDD開発フロー.md` の Refactor セクションに「設計原則レンズ」を追加。Kent Beck の Simple Design rules と SOLID 原則に基づく具体的な問いが、タイミング別（毎 Refactor / モジュール完成時 / Phase 完了時）に定義された。`.claude/rules/zoom-rhythm.md` の往復のリズムセクションが設計原則レンズへの参照に更新され、抽象的な行動規範から具体的な実行プロセスに変わった。また、`.claude/rules/pre-implementation.md` に確認事項セクションの必須化が追加され、実装前の型・パターン・API 確認が構造化された。
- 備考: なし
