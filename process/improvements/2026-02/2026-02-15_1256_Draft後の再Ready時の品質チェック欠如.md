# Draft 後の再 Ready 時の品質チェック欠如

## 事象

PR #536 で、Draft に戻した後に audit_log 対策を追加したコミット（37ff398）に対して、`just check-all` を実行せずに Ready for Review に戻した。その結果、CI で Clippy が失敗した（`audit_log_repository_test.rs:54` の不要な `mut`）。

### タイムライン

| # | イベント | 品質チェック |
|---|---------|-------------|
| 1 | Phase 1 実装完了 | ✅ `just check-all` 実行済み |
| 2 | PR 完了フロー実行 → Ready for Review | ✅ フロー完了 |
| 3 | Issue #540 発見 → Draft に戻す | - |
| 4 | audit_log 対策実装（37ff398） | ❌ **check-all なし** |
| 5 | 改善記録作成 → Ready に戻す | ❌ **check-all なし** |
| 6 | CI 失敗（Clippy エラー） | - |

## 原因分析

### 1. プロセスの不備

現在の PR 完了フロー（`CLAUDE.md`）は、初回 Ready for Review までの手順のみ定義されている。Draft に戻した後、再度 Ready にする際の品質ゲートが明確でない。

```
現在のフロー:
1. 実装完了、just check-all 通過
2. 収束確認完了
3. Draft PR 作成
4. /wrap-up
5. wrap-up 完了の検証
6. base branch 同期確認
7. ユーザーに確認
8. gh pr ready

→ Draft に戻した後の手順が定義されていない
```

### 2. 思い込み

ユーザーが実装したコードに対して、品質チェックを実行する必要性を認識していなかった。他者のコードはチェック済みという誤った前提。

### 3. 状態管理の欠如

Draft → 修正 → Ready の状態遷移において、「Ready にする前の必須条件（品質ゲート通過）」が明確でなかった。

## 対策

### 成果物要件

PR 完了フローに「Draft 後の再 Ready フロー」を追加する:

```markdown
## Draft に戻した後、再度 Ready にする場合

1. 修正・追加コミットを実施
2. **`just check-all` で品質ゲート通過**
3. base branch 同期確認（必要な場合）
4. ユーザーに確認
5. `gh pr ready`

禁止: 品質ゲートを通過せずに Ready for Review に戻すこと
```

### 原則の明確化

- **Ready for Review の前には必ず `just check-all` を実行する**（例外なし）
- コミットの作成者（自分 / ユーザー）に関わらず、品質チェックは必須
- Draft に戻した = 品質保証がリセットされた状態

## 次のアクション

- [x] PR 完了フロー（`CLAUDE.md`）に「Draft 後の再 Ready フロー」を追加する（Issue #545）

## 分類

- カテゴリ: 知識-実行乖離
- 失敗タイプ: プロセスギャップ
