# 品質ゲートでの wrap-up 未実施

## 事象

PR #863（rust-script テスト自動化）を `/wrap-up` を実施せずに Ready for Review にしてマージした。品質ゲートの 6.2（品質チェックリスト）〜 6.4（計画ファイル確認）をスキップし、6.1（`just check-all`）通過後に直接 6.5（プッシュ）以降に進んだ。

結果として、セッションログの作成と計画ファイル（`dynamic-meandering-donut.md`）のリネームが PR に含まれなかった。

## 原因分析

### Want

品質の追求。品質ゲートは各 PR が規定の品質水準を満たすことを保証するプロセス。

### To-Be

品質ゲート 6.1 → 6.2 → 6.3 → 6.4 を順に通過してから 6.5 以降に進む。6.2 の品質チェックリストで「セッションログが作成されているか」を確認し、未作成であれば作成してからコミットする。

### As-Is

`just check-all`（6.1）通過後、品質チェックリスト（6.2）を参照せず、Ready for Review → マージまで一気に実行した。

### ギャップ

品質ゲートの 6.2〜6.4 がスキップされた。

### 根本原因

ユーザーの「y」（作業開始承認）を受けてタスク完了に向かう実行モードに入り、`just check-all` 通過を「品質ゲート通過」と同一視した。手順書を参照せずにフローを記憶ベースで実行した結果、手動確認ステップ（6.2〜6.4）が脱落した。

## 対策

問題の性質: プロセス的（手順スキップ、品質ゲート漏れ）

### 分析

品質ゲートの 6.2〜6.4 は手動確認ステップであり、6.1（自動チェック）との間にゲート機構がない。6.1 通過の「成功」が 6.5 以降への推進力を生み、手動ステップが脱落しやすい構造がある。

既存のルール:
- 品質チェックリスト 6.2: 「セッションログが作成されているか」を含む
- CLAUDE.md: 「wrap-up 完了を検証せずに Ready にすること」を禁止

既存ルールは十分に明確。問題は参照されなかったこと。

### 対策形式の検討

| 形式 | 案 | 評価 |
|------|-----|------|
| 行動規範 | 「品質ゲート時に手順書を参照する」 | 低（今回と同じ脱落が再発しうる） |
| 成果物要件 | Self-review の「設計・ドキュメント」にセッションログの具体パスを必須化 | 中（パスを書くために実際にファイルを作成する必要がある） |
| フロー組み込み | `just check-all` 通過後に品質チェックリストの URL を表示する仕組み | 高（ただし実装コストとのバランス） |

成果物要件への転換を採用する。Self-review の「設計・ドキュメント」カテゴリで、セッションログやADRのパスを具体的に記載することを要求する。「セッションログ作成済み」（検証不能な主張）ではなく `セッションログ: prompts/runs/2026-02/xxx.md`（検証可能な成果物）を要求する形式にする。

## 次のアクション

- [ ] Self-review の「設計・ドキュメント」カテゴリの記載例を、具体的なファイルパスを含む形式に更新する（Issue #867）

## 分類

- カテゴリ: 参照漏れ
- 失敗タイプ: 実行ギャップ
- 問題の性質: プロセス的
