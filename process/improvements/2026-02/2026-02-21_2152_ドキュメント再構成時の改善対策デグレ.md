# ドキュメント再構成時の改善対策デグレ

## 事象

PR #589 で CLAUDE.md の PR 完了フローに追加した「計画ファイル確認ステップ」が、その後の CLAUDE.md リファクタリング（PR 完了フロー → Issue 駆動開発の品質ゲートフローへの統合）で消失していた。PR #766（#765）作業中に同じ問題（計画ファイルのコミット漏れ）が再発し、発覚。

元の改善記録: [plan モード後のコンテキスト喪失による計画ファイルのコミット漏れ](2026-02-16_2301_planモード後のコンテキスト喪失による計画ファイルのコミット漏れ.md)

## 原因分析

### 直接原因

CLAUDE.md のリファクタリング（PR 完了フロー → Issue 駆動開発の品質ゲートフローへの統合）時に、改善対策として追加されたステップが移行先に含まれなかった。

### 根本原因

改善対策がドキュメントの一部として埋め込まれているが、配置先ドキュメントから改善記録への逆方向リンクがない。そのため、ドキュメント再構成時に「この行は改善対策として追加されたもの」という情報が失われ、通常の文章と区別できない。

コードにはテスト（デグレ検出メカニズム）があるが、ドキュメントに埋め込まれた改善対策には同等の仕組みがない。

### 構造的な問題

| 要素 | コード | ドキュメント埋め込み対策 |
|------|--------|----------------------|
| 変更の追跡 | git diff で変更が可視化 | git diff で変更が可視化 |
| デグレ検出 | テストが失敗する | 検出する仕組みがない |
| 出自の識別 | 実装理由がコミットメッセージ・PR に記録 | 改善記録→配置先の片方向リンクのみ |

## 対策

### 問題の性質: プロセス的

ドキュメント再構成時に改善対策のデグレを検出するプロセスがない。

### 対策案: 改善対策の逆方向リンク（成果物要件）

改善対策をドキュメントに配置する際、配置箇所の近くに改善記録への逆方向リンクをコメントとして追加する。

```markdown
<!-- 改善: process/improvements/YYYY-MM/ファイル名.md -->
追加されたステップやルールの記述
```

効果:
- ドキュメント再構成時に「この行は改善対策」と識別できる
- 改善記録を参照することで、なぜこのステップが必要かを確認できる
- 通常のドキュメント変更と改善対策を区別できる

適用範囲:
- 今後の新規対策配置: 必須
- 既存の 27 件の対策: 段階的に追加（任意）

### 対策形式の検証

| 対策 | 形式 | 検証 |
|------|------|------|
| 逆方向リンクの追加 | 成果物要件 | 改善対策配置時にコメントが存在すること |

行動規範（「ドキュメント再構成時に注意する」）ではなく、成果物要件（「コメントが存在すること」）として設計。フロー組み込み（CI での自動検証）も検討可能だが、まず成果物要件として導入し、効果を確認してから自動化を検討する。

## 次のアクション

- Issue #767 で対策を実装

## 分類

- カテゴリ: 視点不足
- 失敗タイプ: プロセスギャップ
- 問題の性質: プロセス的
