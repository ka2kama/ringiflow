# 計画ファイルの確認事項チェック漏れの頻発

**日時**: 2026-02-20 21:00
**発生場面**: PR #733 の Rules Check で再度指摘

## 何が起きたか（As-Is）

計画ファイル（`prompts/plans/*.md`）の「確認事項」セクションで、チェックボックスが未チェック（`- [ ]`）のまま PR が Ready for Review になるケースが繰り返し発生している。

- 計画ファイル 170 件中、チェックボックス 1,874 個のうち 66.9%（1,254 個）が未チェック
- PR #733 でも 17 項目が未チェックのまま品質ゲートに到達
- 改善記録 2026-02-11 で「成果物要件への転換」を提案、ルールに反映済み
- にもかかわらず改善されていない

## どうあるべきだったか（To-Be）

各 Phase の確認事項が Phase 開始時にチェックされ、確認結果が 1 行で記録されている状態。

## なぜこうなったか（ギャップ分析）

### 成功しているプロセスとの比較

| プロセス | タイミング | 実施率 | 特徴 |
|---------|----------|--------|------|
| ブラッシュアップループ | 計画作成時に完結 | 高い | 書く時点で完了する |
| 確認事項チェック | 計画時に `[ ]` → 実装時に `[x]` | 低い | 2つの異なるタイミングにまたがる |

### 根本原因

1. **時間的ギャップ**: 確認事項は「計画時に `[ ]` を書く」と「実装開始時に `[x]` に更新する」の 2 ステップが異なるタイミングにまたがる。AI エージェントは実装開始時にテストを書くことに集中し、計画ファイルに戻るステップが抜ける
2. **ルール追加の限界**: `pre-implementation.md` と `zoom-rhythm.md` にルールを追加済みだが、「行動規範 → 成果物要件化 → 成果物要件も守れない」の再帰に陥っている
3. **自動検証の欠如**: チェックボックスの状態を検証する仕組みがなく、Claude Code Action の Rules Check が唯一の検出手段だった（事後的・PR 単位）

## 対策

### 自動検証スクリプトの追加（本セッション）

`scripts/check/plan-confirmations.sh` を作成し、`just check` → `just check-all` のパイプラインに統合。main との差分で変更された計画ファイルの `#### 確認事項` セクション内にある未チェック `- [ ]` を検出してエラーにする。

PR: #735

### フォーマット変更の検討（将来）

チェックボックスの `[ ]` → `[x]` 方式は AI エージェントにとって「状態遷移」を要求するフォーマットであり、忘れやすい。計画作成時に確認を完結させてチェックボックスを廃止するフォーマット変更を検討する余地がある。ただし本セッションでは lint による自動検出を優先した。

## 分類

- カテゴリ: 知識-実行乖離
- 失敗タイプ: 実行ギャップ
- 問題の性質: プロセス的

## 関連

- PR: #733（直近の発生）, #735（対策）
- 改善記録: [計画ファイルの確認事項を実装時に実施しなかった](2026-02-11_2247_計画ファイルの確認事項を実装時に実施しなかった.md)
- 改善記録: [Test plan チェックボックスの形骸化](2026-02-14_2130_Test-planチェックボックスの形骸化.md)
