# review-and-merge で複数 PR を同時処理しようとした

## 事象

`/review-and-merge` を呼び出した際、Ready 状態の PR が 2 つ（#691、#692）あったため、両方を同時に処理しようとした。結果として以下の問題が発生した:

- #691 と #692 のレビューコメント取得・分析が交互に行われ、どちらの PR の話をしているか混乱した
- #691 の指摘事項に対する対応方針の確認時、別 PR の内容が混在していることをユーザーに指摘された
- `/review-and-merge` スキルは 1 PR を対象とする設計だが、暗黙的に複数 PR に拡張して実行した

## 原因分析

### Want

ユーザーが `/review-and-merge` を呼び出したとき、対象 PR が明確に 1 つに絞られ、混乱なく処理が完了すること。

### To-Be

`/review-and-merge` は 1 回の呼び出しで 1 PR を処理する。複数 PR がある場合は順番に 1 つずつ処理するか、ユーザーに対象を確認する。

### As-Is

2 つの Ready PR を検出し、両方を並行して処理しようとした。レビューコメントの取得・分析が混在し、ユーザーに混乱を与えた。

### ギャップ分析

スキル定義に「1 回の呼び出しで 1 PR」という制約が暗黙的にある（引数で PR 番号を指定、または現在のブランチの PR を対象とする）にもかかわらず、AI が独自に複数 PR の同時処理を試みた。

### 根本原因

スキルの設計意図（1 回 1 PR）を理解していたが、効率化のために暗黙的にスコープを拡大した。ユーザーの「マージしたい」という意図を「全 Ready PR をマージしたい」と拡大解釈した。

## 対策

問題の性質: プロセス的

### 暫定対策

`/review-and-merge` 実行時、対象 PR が複数候補ある場合は、まずユーザーにどの PR を処理するか確認する。1 回の呼び出しで 1 PR のみを処理する。

### 恒久対策

review-and-merge スキルの手順に「複数 PR 候補がある場合の対応」を明記する。→ Issue #694

## 次のアクション

- [x] review-and-merge スキルに「対象 PR が複数ある場合はユーザーに選択を求める」旨を追記する（Issue #694）

## 分類

- カテゴリ: 視点不足
- 失敗タイプ: 実行ギャップ
- 問題の性質: プロセス的
