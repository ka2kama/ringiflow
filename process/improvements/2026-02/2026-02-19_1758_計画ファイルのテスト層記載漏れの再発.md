# 計画ファイルのテスト層記載漏れの再発

## 事象

PR #707 の Claude Rules Check で、計画ファイル（`prompts/plans/689_lifecycle-usecase-transaction.md`）の Phase 3 テストリストに「ユニットテスト」層が省略されていると指摘された。

`zoom-rhythm.md` には「暗黙の省略を防ぐため、層を丸ごと省略してはならない」と明記されている。Phase 1・2 では「ユニットテスト（該当なし — 既存テストが引き続きパス）」と正しく記載されていたが、Phase 3 で統合テストに注力した結果、ユニットテスト層の「該当なし」記載が漏れた。

これは [テストリストがユニットテスト層のみをカバー](2026-02-11_1731_テストリストがユニットテスト層のみをカバー.md) の対策として導入したルールが、導入後も守られなかった再発事例。

## 原因分析

### 直接原因

Phase 3 のテストリスト作成時に、統合テストのテスト設計（6 ステップの詳細なシナリオ）に注意が向き、全テスト層の網羅確認を省略した。

### 構造的原因

テスト層の網羅性チェックがルール文書（zoom-rhythm.md）のみに依存しており、構造的な強制力がない。現状のチェック体制:

| チェックポイント | 検出できるか |
|----------------|------------|
| ルール文書（zoom-rhythm.md） | AI が参照した場合のみ |
| 設計ブラッシュアップループ | ギャップ発見の観点に含まれていない |
| 品質チェックリスト | 計画ファイルの形式は対象外 |
| Claude Rules Check（CI） | 検出可能（今回はここで検出） |

Claude Rules Check が最後の砦として機能しているが、CI でのフィードバックサイクルは遅い。plan mode 終了前にローカルで検出できる仕組みがない。

## 対策

問題の性質: プロセス的（ルールは存在するが、フローに組み込まれた強制力がない）

### 1. 設計ブラッシュアップループの「ギャップ発見の観点」にテスト層網羅を追加（成果物要件）

`zoom-rhythm.md` のギャップ発見の観点（欠陥の発見）に「テスト層網羅漏れ」を追加し、ブラッシュアップループで体系的に検出できるようにする。

→ Issue #710

### 2. CI（Rules Check）での検出は現状維持

Claude Rules Check が最後の砦として今回正しく機能した。追加の対策は不要。

## 次のアクション

1. `zoom-rhythm.md` のギャップ発見の観点にテスト層網羅チェックを追加（Issue #710）

## 分類

- カテゴリ: 単一パス検証
- 失敗タイプ: 実行ギャップ
- 問題の性質: プロセス的
