# エラーメッセージのみで判断し実際の状態を確認しない

## 事象

PR #536 の CI エラー調査で、GitHub Actions のエラーメッセージ「mozilla-actions/sccache-action@v0.0.9 is not allowed」を見て、実際の GitHub Settings を確認せずに「許可設定が不足している」と誤った判断をした。

### 調査の流れ

| ステップ | 私の行動 | 問題点 |
|---------|---------|--------|
| 1 | CI エラーメッセージを確認 | エラーメッセージを絶対的な真実として扱った |
| 2 | ナレッジベースの記載を確認 | ✅ 正しいステップ |
| 3 | 「GitHub Settings に追加されていない」と推測 | ❌ **実際の設定を確認しなかった** |
| 4 | 対策を提案（手動で設定追加） | 誤った対策 |
| 5 | ユーザーから設定の実際の確認を指摘された | - |
| 6 | `gh api` で実際の設定を確認 | 許可設定は既に存在していた |

**実際**: `mozilla-actions/sccache-action@*` は何日も前に GitHub Settings に追加済みだった。

## 原因分析

### 1. エラーメッセージの過信

エラーメッセージを「現状を正確に反映した情報」として無批判に受け入れた。エラーメッセージは以下の可能性がある:

- 古い情報（キャッシュ、タイムラグ）
- 誤った情報（バグ、不正確な判定）
- 文脈依存（特定条件下でのみ真）

しかし、これらの可能性を考慮せず、エラーメッセージを絶対視した。

### 2. 確認手段の未使用

実際の状態を確認する手段（`gh api /repos/{owner}/{repo}/actions/permissions/selected-actions`）が存在したが、最初から使わなかった。

### 3. 推測による判断

「ナレッジベースに記載されている → GitHub Settings には追加されていないはずだ」という推測で判断を進めた。「〜のはずだ」は検証が必要なサインだが、検証しなかった。

### 4. 同じパターンの繰り返し

- Issue #540 の調査: 「Phase 1 とは無関係のはずだ」→ 実際には間接的に関係していた
- 今回: 「許可設定がないはずだ」→ 実際には既に存在していた

「推測で判断 → 実際の状態を確認しない」というパターンが繰り返されている。

## 対策

### フロー組み込み

問題調査プロセスに「実際の状態確認」ステップを必須化する。

```markdown
## 問題調査の必須ステップ

1. エラーメッセージを確認（仮説として扱う）
2. **実際の状態をソースデータで確認**
   - エラーメッセージが指摘する対象の実際の値・設定を取得
   - 推測ではなく、コマンド・API で取得した事実を使用
3. エラーメッセージと実際の状態を照合
4. 差異があれば、なぜ差異が生じたかを分析
5. 根本原因を特定
6. 対策を設計

禁止: エラーメッセージのみを根拠に原因を断定すること
```

### 原則の明確化

- **エラーメッセージは仮説であり、真実ではない**
- **推測（「〜のはずだ」）は検証が必要なサイン**
- **確認手段が存在するなら、必ず使用する**

### 具体的な確認手段の明示

よくある問題パターンごとに、確認手段を明示する:

| 問題 | エラーメッセージの例 | 実際の状態の確認手段 |
|------|---------------------|---------------------|
| GitHub Actions 許可設定 | "action is not allowed" | `gh api /repos/.../actions/permissions/selected-actions` |
| 環境変数の不足 | "environment variable not set" | `env`, `printenv`, コンテナ内で直接確認 |
| ファイルの不存在 | "file not found" | `ls`, `find`, `Read` ツール |
| 依存関係の不足 | "package not found" | `cargo tree`, `pnpm list`, パッケージマネージャの状態確認 |

## 次のアクション

- [x] 技術的トラブルシューティングの基本原則をドキュメント化する（Issue #546）
  - `.claude/rules/troubleshooting.md` を新規作成
  - または既存の適切なルールファイルに追加

## 分類

- カテゴリ: 即座の対策
- 失敗タイプ: 実行ギャップ
- 問題の性質: 思考的
