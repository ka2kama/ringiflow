# TODO/FIXME のライフサイクル管理不在

## 事象

ソースコード内の TODO/FIXME コメントを棚卸ししたところ、以下の問題が発見された:

1. `FIXME(#688)` がクローズ済み Issue（2026-02-19 クローズ）を参照したまま残存（`backend/apps/core-service/src/usecase/workflow.rs:127`）
2. Issue 未追跡の TODO が 2 件存在（`frontend/src/Page/Workflow/New.elm:807`、`frontend/src/Page/Home.elm:114`）

#688 はトランザクション化の Issue であり、FIXME の内容（deps 構造体統合による too_many_arguments 解消）は Issue のスコープ外だった。Issue クローズ時にコード内の参照が確認されなかったため、陳腐化した参照が残存した。

## 原因分析

### Want

品質の追求。コード内のアノテーションが正確に Issue と紐づき、追跡可能であること。

### To-Be

Issue クローズ時に、その Issue を参照する TODO/FIXME が棚卸しされ、解消済みなら削除、未解消なら新 Issue に参照が更新される。

### As-Is

Issue クローズ時に関連 TODO/FIXME を確認するフローが存在しない。TODO/FIXME に Issue 番号を付ける規約はあるが、参照先 Issue のライフサイクルとの連動が未定義。

### ギャップ

TODO/FIXME の作成時のルール（code-annotations.md）は整備されているが、ライフサイクル管理（参照先 Issue クローズ時の棚卸し）が欠如している。

### 根本原因

code-annotations.md が「作成」のみを規定し、「維持・解消」のフェーズを定義していなかった。Issue 駆動開発フロー Step 9（振り返り）に改善記録の検証はあるが、TODO/FIXME の棚卸しは含まれていなかった。

## 対策

問題の性質: プロセス的（フロー不備）

### 分析

手動フローの追加だけでは知識-実行乖離パターンに該当し、再発リスクが高い。プロジェクトの「改善記録 → lint 自動検証」パターン（#843, #845）に従い、ハイブリッド方針（プロセス改善 + 自動 lint）を採用する。

### 対策形式の検討

| 形式 | 案 | 評価 |
|------|-----|------|
| 行動規範 | 「Issue クローズ時に TODO/FIXME を確認する」 | 低（知識-実行乖離パターン） |
| 成果物要件 | 振り返りコメントに「TODO/FIXME 棚卸し結果」を含める | 中（手動で漏れる可能性） |
| フロー組み込み | lint スクリプトで自動検出 + プロセスドキュメント更新 | 高（自動 + 手動の二重ネット） |

フロー組み込みを採用する。

### 具体的な対策

1. `scripts/check/stale-annotations.sh` を作成し、クローズ済み Issue を参照する TODO/FIXME を自動検出する
2. `just check` に組み込み、プッシュ前に自動実行される
3. `code-annotations.md` にライフサイクルセクションを追加する
4. Issue 駆動開発フロー Step 9 に TODO/FIXME 棚卸しステップを追加する

## 次のアクション

- [ ] 未追跡 TODO/FIXME を Issue 化し、アノテーションを更新する
- [ ] `scripts/check/stale-annotations.sh` を作成する
- [ ] `code-annotations.md` にライフサイクルルールを追加する
- [ ] Issue 駆動開発フロー Step 9 に棚卸しステップを追加する

## 分類

- カテゴリ: 知識-実行乖離
- 失敗タイプ: プロセスギャップ
- 問題の性質: プロセス的
