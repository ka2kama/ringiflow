# 長時間コマンドのパイプ実行再発

## 事象

`just check-all` のバックグラウンドタスク（b85adff）が既に正常完了していたにもかかわらず、結果を Read で確認せず `just check-all 2>&1 | tail -30` をフォアグラウンドで新たに実行した。長時間コマンドの全出力を `tail` が待機し、ハングした。ユーザーが手動で中断した。

前回の改善記録: [バックグラウンドタスク出力待ちの長時間ブロック](2026-02-11_2123_バックグラウンドタスク出力待ちの長時間ブロック.md)

## 原因分析

1. 既存ルール `long-running-commands.md` はバックグラウンド実行時のパイプ禁止を規定しているが、フォアグラウンドでも同じ問題が発生する。長時間コマンドを `tail` にパイプすると、コマンド完了まで `tail` が出力を保持するため実質ハングする
2. コンテキスト継続セッションで、バックグラウンドタスクの完了通知がまだ届いていない段階で、代替手段として新規実行を選択した。しかし完了済みの出力ファイルを Read で確認すれば済む状況だった
3. 前回の改善で `long-running-commands.md` にルールを形式知化したが、ルール文面が「バックグラウンド実行時は」と限定しており、フォアグラウンドの長時間コマンドには暗黙的にしか適用されなかった

## 対策

問題の性質: プロセス的（既存ルールのスコープが不十分）

### 対策形式の検証

| 対策案 | 形式 | 有効性 |
|--------|------|--------|
| ~~「パイプ付きコマンドを実行する前に確認する」~~ | 行動規範 | 低 |
| `long-running-commands.md` のルール文面を拡張し、フォアグラウンドも含む一般的な禁止に変更する | 成果物要件 | 高 |

### 採用する対策

`long-running-commands.md` の「バックグラウンド実行時はパイプを使わない」を、長時間コマンド全般に拡張する。フォアグラウンドで `command | tail` を実行しても、コマンド完了まで出力が保留される点は同じである。

## 次のアクション

- [x] `long-running-commands.md` のセクション1を修正し、バックグラウンド限定からフォアグラウンドも含む一般ルールに拡張する（Issue #660）

## 分類

- カテゴリ: 知識-実行乖離（ルールは存在するが、スコープが限定的で今回のケースをカバーしていなかった）
- 失敗タイプ: プロセスギャップ（ルール自体のスコープが不十分）
- 問題の性質: プロセス的
