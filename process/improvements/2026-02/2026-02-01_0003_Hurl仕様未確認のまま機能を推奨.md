# Hurl 仕様未確認のまま機能を推奨

## 事象

Issue #196 の Hurl API テスト修正時に、以下の流れで問題が発生した:

1. `initiated_by` フィールドが `String` → `UserRef` オブジェクトに変更されたため、Hurl のアサーション更新が必要になった
2. ユーザーから「個別フィールド検証ではなくオブジェクト一括比較できないか」と質問された
3. AI が「Hurl はインライン JSON オブジェクトとの比較をサポートしている」と回答し、一括比較の書き方を推奨した
4. CI でパースエラーが発生（`invalid predicate value`）
5. CI のバージョン差異（6.1.1 vs 7.1.0）が原因と誤診し、CI のバージョンを更新してプッシュ
6. 再度 CI が失敗。ローカル（7.1.0）でも失敗することを確認
7. 公式ドキュメントで確認し、Hurl のプレディケート値がインラインJSONオブジェクト内の変数展開をサポートしていないことが判明

結果: 不要なコミット・プッシュが 2 回発生し、CI を 2 回無駄に失敗させた。

## 原因分析

1. 仕様を確認せずに推奨した: Hurl のプレディケート値の型（string, number, boolean, null, collection, binary）を公式ドキュメントで確認しなかった
2. ローカル検証を先に行わなかった: 推奨した構文をローカルでテストせずにコミット・プッシュした
3. 誤診による二重修正: CI の失敗原因をバージョン差異と断定し、別の修正（CI バージョン更新）を行ってさらに失敗を重ねた

根本原因: 「おそらくサポートしているだろう」という推測に基づいて提案を行った。

## 対策

### 暫定対策（実施済み）

- 個別フィールド検証（`jsonpath "$.data.initiated_by.id"` + `jsonpath "$.data.initiated_by.name"`）に修正

### 恒久対策

ツールの仕様に関する推奨を行う前に、以下の検証プロセスを踏む:

1. 公式ドキュメントでサポート状況を確認する
2. ローカルで動作確認してからコミットする
3. CI と ローカルのバージョン差異を認識し、両方で動作する書き方を選択する

これは一般的なベストプラクティスであり、CLAUDE.md への追記は不要と判断する（任意）。

## 次のアクション

なし（暫定対策で解決済み、恒久対策は行動規範レベルの改善）。

## 分類

- カテゴリ: 知識-実行乖離
- 失敗タイプ: 実行ギャップ

## 検証（対策実行後に追記）

- 実施日: 2026-02-02
- 対策の実行状況: 部分的
- 効果: 品質チェックリストに「技術的前提の確認」を追加（`.claude/rules/zoom-rhythm.md` の設計・計画フェーズチェックリスト項目5）。しかし、2026-02-02 に同じパターンが再発した（`--sequential` フラグの仕様未確認）。改善記録で「次のアクション: なし」とした場合に、構造的な余地が残っていないかを検証するステップが欠如していた。再発後、CI の Hurl バージョンをローカルと統一し、改善記録の「次のアクション: なし」を禁止するルールを強化した（Issue #216）。
- 備考: 再発の詳細は [Hurl 仕様未確認の再発と改善記録の形骸化](../2026-02/2026-02-02_1735_Hurl仕様未確認の再発と改善記録の形骸化.md) を参照
