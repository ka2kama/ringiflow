# 子 Issue 分割実装時の UI 操作テスト欠落

## 事象

ワークフローデザイナー画面（#405 Phase 2-4）の「検証」ボタンと「公開」ボタンが動作しない。

- 検証: API リクエストボディに `definition` ラッパーが欠落し、デシリアライズエラー
- 公開: ダイアログ ID のハードコード（`"designer-publish-dialog"`）が `ConfirmDialog.dialogId`（`"confirm-dialog"`）と不一致で、確認ダイアログが表示されない

子 Issue #722-#726 は全てクローズ済みだが、統合した状態での動作確認が行われておらず、バグが残存していた。

## 原因分析

### 直接原因

1. `validateDefinition` API 関数の `body : Encode.Value` 型が構造を強制しないため、呼び出し側が `definition` ラッパーなしで送信してもコンパイルが通った
2. `Ports.showModalDialog` に文字列リテラルをハードコードし、`ConfirmDialog.dialogId` 定数を使わなかった

### 構造的原因

Epic #405 を 5 つの子 Issue に分割して実装した際、個々の Issue のスコープ内ではテストが通っても、Issue をまたぐ統合部分（検証ボタン・公開ボタンの E2E 動作）のテストが計画されなかった。

| 子 Issue | スコープ | 検証・公開ボタンのテスト責任 |
|---------|---------|------------------------|
| #725 キャンバス+ステップ配置 | UI 描画、ドラッグ&ドロップ | ボタンは実装したが E2E テスト対象外 |
| #726 接続線・バリデーション | 接続線描画、バリデーション結果表示 | バリデーション API 呼び出しを実装したがテスト対象外 |

ボタンの実装と API 呼び出しの統合が Issue の境界をまたいでおり、どちらの Issue のテスト責任にも含まれなかった。

### 型の緩さ

`Api/WorkflowDefinition.elm` の `validateDefinition` が `body : Encode.Value` を受け取る設計。保存 API の `encodeUpdateRequest` は構造化されたレコードを受け取るため `definition` フィールドが自然に含まれるが、バリデーション API は構造を強制しない。

## 対策

### 1. 改善記録として残す（今回の対策）

同種の問題（子 Issue 分割時の統合テスト欠落）が再発した場合にルール化を検討する。

### 2. バグ修正（Issue #761）

- `encodeValidationRequest` 関数の追加でリクエストボディを正しくラップ
- ダイアログ ID を `ConfirmDialog.dialogId` に統一
- E2E テストの追加で今後の回帰を防止

## 次のアクション

- Issue #761 でバグ修正 + テスト追加

## 分類

- カテゴリ: 視点不足
- 失敗タイプ: プロセスギャップ
- 問題の性質: プロセス的
