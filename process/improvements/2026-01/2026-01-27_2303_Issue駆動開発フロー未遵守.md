# 2026-01-27 Issue 駆動開発フロー未遵守

## 事象

Issue #115 の Phase 3 実装において、AI エージェントが Issue 駆動開発の手順書を読まずにコード実装を開始しようとした。

経緯:
1. ユーザーが Issue #115 の続きから作業を指示
2. AI エージェントは Phase 2 の完了を確認し、Phase 3 の実装を開始
3. 手順書を読まず、いきなり `Page/Workflow/List.elm` を作成しようとした
4. ユーザーから Issue 駆動開発の手順参照が不足している点を指摘された

## 原因分析

### 直接原因

CLAUDE.md に「機能実装を開始する際は手順書のフローに従う」と記載されているが、AI エージェントがこの指示を実行しなかった。

### 根本原因

CLAUDE.md の該当箇所:

```markdown
## Issue 駆動開発

→ 詳細: [手順書: Issue 駆動開発](...)

1. Issue を確認または作成
...

AI エージェントへの指示:
- 機能実装を開始する際は、[手順書]のフローに従う（独自に手順を生成しない）
```

問題点:

| 問題 | 詳細 |
|------|------|
| 指示の位置 | セクション末尾の箇条書きに埋もれている |
| トリガーが不明確 | 「機能実装を開始する際」が何を指すか曖昧 |
| 行動が不明確 | 「フローに従う」ではなく「手順書を読む」と書くべき |

## 対策

CLAUDE.md の Issue 駆動開発セクションを改善する。

### 変更前

```markdown
## Issue 駆動開発

→ 詳細: [手順書: Issue 駆動開発](docs/04_手順書/04_開発フロー/01_Issue駆動開発.md)

1. Issue を確認または作成
...

AI エージェントへの指示:
- 機能実装を開始する際は、[手順書](docs/04_手順書/04_開発フロー/01_Issue駆動開発.md)のフローに従う（独自に手順を生成しない）
- 機能実装前に対応 Issue の存在を確認
- ブランチ名には Issue 番号を含める
- Phase やタスク完了時は Issue のチェックボックスを更新
```

### 変更後

```markdown
## Issue 駆動開発

**AI エージェントへの必須事項:**

機能実装の依頼を受けたら、**コードを書く前に**必ず [手順書](docs/04_手順書/04_開発フロー/01_Issue駆動開発.md) を読み、記載されたフローに従う。

**禁止:** 手順書を読まずに実装を開始すること

→ 詳細: [手順書: Issue 駆動開発](docs/04_手順書/04_開発フロー/01_Issue駆動開発.md)

1. Issue を確認または作成
...

補足:
- 機能実装前に対応 Issue の存在を確認
- ブランチ名には Issue 番号を含める
- Phase やタスク完了時は Issue のチェックボックスを更新
```

変更のポイント:
1. セクション冒頭に配置し、見落としを防ぐ
2. 「コードを書く前に」でトリガーを明確化
3. 「禁止」で境界を明示
4. 太字で強調

---

## 追加事象: PR を Draft なしで作成しようとした

### 事象

同セッション内で、顛末書の対応を別 PR として作成する際に、Draft PR ではなく通常の PR を作成しようとした。

### 原因

手順書に「ブランチ作成後、すぐに Draft PR を作成する」と記載されているが、AI エージェントがこの手順を実行しなかった。

### 対策

これは CLAUDE.md の Issue 駆動開発セクション改善で対応済み。「コードを書く前に手順書を読む」を明確にしたことで、PR 作成時も手順書を参照するようになる。

---

## 追加事象: recipe を自発的に作成しなかった

### 事象

セッション終了時に recipe の有無を確認された際、AI エージェントは:
1. 最初は「該当するものはない」と回答
2. 再度聞かれて「AI エージェントへの指示の書き方」と的外れな回答
3. さらに聞かれてようやく「worktree 環境でのブランチ作成」を思い出した

### 原因

CLAUDE.md のドキュメント自動作成ルールに「操作レシピ — 非自明な操作で問題解決、再利用可能なパターン発見」と記載されているが、AI エージェントがセッション中の操作を振り返って自発的に recipe を作成しなかった。

### 対策

CLAUDE.md のドキュメント自動作成ルールの指示を強化する必要がある。現状の記載:

```markdown
セッション中に以下に該当したら対応ドキュメントを作成:
- **操作レシピ** — 非自明な操作で問題解決、再利用可能なパターン発見
```

この指示はセクション末尾にあり、見落とされやすい。Issue 駆動開発セクションと同様に、セッション終了前にドキュメント作成ルールを確認するよう明示すべき。

---

## 次のアクション

- [x] CLAUDE.md の Issue 駆動開発セクションを改善する
- [x] CLAUDE.md のドキュメント自動作成ルールを改善する（Issue #156）
- [ ] 改善後、Issue #115 Phase 3 の実装を手順書に従って進める

## 分類

- カテゴリ: 参照漏れ
- 失敗タイプ: 実行ギャップ

## 検証（対策実行後に追記）

- 実施日: 2026-02-11
- 対策の実行状況: 実行済み
- 効果: CLAUDE.md の Issue 駆動開発セクションに「必須事項」「禁止」が冒頭配置され、以降のセッションで手順書の参照が定着している。ドキュメント自動作成ルールも改善された（#156）。同種の問題（手順書未参照で実装開始）の再発は確認されていない
- 備考: なし
