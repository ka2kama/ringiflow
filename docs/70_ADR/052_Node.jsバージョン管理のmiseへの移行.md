# ADR-052: Node.js バージョン管理の mise への移行

## ステータス

承認済み（2026-02-19）

## コンテキスト

プロジェクトでは Volta を使用して Node.js のバージョンを `package.json` の `volta` フィールドで固定していた（`node: "22.16.0"`）。しかし、Volta のメンテナンスが停止しており、新規参画者への推奨ツールとしての持続性に懸念がある。

一方、プロジェクトでは既に mise を以下の場面で活用していた:

- 開発環境構築ドキュメントで Node.js インストールの選択肢として記載
- just, pnpm, lefthook 等のグローバルツール管理
- [ADR-002](002_フロントエンドツールチェーンの選定.md) で `.mise.toml` による Elm ツール管理を言及

## 検討した選択肢

### 選択肢 1: mise に統合

Volta を廃止し、mise の `.mise.toml` でプロジェクトレベルのツールバージョンを管理する。

評価:
- 利点: 既に mise を使用しているため追加ツール不要、Node.js 以外（elm, elm-format）も一元管理可能
- 欠点: Volta ユーザーは mise への移行が必要

### 選択肢 2: Volta を継続使用

メンテナンス停止を受け入れて Volta を使い続ける。

評価:
- 利点: 変更不要
- 欠点: メンテナンスされていないツールへの依存、セキュリティリスク、新しい Node.js バージョンへの追従が不確実

### 選択肢 3: .node-version ファイル

`.node-version` ファイルで Node.js バージョンを指定する。多くのバージョンマネージャー（fnm, nvm, mise 等）が読み取り可能。

評価:
- 利点: ツール非依存、広い互換性
- 欠点: Node.js のみ。elm, elm-format のバージョン管理が別途必要

### 比較表

| 観点 | mise | Volta 継続 | .node-version |
|------|------|-----------|---------------|
| メンテナンス状況 | 活発 | 停止 | N/A（ファイル形式） |
| 管理対象 | 複数ツール | Node.js + npm パッケージ | Node.js のみ |
| 既存の利用 | あり | あり | なし |
| elm ツール管理 | 可能 | 不可 | 不可 |
| 追加ツール | 不要 | 不要 | 不要 |

## 決定

選択肢 1: mise に統合する。

理由:

1. ADR-002 との整合: ADR-002 で `.mise.toml` による Elm ツール管理が方針として示されており、その実現形となる
2. ツールの一元管理: Node.js、elm、elm-format のバージョンを `.mise.toml` 1ファイルで管理できる
3. 既存の活用: プロジェクトで既に mise を多数のグローバルツールの管理に使用している

## 帰結

### 肯定的な影響

- `package.json` から Volta 固有の設定が除去され、パッケージマネージャー非依存の原則（ADR-002）が強化される
- ADR-002 で言及されていた `.mise.toml` による Elm ツールのバージョン明示が実現する
- Node.js、elm、elm-format のバージョンが `.mise.toml` で一元管理される

### 否定的な影響・トレードオフ

- Volta ユーザーは mise への移行が必要（移行手順は開発環境構築ドキュメントに反映済み）
- mise 未使用の環境では Node.js バージョンの自動切り替えが機能しない（CI は `actions/setup-node` で独立管理のため影響なし）

### 関連ドキュメント

- 前提 ADR: [ADR-002 フロントエンドツールチェーンの選定](002_フロントエンドツールチェーンの選定.md)
- 手順書: [開発環境構築](../60_手順書/01_開発参画/01_開発環境構築.md)

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-02-19 | 初版作成 |
