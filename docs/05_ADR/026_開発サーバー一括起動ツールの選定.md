# ADR-026: 開発サーバー一括起動ツールの選定

## ステータス

承認済み（2026-01-28）

## コンテキスト

RingiFlow の開発では BFF・Core Service・Auth Service・Web の 4 つの開発サーバーを同時に起動する必要がある。

現状の課題:
- ターミナルを 4 つ開いて個別に `just dev-bff` 等を実行する必要がある
- 事前に `just dev-deps` で PostgreSQL/Redis を起動する手順を忘れやすい
- 新メンバーのオンボーディング時に手順が煩雑

1 コマンドで全サーバーを一括起動し、各プロセスのログを個別に確認できるツールを導入したい。

## 検討した選択肢

### 選択肢 1: mprocs

Rust 製の TUI プロセスマネージャー。複数プロセスを 1 画面で管理し、プロセスごとにログを切り替えて確認できる。

評価:
- 利点: TUI で各プロセスのログを個別表示、YAML で宣言的に設定、Rust 製シングルバイナリで高速・軽量、目的に対して必要十分
- 欠点: tmux ほどの汎用性はない

### 選択肢 2: tmux

ターミナルマルチプレクサ。ペインを分割して複数プロセスを同時表示できる。

評価:
- 利点: 高い汎用性、広い採用実績
- 欠点: 設定が複雑（tmuxinator 等の追加ツールが必要）、プロセス管理が主目的のツールではない

### 選択肢 3: concurrently

Node.js 製の並行プロセス実行ツール。npm scripts との統合が良い。

評価:
- 利点: npm エコシステムで広く使われている、色分けされた出力
- 欠点: Node.js 依存、ログが混在する（プロセスごとの切り替え不可）、TUI なし

### 選択肢 4: foreman

Procfile ベースのプロセスマネージャー。Heroku 由来。

評価:
- 利点: Procfile 形式が広く知られている
- 欠点: Ruby 依存（Rust 版の overmind もあるが追加の依存）、TUI なし、ログが混在する

### 比較表

| 観点 | mprocs | tmux | concurrently | foreman |
|------|--------|------|-------------|---------|
| 言語依存 | なし（シングルバイナリ） | なし（OS パッケージ） | Node.js | Ruby / Go |
| TUI（プロセス切替） | あり | あり（ペイン分割） | なし | なし |
| 設定の簡潔さ | YAML | スクリプト必要 | コマンドライン | Procfile |
| インストール | cargo / brew / バイナリ | OS パッケージ | npm | gem / go install |
| 目的特化度 | 高（プロセス管理専用） | 低（汎用ターミナル） | 中 | 中 |

## 決定

**mprocs を採用する。**

理由:
1. **TUI による個別ログ表示**: 4 つのサーバーのログを混在させず、プロセスを切り替えて確認できる。デバッグ効率が大幅に向上する
2. **YAML 設定のシンプルさ**: `mprocs.yaml` に `shell: "just dev-xxx"` を列挙するだけで設定が完結する。複雑なスクリプトが不要
3. **シングルバイナリで言語非依存**: Rust 製のシングルバイナリとして配布されており、Node.js や Ruby への追加依存が不要。本プロジェクトの方針（Node.js 依存の最小化）に合致する

tmux は汎用的すぎて設定コストが高い。concurrently は Node.js 依存かつ TUI がない。foreman は Ruby 依存で TUI がない。mprocs は「複数プロセスの一括起動と個別ログ確認」という目的に対して必要十分なツールである。

## 帰結

### 肯定的な影響

- `just dev-all` の 1 コマンドで開発環境が完全に立ち上がる
- 新メンバーのオンボーディングが簡素化される
- TUI により各サーバーのログを独立して確認でき、デバッグが効率化する

### 否定的な影響・トレードオフ

- 開発環境に mprocs のインストールが必要（cargo install / brew で容易にインストール可能）
- 個別のサーバー起動（`just dev-bff` 等）も引き続きサポートする必要がある

### 関連ドキュメント

- 手順書: [開発環境構築](../04_手順書/01_開発参画/01_開発環境構築.md)
- 設定ファイル: [`mprocs.yaml`](../../mprocs.yaml)
- justfile: `dev-all` タスク

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-28 | 初版作成 |
