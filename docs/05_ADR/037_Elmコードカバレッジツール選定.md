# ADR-037: Elm コードカバレッジツール選定

## ステータス

承認済み

## コンテキスト

バックエンドのテストカバレッジ改善（#291, ADR-035）に続き、フロントエンド（Elm）のテストカバレッジ計測ツールの導入可否を検討する。

要件:
- Elm 0.19.1 および elm-test 0.19.1-revision17 と互換性がある
- 安定してメンテナンスされている
- CI（GitHub Actions）への統合が容易

## 検討した選択肢

### 選択肢 1: elm-coverage

zwilias/elm-coverage。Elm 専用のカバレッジ計測ツール。elm-instrument（elm-format のフォーク）で AST 変換し、テスト実行時にカバレッジデータを収集する。

評価:
- 利点: Elm 専用で既存のワークフローに統合しやすい設計
- 欠点:
  - 最終コミットが 2022年1月（4年以上メンテナンスなし）
  - elm-test 0.19.1-revision7 までの対応（revision17 との互換性未検証）
  - LCOV 出力非対応（CI 統合困難）
  - Apple Silicon はRosetta 経由のみ

### 選択肢 2: ツール導入なし（テスト戦略で品質担保）

カバレッジツールを導入せず、Elm の型システムの強さと戦略的なテスト選定でテスト品質を担保する。

評価:
- 利点: 追加依存なし、メンテナンスコストゼロ、Elm の特性に合致
- 欠点: カバレッジの定量的な把握ができない

### 比較表

| 観点 | elm-coverage | ツール導入なし |
|------|-------------|---------------|
| elm-test 互換性 | revision7 まで（revision17 未検証） | N/A |
| メンテナンス | 4年間停止 | N/A |
| CI 統合 | LCOV 非対応で困難 | N/A |
| 定量的把握 | 可能（動作すれば） | 不可 |
| 追加コスト | 互換性問題の調査・対処 | なし |

## 決定

ツール導入なし（選択肢 2）を採用する。

理由:
1. elm-coverage は 4年間メンテナンスされておらず、現在の elm-test（revision17）との互換性が未検証で動作しない可能性が高い
2. Elm エコシステムに代替のカバレッジツールが存在しない（構造的制約: コンパイラがカバレッジ計測機能を提供していない）
3. Elm は型システムと TEA アーキテクチャにより、カバレッジ率よりもテスト対象領域の戦略的選定が効果的（Issue #331 の優先度表で担保）

## 帰結

### 肯定的な影響

- 不安定なツールへの依存を回避し、テスト基盤の信頼性を維持
- テスト品質は戦略的なテスト選定（外部境界のデコーダ、ビジネスロジック優先）で担保

### 否定的な影響・トレードオフ

- カバレッジの定量的な把握ができない（テストの抜けを数値で検出できない）
- 将来、Elm エコシステムに成熟したカバレッジツールが登場した場合、再検討が必要

### 関連ドキュメント

- バックエンドのカバレッジ: [ADR-035: コードカバレッジ計測ツール選定](035_コードカバレッジ計測ツール選定.md)
- テスト戦略: [Issue #331](https://github.com/ka2kama/ringiflow/issues/331)

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-02-09 | 初版作成（#331） |
