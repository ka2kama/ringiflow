# ADR-040: 機能仕様書の導入

## ステータス

承認済み

## コンテキスト

RingiFlow のドキュメント体系において、「ユーザー視点で何ができるか」を技術詳細なしに記述する場所が欠けている。

現状:

| レイヤー | 一般的な名称 | RingiFlow |
|---------|------------|-----------|
| ビジネス要件 | PRD / BRD | `01_要件定義書/01_コア要件.md` |
| 機能仕様 | Functional Spec | 不在 |
| 技術設計 | Architecture / Design Doc | `02_基本設計書/` + `03_詳細設計書/` |

`01_コア要件.md` は 25,000+ トークンの巨大ファイルで、ビジネスルール（機能 ID、優先度）、技術仕様（API 設計、スキーマ）、非機能要件が混在している。「ユーザーがこの機能で何をできるか」を取り出すには、技術的な記述を読み飛ばす必要がある。

参照規格: ISO/IEC/IEEE 29148:2018（IEEE 830 の後継。要件エンジニアリングのプロセスと仕様書テンプレートを定義）

## 検討した選択肢

### 選択肢 1: `01_要件定義書/機能仕様書/` サブディレクトリ

要件定義書の配下にサブディレクトリとして配置する。

評価:
- 利点: 既存の番号体系を変更しない（参照更新ゼロ）。ISO 29148 の StRS → SRS の関係に沿い、要件の詳細化として自然
- 欠点: PRD 相当のコア要件と機能仕様書が同じ親ディレクトリに同居する

### 選択肢 2: リナンバリング（`02_機能仕様書/`）

全ドキュメントをリナンバリングし、`02_機能仕様書/` を独立ディレクトリとして配置する。

評価:
- 利点: 概念的にきれいな階層（要件 → 機能仕様 → 基本設計 → 詳細設計）
- 欠点: `docs/0[2-8]_` への参照が 536 箇所（213 ファイル）存在し、変更コストが大きい

### 選択肢 3: `01.5_機能仕様書/` 中間番号

要件定義書と基本設計書の間に `01.5` 番号で配置する。

評価:
- 利点: 既存参照を変更しない。概念的な順序が番号に反映される
- 欠点: `01.5` は番号体系として不自然

### 比較表

| 観点 | 選択肢 1（サブディレクトリ） | 選択肢 2（リナンバリング） | 選択肢 3（中間番号） |
|------|---------|---------|---------|
| 参照更新コスト | ゼロ | 536 箇所 | ゼロ |
| 概念的な整合性 | 良い（要件の詳細化） | 最も良い | 中間 |
| 番号体系の自然さ | 自然 | 自然 | 不自然 |
| 将来の移行 | #323 でリナンバリング可能 | 完了 | #323 でリナンバリング可能 |

## 決定

選択肢 1: `01_要件定義書/機能仕様書/` サブディレクトリ方式を採用する。

主な理由:
1. ISO 29148 では StRS（ステークホルダー要件）と SRS（ソフトウェア要件）は同じ「要件」カテゴリの異なる詳細度であり、機能仕様書を要件定義書の配下に置くのは概念的に正しい
2. 既存参照を変更しないため、この PR のスコープが機能仕様書の作成に集中できる
3. #323（ドキュメント体系リナンバリング）で必要に応じて独立ディレクトリに移動できる

テンプレート構造は、ISO/IEC/IEEE 29148 の SRS テンプレート（セクション 1-3）と Joel Spolsky のシナリオ駆動アプローチを組み合わせた構成とする。

コア要件との関係:
- `01_コア要件.md` は変更しない
- 機能仕様書はコア要件の CORE-04（機能要件）をユーザー視点で展開したもの
- 含めるもの: ユースケース、画面フロー、入出力、バリデーション、状態遷移、権限、エラーケース
- 除外するもの: API 設計、DB スキーマ、アーキテクチャ、パフォーマンス数値、実装詳細

## 帰結

### 肯定的な影響

- 新機能設計時に「ユーザーから見た振る舞い」を先に整理できる
- 完了条件をユーザー視点で定義できる（受入基準の明確化）
- エンタープライズ開発で求められる機能仕様書の作成スキルを習得できる（学習効果）

### 否定的な影響・トレードオフ

- コア要件と機能仕様書の間で記述が一部重複する（状態遷移図など）。ただし、コア要件はビジネスルールと機能 ID の管理、機能仕様書はユーザー視点の振る舞い記述という役割の違いで正当化される
- #323 でリナンバリングする際に移動が必要になる可能性がある

### 関連ドキュメント

- Issue: [#299 機能仕様書（Functional Specification）の新設](https://github.com/ka2kama/ringiflow/issues/299)
- 将来の対応: [#323 ドキュメント体系リナンバリング](https://github.com/ka2kama/ringiflow/issues/323)
- 参照規格: ISO/IEC/IEEE 29148:2018
- 参照: Joel Spolsky, "Painless Functional Specifications" (2000)

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-02-10 | 初版作成 |
