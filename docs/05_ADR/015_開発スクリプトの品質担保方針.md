# ADR-015: 開発スクリプトの品質担保方針

## ステータス

承認済み

## コンテキスト

開発中に使用する自作ツールやスクリプト（justfile タスク、Git フック等）の品質をどう担保するかという課題がある。

現状のスクリプト:
- `.claude/hooks/pre-commit-check.sh`: コミット前の lint/test 実行
- `.lefthook/prepare-commit-msg/add-issue-number.sh`: Issue 番号自動付与

これらはデプロイ成果物ではないが、開発フローの一部として正しく動作する必要がある。

## 検討した選択肢

### 選択肢 1: ShellCheck による静的解析

シェルスクリプトの静的解析ツールを導入し、構文エラーやバグを検出する。

評価:
- 利点: 低コスト導入、追加依存が少ない、既存スクリプトをそのまま使える
- 欠点: ユニットテストは書けない、型安全性なし

### 選択肢 2: rust-script による Rust 化

シェルスクリプトを Rust で書き直し、テスト可能にする。

評価:
- 利点: 型安全性、`#[test]` でユニットテスト可能、プロジェクトの技術スタックと一致
- 欠点: 外部コマンド呼び出しが冗長、rust-script のインストールが必要、単純なスクリプトにはオーバーキル

### 選択肢 3: Python への移行

シェルスクリプトを Python で書き直す。

評価:
- 利点: テスト可能（pytest）、型ヒント使用可能
- 欠点: プロジェクトの技術スタック外、外部コマンド呼び出しが冗長

### 比較表

| 観点 | ShellCheck | rust-script | Python |
|------|-----------|-------------|--------|
| 導入コスト | 低 | 中 | 中 |
| テスト可能性 | × | ◎ | ○ |
| 型安全性 | × | ◎ | △ |
| 技術スタック一致 | - | ◎ | × |
| 現状への適合 | ◎ | △ | △ |

## 決定

**現時点では ShellCheck を採用する。rust-script は将来の選択肢として保留する。**

理由:
1. 現状のスクリプトはシンプルで、ShellCheck による静的解析で十分
2. KISS 原則: 必要十分な複雑さに留める
3. YAGNI: 今必要でない機能（ユニットテスト）を先取りしない

### 将来の移行基準

以下のいずれかに該当した場合、rust-script または dev-tools クレートへの移行を検討する:

- スクリプトに複雑なロジック（正規表現パース、条件分岐が多い等）が必要になった
- スクリプトのバグにより開発フローに支障が出た
- ユニットテストが必要な要件が発生した

## 帰結

### 肯定的な影響

- 低コストで品質向上を実現
- CI でシェルスクリプトの問題を早期検出
- 将来の移行パスを明確化

### 否定的な影響・トレードオフ

- ユニットテストは書けない（現時点では許容）
- 複雑なロジックには不向き（将来の移行で対応）

### 関連ドキュメント

- 実装: `justfile` の `lint-shell` タスク
- CI: `.github/workflows/ci.yaml` の `shell` ジョブ
- セッションログ: [`prompts/runs/2026-01/2026-01-17_2138_ShellCheck導入.md`](../../prompts/runs/2026-01/2026-01-17_2138_ShellCheck導入.md)

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-17 | 初版作成 |
