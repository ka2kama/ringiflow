# ADR-014: lefthook 導入

## ステータス

承認済み（2026-01-17）

## コンテキスト

Issue 駆動開発を採用しており、コミットメッセージや PR タイトルに Issue 番号を含めることで追跡性を確保したい。

現状の課題:
- コミットメッセージへの Issue 番号付与が手動に依存している
- 付け忘れや形式の不統一が発生しうる
- ブランチ名には `feature/34-xxx` の形式で Issue 番号を含めているが、活用されていない

Git フック管理ツールを導入し、ブランチ名から Issue 番号を抽出してコミットメッセージに自動付与することで、一貫性と追跡性を向上させたい。

## 検討した選択肢

### 選択肢 1: lefthook

Evil Martians が開発する Git フック管理ツール。Go で書かれたシングルバイナリ。

評価:
- 利点: 言語依存なし、高速、YAML で宣言的に設定、GitLab での採用実績
- 欠点: husky ほどの知名度はない

### 選択肢 2: husky

Node.js エコシステムで広く使われる Git フック管理ツール。

評価:
- 利点: 知名度が高い、npm エコシステムとの統合が良い
- 欠点: Node.js が必須、本プロジェクトはフロントエンドも Elm で Node.js への依存を最小化したい

### 選択肢 3: 生の Git hooks

`.git/hooks/` にスクリプトを直接配置する。

評価:
- 利点: 依存なし、シンプル
- 欠点: チーム共有が困難（.git はバージョン管理外）、設定が煩雑

### 比較表

| 観点 | lefthook | husky | 生の Git hooks |
|------|----------|-------|----------------|
| 言語依存 | なし | Node.js | なし |
| チーム共有 | ◎（YAML + スクリプト） | ◎ | △（手動設定必要） |
| 設定の簡潔さ | ◎（YAML） | ○ | △（シェル） |
| 採用実績 | GitLab, Discourse | 多数 | - |

## 決定

**lefthook を採用する。**

理由:
1. **言語非依存**: Rust + Elm のプロジェクトで Node.js に依存しない
2. **信頼性**: GitLab での採用実績があり、活発にメンテナンスされている
3. **シンプルな設定**: YAML で宣言的に設定でき、スクリプトも `.lefthook/` で管理可能

husky は Node.js 必須であり、本プロジェクトの方針（Node.js 依存の最小化）に反する。
生の Git hooks はチーム共有が困難で、セットアップの自動化が難しい。

## 帰結

### 肯定的な影響

- コミットメッセージへの Issue 番号付与が自動化され、付け忘れを防止できる
- 一貫した形式でコミット履歴が整理される
- 将来的に pre-commit でのリント実行など、他のフックも追加可能

### 否定的な影響・トレードオフ

- 開発環境に lefthook のインストールが必要（mise や brew で容易にインストール可能）
- `--no-verify` でスキップ可能なため、強制力は完全ではない

### 関連ドキュメント

- ナレッジベース: [lefthook](../06_ナレッジベース/devtools/lefthook.md)
- 手順書: [開発環境構築](../04_手順書/01_開発参画/01_開発環境構築.md)
- 手順書: [Issue 駆動開発](../04_手順書/04_開発フロー/01_Issue駆動開発.md)

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-17 | 初版作成 |
