# ワークフロー承認/却下機能 - 実装解説

## 概要

ワークフローインスタンスの承認/却下機能を実装する。
重点学習テーマ「並行更新と状態整合性」を実践的に学ぶ。

### 対応 Issue

[#36 ワークフロー承認/却下機能](https://github.com/ka2kama/ringiflow/issues/36)

## Phase 構成

| Phase | 内容 | 状態 | 解説 |
|-------|------|------|------|
| Phase 1 | ドメインモデル拡張 | ✅ 完了 | [解説](./01_Phase1_ドメインモデル拡張.md) |
| Phase 2 | マイグレーション | ✅ 完了 | [解説](./02_Phase2_3_マイグレーションとリポジトリ層.md) |
| Phase 3 | リポジトリ層 | ✅ 完了 | [解説](./02_Phase2_3_マイグレーションとリポジトリ層.md) |
| Phase 4 | ユースケース層 | ✅ 完了 | [解説](./03_Phase4_ユースケース層.md) |
| Phase 5 | API 層 | 待機 | - |
| Phase 6 | フロントエンド | 待機 | - |

## 設計書

- [ワークフロー承認却下機能設計](../../03_詳細設計書/11_ワークフロー承認却下機能設計.md)
- [OpenAPI 仕様書](../../../openapi/openapi.yaml)

## 学習ポイント

本実装で得られる学習効果：

### 並行更新と状態整合性

1. **楽観的ロック**: version フィールドによる競合検出
2. **状態遷移の設計**: ステートマシンの型による表現
3. **競合時のエラーハンドリング**: 409 Conflict と再取得フロー

### ドメイン駆動設計

4. **値オブジェクト**: Version 型による意味のある値の表現
5. **エンティティの振る舞い**: approve/reject メソッドによる状態遷移
6. **不変条件の保護**: 不正な状態遷移をコンパイル時に防止

### TDD

7. **テストファースト**: Red → Green → Refactor サイクルの実践
8. **テストリスト**: 振る舞いを先に定義してから実装
