# モノレポディレクトリ構成

## 概要

多言語モノレポ（Rust + Elm）におけるディレクトリ構成のベストプラクティス。

## 設計原則

### 1. 言語境界の明確化

トップレベルで言語ごとにディレクトリを分離する。

```
project/
├── backend/      # Rust
├── frontend/     # Elm (または React, Vue 等)
├── infra/        # Terraform, Docker
└── docs/
```

**メリット**:
- 各ディレクトリの責務が自明
- 言語固有のツール設定（Cargo.toml, package.json）がトップレベルを汚さない
- CI/CD のパスフィルタが簡潔

**アンチパターン**:
```
# NG: 言語が混在
project/
├── Cargo.toml        # Rust ワークスペース
├── apps/
│   ├── api/          # Rust
│   └── web/          # Elm (Cargo.toml に含まれない)
└── packages/         # Rust のみなのに汎用的な名前
```

### 2. 命名の一貫性

ディレクトリ名は中身を正確に表す。

| 名前 | 適切な中身 |
|------|-----------|
| `crates/` | Rust クレート |
| `packages/` | 言語非依存の共有パッケージ |
| `libs/` | 言語非依存のライブラリ |

```
backend/
├── apps/       # 実行可能バイナリ
└── crates/     # 共有ライブラリ（Rust だと自明）
```

### 3. YAGNI の適用

将来の拡張を過度に考慮しない。

```
# NG: 将来のモバイルアプリを想定した過度な階層
frontend/
└── web/
    └── src/

# OK: 現時点で必要な構成のみ
frontend/
└── src/
```

モバイルアプリが必要になった時点で `frontend/web/`, `frontend/mobile/` に再構成すればよい。

## 環境変数の分離

### 原則

環境変数は使用者ごとに分離する。

```
.env.template           # 共通（Docker ポート、開発サーバーポート）
backend/.env.template   # Rust 固有（DB 接続、ログレベル）
frontend/.env.template  # フロントエンド固有（必要な場合のみ）
```

### justfile との連携

`justfile` の `set dotenv-load := true` はルートの `.env` を読み込む。

```just
set dotenv-load := true

dev-web:
    cd frontend && pnpm run dev  # ルートの .env が環境変数として渡される
```

これにより、`frontend/.env` が不要になる場合がある。

### 分離の判断基準

| 条件 | 方針 |
|------|------|
| justfile 経由でのみ実行 | ルートに統合可能 |
| 直接実行も想定 | サブディレクトリに配置 |
| 言語固有の設定 | 該当ディレクトリに配置 |

## 参考

- [01_プロジェクト構造設計](../02_設計書/01_プロジェクト構造設計.md)
- [Cargo ワークスペース](./Cargoワークスペース.md)
