# 2026-01-15_06_ドキュメント自動作成の仕組み

## 概要

ADR・技術ノート・セッションログの自動作成を促す仕組みを導入した。

## 背景と目的

- ADR / 技術ノート / セッションログは手動で作成忘れが発生しやすい
- AI エージェントが適切なタイミングでドキュメントを作成できるよう、条件を明確化したい
- セッション終了時にリマインドを表示することで、作成忘れを防ぎたい

## 実施内容

### 1. Claude Skills の調査

Claude Code の Skills 機能について調査した。

- **Skills**: Markdown ファイルで記述された専門知識・指示セットで、Claude が自動判断して適用する機能
- **CLAUDE.md との違い**: CLAUDE.md は全会話に自動適用、Skills は状況に応じて自動選択

**結論**: 現時点では CLAUDE.md が十分整備されており、Skills の導入は見送り。

### 2. ドキュメント自動作成ルールの追加

CLAUDE.md に以下の作成条件を明記した。

| ドキュメント | 作成条件 |
|-------------|---------|
| ADR | 技術選定、実装方針の選択、設計判断、見送り判断 |
| 技術ノート | 新ツール導入、技術解説、既存ノートへの追記 |
| セッションログ | コード変更、設計判断、調査結果 |

### 3. SessionEnd フックの追加

`.claude/settings.json` に SessionEnd フックを追加し、セッション終了時にリマインドを表示するようにした。

```json
"SessionEnd": [
  {
    "hooks": [
      {
        "type": "command",
        "command": "echo '📝 ドキュメント作成を確認: ADR / 技術ノート / セッションログ（該当する場合）'"
      }
    ]
  }
]
```

**補足**: Stop（毎ターン発火）ではなく SessionEnd（セッション終了時のみ）を採用。

## 成果物

### コミット

- `69bc6ed` ドキュメント自動作成の仕組みを追加

### 更新ファイル

- `CLAUDE.md`: ドキュメント自動作成ルールセクションを追加
- `.claude/settings.json`: SessionEnd フックを追加

## 設計判断と実装解説

### Stop vs SessionEnd の選択

| イベント | 発火タイミング | 採用 |
|---------|--------------|------|
| Stop | 毎回の応答完了時 | ✗ 頻繁すぎる |
| SessionEnd | セッション終了時 | ✓ 適切な頻度 |

毎回リマインドが表示されるとうるさいため、SessionEnd を採用した。

## ユーザープロンプト（抜粋）

> ADR、技術ノート、セッションログあたりは、指示がなくともある程度自動で作成されるようにしたいです。できそうですか？

> 完全自動化は目指していないのである程度できればいい。

## 学んだこと

- Claude Code の Hooks には複数のイベントタイプがあり、用途に応じて使い分ける
  - Stop: 毎ターン終了時
  - SessionEnd: セッション終了時
  - その他: PreToolUse, PostToolUse, SubagentStop など
- セッション中に設定ファイルを変更しても、次回起動まで反映されない
