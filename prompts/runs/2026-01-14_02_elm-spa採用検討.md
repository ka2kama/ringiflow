# 2026-01-14_02: elm-spa 採用検討

## 概要

Elm のルーティングフレームワーク（elm-spa）の採用可否を検討し、ADR として決定を記録した。また、ADR README の一覧管理を廃止し、メンテナンス負担を軽減した。

## 背景と目的

Phase 0 で Elm プロジェクトの雛形が完成し、Phase 1 に向けてルーティング設計を検討する段階に入った。Elm のルーティング実装には複数のアプローチがあり、プロジェクトの方針に合った選択が必要だった。

## 実施内容

### 1. elm-spa 採用の検討

以下の 3 つの選択肢を比較検討した:

| 選択肢 | 概要 |
|--------|------|
| 手動実装 | elm/url + Url.Parser で自前実装 |
| elm-spa | ファイルベースルーティングのフレームワーク |
| elm-land | elm-spa の後継（v7 相当） |

### 2. ADR 作成

検討結果を ADR-003 として記録。決定内容:

- **採用**: 手動実装
- **理由**: 学習効果最大化、Ports 設計の自由度、MVP 規模で十分
- **再検討トリガー**: ページ数 20 超過、バグ頻発、チーム拡大時

### 3. ADR README の改善

ADR 追加時に README の一覧を手動更新する運用を廃止。ディレクトリ参照に変更し、メンテナンス負担を解消した。

## 成果物

### 作成ファイル

| ファイル | 内容 |
|---------|------|
| `docs/04_ADR/003_Elmルーティングフレームワークの選定.md` | ADR 本体 |

### 更新ファイル

| ファイル | 変更内容 |
|---------|---------|
| `docs/04_ADR/README.md` | 手動一覧を廃止、ディレクトリ参照に変更 |

## 設計判断と実装解説

### なぜ手動実装を選択したか

1. **学習目的との整合性**: プロジェクトの第一目的は Elm/TEA の深い理解。フレームワークを使うと TEA の仕組みが抽象化され、学習機会が減る

2. **Ports 要件の複雑さ**: 要件定義書で WebSocket 再接続、楽観的 UI 更新、再同期など複雑な Ports 連携を規定しており、フレームワークの制約が障害になる可能性がある

3. **後から移行可能**: 手動実装で限界を感じた場合、elm-spa への移行は後からでも可能

### ページモジュールパターン

手動実装でも elm-spa のメリット（ページの独立性）は取り入れる:

```elm
-- Pages/Workflows.elm として独立モジュール化
module Pages.Workflows exposing (Model, Msg, init, update, view)
```

## ユーザープロンプト（抜粋）

> elm-spa を採用すべきかどうか議論したいです。

> ADR をまとめてください。

> README に一覧を追加していくのは大変ではないですか？

## 学んだこと

- ADR は決定の記録だけでなく、再検討のトリガー条件を明示することで将来の判断材料になる
- ドキュメントの手動メンテナンスは負担になりやすい。ファイル名規則で代替できる場合は一覧管理を省略できる

## 次のステップ

- Phase 1 実装開始時に、ページモジュールパターンを適用してルーティングを構築
