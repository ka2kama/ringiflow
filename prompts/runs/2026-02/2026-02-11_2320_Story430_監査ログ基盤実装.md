# Story #430: DynamoDB 基盤 + 監査ログ API 実装

## 概要

Epic #403 Phase 2-2 の Story #430 として、DynamoDB Local をローカル開発環境に導入し、監査ログの記録・閲覧 API を実装した。BFF のユーザー操作・ロール操作ハンドラに監査ログ記録を統合し、テナント管理者が一覧・検索できる API を提供する。

## 実施内容

### DynamoDB インフラ導入

- `docker-compose.yaml` に DynamoDB Local コンテナを追加
- API テスト用の `docker-compose.api-test.yaml` にも DynamoDB Local を追加
- `scripts/generate-env.sh` に DynamoDB エンドポイント環境変数を追加
- テーブル作成スクリプトの整備

### ドメイン・リポジトリ層

- `AuditLog` ドメインモデル: `id`, `tenant_id`, `actor_id`, `actor_name`, `action`, `result`, `resource_type`, `resource_id`, `detail`, `source_ip`, `created_at`
- `AuditLogRepository`: DynamoDB に対する `put_item` と `query`（テナント ID + 時刻降順のカーソルページネーション）
- `PaginatedResponse<T>`: `data` + `next_cursor` のジェネリックなレスポンス型

### BFF 統合

- ユーザー操作（作成・更新・ステータス変更）の成功後に監査ログを記録
- ロール操作（作成・更新・削除）の成功後に監査ログを記録
- 監査ログ一覧 API: `GET /api/admin/audit-logs`（フィルタ: 期間、アクターID、アクション、結果）

### OpenAPI 仕様

- 監査ログ関連エンドポイントの仕様を `openapi/openapi.yaml` に追加
- レスポンススキーマ（`AuditLogItem`, `AuditLogListResponse`）を定義

## 判断ログ

- DynamoDB を監査ログのデータストアに採用（PostgreSQL ではなく）: 追記型ワークロード、将来の大量データ対応、テナント退会時の一括削除が容易
- カーソルページネーション: `next_cursor` のみ（前のページはカーソル履歴管理が必要で初期スコープ外）
- 監査ログ記録は BFF レベルで実施（Core Service ではなく）: HTTP リクエストの IP アドレスや操作者情報が BFF で確定するため

## 成果物

### コミット

| ハッシュ | 内容 |
|---------|------|
| `2edc1bd` | DynamoDB Local インフラ導入 |
| `9e9b9d5` | 監査ログドメインモデル・リポジトリ |
| `011478b` | BFF ユーザー・ロールハンドラに監査ログ記録を統合 |
| `69e4f26` | 監査ログ一覧 API + OpenAPI 仕様 |
