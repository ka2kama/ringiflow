# #323 docs/ ディレクトリ番号体系の見直し

Issue: #323
PR: #984
ブランチ: `feature/323-docs-directory-numbering`

## 概要

`docs/` ディレクトリの番号体系を 1 刻み（01-08）から 10 刻み飛び番号（10-90）に変更し、機能仕様書を要件定義書の配下から独立ディレクトリに昇格させた。

## 変更内容

### ディレクトリ構成の変更

```
変更前 → 変更後
01_要件定義書     → 10_要件定義書
  └ 機能仕様書/   → 20_機能仕様書（昇格）
02_基本設計書     → 30_基本設計書
03_詳細設計書     → 40_詳細設計書
08_テスト        → 50_テスト（順序変更: 設計の近くへ）
04_手順書        → 60_手順書
05_ADR          → 70_ADR
06_ナレッジベース  → 80_ナレッジベース
07_実装解説       → 90_実装解説
```

### 設計判断

- 10 刻み飛び番号: 将来のカテゴリ追加時にリネームが不要
- V モデル順: 仕様(10-20) → 設計(30-40) → テスト(50) → 運用(60) → 参考(70-90)
- 機能仕様書の昇格: ISO 29148 の StRS/SRS の関係に基づき、要件定義書と同列の独立ドキュメントとして位置づけ
- ADR-040 に変更履歴を追記

### 影響範囲

- 684 ファイル変更（1664 挿入 / 1457 削除）
- docs/ 配下のディレクトリ移動
- 全リポジトリの参照パス更新（.md, .rs, .elm, .js, .css, .sh, .yaml, .yml, .toml, justfile, .sql）
- 機能仕様書の相対パス修正（ディレクトリ深度変更: 2 → 1）
- CLAUDE.md のドキュメント体系テーブル更新
- .claude/rules/docs.md のエントリファイル注記更新

## 判断ログ

### 他 Issue の計画ファイルの扱い

sed による一括置換が他 Issue の計画ファイルにも波及し、pre-push hook（lint-plans, lint-plan-test-layers）で既存の未チェック項目が検出された。

判断: 他 Issue の計画ファイルは main 版に revert する。これらのファイルの doc パス更新は、各 Issue の作業開始時に行う。

理由: 他 Issue の計画ファイルの内容（テストリスト等）は、その Issue の文脈でのみ修正すべき。機械的な sed 置換で内容を変更すると、lint の範囲に入り、既存の問題が表面化する。

### revert 後の壊れたリンクの修正

計画ファイル `208_display-id-workflow-step.md` は main 版に revert したが、参照先 `docs/03_詳細設計書/` が存在しなくなっていた。このファイルのみ `40_詳細設計書` に修正した。

## 技術的な知見

### pre-push hook の仕組み

`scripts/check/plan-confirmations.sh` は `git diff --name-only "$base_ref"...HEAD` で差分に含まれるファイルを検査する。一括置換で他 Issue の計画ファイルも差分に含まれると、そのファイルの既存の問題が検出される。

### `just check` の構成

`scripts/check/parallel.sh` が Rust lane と Non-Rust lane を並列実行。S3 統合テスト（MinIO 依存）は `--skip-db` で除外可能。`just check-pre-push` が MinIO 不要な確認セット。

## 改善記録

- [Issue 精査の As-Is 検証が事実確認で終わり評価をスキップする](../../../process/improvements/2026-02/2026-02-28_2115_Issue精査のAs-Is検証が事実確認で終わり評価をスキップする.md) — 前セッションで作成
