# プロセスドキュメントの AI エージェント最適化

Issue: #739

## 概要

CLAUDE.md と always-loaded ルールファイルが消費するコンテキストトークン（~75,000-91,000 トークン、37-45%）を削減した。重複排除、散文除去、構造化により合計 30% 削減を達成。

## 実施内容

### Phase 1: CLAUDE.md スリム化

CLAUDE.md を 465→285 行（38.7%）、24,752→13,790 bytes（44.3%）に圧縮した。

主な変更:
- Git 操作手順の詳細（89 行）を必須ルール + 手順書リンクに集約（~30 行）
- Issue 駆動開発フローの要約（L337-346）を削除（手順書が SSOT）
- プロジェクト理念の散文的説明を指示形式 + KB リンクに変換
- 開発コマンド・アーキテクチャ・ドキュメント体系の参照テーブルを簡略化
- 重複禁止事項 3 件を削除（always-loaded ルールに canonical 定義あり）

### Phase 2: Always-loaded ルールファイル最適化

合計 40,142→33,487 bytes（16.6%）に圧縮した。

| ファイル | 変更 | 削減率 |
|---------|------|--------|
| zoom-rhythm.md | 散文除去、テンプレート圧縮、「品質を守る二つの砦」を表に圧縮 | 20.3% |
| troubleshooting.md | 3 原則を表に統合、「既知手法との関連」を KB リンクに | 17.1% |
| problem-solving.md | Want/How セクションの ASCII 図・例示テーブルを圧縮 | 21.1% |
| pre-implementation.md | 変更なし（rule-skill-writing.md 準拠済み） | — |

## 判断ログ

- 禁止事項の canonical location 判定: CLAUDE.md と always-loaded ルールの両方に存在する禁止事項 5 件を精査。always-loaded ルールに定義がある 3 件は CLAUDE.md から削除、CLAUDE.md 固有の 2 件（手順書未読、テスト未作成）は残した
- 背景知識の移動先: プロジェクト理念の哲学的背景は、既存の KB 記事（ISO25010.md, V&V.md）にリンクする形で対応。新規ドキュメント作成は不要と判断
- zoom-rhythm.md のギャップ発見テーブル: 12 ファイルから参照されているため、テーブル構造は維持し形式のみ圧縮

## 成果物

コミット:
- `6bbc7ea` #739 Slim down CLAUDE.md by removing duplication and narrative prose
- `91367b1` #739 Optimize always-loaded rule files for AI agent efficiency

作成/更新ファイル:
- `CLAUDE.md` — 38.7% 行数削減、44.3% バイト数削減
- `.claude/rules/zoom-rhythm.md` — 20.3% 削減
- `.claude/rules/troubleshooting.md` — 17.1% 削減
- `.claude/rules/problem-solving.md` — 21.1% 削減
- `prompts/plans/sleepy-discovering-pillow.md` — 計画ファイル

## 議論の経緯

- スコープの選択: 方向性 1-3（CLAUDE.md スリム化 + 禁止事項統合 + ルールファイル圧縮）を対象とし、方向性 4-5（フェーズベース構造化、手順書の機械可読化）は follow-up Issue に先送りとした
