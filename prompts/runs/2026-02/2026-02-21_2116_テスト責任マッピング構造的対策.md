# テスト責任マッピング構造的対策

## 概要

Issue #761（ワークフローデザイナーの検証・公開ボタン不動作）の根本原因を分析し、Epic → Story 分割時にテスト責任が断絶する構造的欠陥への対策を手順書・ルールファイルに組み込んだ。

## 実施内容

### 1. 改善記録の全面改訂

`process/improvements/2026-02/2026-02-21_1700_子Issue分割実装時の操作パス検証欠落.md` を全面改訂。

- 5つの防波堤（型システム → ユニットテスト → E2E テスト → PR Test plan → 改善記録）の突破連鎖を分析
- 3層の構造的原因を分解（L1: テスト責任割り当てプロセスの欠如、L2: 統合検証ステップの欠如、L3: Test plan 未検証通過）
- 対策形式を「成果物要件」または「フロー組み込み」に限定（行動規範は不採用）

### 2. 手順書改訂（対策 A/B/C）

`docs/60_手順書/04_開発フロー/01_Issue駆動開発.md`:

- 対策 A: Story 分解の品質基準に「テスト責任の網羅」を追加。テスト責任マッピング表（テスト層 × 操作パス × Story）を成果物要件化
- 対策 B: Epic クローズフローに統合検証ゲートを追加
- 対策 C: 品質チェックリストにテスト責任の検証項目を追加

### 3. ギャップ発見の観点更新

`.claude/rules/zoom-rhythm.md` の欠陥の発見観点に「テスト責任の断絶」を追加。

### 4. GitHub Issue #763 作成

構造的対策の実装タスクとして Issue #763 を作成し、PR #764 で対応。

## 判断ログ

- 操作パスの分類: 正常系・準正常系・異常系の用語を採用。ISTQB の positive/negative testing（2分類）は粒度が不足するため、日本の IT 現場での慣用分類を採用し、初出に定義の注釈を付与
- テスト責任のスコープ: 当初 E2E テスト限定で設計していたが、テストピラミッドの全層（ユニット/ハンドラ/API/E2E）に拡張。今回の事象は E2E で顕在化したが、ユニットテスト（`encodeValidationRequest` のエンコード結果検証）も欠落しており、層横断の問題だった
- 対策形式: 行動規範（「気をつける」）は採用せず、成果物要件（テスト責任マッピング表の存在）とフロー組み込み（統合検証ゲート）のみ採用

## 成果物

### コミット

- `f0d12e6` #763 Add structural countermeasures for test responsibility gaps in Epic decomposition

### 作成・更新ファイル

| ファイル | 操作 |
|---------|------|
| `process/improvements/2026-02/2026-02-21_1700_子Issue分割実装時の操作パス検証欠落.md` | 全面改訂 |
| `docs/60_手順書/04_開発フロー/01_Issue駆動開発.md` | テスト責任マッピング追加、統合検証ゲート追加、品質チェックリスト更新 |
| `.claude/rules/zoom-rhythm.md` | ギャップ発見の観点に「テスト責任の断絶」追加 |
| GitHub Issue #763 | 作成 |
| PR #764 | Draft 作成 |

## 議論の経緯

1. 分析のスコープについて: 当初「ハッピーパスが通らない」という事象に焦点を当てたが、問題は正常系に限らず全操作パス（正常系・準正常系・異常系）にわたるテスト責任の断絶であるため、スコープを全操作パスに拡大

2. 用語の妥当性検証: 「正常系・準正常系・異常系」の用語について ISTQB、Cockburn のユースケース理論、日本の IT 現場慣行を調査。ISTQB は positive/negative の 2 分類のみで準正常系に相当する概念がなく、日本の IT 現場での慣用分類が最も実用的と判断。初出に定義注釈を付与する方式を採用

3. テスト層のスコープ: 当初「E2E 責任マッピング」として設計したが、今回の欠落はユニットテスト層（`encodeValidationRequest` のエンコード結果検証）にも及んでおり、テストピラミッドの全層で適用すべき問題であるため、「テスト責任マッピング」に拡張
