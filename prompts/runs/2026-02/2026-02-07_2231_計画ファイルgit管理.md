# 計画ファイルの git 管理化

## 概要

Claude Code の plan mode で作成される計画ファイルを `prompts/plans/` に配置し、git 管理下に置いた。既存の46ファイルを移行し、Issue 番号起点の命名規則を策定した。

## 背景と目的

計画ファイルには設計ブラッシュアップループの記録や収束確認チェックリストなど、セッションログでは拾いきれない「設計の試行錯誤の過程」が含まれている。しかし `~/.claude/plans/`（全プロジェクト共通、git 管理外）に保存されており、永続性に問題があった。

直接的なきっかけは改善記録「Plan ファイルの永続性誤認による実装解説の欠落」で、Plan ファイルが git 管理下にあると誤認して実装解説の作成を省略した事例が発生していた。

## 実施内容

1. `.claude/settings.json` に `plansDirectory: "./prompts/plans"` を追加
2. `prompts/plans/README.md` を作成（命名規則、運用方針）
3. 既存の46計画ファイルを `~/.claude/plans/` からコピー
4. ランダム名を Issue 番号起点の命名規則にリネーム
5. `/wrap-up` スキルに計画ファイルのリネーム手順を追加（Step 4）
6. `CLAUDE.md` のドキュメント体系表、`prompts/README.md` を更新
7. 関連する改善記録に「後日対応」を追記

## 設計上の判断

### 保存先: `prompts/plans/` を選択

`prompts/` は「AI との協働の記録」という括りで、計画ファイルもこのカテゴリに属する。`.claude/` は設定・ルール等の「ツール設定」が置かれている場所であり、コンテンツの保管場所ではない。

### 命名規則: Issue 番号起点

| パターン | 用途 |
|---------|------|
| `{Issue番号}_{トピック}.md` | Issue に紐付く計画 |
| `YYYYMMDD_{トピック}.md` | Issue なしの計画（例外） |

当初はランダム名をそのまま使う方針だったが、ナビゲーションの困難さから索引テーブルを導入 → 索引の管理コストが課題に → リネーム方式に転換した。

計画ファイルを探すときの思考は「Issue #288 の設計どうだったっけ？」が自然であり、日付起点よりも Issue 番号起点の方が検索性が高い。

### リネームのタイミング: plan mode 終了後

plan mode 中は Claude Code がファイル名で追跡しているため、plan mode を抜けた後にリネームする。`/wrap-up` の一環として実施する運用とした。

## 成果物

- PR: #309
- 変更ファイル: 52 files changed（うち46は計画ファイルの移行・リネーム）

## 議論の経緯

### ランダム名の課題と解決策の変遷

移行後にランダム名のわかりづらさが問題になり、以下の順で解決策を検討した:

1. 索引テーブルを README に追加 → 管理が大変
2. スクリプトで自動生成 → 提案したが
3. リネーム方式 → ユーザーから提案があり採用

Issue 番号起点は「plan mode に入るようなトピックなら Issue 化すべき」というユーザーの指摘に基づく。

### 改善記録の発見

ユーザーが「前にもどこかで plan ファイルの記述をした気がする」と指摘。検索したところ、改善記録「Plan ファイルの永続性誤認」が見つかり、今回の変更で根本原因が解消されたことを追記した。

## 学んだこと

- `plansDirectory` 設定で計画ファイルの保存先をプロジェクト単位で制御できる（既知のバグあり: Issue #14186）
- 情報の命名は「どう検索するか」から逆算して設計すると良い（時系列 vs Issue 番号）
- 最初から完璧な方針を決めるより、実物を見ながら段階的に改善する方が良い結果になることがある（ランダム名 → 索引 → リネーム）

## 次のステップ

- `plansDirectory` 設定が実際に機能するか検証（次回 plan mode 使用時）
- 機能しない場合はシンボリックリンク等の回避策を検討
