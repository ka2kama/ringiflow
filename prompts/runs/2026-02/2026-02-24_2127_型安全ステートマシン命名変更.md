# 型安全ステートマシン命名変更

## 概要

#855 に基づき、パターン名「ADT ベースステートマシン」を手段非依存な「型安全ステートマシン」に変更した。CLAUDE.md の「Want と How」原則に従い、特定の実装手段（ADT: 代数的データ型）をパターン名から除外し、判断基準を「ADT で表現できるか」から「不正な状態遷移が型レベルで防止されているか」に修正した。

## 実施内容

### Phase 1: ADR-054 の修正（核心）

- ファイルリネーム: `054_ADTベースステートマシンパターンの標準化.md` → `054_型安全ステートマシンパターンの標準化.md`
- タイトル・本文の用語更新
- 判断基準の変更: 「ADT で表現できるか」→「不正な状態遷移が型レベルで防止されているか」
- 「実装手段の選択」セクションを新設（ADT / ジェネリクス / trait bounds の比較表）
- 変更履歴に本変更を追記

### Phase 2: ルールファイル・手順書の更新

- `.claude/rules/zoom-rhythm.md`: 「状態依存フィールド」観点の記述を更新
- `.claude/rules/pre-implementation.md`: セクション名と本文を更新
- `docs/60_手順書/04_開発フロー/02_TDD開発フロー.md`: ADR-054 リンクを更新

### Phase 3: 設計書・ソースコードコメントの更新

- `docs/40_詳細設計書/エンティティ影響マップ/WorkflowInstance.md`: 用語とリンクを更新
- Rust ソースコード（instance.rs, step.rs）: モジュール doc、struct/enum doc を更新
- Elm ソースコード（Designer.elm, Detail.elm, New.elm, Task/Detail.elm）: モジュール doc と型コメントを更新

### Phase 4: 実装解説ドキュメントの更新

3 PR 分のディレクトリリネーム + ファイルリネーム + 内容更新:
- PR802_Designer, PR839_WorkflowDetail, PR840_WorkflowStep

### Phase 5: GitHub Actions ワークフローの更新

- `.github/workflows/claude-auto-review.yaml`: レビュー指示の用語を更新

### Phase 6: GitHub Issues の用語・方針更新

- Epic #822: タイトルと本文を更新（用語 + 判断基準）
- Issue #854: 本文の「ADT パターン」→「型安全ステートマシンパターン」に更新

### Phase 7: フォローアップ Issue の作成

- #859: 既存実装の新判断基準での再評価
- #860: 中優先度 Story のアプローチ見直し

## 判断ログ

- 命名選択: 「型安全ステートマシン」を採用（「型駆動ステートマシン」「型レベルステートマシン」との比較で、最も直感的かつ目的を表現する名称として選択）
- スコープ決定: Living documents（ADR、ルール、設計書、コードコメント）は本 Issue で更新、Historical records（セッションログ、計画ファイル、マイグレーション）は時点の記録として変更しない
- 技術的説明文脈の維持: ADT の具体手段としての説明箇所は「型安全ステートマシン」に置換せず維持（例: 「ADT（代数的データ型）で状態を分離する」等）
- フォローアップ分離: 既存実装の再評価と未着手 Story のアプローチ変更は本 Issue のスコープ外とし、別 Issue（#859, #860）で対応

## 成果物

### コミット

- `fd6f400` ADR-054 ファイルリネーム
- `7d6ab85` ADR-054 内容更新
- `56c4818` ルールファイル・手順書更新
- `9abd5d2` 設計書・ソースコードコメント更新
- `2f5e191` 実装解説ドキュメントリネーム・更新
- `a10ad76` Auto-review ワークフロー更新
- `01945c9` 計画ファイル追加

### PR

- #856: https://github.com/ka2kama/ringiflow/pull/856 (Draft)

### 作成・更新ファイル

更新（20 ファイル）: ADR-054、ルールファイル 2 件、手順書 1 件、設計書 1 件、Rust ソース 2 件、Elm ソース 4 件、実装解説 6 件、GitHub Actions 1 件、計画ファイル 1 件

GitHub Issues 更新: Epic #822、Issue #854
GitHub Issues 作成: #859、#860

## 議論の経緯

- 初版の計画がドキュメント修正のみのスコープだったが、既存パターンや未着手 Issue の方向性も含めるべきとの指摘を受けた
- スコープの広さについて確認し、「全体的に見直す必要はあるが、この Issue で全て終わらせる必要はない」との方針でフォローアップ Issue を切り出す形に決定した
