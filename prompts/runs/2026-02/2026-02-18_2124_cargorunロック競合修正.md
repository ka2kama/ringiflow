# cargo run ロック競合修正

## 概要

#641: API テスト・E2E テストのサービス起動で `cargo run` を 3 プロセス同時起動した際の Cargo ファイルロック競合を修正した。

## 実施内容

- `scripts/run-api-tests.sh` と `scripts/run-e2e-tests.sh` で `cargo run -p <package>` を `./target/debug/<binary>` に置き換え
- Issue 精査を実施し、As-Is が Issue 記述通りであることを確認
- `just check-all` で API テスト（24/24 パス）、E2E テスト含め全チェック通過を確認

### 修正の背景

両スクリプトは L45/L49 で `cargo build` によるビルド完了後に `cargo run` でサービスを起動していた。`cargo run` は内部で暗黙に `cargo build` を実行するため、3 プロセス同時起動時に Cargo のファイルロック（package cache、artifact directory）で競合が発生していた。ロック解放後にキャッシュが不整合状態になり、依存クレートの再コンパイルが走ることでヘルスチェックタイムアウトに至った。

1 回目の `just check-all` 実行で、API テストは修正済みで成功したが E2E テストが同じパターンで失敗したことから、`run-e2e-tests.sh` も同一の修正が必要であることが判明した。

## 判断ログ

特筆すべき判断なし。Issue の To-Be に従った修正。E2E テストスクリプトも同じパターンであることを発見し、同時に修正した。

## 成果物

- コミット: `88a0869` — `#641 Replace cargo run with pre-built binaries in test scripts`
- PR: #643（Draft）
