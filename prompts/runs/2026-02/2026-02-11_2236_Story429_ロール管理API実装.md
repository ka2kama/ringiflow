# Story #429: ロール管理 API 実装

## 概要

Epic #403 Phase 2-2 の Story #429 として、ロール CRUD API をドメイン層から BFF 層まで一気通貫で実装した。システムロールとカスタムロールの区別、権限モデル、ユーザー割り当て中のロール削除防止を含む。

## 実施内容

### ドメイン層 + リポジトリ + Core Service

- `Role` エンティティに CRUD メソッドを追加（`with_name`, `with_description`, `with_permissions`）
- `RoleRepository` に `insert`, `update`, `delete`, `find_by_id`, `find_all_by_tenant`, `count_users_with_role` を追加
- システムロール（`is_system = true`）の更新・削除を禁止するドメインルール
- Core Service に CRUD ハンドラ: `POST /internal/roles`, `GET /internal/roles/{role_id}`, `PATCH /internal/roles/{role_id}`, `DELETE /internal/roles/{role_id}`
- 削除時にユーザー割り当てチェック（`count_users_with_role > 0` なら 409 Conflict）

### BFF クライアント拡張

- `CoreServiceClient` に `create_role`, `get_role`, `update_role`, `delete_role`, `list_roles` メソッドを追加
- 既存の `list_roles` を拡張してロール詳細情報を返すように変更

### BFF ハンドラ

- `POST /api/admin/roles`, `GET /api/admin/roles`, `GET /api/admin/roles/{role_id}`, `PATCH /api/admin/roles/{role_id}`, `DELETE /api/admin/roles/{role_id}`
- RBAC 認可ミドルウェアによる権限チェック

## 判断ログ

- Story #428 のユーザー CRUD と同じレイヤー構成パターンを踏襲（一貫性重視）
- `delete` のレスポンスは 204 No Content（REST のベストプラクティス）

## 成果物

### コミット

| ハッシュ | 内容 |
|---------|------|
| `974f5f1` | ドメイン・リポジトリ・Core Service のロール CRUD |
| `d4a7660` | BFF クライアント拡張 |
| `f627b02` | BFF ハンドラ実装 |
| `c127b70` | 計画ファイル追加 |
