# #615 WCAG 2.1 AA 対応強化

Issue: [#615](https://github.com/ka2kama/ringiflow/issues/615)
Epic: [#445](https://github.com/ka2kama/ringiflow/issues/445)（Story 5）
PR: [#642](https://github.com/ka2kama/ringiflow/pull/642)

## 概要

WCAG 2.1 AA 準拠のギャップを 3 領域で解消した:

1. テーブルヘッダーのカラーコントラスト改善（`text-secondary-500` → `text-secondary-600`）
2. フォーム要素への `aria-label` 追加（ApproverSelector、PermissionMatrix）
3. インタラクティブ要素への `focus-visible` リング追加（Button、MessageAlert、ApproverSelector）

## 実施内容

### Phase 1: カラーコントラスト改善

テーブルヘッダーの `text-secondary-500`（#64748b）を `text-secondary-600`（#475569）に変更。`bg-secondary-50` 背景上でのコントラスト比を ~4.4:1（AA 未達）から ~6.4:1（AA 適合）に改善した。

対象: 6 ファイル（PermissionMatrix、Workflow/List、AuditLog/List、User/List、Task/List、Role/List）および styles.css のデザインガイドライン。

### Phase 2: フォームラベル追加

- ApproverSelector: 検索入力に `aria-label="承認者を検索"`、解除ボタンに `aria-label="承認者を解除"` を追加
- PermissionMatrix: "すべて" チェックボックスに `aria-label="<リソース名> すべて"`、個別チェックボックスに `aria-label="<リソース名> <アクション名>"` を追加

TDD でテストから実装。`Test.Html.Query` + `Test.Html.Selector` で HTML 属性を検証。

### Phase 3: フォーカスインジケータ追加

- Button: `baseClass` に `outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2` を追加
- MessageAlert: 閉じボタンに `rounded outline-none focus-visible:ring-2 focus-visible:ring-primary-500` を追加
- ApproverSelector: 解除ボタンに同様のフォーカスリングを追加

TDD でテストから実装。

## 判断ログ

- Phase 1: `text-secondary-600` を採用（700 は過度なコントラスト。600 で 6.4:1 と AA 基準 4.5:1 を十分超過し、テーブルヘッダーの控えめな視覚的役割を維持）
- Phase 1: `text-secondary-500` の変更はテーブルヘッダー（`bg-secondary-50` 上）に限定。白背景上では ~4.6:1 で AA を満たすため全箇所変更は不要
- Phase 3: 背景色付きボタンには `ring-offset-2` を使用（リングとボタンの間に白いギャップを設け視認性確保）。背景透過の小ボタンには `ring-offset` なし
- Phase 3: Button の `baseClass` をテスト用に公開（`variantClass` の前例に準拠）。ただし `view` 関数で描画した HTML のクラス属性を `Test.Html.Query.has` で検証する方式を採用し、`baseClass` の公開は不要だった
- Refactor: elm-test で `Query.find [ Selector.tag "button" ]` は子孫のみを検索するため、ルート要素が `<button>` の場合は直接 `Query.has` を使う必要がある

## 成果物

### コミット

1. `#615 Improve table header color contrast for WCAG 2.1 AA`
2. `#615 Add aria-label to form elements for WCAG 2.1 AA compliance`
3. `#615 Add focus-visible indicators to interactive elements`

### 変更ファイル

プロダクションコード:
- `frontend/src/styles.css` — デザインガイドライン更新
- `frontend/src/Component/Button.elm` — フォーカスリング追加
- `frontend/src/Component/MessageAlert.elm` — フォーカスリング追加
- `frontend/src/Component/ApproverSelector.elm` — aria-label + フォーカスリング追加
- `frontend/src/Component/PermissionMatrix.elm` — コントラスト改善 + aria-label 追加
- `frontend/src/Page/Workflow/List.elm` — コントラスト改善
- `frontend/src/Page/AuditLog/List.elm` — コントラスト改善
- `frontend/src/Page/User/List.elm` — コントラスト改善
- `frontend/src/Page/Task/List.elm` — コントラスト改善
- `frontend/src/Page/Role/List.elm` — コントラスト改善

テストコード:
- `frontend/tests/Component/ButtonTest.elm` — フォーカスインジケータテスト追加
- `frontend/tests/Component/ApproverSelectorTest.elm` — view テスト追加（aria-label + フォーカスリング）
- `frontend/tests/Component/PermissionMatrixTest.elm` — 新規作成（aria-label テスト）
- `frontend/tests/Component/MessageAlertTest.elm` — フォーカスインジケータテスト追加
