# Playwright E2E テスト導入

## 概要

Issue #128 に基づき、Playwright による E2E テストを導入した。ダッシュボード表示、申請フロー、承認フローの 3 カテゴリ 8 テストを作成し、CI 統合まで完了した。

## 実施内容

### Phase 1: Playwright セットアップ + スモークテスト

- `tests/e2e/` ディレクトリを新規作成（`@playwright/test` 依存）
- `playwright.config.ts` 作成（baseURL は `E2E_BASE_URL` 環境変数で制御）
- 認証セットアップ: API ログイン（`POST /api/v1/auth/login`）で Cookie を取得し `storageState` に保存
- ダッシュボードテスト 3 件: ページ表示、KPI カード、クイックアクション

### Phase 2: 申請フローテスト

- 新規申請ページ表示テスト
- 申請フォーム入力→送信→一覧反映テスト
  - 重複 `id="title"` 問題: メインタイトルは `getByPlaceholder` で、動的フォームの「件名」は `.bg-secondary-50` コンテナにスコープして回避
  - 送信後はページ遷移なし（「申請が完了しました」メッセージ表示）→ 明示的に `/workflows` へ遷移して確認

### Phase 3: 承認フローテスト

- タスク一覧表示テスト
- 承認操作→ステータス更新テスト
  - 管理者が自分自身を承認者に指定する設計で、単一セッションで完結
  - 「承認」ボタンと確認ダイアログの「承認する」ボタンの区別: `exact: true` で対応

### Phase 4: CI 統合 + justfile

- `scripts/run-e2e-tests.sh` 作成（API テスト環境を再利用）
- justfile に `test-e2e` レシピ追加、`check-all` に統合
- CI に `e2e-test` ジョブ追加（変更検出: `backend/**`, `frontend/**`, `tests/e2e/**`）
- 開発環境構築手順書に Playwright セクション追加

## 判断ログ

- 認証方式: API ログイン + storageState を採用（ログインページ未実装のため UI 認証は不可、Playwright 推奨パターン）
- ディレクトリ配置: `tests/e2e/` に配置（既存の `tests/api/` パターンに合わせる）
- ブラウザ: Chromium のみ（MVP として必要十分）
- CI: API テスト環境（ポート 14000-14002、DB 15433、Redis 16380）を再利用
- Vite dev server: CI では `VITE_PORT=15173 BFF_PORT=14000` で起動し、テスト用 BFF にプロキシ

## 成果物

### コミット

| コミット | 内容 |
|---------|------|
| `1d685a8` | Playwright セットアップ + ダッシュボードスモークテスト |
| `3f94db7` | 申請フローテスト |
| `f614aa5` | 承認フローテスト |
| `c84dc8c` | CI 統合 + justfile + 実行スクリプト |

### 作成ファイル

| ファイル | 内容 |
|---------|------|
| `tests/e2e/` | Playwright プロジェクト一式 |
| `scripts/run-e2e-tests.sh` | E2E テスト実行スクリプト |

### 更新ファイル

| ファイル | 変更内容 |
|---------|---------|
| `.github/workflows/ci.yaml` | `e2e-test` ジョブ追加 |
| `justfile` | `test-e2e`、`check-all`、`check-tools`、`setup-deps` 更新 |
| `docs/04_手順書/01_開発参画/01_開発環境構築.md` | Playwright セクション追加 |

### PR

- Draft PR #434: https://github.com/ka2kama/ringiflow/pull/434
