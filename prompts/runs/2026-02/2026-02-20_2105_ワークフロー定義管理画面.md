# ワークフロー定義管理画面の実装

Issue: #724
PR: #734
ブランチ: `feature/724-workflow-definition-management`

## 概要

テナント管理者向けのワークフロー定義管理画面を Elm フロントエンドで実装した。CRUD API（#723、PR #730）が完了済みの状態から、フロントエンド実装に集中。6 Phase の TDD で一覧表示・作成・公開・アーカイブ・削除の全機能を構築した。

## 実施内容

### Phase 1: Data モデル拡張

`Data/WorkflowDefinition.elm` に `WorkflowDefinitionStatus` カスタム型と関連ヘルパーを追加。

- `statusFromString`: 文字列→型変換（`Maybe` ではなく `Draft` フォールバック。UI フィルタ用途で安全なデフォルトが望ましいため）
- `statusToBadge`: `Data.AdminUser.BadgeConfig` 型を再利用し、管理画面間でバッジ表示を統一
- `encodeCreateRequest`: バックエンドが要求する最小限の `definition` JSON（開始ステップのみ）を含むエンコーダー
- `encodeVersionRequest`: 公開・アーカイブ操作の楽観的ロック用

テスト: 16 件

### Phase 2: API クライアント拡張

`Api/WorkflowDefinition.elm` に 4 関数を追加。

- `createDefinition` (POST), `publishDefinition` (POST /{id}/publish), `archiveDefinition` (POST /{id}/archive): `Api.post` パターン
- `deleteDefinition` (DELETE /{id}): `Api.deleteNoContent` パターン（204 No Content）

### Phase 3: ルーティング

`Route.elm` に `WorkflowDefinitions` バリアントを追加。URL: `/workflow-definitions`（既存の `/workflows` と明確に区別）。

テスト: 3 件（fromUrl, toString, isRouteActive）

### Phase 4: 一覧ページ実装

`Page/WorkflowDefinition/List.elm` を新規作成（672 行）。既存の `Page/Role/List.elm`, `Page/User/List.elm` のパターンに準拠。

- ステータスフィルタ（クライアントサイド、select 要素）
- 作成ダイアログ（HTML `<dialog>` + `Ports.showModalDialog`）
- 確認ダイアログ（`ConfirmDialog` コンポーネント再利用、ActionStyle を操作種別にマッピング）
- `PendingAction` 型で公開/アーカイブ/削除の操作状態を型安全に管理

### Phase 5: Main.elm 統合

Main.elm に 8 箇所の変更（import, Page 型, initPage, Msg 型, update, viewPage, updatePageShared, viewAdminSection）。`Component/Icons.elm` にフロー図モチーフのアイコンを追加。

### Phase 6: E2E テスト

3 テストケース: 一覧閲覧、作成（Draft 状態確認）、公開→アーカイブのライフサイクル。E2E テスト突合表を更新。

## 判断ログ

- 計画段階: 作成 UI はダイアログ方式を選択（入力項目が名前・説明のみで別ページは不要）
- 計画段階: デザイナーへの遷移は #725/#726 の責務として本 Story から除外（Story 独立性を優先）
- 計画段階: ステータスフィルタは URL パラメータ対応を見送り、クライアントサイドで管理
- Phase 1: `statusFromString` のフォールバック方針として `Maybe` ではなく `Draft` を選択（UI フィルタのデフォルト値として安全）
- Phase 4: `onClick` を未使用のまま import していたことを elm-review が検出。`Button.button` コンポーネント経由でクリックハンドラを設定するため不要だった

## 成果物

### コミット

- `5ca4cc5` #724 Implement workflow definition management screen

### 作成・更新ファイル

| ファイル | 種別 |
|---------|------|
| `frontend/src/Data/WorkflowDefinition.elm` | 変更 |
| `frontend/src/Api/WorkflowDefinition.elm` | 変更 |
| `frontend/src/Route.elm` | 変更 |
| `frontend/src/Page/WorkflowDefinition/List.elm` | 新規 |
| `frontend/src/Main.elm` | 変更 |
| `frontend/src/Component/Icons.elm` | 変更 |
| `frontend/tests/Data/WorkflowDefinitionStatusTest.elm` | 新規 |
| `frontend/tests/RouteTest.elm` | 変更 |
| `tests/e2e/tests/workflow-definition-management.spec.ts` | 新規 |
| `docs/50_テスト/E2Eテスト突合表.md` | 変更 |
