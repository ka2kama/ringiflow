# デモ環境 DevAuth 有効化

## 概要

Lightsail デモ環境で DevAuth を有効にし、認証済み状態でダッシュボードの API 呼び出しが成功するようにした。Docker ビルド引数で本番/デモのフィーチャー切り替えを実現。

Issue: #274

## 実施内容

### 問題

- デモ環境（`https://demo.ka2kama.com`）でダッシュボードは表示されるが API 呼び出しが失敗
- 本番ビルド（`--no-default-features`）により DevAuth が除外されており、セッションが存在しない
- フロントエンドのログインページは未実装

### 対応方針

ログインページの実装は別 Issue に分離し、#274 では DevAuth をデモ環境でも有効にする最小限の対応に留めた。

### 変更内容

1. **Backend Dockerfile**: `CARGO_FEATURES` ビルド引数を追加（デフォルト: `--no-default-features`）
2. **Frontend main.js**: `VITE_DEV_AUTH` 環境変数による Cookie 設定の条件追加
3. **Frontend Dockerfile**: `VITE_DEV_AUTH` ビルド引数を追加
4. **Lightsail docker-compose**: BFF に `DEV_AUTH_ENABLED: "true"` を追加
5. **Lightsail .env.example**: `DEV_AUTH_ENABLED` の説明を追加
6. **デプロイスクリプト**: デモ用ビルド引数をハードコード
7. **DevAuth ナレッジベース**: デモ環境での使用方法を追記

## 判断ログ

- スコープ判断: ログインページ実装は別 Issue に分離。デモ環境を動かす最小限の対応に留めた
- Dockerfile のビルド引数方式を採用（別 Dockerfile を作らない）。重複排除とメンテナンスコストの観点
- Cookie の Secure フラグとの共存を確認。HTTPS 経由なら Secure フラグなしの Cookie も送信される

## 成果物

### コミット

- `c126715` #274 Enable DevAuth for Lightsail demo environment

### 作成・更新ファイル

| ファイル | 変更内容 |
|---------|---------|
| `backend/Dockerfile` | `CARGO_FEATURES` ビルド引数追加 |
| `frontend/Dockerfile` | `VITE_DEV_AUTH` ビルド引数追加 |
| `frontend/src/main.js` | DevAuth 条件に `VITE_DEV_AUTH` チェック追加 |
| `infra/lightsail/docker-compose.yaml` | `DEV_AUTH_ENABLED` 追加 |
| `infra/lightsail/.env.example` | DevAuth 設定セクション追加 |
| `infra/lightsail/deploy.sh` | デモ用ビルド引数追加 |
| `docs/80_ナレッジベース/security/DevAuth.md` | デモ環境での使用方法追記 |

### PR

- #433 (Draft)
