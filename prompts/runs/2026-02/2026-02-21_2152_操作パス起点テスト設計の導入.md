# 操作パス起点テスト設計の導入

## 概要

Issue #765 — 完了基準・テスト計画を操作パス起点で設計する仕組みを導入した。TDD フロー、Issue 駆動開発、zoom-rhythm のルールファイル、ナレッジベースの 4 領域にわたるドキュメント改訂。セッション中に計画ファイルのコミット漏れが再発し、改善対策のデグレという新たな構造的問題を発見・記録した。

## 実施内容

### Phase 1: TDD フローに「操作パスの列挙」ステップを追加

- テストリストセクションに「操作パスの列挙（テストリスト作成の前に）」を挿入
  - 適用条件表（フルスタック: 必須、API: 必須、ドメイン: 推奨、ドキュメント: 不要）
  - 4 ステップの手順、操作パス分類表、テスト層変換表
- 「テスト設計の方向性」セクションを追加（トップダウン設計 × ボトムアップ実装）
- 「作成のコツ」を操作パス起点に更新
- ログイン機能の例に操作パス列挙を追加
- ワークフロー Mermaid 図に「操作パスを列挙」ノードを追加

### Phase 2: Issue 駆動開発の完了基準と品質チェックリスト更新

- 完了基準セクションに「完了基準と操作パス」サブセクションを追加
  - コンポーネント実装レベル vs 操作パスレベルの対比表
- 品質チェックリストのテスト項目を操作パス起点の検証に強化

### Phase 3: zoom-rhythm.md の更新

- ギャップ発見観点に「操作パス網羅漏れ」を追加
- 計画ファイル必須要素に「操作パス」セクションを追加（テストリストの前提として配置）

### Phase 4: ナレッジベースと改善記録の更新

- 「独自フレームワークと既知手法の対応」に BDD/ATDD/Cockburn Use Cases との対応を追記
- 改善記録の対策 L0 の次のアクションを完了に更新

### 追加対応: 計画ファイルのコミット漏れ再発

- 計画ファイル `prompts/plans/wild-squishing-origami.md` のコミット漏れを指摘で発見
- 品質ゲートフロー（6.4）に計画ファイル確認ステップを再追加（PR #589 で追加後、リファクタリングで消失していた）
- 改善対策のデグレという構造的問題を識別し、改善記録を作成（Issue #767）

## 判断ログ

- 操作パス列挙の配置: TDD フローのテストリストセクション内に配置（テストリスト作成の直前ステップとして自然な位置）
- Cockburn Use Cases の採用レベル: MSS + Extensions の簡略版（完全な Use Case 記述はオーバーヘッド）
- テスト設計の方向性: トップダウン設計 × ボトムアップ実装を明示（ATDD の二重ストリームに対応）
- 適用条件: ユーザー操作を伴う Issue のみ必須（ドキュメント/インフラは不要）

## 成果物

### コミット

1. `b7b23d0` — worktree-remove の Docker bind mount 修正
2. `5306983` — 操作パス起点テスト設計の導入（5 ファイル）
3. `c8287db` — 計画ファイルの追加
4. `9391e0b` — 品質ゲートフローに計画ファイル確認ステップを再追加
5. `0f839f7` — 改善記録の追加（ドキュメント再構成時の対策デグレ）

### 作成・更新ファイル

| ファイル | 変更内容 |
|---------|---------|
| `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md` | 操作パス列挙ステップ、テスト設計の方向性、例の更新 |
| `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` | 完了基準の操作パス観点、品質チェックリスト更新、計画ファイル確認ステップ再追加 |
| `.claude/rules/zoom-rhythm.md` | ギャップ発見観点、計画ファイル必須要素 |
| `docs/06_ナレッジベース/methodology/独自フレームワークと既知手法の対応.md` | BDD/ATDD/Cockburn 対応 |
| `process/improvements/2026-02/2026-02-21_1700_子Issue分割実装時の操作パス検証欠落.md` | 対策 L0 完了 |
| `process/improvements/2026-02/2026-02-16_2301_planモード後のコンテキスト喪失による計画ファイルのコミット漏れ.md` | 再発記録 |
| `process/improvements/2026-02/2026-02-21_2152_ドキュメント再構成時の改善対策デグレ.md` | 新規作成 |
| `prompts/plans/wild-squishing-origami.md` | 計画ファイル（#765） |

### Issue

- #767: ドキュメント再構成時の改善対策デグレ検出の仕組み導入

## 議論の経緯

### 計画ファイルのコミット漏れ再発

PR 作成時に `prompts/plans/wild-squishing-origami.md` を「作業と無関係なファイル」と判断した。コンテキスト圧縮により plan mode で作成した記憶が失われていた。指摘を受け、同じ問題の過去の改善記録（2026-02-16）を発見。PR #589 で追加した対策ステップが、CLAUDE.md リファクタリング時に消失していたことが判明。

### 改善対策のデグレは構造的問題

当初「ドキュメント再構成時は既存対策の保持を確認する」という教訓として扱おうとしたが、これはデグレ（品質後退）であり、行動規範ではなく構造的対策が必要との指摘を受けた。分析の結果、27 件の改善対策が 10 ファイルに埋め込まれているがデグレ検出の仕組みがないことを確認。改善記録と Issue を作成した。
