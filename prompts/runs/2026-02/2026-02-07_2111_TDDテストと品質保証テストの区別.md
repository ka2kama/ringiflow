# TDD テストと品質保証テストの区別

## 概要

TDD フロードキュメント（`docs/60_手順書/04_開発フロー/02_TDD開発フロー.md`）に、TDD で書くテストと品質保証テストの区別を明記した。Refactor ステップの拡充、テストリストの二面性の明記、Phase 完了時のテストレビューステップの追加を行った。

## 背景と目的

Issue #279 で指摘された課題:
- TDD の Refactor ステップがプロダクションコードの改善のみに焦点を当てており、テストコード自体のリファクタリングへの言及がなかった
- TDD サイクル中にテストの統廃合を行う観点がなかった
- TDD で書いたテストがそのまま最終成果物になる暗黙の前提があった

## 実施内容

3ファイル、6箇所の変更:

1. `02_TDD開発フロー.md` — Refactor ステップにテストコードのリファクタリングを明記（プロダクションコードとテストコードを分離して記載）
2. `02_TDD開発フロー.md` — テストリストの二面性（TDD サイクル中 = 実装の道標、Phase 完了時 = 仕様の文書化）を表形式で追加
3. `02_TDD開発フロー.md` — Phase 完了時のテストレビューステップを MVP 積み上げ方式セクション内に追加（冗長性・網羅性・明確さ・構造の4観点）
4. `01_Issue駆動開発.md` — 品質チェックリストのテスト項目にテストレビュー済みかの確認を1行追加
5. `zoom-rhythm.md` — テストフェーズチェックリストにテスト品質の観点を1行追加
6. `02_TDD開発フロー.md` — 変更履歴の更新

## 設計上の判断

### テストレビューの配置場所

テストレビューを「MVP 積み上げ方式」セクション内のサブセクションとして配置。TDD サイクルと同レベルの独立セクションにする案も検討したが、テストレビューは Phase 完了時のアクションの一部であり、独立性はそこまで高くないと判断した。

### Refactor とテストレビューの二層構造

zoom-rhythm.md の「局所作業 vs 俯瞰」のリズムをテストにも適用:
- Refactor ステップ: TDD サイクルごとの局所的なテスト改善
- テストレビュー: Phase 完了時のテスト全体の俯瞰整理

### AAA vs Given-When-Then の用語統一

Refactor ステップのテストコード確認項目で、テスト構造の用語を AAA（Arrange-Act-Assert）に統一した。

- AAA は TDD の文脈で自然（Kent Beck 由来）
- Given-When-Then は BDD 由来であり、BDD 採用は Issue #106（テスト設計方針の策定）で別途検討する
- 既存の Red ステップのコード例も AAA を使用しており、一貫性が保たれる

## 成果物

- コミット:
  - `#279 Distinguish TDD tests from quality assurance tests in TDD flow`
  - `#279 Align test structure terminology to Given-When-Then (AAA)`
  - `#279 Use AAA terminology consistently in TDD flow`
- Draft PR: #283

## 議論の経緯

### AAA と Given-When-Then の用語の混在

ユーザーから、追加したテストコードの確認項目で AAA と Given-When-Then が混在している指摘があった。既存のパターン2 セクションが「Given-When-Then（AAA）」と併記しており、どちらに統一するか議論した。

BDD フロー自体を採用する案も浮上したが、テスト設計方針の変更は #279 のスコープ外であり、Issue #106（テスト設計方針の策定）で検討すべきと整理。今回は TDD の文脈に自然な AAA に統一した。

## 学んだこと

- TDD のテストと品質保証テストは性質が異なる。TDD のテストは「設計発見のフィードバックループ」であり、品質保証テストは「仕様の文書化」。この区別を明示することで、テストの品質が意識的に管理される
- AAA と Given-When-Then は同じ三相構造を異なる文脈で表現したもの。用語の選択は単なる好みではなく、テストの位置づけ（構造の検証 vs 仕様の表現）を反映する

## 次のステップ

- PR #283 のレビュー・マージ
- Issue #106（テスト設計方針の策定）で BDD 採用を含むテスト用語の統一を検討
