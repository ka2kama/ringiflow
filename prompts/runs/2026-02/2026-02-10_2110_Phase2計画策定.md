# Phase 2 計画策定

## 概要

Issue #393 に基づき、Phase 2（機能拡張）のスコープを定義した。既存ロードマップの Phase 2 セクション（9 機能の概要列挙のみ）を、5 サブフェーズに分割した詳細計画に更新した。合わせて各サブフェーズの Epic Issue を GitHub に作成した。

## 実施内容

### 1. 要件・設計書の確認

Phase 2 各機能の要件が実装開始に十分か確認した。

| ドキュメント | 確認結果 |
|-------------|---------|
| コア要件（CORE-03, WF-002 等） | 全要件 ID 定義済み |
| 基本設計書 7.1.3 節（RLS 二重防御） | 設計詳細あり。Phase 2-1 着手に十分 |
| テナント退会時データ削除設計 | Phase 2 追加データストア（DynamoDB 監査ログ、S3 ドキュメント）が既に削除対象として定義済み |
| 機能仕様書（ワークフロー管理） | 単一承認のシナリオのみ。複数ステップ・差し戻しのシナリオは未記載 |

### 2. サブフェーズ分割

依存関係・学習効果・プロダクト完成度の 3 軸で 9 機能を 5 サブフェーズに分割した。

| サブフェーズ | 機能 | 分割理由 |
|-------------|------|---------|
| 2-1 | マルチテナント RLS | 全機能の基盤。設計ドキュメントが最も充実 |
| 2-2 | ユーザー管理 + 監査ログ | RLS の実運用検証。監査ログは横断的基盤 |
| 2-3 | 複数ステップ承認 + 差し戻し + コメント | ワークフロー実行層の拡張。デザイナーの前提 |
| 2-4 | ワークフローデザイナー | Phase 2 の目玉。実行エンジンが動く状態が前提 |
| 2-5 | 通知 + ドキュメント管理 | AWS 連携（SES, S3）。独立した学習ドメイン |

### 3. 実装ロードマップ更新

`docs/03_詳細設計書/00_実装ロードマップ.md` の Phase 2 セクションを更新した（+250 行, -35 行）。

追加した情報:
- 各サブフェーズのスコープ・アーキテクチャ変更点・学習ポイント・完了基準
- 設計ドキュメントの準備状況（不足箇所を ⚠️ で明示）
- サブフェーズ依存関係の Mermaid フローチャート
- Phase 2 全体の完了基準

### 4. Epic Issue 作成

| Issue | サブフェーズ | Milestone |
|-------|------------|-----------|
| #402 | Phase 2-1 マルチテナント RLS | Phase 2 |
| #403 | Phase 2-2 ユーザー管理 + 監査ログ | Phase 2 |
| #404 | Phase 2-3 複数ステップ承認 + 差し戻し + コメント | Phase 2 |
| #405 | Phase 2-4 ワークフローデザイナー | Phase 2 |
| #406 | Phase 2-5 通知 + ドキュメント管理 | Phase 2 |

## 判断ログ

- サブフェーズ分割で、RLS を最初に置く判断をした。理由: 他の全機能がテナント分離を前提とするため、セキュリティ基盤を最初に確立する必要がある
- Phase 2-3 と Phase 2-5 を並列可能にした。理由: 通知・ドキュメント管理は承認フロー実行が前提だが、デザイナー（2-4）とは独立しているため
- 設計ドキュメント不足を Issue 化せず、ロードマップ内に ⚠️ で記載した。理由: 各サブフェーズ着手時に作成する方が効率的（先に作ると実装時にずれが生じる）

## 成果物

### コミット

| コミット | 内容 |
|---------|------|
| `9123021` | `#393 WIP: Define Phase 2 scope and subphase plan` |
| `60f818d` | `#393 Update Phase 2 roadmap with 5 subphase structure` |

### 作成・更新ファイル

| ファイル | 操作 |
|---------|------|
| `docs/03_詳細設計書/00_実装ロードマップ.md` | 更新（Phase 2 セクション詳細化） |

### GitHub リソース

| リソース | URL |
|---------|-----|
| Draft PR #401 | https://github.com/ka2kama/ringiflow/pull/401 |
| Epic Issue #402〜#406 | Phase 2 サブフェーズ Epic |
