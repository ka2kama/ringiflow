# 設計原則レンズ検証項目見直し

Issue: #891
PR: #892
計画ファイル: `prompts/plans/891_design-principle-lens-review.md`

## 概要

設計原則レンズ（TDD Refactor ステップで設計品質を評価する仕組み）の検証項目を見直した。レンズ間の具体性のばらつきを解消し、品質チェックリストとの役割分担を明確化し、既知手法との対応を更新した。

## 実施内容

### Phase 1: 設計原則レンズの問い改善（TDD開発フロー.md）

- 抽象的だったレンズに「手がかり」を追加:
  - 意図の明確さ: 関数名・変数名・コメント代替の観点
  - SRP: レイヤー別の変更理由（Handler/UseCase/Repository/Domain Entity）
  - DIP: プロジェクトのレイヤー依存方向ルール（`apps → domain → shared`）
  - 型の活用: ADR-016/051/054 の 3 つの型活用パターン + 境界型変換 + 不変条件保護
- レンズと品質チェックリストの関係説明を更新（作り込み vs 最終確認）
- 既知手法テーブルに 4 行追加、参考資料に 4 件追加

### Phase 2: 品質チェックリストの役割分担明確化（Issue駆動開発.md）

- マイナス→ゼロ: 「String/整数の濫用」→「既存の Newtype を使わず生の String/整数を使用していないか」
- ゼロ→プラス: 「型で防げる不正状態」→「新たに型で防げる不正状態がないか（Newtype 候補、型安全ステートマシン化、構造的強制の機会）」

### Phase 3: 既知手法との対応更新（独自フレームワークと既知手法の対応.md）

- mermaid 図にコード設計レンズのノードと 4 つの既知手法ノードを追加
- 新セクション「設計原則レンズ（コード設計）と既知手法」を追加:
  - Four Rules of Simple Design（Beck, 2000）
  - SOLID 原則 SRP・DIP（Martin, 2003）— OCP/LSP/ISP 不採用理由も記載
  - Making Illegal States Unrepresentable（Minsky, 2011; Feldman, 2016）
  - Parse, don't validate（King, 2019）
- 関連リソースに 6 件追加

## 判断ログ

- 2列テーブル（問い列に手がかりを含める）を採用。3列テーブル（問い | 手がかり）は Markdown 横幅過大で既存パターンとも不整合のため不採用
- マイナス→ゼロ / ゼロ→プラスの区分基準: 既存パターンへの準拠確認（欠陥）vs 新しい改善機会の発見（品質向上）
- SOLID のうち OCP/LSP/ISP はレンズに含めない判断: OCP は関数型スタイルで自然に実現、LSP は trait 実装が少なく適用場面が限定的、ISP はモジュール分割で対応済み

## 議論の経緯

- 計画段階で「マイナス→ゼロが型に終止していないか」という指摘があった
- 分析: Phase 2 の変更は型関連項目のみだが、これは Issue スコープが型関連の重複解消に限定されているため。不具合検出や考慮漏れは既存のマイナス→ゼロ項目（アーキテクチャ一貫性、仕様突合、レイヤー間接続等）で検証される
- 背景として ISO 25010 に基づく品質追求（理念2）の Want への適合見直しの一環であることを計画に追記し、品質チェックリスト全体と ISO 25010 品質特性の対応見直しは将来の Issue 候補として認識

## 成果物

### コミット

- `#891 Improve design principle lens heuristics and known method mappings`

### 変更ファイル

- `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md` — レンズの問い改善、既知手法テーブル・参考資料追加
- `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` — 品質チェックリストの型関連項目の役割分担明確化
- `docs/06_ナレッジベース/methodology/独自フレームワークと既知手法の対応.md` — コード設計レンズセクション新設
- `prompts/plans/891_design-principle-lens-review.md` — 計画ファイル
