# シードデータ充実化

## 概要

開発・デモ環境のシードデータを充実させた。ユーザー 2→10人、ワークフローインスタンス 5→30件、ステップ 4→28件、コメント 0→12件に拡充。実装中に `ORDER BY created_at` の非決定性バグを発見・修正した。

## 実施内容

1. Issue #679 を作成し、`feature/679-enrich-seed-data` ブランチで作業
2. 計画ファイルを作成（UUID 体系、データ設計、検証クエリを含む）
3. マイグレーション `20260219000001_seed_additional_data.sql` を作成（751行）
   - ユーザー 8人追加（田中〜中村、多様なロール構成）
   - インスタンス 25件追加（draft/pending/in_progress/approved/rejected の分布）
   - ステップ 24件追加（汎用承認 + 2段階承認の両パターン）
   - コメント 12件追加（承認プロセスに沿ったリアルなコメント）
   - display_id_counters の更新
4. API テスト `multi_step_approve.hurl` の失敗を発見・修正
   - 根本原因: `find_by_instance` の `ORDER BY created_at ASC` が非決定的
   - `submit.rs` で全ステップを同じ `now` タイムスタンプで作成するため、`created_at` が同一値
   - `ORDER BY display_number ASC` に変更して解決

## 判断ログ

- `ORDER BY created_at ASC` → `ORDER BY display_number ASC` に変更。`display_number` は `counter_repo.next_display_number()` で単調増加するため、常に正しい順序を保証する。既存の他のクエリ（`find_by_assigned_to` 等）は `created_at DESC` で問題ないため変更なし

## 成果物

- コミット: `70f99d7` - `#679 Enrich seed data with users, instances, steps, and comments`
- PR: #682 (Draft)
- 新規ファイル:
  - `backend/migrations/20260219000001_seed_additional_data.sql`
  - `prompts/plans/calm-brewing-token.md` → `679_enrich-seed-data.md`（リネーム）
- 変更ファイル:
  - `backend/crates/infra/src/repository/workflow_step_repository.rs` (ORDER BY 修正)
  - `backend/.sqlx/query-*.json` (sqlx キャッシュ更新)
