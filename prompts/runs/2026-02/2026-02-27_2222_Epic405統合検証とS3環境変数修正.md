# Epic #405 統合検証と S3 環境変数修正

## 概要

Epic #405（ワークフローデザイナーを実装する）の統合検証を実施しクローズした。検証過程で `just check-all` が S3 環境変数の欠落により失敗する問題を発見し、Issue #963 として修正を実施した。

## 実施内容

### Epic #405 統合検証

- 6 つの Story（#722-#727）が全て CLOSED であることを確認
- テストピラミッド全層（ユニット、ハンドラ、API、E2E）でワークフローデザイナー関連テストの存在と通過を確認
- テスト責任マッピングを作成し、Epic 本文に記録
- 統合検証コメントを投稿し、Epic をクローズ

### S3 環境変数修正（Issue #963）

- `just check-all` 実行時に S3 統合テスト（5件）が `dispatch failure` で失敗
- API テスト実行時に core-service が `S3_BUCKET_NAME` 未設定で panic
- 原因: `scripts/env/setup.sh` の sentinel キーが `API_TEST_POSTGRES_PORT`（#624 時代）のままで、S3 導入（#917）後の `.env` 再生成がトリガーされなかった
- 修正: sentinel キーを `MINIO_API_PORT` に更新
- `just setup` 再実行で `.env` ファイルが再生成され、全テスト通過を確認
- PR #966 を作成し Ready for Review

## 判断ログ

- sentinel キーの選定: `MINIO_API_PORT` を選択。S3 インフラ導入（#917）で追加された変数であり、この変数が `.env` に存在しなければ S3 設定が欠落していると判定できる。`generate.sh` に既に S3 設定が含まれているため、sentinel の更新のみで解決

## 成果物

### コミット

- `9dce3c5b` #963 Update setup.sh sentinel key to detect stale S3 env vars

### 変更ファイル

- `scripts/env/setup.sh` — sentinel キーを `API_TEST_POSTGRES_PORT` → `MINIO_API_PORT` に更新

### Issue / PR

- Issue #963: S3 環境変数の未設定により just check-all / just test-api が実行不可
- PR #966: #963 Update setup.sh sentinel key to detect stale S3 env vars（Ready for Review）

### GitHub 操作

- Epic #405: 統合検証コメント投稿、クローズ
- Issue #963: 精査コメント投稿、完了基準チェック更新
