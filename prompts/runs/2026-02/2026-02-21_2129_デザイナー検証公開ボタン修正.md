# デザイナー検証・公開ボタン修正

Issue: [#761](https://github.com/ka2kama/ringiflow/issues/761)
PR: [#762](https://github.com/ka2kama/ringiflow/pull/762)

## 概要

ワークフローデザイナー画面の「検証」ボタンと「公開」ボタンが動作しない不具合を修正した。

- 検証ボタン: API リクエストボディに `definition` ラッパーが欠落し、デシリアライズエラーが発生していた
- 公開ボタン: ダイアログ ID のハードコード（`"designer-publish-dialog"`）が `ConfirmDialog.dialogId`（`"confirm-dialog"`）と不一致で、確認ダイアログが表示されなかった

## 実施内容

### バグ修正

1. `Data/WorkflowDefinition.elm` に `encodeValidationRequest` 関数を追加（既存 `encodeUpdateRequest` パターンに準拠）
2. `Designer.elm` の 3 箇所を修正:
   - `ValidateClicked`: `body = definition` → `body = WorkflowDefinition.encodeValidationRequest { definition = definition }`
   - `ConfirmPublish` の else ブランチ: 同上
   - `PublishClicked`: `"designer-publish-dialog"` → `ConfirmDialog.dialogId`

### テスト追加

- Elm ユニットテスト: `encodeValidationRequest` が `definition` フィールドでラップすることを検証
- E2E テスト 2 件: デザイナー画面の検証ボタン・公開ボタンの動作を検証

### 改善記録

子 Issue 分割実装時に UI 操作テストが欠落した問題について改善記録を作成。

## 判断ログ

- 特筆すべき判断なし（既存パターン踏襲のバグ修正のみ）

## 議論の経緯

- 不具合の原因が Issue 分割（#725/#726）による統合テスト不足に起因する可能性を分析
- 再発防止策として、ルール追加やプロセス変更ではなく改善記録のみ残す方針をオーナーと合意

## 成果物

### コミット

- `a33ae60` #761 Fix designer validate and publish buttons

### 作成/更新ファイル

| ファイル | 変更 |
|---------|------|
| `frontend/src/Data/WorkflowDefinition.elm` | `encodeValidationRequest` 関数追加 |
| `frontend/src/Page/WorkflowDefinition/Designer.elm` | 3 箇所修正 |
| `frontend/tests/Data/WorkflowDefinitionTest.elm` | ユニットテスト追加 |
| `tests/e2e/tests/workflow-definition-management.spec.ts` | E2E テスト 2 件追加 |
| `docs/08_テスト/E2Eテスト突合表.md` | テスト件数・更新履歴更新 |
| `process/improvements/2026-02/2026-02-21_1700_子Issue分割実装時の操作パス検証欠落.md` | 改善記録作成 |
| `prompts/plans/761_designer-validate-publish-buttons.md` | 計画ファイル |
