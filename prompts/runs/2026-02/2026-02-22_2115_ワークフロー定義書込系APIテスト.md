# ワークフロー定義書込系 API テスト追加

Issue: #778 / Epic: #774

## 概要

ワークフロー定義管理の書込系 6 エンドポイントの Hurl API テストを追加し、API テストカバレッジギャップを解消した。先行 Story #776（ユーザー管理）、#777（ロール管理）のパターンを踏襲。ワークフロー定義固有の状態遷移（Draft → Published → Archived）と楽観的ロック（version）の検証を含む。

## 実施内容

### テストファイルの作成

`tests/api/hurl/workflow_definition/` ディレクトリに 6 テストファイルを作成:

| ファイル | エンドポイント | テスト内容 |
|---------|-------------|-----------|
| `create_definition.hurl` | POST /api/v1/workflow-definitions | 正常系（201、status=="Draft"、version==1） |
| `validate_definition.hurl` | POST /api/v1/workflow-definitions/validate | 有効な定義（valid==true）+ 無効な定義（valid==false、missing_approval_step） |
| `update_definition.hurl` | PUT /api/v1/workflow-definitions/{id} | 名前・定義の更新（200、version 1→2） |
| `delete_definition.hurl` | DELETE /api/v1/workflow-definitions/{id} | Published 削除失敗（400）+ Draft 削除成功（204） |
| `publish_definition.hurl` | POST /api/v1/workflow-definitions/{id}/publish | Draft → Published（200、version 1→2） |
| `archive_definition.hurl` | POST /api/v1/workflow-definitions/{id}/archive | Draft → Published → Archived の全フロー（version 1→2→3） |

### 既存テストの修正

`list_workflow_definitions.hurl` を修正:
- `count == 2` → `count >= 2`: 書込テストによるデータ増加に対応
- インデックス指定の seed データアサーション → 構造検証に変更

### API テスト突合表の更新

`docs/50_テスト/APIテスト突合表.md` を更新:
- ワークフロー定義セクション: 6 EP すべて「カバー済み」に変更
- カバレッジ: ワークフロー定義 25% → 100%、全体 81.1% → 97.3%

## 判断ログ

- テスト間のデータ汚染に対応: 書込テストが DB にデータを追加するため、一覧取得テスト（`list_workflow_definitions.hurl`）のアサーションを厳密一致から構造検証に変更した

## 成果物

### コミット

- `#778 WIP: Add workflow definition write API tests` — 6 テストファイル作成 + 突合表更新
- `#778 Add workflow definition write API tests (6 endpoints)` — 一覧テスト修正 + 全テスト通過

### 作成・更新ファイル

| ファイル | 操作 |
|---------|------|
| `tests/api/hurl/workflow_definition/create_definition.hurl` | 新規作成 |
| `tests/api/hurl/workflow_definition/validate_definition.hurl` | 新規作成 |
| `tests/api/hurl/workflow_definition/update_definition.hurl` | 新規作成 |
| `tests/api/hurl/workflow_definition/delete_definition.hurl` | 新規作成 |
| `tests/api/hurl/workflow_definition/publish_definition.hurl` | 新規作成 |
| `tests/api/hurl/workflow_definition/archive_definition.hurl` | 新規作成 |
| `tests/api/hurl/workflow_definition/list_workflow_definitions.hurl` | 更新 |
| `docs/50_テスト/APIテスト突合表.md` | 更新 |
