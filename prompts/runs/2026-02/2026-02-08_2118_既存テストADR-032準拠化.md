# 既存テストの ADR-032 準拠化（Phase 3 一括適用）

## 概要

ADR-032（テスト設計方針）に対して既存テストを一括準拠させる Phase 3 修正を実施した。`fixture_` プレフィックス規則の削除、テスト関数名の日本語化、rstest フィクスチャの導入、不要な `#[allow(non_snake_case)]` の削除を行った。

## 背景と目的

ADR-032 で定義したテスト命名規則・構造化方法に対し、既存テストの一部がまだ準拠していなかった。ADR-032 の移行方針では Phase 2（ボーイスカウトルール）と Phase 3（一括適用）を定義しており、今回は Phase 3 として合理的に修正できるものを一括修正した。

## 実施内容

### 1. ADR-032: `fixture_` プレフィックス規則の削除

命名規則テーブルのフィクスチャ行を変更。`#[fixture]` 属性で識別可能なため、プレフィックスは不要と判断。rstest の引数名マッチングとの相性が悪い（プレフィックスが全呼び出し側に伝播する）点も理由。

### 2. `api_response.rs`: `test_` プレフィックス追加

ADR-032 の命名規則に従い、テスト関数に `test_` プレフィックスを追加。

### 3. `workflow.rs`: rstest フィクスチャ導入 + テスト名日本語化

- `#[allow(non_snake_case)]` を削除
- セットアップ関数を rstest フィクスチャに変換
- 英語テスト名を日本語化

### 4. `password.rs`: 不要な `#[allow(non_snake_case)]` 削除

テスト名が既に日本語で、`non_snake_case` 警告が発生しないことを確認し、不要な属性を削除。`Debug` → `debug` のリネームも実施。

### 5. `workflow_definition_repository_test.rs`: テスト名日本語化

英語テスト名を日本語化。統合テストでも ADR-032 の命名規則に準拠させた。

## 成果物

### コミット

| コミット | 内容 |
|---------|------|
| edd632f | ADR-032 から `fixture_` プレフィックス規則を削除 |
| 3a7ada1 | `api_response.rs` テスト関数に `test_` プレフィックス追加 |
| f54fa99 | `workflow.rs` rstest フィクスチャ導入 + テスト名日本語化 |
| d3b3a07 | `password.rs` 不要な `#[allow(non_snake_case)]` 削除（初版） |
| a5f8cee | `workflow_definition_repository_test.rs` テスト名日本語化 |
| 10440a1 | `password.rs` `Debug` → `debug` リネーム |

### PR

- [#312](https://github.com/ka2kama/ringiflow/pull/312)

## 学んだこと

- rstest の `#[fixture]` 属性は関数名でマッチングされるため、`fixture_` プレフィックスを付けると呼び出し側すべてにプレフィックスが伝播し、可読性が低下する。属性自体がフィクスチャであることの識別を担うため、プレフィックスは冗長
- `#[allow(non_snake_case)]` は日本語テスト名に対して実際に警告が出る場合にのみ必要。Rust コンパイラは日本語のみのテスト名に対して `non_snake_case` 警告を出さないケースがあり、不要な属性が残っていた
