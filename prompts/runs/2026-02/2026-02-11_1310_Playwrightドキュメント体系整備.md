# Playwright ナレッジベースとテストドキュメント体系の整備

Issue: #435
PR: #437
ブランチ: `feature/435-playwright`

## 概要

#128 で導入した Playwright E2E テストに関するドキュメント体系を整備した。ナレッジベース、テスト戦略セクション、E2E テスト突合表、AI エージェント向けルール、TDD 開発フローへの追記の 5 件を作成・更新した。

## 実施内容

### Phase 1: ナレッジベース `Playwright.md`

`hurl.md` のパターンに倣い、Playwright の使い方・認証パターン（storageState）・デバッグ手順・環境差異をナレッジベースとして作成した。

実装解説（`docs/07_実装解説/18_E2Eテスト/`）が #128 で既に作成済みだったため、住み分けを意識した。ナレッジベースはツールの汎用的な使い方に集中し、PR 固有の設計判断は実装解説に委ねた。

### Phase 2: テスト戦略の体系化

`docs/02_基本設計書/01_アーキテクチャ設計.md` にセクション 5.6「テスト戦略」を追加した。テストピラミッド（CORE-12 ベース）と各テスト層の役割分担・責務境界を表形式で整理し、分散していたテスト情報への参照を集約した。

### Phase 3: E2E テスト突合表

`APIテスト突合表.md` のパターンに倣い、要件定義の E2E シナリオ（E2E-001〜E2E-010）と実装済み Playwright テストの突合表を作成した。現状のクリティカルパスカバー率は 43%（3/7 必須シナリオ）。

### Phase 4: `.claude/rules/e2e-test.md`

`api-test.md` のパターンに倣い、E2E テスト実装時の AI エージェント向けルールを作成した。スコープ方針（クリティカルパスに集中）、ロケーター戦略、テストデータ管理、必須チェック項目を定義した。

### Phase 5: TDD 開発フローへの追記

E2E テストの実行タイミングセクションを追加した。E2E テストは TDD サイクルには組み込まず、品質ゲート（`just check-all`）として位置づけた。

## 判断ログ

- E2E テストと TDD の関係: E2E テストは TDD の Red-Green-Refactor サイクルに組み込まない。実行速度が遅くフィードバックループを崩すため、品質ゲートとして位置づけた
- ナレッジベースと実装解説の住み分け: ナレッジベースはツールの汎用的な使い方、実装解説は PR 固有の設計判断。重複を避けた
- ADR 不要の判断: ADR-032 で E2E の表現形式は定義済み、#128 の計画ファイルで設計判断は記録済み。新たな ADR は不要と判断した

## 成果物

### 新規作成

| ファイル | 内容 |
|---------|------|
| `docs/06_ナレッジベース/devtools/Playwright.md` | Playwright ナレッジベース |
| `docs/08_テスト/E2Eテスト突合表.md` | E2E テスト突合表 |
| `.claude/rules/e2e-test.md` | E2E テスト AI ルール |
| `prompts/plans/435_playwright-docs.md` | 計画ファイル |

### 更新

| ファイル | 変更内容 |
|---------|---------|
| `docs/02_基本設計書/01_アーキテクチャ設計.md` | セクション 5.6 テスト戦略を追加 |
| `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md` | E2E テスト実行タイミングセクション追加、チェックリスト更新 |
