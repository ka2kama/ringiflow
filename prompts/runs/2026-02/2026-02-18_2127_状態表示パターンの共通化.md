# 状態表示パターンの共通化（ErrorState / EmptyState）

Issue: [#613](https://github.com/ka2kama/ringiflow/issues/613)
Epic: [#445](https://github.com/ka2kama/ringiflow/issues/445) Story 3

## 概要

RemoteData の Failure 状態と Success+Empty 状態の表示を共通コンポーネントに抽出した。ErrorState（13 箇所、10 ファイル）と EmptyState（3 箇所、3 ファイル）を TDD で作成し、各ページの直書きを置換した。

## 実施内容

### Phase 1: ErrorState コンポーネント

1. `Component/ErrorState.elm` を新規作成
   - `view`: エラーメッセージ + リフレッシュボタン（`Button.Outline`）
   - `viewSimple`: エラーメッセージのみ
   - `containerClass`: テスト用 CSS クラス定数
   - `role="alert"` を追加（WCAG ベストプラクティス、MessageAlert との一貫性）
2. `ErrorStateTest.elm` を新規作成（`containerClass` の 3 テスト）
3. 13 箇所のエラー表示を置換
   - リフレッシュボタンあり: 8 箇所（User/List, User/Detail, Role/List, AuditLog/List, Task/List, Workflow/List, Workflow/Detail, Task/Detail）
   - リフレッシュボタンなし: 5 箇所（Home, User/New, User/Edit x2, Role/Edit）

### Phase 2: EmptyState コンポーネント

1. `Component/EmptyState.elm` を新規作成
   - `view`: メッセージ + オプショナルな description
   - `containerClass`: テスト用 CSS クラス定数
2. `EmptyStateTest.elm` を新規作成（`containerClass` の 2 テスト）
3. 3 箇所の空状態表示を置換（User/List, AuditLog/List, Task/List）

### 品質ゲートでの発見

`bg-error-50` の Grep 検証で `Page/User/Detail.elm` が計画のスコープから漏れていることを発見。追加修正を実施。

## 判断ログ

- ErrorState の API 設計: `view` + `viewSimple` の 2 関数を選択。`Maybe msg` で統一する方式より、call site での意図が明確
- テストアプローチ: elm-html-test が未導入のため、`containerClass` を公開してテスト。FormFieldTest/ButtonTest の既存パターンを踏襲
- `role="alert"` の追加: 既存コードにはなかったが、WCAG ベストプラクティスに従い追加。MessageAlert との一貫性確保
- EmptyState の padding: `py-12` に統一。Role/List (py-8) はセクションレベルのためスコープ対象外
- スコープ除外判断: Workflow/New.elm の 3 パターン、Workflow/Detail.elm:1098、Workflow/List.elm:268、Role/List.elm:218 は固有レイアウトのため対象外

## 成果物

### コミット

| コミット | 内容 |
|---------|------|
| `996e938` | WIP: Draft PR 作成 |
| `3ebe048` | ErrorState コンポーネント + 12 箇所リファクタリング |
| `43eae29` | EmptyState コンポーネント + 3 箇所リファクタリング |
| `8643e3f` | 実装計画ファイル追加 |
| `77b1a7b` | User/Detail.elm 追加修正 + 計画更新 |

### 新規ファイル

- `frontend/src/Component/ErrorState.elm`
- `frontend/src/Component/EmptyState.elm`
- `frontend/tests/Component/ErrorStateTest.elm`
- `frontend/tests/Component/EmptyStateTest.elm`
- `prompts/plans/613_state-display-patterns.md`

### 変更ファイル（12 ページファイル）

`Page/User/List.elm`, `Page/User/Detail.elm`, `Page/Role/List.elm`, `Page/AuditLog/List.elm`, `Page/Task/List.elm`, `Page/Workflow/List.elm`, `Page/Workflow/Detail.elm`, `Page/Task/Detail.elm`, `Page/Home.elm`, `Page/User/New.elm`, `Page/User/Edit.elm`, `Page/Role/Edit.elm`
