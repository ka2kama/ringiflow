# TODO/FIXME ライフサイクル管理

## 概要

ソースコード内の TODO/FIXME コメントを棚卸しし、Issue 未追跡のアノテーションを Issue 化した。さらに、Issue クローズ時に関連 TODO/FIXME を棚卸しするフローが未定義だったため、自動 lint スクリプト + プロセスドキュメント更新のハイブリッド方針で改善した。

## 実施内容

### 1. TODO/FIXME の棚卸し

grep でソースコード内の TODO/FIXME を網羅的に検索し、Issue 追跡状況を分類した。

| アノテーション | 場所 | 状態 |
|-------------|------|------|
| `FIXME(#688)` | `workflow.rs:127` | Issue #688 クローズ済みだが残存 |
| `FIXME(#854)` | `instance.rs:598` | Issue #854 OPEN（問題なし） |
| `TODO` | `New.elm:807` | Issue 未追跡 |
| `TODO(human)` | `Home.elm:114` | Issue 未追跡 |
| `TODO` x4 | `ReviewConfig.elm` | Phase 3/BFF 連携で自然解消（対象外） |

### 2. Issue 作成（3 件）

- #888: WorkflowUseCaseImpl の deps 構造体統合（too_many_arguments 解消）
- #889: ワークフロー申請の保存→申請連続処理
- #890: ダッシュボード KPI カードのデザイン実装

### 3. アノテーション更新

- `FIXME(#688)` → `FIXME(#888)` に参照先更新
- `TODO` → `TODO(#889)` に Issue 番号追加

### 4. stale-annotations.sh 作成

クローズ済み Issue を参照する TODO/FIXME を自動検出する bash スクリプトを作成。`just check-stale-annotations` として justfile に追加し、`parallel.sh` の Non-Rust レーンに組み込んだ。

### 5. ドキュメント更新

- `code-annotations.md`: ライフサイクルセクション追加（作成→維持→解消のフロー）
- Issue 駆動開発フロー Step 9: TODO/FIXME 棚卸しステップ追加

## 判断ログ

- ハイブリッド方針（手動プロセス + 自動 lint）を採用。知識-実行乖離率 45% のため、手動のみでは不十分と判断
- API 呼び出しは `gh issue view` の個別 REST。アノテーション数 <10 のため GraphQL バッチは不要（シンプルさ優先）
- `gh` 未インストール/未認証時は警告を出してスキップ（exit 0）。ローカル環境をブロックしない設計
- `ReviewConfig.elm` の TODO 4 件は対象外とした。Phase 3 / BFF 連携で自然解消するため個別 Issue 不要
- `TODO(human)` のアノテーションは維持。人間実装の目印として機能しており、Issue #890 で追跡

## 成果物

### コミット

- `4322b38` Add TODO/FIXME lifecycle management with stale annotation lint

### 作成/更新ファイル

| 種類 | ファイル |
|------|---------|
| 新規 | `scripts/check/stale-annotations.sh` |
| 新規 | `process/improvements/2026-02/2026-02-24_1500_TODO-FIXMEのライフサイクル管理不在.md` |
| 変更 | `.claude/rules/code-annotations.md` |
| 変更 | `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` |
| 変更 | `justfile` |
| 変更 | `scripts/check/parallel.sh` |
| 変更 | `backend/apps/core-service/src/usecase/workflow.rs` |
| 変更 | `frontend/src/Page/Workflow/New.elm` |

### GitHub Issue

- #888, #889, #890
