# 機能仕様書の新設

## 概要

ドキュメント体系に不足していた「機能仕様書（Functional Specification）」レイヤーを新設した。配置場所・テンプレートを決定し（ADR-040）、ワークフロー管理機能の機能仕様書を作成した。

## 背景と目的

Issue #299 に基づく。現状のドキュメント体系では、PRD 相当の `01_コア要件` と技術設計書の間に「ユーザー視点で何ができるか」を記述する場所が欠けていた。

コア要件は 25,000+ トークンの巨大ファイルで、ビジネスルール（機能 ID、優先度）、技術仕様（API 設計、スキーマ）、非機能要件が混在しており、「ユーザーから見た振る舞い」を取り出すのが困難だった。

## 実施内容

1. 既存ドキュメント体系の調査 — `10_要件定義書/`、`30_基本設計書/`、`40_詳細設計書/` の構造を確認
2. ベストプラクティス調査 — ISO/IEC/IEEE 29148、Joel Spolsky "Painless Functional Specifications"、Shape Up を調査
3. 配置場所の検討 — 3 つの選択肢（サブディレクトリ / リナンバリング / 中間番号）を比較
4. ADR-040 の作成 — `20_機能仕様書/` サブディレクトリ方式を採用
5. テンプレートの設計 — ISO 29148 SRS + シナリオ駆動の8セクション構成
6. ワークフロー管理の機能仕様書を作成 — 申請・一覧・詳細・承認・却下を網羅
7. 既存ドキュメントの参照更新 — `00_はじめに.md`、`CLAUDE.md`

## 設計上の判断

### 配置場所: サブディレクトリ方式

3 つの選択肢を検討:

| 選択肢 | 概要 |
|--------|------|
| A: `20_機能仕様書/` | 既存番号変更ゼロ |
| B: リナンバリング | 概念的にきれいだが 536 箇所の参照更新が必要 |
| C: `01.5_機能仕様書/` | 番号体系が不自然 |

選択肢 A を採用。ISO 29148 の StRS → SRS の関係に沿い、要件の詳細化として自然。#323 でリナンバリング予定のため、将来の移動も考慮済み。

### テンプレート構造: ISO 29148 + シナリオ駆動

ISO 29148 の SRS テンプレート（セクション 1-3 中心）と Joel Spolsky のシナリオ駆動アプローチを組み合わせた。Shape Up の No-gos（非ゴール明示）も取り入れた。

### 含める/除外するものの境界

「ユーザーから観察可能な振る舞い（black box）」が含める基準。API エンドポイント、DB スキーマ、コード例は除外。状態遷移図はユーザーから見えるステータスの変化として含める。

## 成果物

### コミット

- `32e6fc3` #299 Add functional specification for workflow management

### 作成/更新ファイル

| ファイル | 種別 |
|---------|------|
| `docs/70_ADR/040_機能仕様書の導入.md` | 新規 |
| `docs/20_機能仕様書/00_はじめに.md` | 新規 |
| `docs/20_機能仕様書/01_ワークフロー管理.md` | 新規 |
| `docs/10_要件定義書/00_はじめに.md` | 更新 |
| `CLAUDE.md` | 更新 |

## 議論の経緯

### 配置場所の選択

3 つの選択肢を提示し、リナンバリングのコスト（536 箇所）を確認した。ユーザーから「リナンバリングは Issue #323 でやるので今回はこだわらない」との方針が示され、サブディレクトリ方式を採用した。

## 学んだこと

- IEEE 830 は 2011 年に ISO/IEC/IEEE 29148 に superseded されており、現行の参照先は 29148
- PRD → Functional Spec → Technical Design の3層は業界標準のドキュメント階層
- Joel Spolsky の "Painless Functional Specifications" (2000) は 20 年以上経った今でも参照される古典。シナリオ駆動の記述スタイルが実用的
- 機能仕様書は「外部から観察可能な振る舞い（black box 視点）」を記述する場所。技術的な HOW は含めない

## 次のステップ

- 他の機能（認証、タスク管理、ドキュメント管理等）の機能仕様書を順次作成
- #323 でドキュメント体系のリナンバリングを実施する際に、機能仕様書の配置を見直し
