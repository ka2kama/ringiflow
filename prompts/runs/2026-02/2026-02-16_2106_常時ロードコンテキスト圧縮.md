# 常時ロードコンテキスト圧縮

## 概要

CLAUDE.md + 常時ロード rules ファイル（`paths` フロントマターなし）が計 ~74KB のコンテキストを常時占有していた問題に対処し、ルール・禁止事項を保持しつつ ~52KB（30% 削減）に圧縮した。

## 実施内容

### 手法 1: 非ルール要素の除去・冗長記述の圧縮

以下の要素を除去・圧縮した:

- Mermaid 図（zoom-rhythm.md に 3 個、CLAUDE.md に 1 個）
- 改善の経緯リンク（全常時ロードファイルから除去）
- 既知手法との関連・参照セクション
- テーブルの不要列（出典列、例列）
- 冗長な説明・重複する例示

### 手法 2: CLAUDE.md から条件付き rules への抽出

CLAUDE.md にのみ存在していたルールを、`paths` フロントマター付き rules ファイルに移動:

| 移動した内容 | 移動先 |
|------------|--------|
| エンティティ追加・更新パス追加時 | repository.md |
| 開発ツール追加時 | scripts.md |
| CI ワークフロー変更時 | scripts.md |
| アーキテクチャ構成変更時 | structural-review.md |

### 手法 3: CLAUDE.md の対応 rules ポインタ除去

以下のセクションは対応する条件付き rules が `paths` マッチで自動ロードされるため、CLAUDE.md のポインタを除去:

- 構造品質の維持（→ structural-review.md）
- データストア追加時（→ data-store.md）
- リポジトリ実装時（→ repository.md）
- API 実装時（→ api.md）
- ドキュメント規約（→ docs.md）

### 削減結果

| ファイル | Before | After | 削減率 |
|---------|--------|-------|--------|
| CLAUDE.md | 33,645 | 22,205 | 34% |
| zoom-rhythm.md | 25,996 | 17,800 | 31% |
| problem-solving.md | 5,439 | 4,594 | 16% |
| pre-implementation.md | 4,644 | 3,439 | 26% |
| troubleshooting.md | 2,483 | 2,251 | 9% |
| long-running-commands.md | 1,795 | 1,575 | 12% |
| **計** | **74,002** | **51,864** | **30%** |

## 判断ログ

- CLAUDE.md から条件付き rules への抽出先は、既存 rules の `paths` パターンとの整合性で選定した（新規ファイルは作成せず既存ファイルに追記）
- README.md の CLAUDE.md 行数表記（700行超→約400行）とルールファイル数（21→22）を更新した

## 成果物

- PR: #564
- 変更ファイル: CLAUDE.md, zoom-rhythm.md, problem-solving.md, pre-implementation.md, troubleshooting.md, long-running-commands.md, repository.md, scripts.md, structural-review.md, README.md
- 計画ファイル: prompts/plans/563_compress-always-loaded-context.md
