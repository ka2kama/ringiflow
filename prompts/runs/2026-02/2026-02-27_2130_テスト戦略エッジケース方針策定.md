# テスト戦略エッジケース方針策定

- Issue: #939
- PR: #949
- 日付: 2026-02-27

## 概要

テスト戦略を拡充し、エッジケース・境界値・不変条件テストの方針を定義した。

## 成果物

| 成果物 | ファイル |
|--------|---------|
| テスト戦略方針 | `docs/50_テスト/テスト戦略_エッジケース方針.md` |
| API テストルール追記 | `.claude/rules/api-test.md` |
| E2E テストルール追記 | `.claude/rules/e2e-test.md` |
| 状態遷移表（WorkflowInstance） | `docs/50_テスト/状態遷移表_WorkflowInstance.md` |
| 状態遷移表（WorkflowStep） | `docs/50_テスト/状態遷移表_WorkflowStep.md` |
| proptest ADR | `docs/70_ADR/058_プロパティベーステスト導入.md` |

## 判断ログ

### 全体方針の配置先

既存ルールファイルへの追記 + `docs/50_テスト/` に新規ドキュメント。層ごとの責務分担表は参照用ドキュメントに集約し、各層固有の方針は AI ディレクティブとしてルールファイルに配置する。

### 状態遷移表の粒度

ドメインモデルの遷移メソッドレベルを選択。型安全ステートマシンの防御範囲（コンパイル時）とテストで検証すべき範囲（ランタイム）を明確に区別するため。

### proptest 導入

ADR-058 で導入を決定。rstest パラメータ化テストとの併用方針。重要な操作列は rstest で明示的に、組み合わせ空間は proptest で探索的に検証する。

### 状態遷移表の分析結果

- WorkflowInstance: 56 セル中 49 テスト済み（88%）。未テスト 7 セルは `submitted()` と `with_current_step()` の Error セル
- WorkflowStep: 21 セル中 18 テスト済み（86%）。`completed()` の Error セル 3 件が未テスト
