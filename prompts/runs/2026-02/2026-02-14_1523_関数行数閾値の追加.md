# 関数行数閾値の追加

Issue: #509

## 概要

構造レビュー指針にファイルサイズ閾値（500行）に加え、関数の行数閾値（50行）を追加した。clippy の `too_many_lines` lint を活用し、`just check-fn-size` コマンドで検出可能にした。

## 実施内容

1. clippy `too_many_lines` lint の調査（デフォルト閾値: 100行、`restriction` カテゴリで `allow` がデフォルト）
2. 既存コードの超過関数を閾値50行/100行で洗い出し
3. `backend/clippy.toml` を新規作成（`too-many-lines-threshold = 50`）
4. `justfile` に `check-fn-size` コマンドを追加（テストファイル除外、警告のみ）
5. `.claude/rules/structural-review.md` に関数行数閾値セクションを追加
6. `.claude/settings.json` にパーミッションを追加

## 判断ログ

- 閾値を50行に決定。100行（デフォルト）は緩すぎ、30行は Rust のパターンマッチで頻繁にヒットする。50行が注意喚起のトリガーとして適切
- `just check` に統合しない判断。clippy を再実行するため時間がかかる。Phase 完了時の手動実行で十分
- clippy `too_many_lines` は `restriction` カテゴリで `allow` がデフォルト。`-D warnings` と干渉しないため、通常の `lint-rust` に影響なし
- テストファイル除外は `check-file-size` と一貫した方針
- 既存超過関数は全件許容。仕組みの導入がスコープであり、リファクタリングは別途

## 成果物

- コミット: `150ab71` — `#509 Add function line count threshold to structural review guidelines`
- PR: #514
- 新規ファイル: `backend/clippy.toml`
- 更新ファイル: `justfile`, `.claude/rules/structural-review.md`, `.claude/settings.json`
