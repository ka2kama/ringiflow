# Phase 4: レガシーカラム削除

## 日時

2026-01-22 22:25

## 対応 Issue

[#80 Auth Service を分離する](https://github.com/ka2kama/ringiflow/issues/80)

## 概要

Auth Service 分離の最終フェーズとして、`users.password_hash` カラムを削除した。

## 実施内容

1. マイグレーション作成（`20260122000003_drop_users_password_hash.sql`）
2. ドメイン層の `User` エンティティから `password_hash` 関連を削除
3. インフラ層の SQL クエリから `password_hash` を削除
4. テストコードの更新
5. SQLx オフラインキャッシュの更新

## 変更ファイル

- `backend/migrations/20260122000003_drop_users_password_hash.sql`: 新規
- `backend/crates/domain/src/user.rs`: `password_hash` 関連削除
- `backend/crates/infra/src/repository/user_repository.rs`: クエリ更新
- `backend/crates/infra/tests/user_repository_test.rs`: テスト更新
- `backend/apps/core-api/src/handler/auth.rs`: テスト更新
- `backend/.sqlx/*.json`: キャッシュ更新
- `docs/90_実装解説/03_AuthService/00_概要.md`: Phase 4 完了
- `docs/90_実装解説/03_AuthService/04_Phase4_レガシー削除.md`: 新規

## 設計判断

Phase 3 完了後に削除を実施することで、段階的な移行と検証を可能にした。

## 検証

`just check-all` 全てパス。

## 次のステップ

Issue #80（Auth Service 分離）の全フェーズが完了。今後の認証機能拡張（MFA、SSO 等）は Auth Service 上で実装予定。
