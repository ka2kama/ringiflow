# lefthook 導入とコミット規約整備

## 概要

コミットメッセージと PR タイトルに Issue 番号を含める規約を策定し、lefthook による自動付与を導入した。
また、開発環境構築手順書を整備し、各ツールの説明と公式リンクを追加した。

## 背景と目的

Issue 駆動開発を採用しているが、コミットメッセージや PR タイトルと Issue の紐付けが手動に依存していた。
ブランチ名には Issue 番号を含めているため、これを活用して自動化することで、一貫性と追跡性を向上させる。

## 実施内容

### 1. コミットメッセージ・PR タイトルの規約策定

Issue と紐づく場合は先頭に Issue 番号を含める形式に統一した。

```
#<Issue番号> <変更内容>
```

先頭に置く理由:
- `git log --oneline` で Issue 番号がすぐ目に入る
- GitHub の Issue/PR 一覧で番号が揃って見やすい

### 2. lefthook による自動付与

Git フック管理ツール lefthook を導入し、`prepare-commit-msg` フックでブランチ名から Issue 番号を抽出してコミットメッセージの先頭に自動追加する仕組みを構築した。

作成したファイル:
- `lefthook.yml`: lefthook 設定ファイル
- `.lefthook/prepare-commit-msg/add-issue-number`: Issue 番号自動付与スクリプト

動作:
- ブランチ名 `feature/34-user-auth` → コミットメッセージの先頭に `#34 ` を追加
- すでに `#数字` で始まっている場合はスキップ
- main や develop などの Issue 番号がないブランチでは何もしない

### 3. 開発環境構築手順書の整備

- lefthook のインストール手順を追加
- 各ツールに 1〜2 行の説明を追加
- 各ツールに公式リンクを追加
- mise の選択肢を追加（just, lefthook）
- Volta/mise を強制せず、あくまでインストール方法の例として提示

### 4. justfile の更新

- `setup-hooks` タスクを追加
- `check-tools` に lefthook のチェックを追加

## 成果物

### 新規作成

| ファイル | 内容 |
|---------|------|
| `lefthook.yml` | lefthook 設定 |
| `.lefthook/prepare-commit-msg/add-issue-number` | Issue 番号自動付与スクリプト |
| `docs/05_ADR/014_lefthook導入.md` | lefthook 導入の ADR |
| `docs/06_技術ノート/lefthook.md` | lefthook 技術ノート |

### 更新

| ファイル | 変更内容 |
|---------|---------|
| `CLAUDE.md` | コミットメッセージ・PR タイトルの規約追加 |
| `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` | 規約と自動付与の説明追加 |
| `docs/04_手順書/01_開発参画/01_開発環境構築.md` | lefthook 追加、各ツールの説明と公式リンク追加 |
| `justfile` | `setup-hooks` タスク追加 |

## 設計判断

### lefthook を選定した理由

| 観点 | lefthook | husky | 生の Git hooks |
|------|----------|-------|---------------|
| 依存関係 | なし（シングルバイナリ） | Node.js 必須 | なし |
| 言語非依存 | ◎ | △ | ◎ |
| 設定の簡潔さ | YAML で宣言的 | package.json + スクリプト | シェルスクリプト |
| 採用実績 | GitLab, Discourse | 多数 | - |

Rust + Elm のプロジェクトで Node.js に依存しない選択肢として lefthook を選定した。

### Issue 番号を先頭に置く理由

- `git log --oneline` で番号がすぐ見える
- GitHub の一覧表示で揃う
- Conventional Commits との組み合わせ: `#34 feat: ログイン機能`

## ユーザープロンプト（抜粋）

> コミットや PR が特定の Issue と紐付いている場合、コミットメッセージの先頭や PR のタイトルに Issue 番号を含めたいです。

> フックで強制することはできますか？ブランチ名の先頭に合わせるなど。

> mise で入れられるツールは mise で入れたいです。

> 各ツールに公式へのリンクが欲しいです。各ツールの簡単な説明も（1〜2行）。

> lefthook は信頼できるツールですか？

## 学んだこと

- lefthook は Evil Martians が開発する Git フック管理ツールで、GitLab でも採用されている信頼性の高いツール
- `prepare-commit-msg` フックでコミットメッセージを自動修正できる
- ドキュメントでは特定のツールを「推奨」として押し付けず、選択肢として提示する方が柔軟性が高い

## 次のステップ

- 実際のブランチでの動作確認
- PR タイトルの自動付与は手動運用（`gh pr create` 時に指定）
