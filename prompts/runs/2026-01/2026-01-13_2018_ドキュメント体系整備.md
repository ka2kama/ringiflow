# 2026-01-13: ドキュメント体系整備

## 概要

本セッションでは、CLAUDE.md の肥大化を解消し、プロジェクトのドキュメント体系を WHAT / HOW / WHY / HOW TO の4分類に整理した。

## 背景と目的

RingiFlow プロジェクトでは「暗黙知ゼロ」を基本方針として掲げている。しかし、CLAUDE.md にアーキテクチャ詳細や実装規約が直接記載され、111行まで肥大化していた。また、設計上の意思決定（WHY）とその実装方法（HOW）が混在し、ドキュメントの役割が不明瞭になっていた。

本セッションの目的は以下のとおりである。

- 「暗黙知ゼロ」方針をプロジェクトに明文化する
- ID 設計の意思決定を形式知として記録する
- CLAUDE.md を AI 向けナビゲーションに特化させる
- 設計詳細を適切なドキュメントに分離する

## 実施内容

### 1. 暗黙知ゼロ方針の明文化

CLAUDE.md に「基本方針: 暗黙知ゼロ」セクションを追加し、ドキュメント体系の案内表を設けた。

### 2. ID 形式の選定と ADR 作成

UUID と ULID の比較検討を行い、以下の決定を下した。

| 用途 | 採用形式 | 理由 |
|------|---------|------|
| 参照系（マスタデータ） | UUID v4 | ランダム性が高く、ソート不要な用途に適する |
| 時系列系（運用データ） | UUID v7 | RFC 9562 標準、タイムスタンプ含有でソート可能 |

型安全性については、Rust の Newtype パターンで担保する方針とした。

この決定を ADR（Architecture Decision Record）として記録し、設計書からは WHY を分離して HOW に特化させた。

### 3. CLAUDE.md の再構築

CLAUDE.md を 111行から 65行に圧縮し、以下の構成に変更した。

- プロジェクト概要と基本方針
- ドキュメント体系の案内（WHAT / HOW / WHY / HOW TO）
- ドキュメント規約
- ツール設定への参照

詳細なアーキテクチャ図や実装規約は設計書に移動した。

### 4. 設計書の新規作成

CLAUDE.md から分離した内容を以下の設計書として整備した。

| ファイル | 内容 |
|---------|------|
| `05_アーキテクチャ概要.md` | システム構成図、レイヤー構成、主要パターン（BFF、セッション管理、マルチテナント、イベント駆動） |
| `06_実装ガイドライン.md` | Elm/Ports 設計、Rust バックエンド規約、横断的関心事（ログ、設定、テスト） |

## 成果物

### 最終的なドキュメント体系

```
CLAUDE.md              # AI 向けナビゲーション（65行）
docs/
├── 10_要件定義書/     # WHAT（何を作るか）
├── 02_設計書/         # HOW（どう作るか）
│   ├── 04_ID設計規約.md
│   ├── 05_アーキテクチャ概要.md
│   └── 06_実装ガイドライン.md
├── 03_手順書/         # HOW TO（どう操作するか）
└── 04_ADR/            # WHY（なぜその決定か）
    ├── README.md
    ├── template.md
    └── 001_ID形式の選定.md
```

### 変更ファイル一覧

| ファイル | 操作 |
|---------|------|
| `CLAUDE.md` | リファクタリング（111→65行） |
| `docs/02_設計書/01_プロジェクト構造設計.md` | uuid の features を修正 |
| `docs/02_設計書/04_ID設計規約.md` | WHY を ADR に分離し HOW に特化 |
| `docs/02_設計書/05_アーキテクチャ概要.md` | 新規作成 |
| `docs/02_設計書/06_実装ガイドライン.md` | 新規作成 |
| `docs/04_ADR/README.md` | 新規作成 |
| `docs/04_ADR/template.md` | 新規作成 |
| `docs/04_ADR/001_ID形式の選定.md` | 新規作成 |

## 知見

### ドキュメント分類の原則

| 問い | ドキュメント種別 | 更新頻度 |
|------|-----------------|---------|
| WHAT（何を作るか） | 要件定義書 | 要件変更時 |
| HOW（どう作るか） | 設計書 | 実装変更時 |
| WHY（なぜその決定か） | ADR | 原則不変 |
| HOW TO（どう操作するか） | 手順書 | 手順変更時 |

### ADR 運用のポイント

- 設計書に「なぜその方式を選んだか」が混在し始めたら、ADR への分離を検討する
- ADR は原則として不変とし、決定を変更する場合は新規 ADR を作成して置換する
- 比較表で選択肢を並べておくと、後から意思決定を追跡しやすい

### CLAUDE.md の役割

CLAUDE.md は詳細を記述する場所ではなく、適切なドキュメントへの案内役として機能させる。AI エージェントが作業開始時に「どこを参照すべきか」を即座に把握できる構成が望ましい。

## 有効だったプロンプト技法

### 技術選定の深掘り

```
ULID と UUID v7 を比較してください。
```

簡潔な比較依頼から開始し、追加の質問で論点を深掘りする手法。

### ベストプラクティスとの照合

```
2026年1月現在のベストプラクティスと照合した場合、どのような評価になりますか？ ultrathink
```

`ultrathink` キーワードで深い思考を促し、最新の業界動向との整合性を確認する手法。

### 構造的な見直し依頼

```
CLAUDE.md の構成を全体的に見直してください。 ultrathink
```

特定箇所の修正ではなく、構造的な問題の発見を依頼する手法。

### 判断の委任

```
判断をお任せします。本プロジェクトの目的に合致する形で、最適な方式を選択してください。
```

細かい選択を AI に委任し、プロジェクト方針に沿った一貫性のある判断を促す手法。

## 実行環境

| 項目 | 値 |
|------|-----|
| モデル | Claude Opus 4.5 |
| ツール | Claude Code CLI |
| 主な操作 | Read, Write, Edit, Glob, Grep |
