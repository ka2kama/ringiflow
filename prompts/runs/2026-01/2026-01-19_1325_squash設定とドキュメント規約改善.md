# Squash マージ設定とドキュメント規約改善

**日付:** 2026-01-19
**PR:** [#85](https://github.com/ka2kama/ringiflow/pull/85)

## 背景

Issue #34 の実装で Phase ごとにコミットしていたが、squash マージで履歴が失われるという懸念が発生。この運用を見直すことになった。

## 議論の経緯

### 1. Squash マージの是非

**問題:** squash マージでは PR 内の詳細コミット履歴が main ブランチに残らない

**結論:** Squash マージは継続。ただし、コミットメッセージに PR 本文を含めることで追跡性を向上。

理由:
- PR が詳細履歴のアーカイブになる
- 1 Issue = 1 PR = 1 squash コミットは追跡性が高い
- Phase 単位の revert が必要なら、別 Issue/PR に分割する方がクリーン

### 2. Squash マージ時のコミットメッセージ

**問題:** 現状のコミットメッセージがタイトルのみで body が空

**対応:** GitHub リポジトリ設定を変更
- `squash_merge_commit_message`: `BLANK` → `PR_BODY`

これにより、PR の Summary / Test plan がコミットメッセージに含まれるようになった。

### 3. ドキュメント規約違反の発見

PR 本文の設定変更に伴い、ドキュメント全体の規約準拠を確認したところ、複数の違反を発見。

**違反内容:** `**注意:**`, `**重要:**` などの定型ラベルが太字になっていた

**規約:** 「注意:」「重要:」などの定型ラベルは太字にしない

### 4. ドキュメント規約自体の改善

規約（`.claude/rules/docs.md`）の問題点:
- 規約自体が規約違反（`**併記すべき:**` 等が太字）
- 「使ってよい場面」が曖昧

**改善内容:**
- 具体例を追加（`**禁止:**`, `**Draft PR の目的:**`）
- 判断基準を追加: 「太字を外しても意味が伝わるなら不要」
- 規約自体の太字を削除

## 変更内容

### GitHub リポジトリ設定
```bash
gh api repos/ka2kama/ringiflow -X PATCH \
  -f squash_merge_commit_title=PR_TITLE \
  -f squash_merge_commit_message=PR_BODY
```

### 修正ファイル

| ファイル | 修正内容 |
|---------|----------|
| `.claude/rules/docs.md` | 規約を明確化、自己矛盾を解消 |
| `03_GitHub設定.md` | squash 設定の説明を更新 + 太字修正 |
| `01_Issue駆動開発.md` | 定型ラベル・文全体の太字を修正 |
| `02_TDD開発フロー.md` | `**重要:**` を修正 |
| `CSRF.md` | `**注意:**`, `**重要:**` を修正 |
| `sqlx-cli.md` | `**重要:**` を修正 |
| `パスワードハッシュ.md` | `**注意:**` を修正 |

## 学び

1. **設定変更とドキュメント更新はセットで行う** - 暗黙知を許容しないプロジェクト理念に沿った対応
2. **規約は自己矛盾なく** - 規約自体が規約に従っていることが重要
3. **曖昧な表現より具体例** - 判断基準を明示すると迷いが減る
