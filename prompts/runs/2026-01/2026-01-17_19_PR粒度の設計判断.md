# 2026-01-17_14_PR粒度の設計判断

## 概要

Issue #34（ユーザー認証）の PR 戦略について議論し、全 Phase を 1 つの PR にまとめる方針を決定した。

## 背景と目的

Issue #34 は 6 つの Phase に分かれており、Phase 2 まで実装が完了した時点で、PR の粒度をどうするか検討が必要になった。

## 検討した選択肢

### 選択肢 A: 1 つの PR に全 Phase

- Issue と PR が 1:1 対応
- コミットは Phase 毎に分かれているので履歴は追える

### 選択肢 B: Phase 毎に別 PR

- 小さな PR でレビューしやすい
- 早期フィードバックが得られる

### 選択肢 C: フィーチャーブランチを基底にした Phase 毎の PR

```
main
 └── feature/34-user-auth（統合ブランチ）
      ├── feature/34-phase3 → PR to feature/34-user-auth
      └── ...
```

- Phase 毎にレビューを受けつつ、最終的に 1 PR で main にマージ

## 設計判断

**選択肢 A（1 つの PR に全 Phase）を採用。**

### 判断理由

1. **横割り vs 縦割りの問題**

   Issue #34 の Phase 分けは横割り（Horizontal Slice）:
   - Phase 1: Repository（データ層）
   - Phase 2: PasswordHasher（ユーティリティ）
   - Phase 3: SessionManager（データ層）
   - Phase 4-5: Handler（API 層）

   Phase 3（SessionManager）だけ見せられても、それを使うコードがないため「これが正しいか」の判断ができない。

2. **縦割り（Vertical Slice）との比較**

   本来あるべき分け方:
   - Slice 1: 「ログインできる」（Repository + Hasher + Session + Handler）
   - Slice 2: 「ログアウトできる」
   - Slice 3: 「認証状態を確認できる」

   ただし認証機能は「ログイン → セッション保存 → 認可」が一体で動いて初めて意味があるため、縦割りにしても Slice 1 の時点で大きくなる。

3. **結論**

   認証のような横断的機能は、無理に分けると「単体で動かないコード」のレビューを強いることになり逆効果。1 つの PR でまとめる方が合理的。

## 学んだこと

- 「小さな PR」は良いプラクティスだが、「意味のある単位」であることが前提
- 横割り（レイヤー毎）で分けた PR は、使われ方がわからずレビューしにくい
- 縦割り（機能毎）で分けるのが理想だが、認証のような横断的機能は分けにくい
- 実装の Phase 分け（横割り）と PR の粒度（縦割り）は別の観点

## ユーザープロンプト（抜粋）

> Issue #34 の Phase 2 まで実装しましたが、PR #46 に全フェーズの変更を載せるべきでしょうか？

> フィーチャーブランチを基底にして Phase 毎にブランチを切る案はどうでしょうか？

> 個人の学習用なので今はどちらでも機能しますが、チーム開発という前提ならどうでしょうか？

> 単体で動かないコミットを見せられても、それはそれでレビューしづらいのでは？

## 次のステップ

- PR #46 に全 Phase を載せる方針で Phase 3（SessionManager）の実装に進む
