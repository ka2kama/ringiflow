# 2026-01-18_09: Auth Service 分離の方針決定と Epic/Story 運用導入

## 概要

認証基盤のアーキテクチャについて議論し、Auth Service として分離する方針を決定した。
また、GitHub Projects との連携として Epic/Story 運用をプロジェクトに導入した。

## 背景と目的

現在の RingiFlow では、認証機能が BFF と Core API に分散している。
将来の SSO/MFA/SCIM 対応を見据え、認証基盤のアーキテクチャを検討する必要があった。

議論の発端となった問い:

> このプロジェクトではバックエンドを BFF と Core API に分けているが、そもそも認証基盤は Core API に含めてよいのか？別の専用 API を用意すべきでは？

## 実施内容

### 1. アーキテクチャの検討

3つの選択肢を比較検討した:

| 選択肢 | 説明 |
|--------|------|
| 現状維持 | Core API に認証ロジックを含める |
| Auth Service 分離 | 認証専用のマイクロサービスを作成 |
| 外部 IdP | Auth0, Cognito 等の外部サービスを利用 |

プロジェクト理念（学習効果の最大化、品質の追求）と要件（SSO/MFA/SCIM 対応）を踏まえ、
**Auth Service として分離**する方針を決定した。

### 2. ADR-017 作成

決定内容を ADR-017 として記録した。段階的ロードマップも定義:

- Phase 2: Auth Service 分離（基盤）
- Phase 3: MFA 対応
- Phase 4: SSO (OIDC) 対応
- Phase 5: SSO (SAML) / SCIM 対応

### 3. GitHub Projects との連携

Epic/Story 運用を導入し、Issue 駆動開発の手順書を更新した。

| 概念 | GitHub での実現 |
|------|----------------|
| Epic | Issue + `type:epic` + Sub-issues |
| Story | Issue + `type:story` |
| Task | Issue 内のチェックリスト |

## 成果物

### コミット

- `#80 docs: Auth Service 分離の方針を決定し、Epic/Story 運用を導入`

### 作成/更新ファイル

| ファイル | 内容 |
|---------|------|
| `docs/05_ADR/017_AuthService分離の方針.md` | 新規作成 |
| `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` | Epic/Story 運用セクション追加 |

### GitHub

| 種別 | URL |
|------|-----|
| Issue | [#80 Auth Service を分離する](https://github.com/ka2kama/ringiflow/issues/80) |
| PR | [#81](https://github.com/ka2kama/ringiflow/pull/81) |
| Label | `type:epic`, `type:story` を新規作成 |

## 設計判断と実装解説

### なぜ Auth Service を分離するか

1. **プロジェクト理念との整合**
   - 「学習効果の最大化」という理念に最も合致
   - マイクロサービス設計、認証ドメインの深い理解が得られる

2. **将来の拡張性**
   - SSO（OIDC/SAML）、MFA、SCIM といった複雑な認証要件を独立したサービスとして管理
   - Core API の責務を明確に保てる

3. **上流アーキテクチャとしての安定性**
   - 認証は後から構造を変えにくい領域
   - 最初から分離しておくことで将来の変更コストを抑える

### YAGNI との折り合い

「今すぐ必要ではないものを作るな」という YAGNI 原則との整合について議論した。

結論: 上流アーキテクチャの変更は後からのコストが高いため、「計画的な延期」という判断を採用。

- **今決めること**: サービス分離の方針、モジュール境界
- **今決めないこと**: SAML の実装方法（自前 vs ライブラリ）
- **再評価のタイミング**: Phase 5 に入る時点

### Epic/Story 運用の導入理由

GitHub には公式の Epic/Story 機能がないが、以下の組み合わせで実現できる:

- Label（`type:epic`, `type:story`）
- Sub-issues（親子関係）
- Milestones（リリース単位）

最小限の構成で始め、運用しながら育てていくアプローチを採用した。

## ユーザープロンプト（抜粋）

> このプロジェクトではバックエンドを BFF と Core API に分けているが、そもそも認証基盤は Core API に含めてよいのか？別の専用 API を用意すべきでは？

> 現状では過剰であることはある程度理解しつつも、このプロジェクトの理念、目的、要件から総合的に考えたい。特にこのレベルの上流アーキテクチャの場合、あとからコロコロ変更するものでもない。YAGNI は尊重すれど、なんとかなれ精神でいきたいわけではない。

> 個人的な、学習への興味という意味では、Auth Service をある程度作ってみたい。

> Epic とか Story とかあったはず。こういうののベストプラクティスをプロジェクト管理に取り入れてフローに組み込みたい。

## 学んだこと

1. **上流アーキテクチャの判断は理念から**
   - YAGNI だけでなく、プロジェクトの理念・目的を考慮する
   - 後から変更が困難な領域は、最初に慎重に検討する価値がある

2. **「計画的な延期」という判断**
   - 今決めることと、後で決めることを明確に分ける
   - 再評価のタイミングを ADR に記録しておく

3. **GitHub Projects の柔軟性**
   - 公式機能がなくても、Label + Sub-issues で Epic/Story 運用を実現できる
   - 最小限で始めて育てていくアプローチが有効

## 次のステップ

- Phase 2 着手時に、Auth Service の設計を進める
- 設計フェーズで Story に分解し、Sub-issues として管理
