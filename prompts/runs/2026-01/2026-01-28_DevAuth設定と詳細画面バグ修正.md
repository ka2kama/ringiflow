# DevAuth 設定と詳細画面バグ修正

**日時**: 2026-01-28
**Issue**: #115 ワークフロー申請フォームフロントエンド

## 概要

開発環境での認証バイパス（DevAuth）のフロントエンド連携を設定し、詳細画面のデコーダーバグを修正した。

## 実施内容

### 1. DevAuth フロントエンド連携

**変更ファイル:**
- `frontend/src/main.js`: 開発環境で DevAuth 用 Cookie を自動設定
- `scripts/generate-env.sh`: `DEV_AUTH_ENABLED=true` を backend/.env に含める
- `backend/apps/bff/src/config.rs`: リリースビルドで `DEV_AUTH_ENABLED=true` の場合は panic

**設計判断:**
- `#[cfg(not(debug_assertions))]` を使用し、リリースビルドでのみセーフティチェックを有効化
- 本番環境への誤デプロイを防ぐセーフティネットとして機能

### 2. 詳細画面のデコーダーバグ修正

**問題:**
- `GET /api/v1/workflows/{id}` のレスポンスは `{"data": {...}}` 形式
- `Api.Workflow.getWorkflow` のデコーダーが `data` ラッパーを処理していなかった
- 結果: API からデータは取得できるが、画面に反映されない

**原因:**
- `listDecoder` は `Decode.field "data" (Decode.list decoder)` で正しく処理
- `getWorkflow` は `WorkflowInstance.decoder` を直接使用していた（`data` ラッパー未対応）

**修正:**
```elm
-- 修正前
decoder = WorkflowInstance.decoder

-- 修正後
decoder = Decode.field "data" WorkflowInstance.decoder
```

### 3. Issue 作成

- **#136**: シードデータの本番マイグレーションからの分離
- **#137**: API 仕様と実装の整合性担保（OpenAPI / BFF / Elm）

## 学び

### API レスポンス形式の一貫性

BFF の API レスポンスは統一された形式（`{"data": ...}`）を使用している。デコーダーも統一的に処理すべき。

**改善案:**
```elm
-- 共通のラッパーデコーダー
wrapDecoder : Decoder a -> Decoder a
wrapDecoder = Decode.field "data"
```

### OpenAPI と実装の整合性

現状、OpenAPI / BFF / Elm の3箇所が独立しており、手動同期による不整合が発生しやすい。

**提案（#137）:**
- Code First アプローチ: Rust → `utoipa` → OpenAPI → Elm コード生成
- Rust を「信頼できる唯一の情報源」とする

## コミット

```
#115 DevAuth: フロントエンド連携とリリースビルド保護を追加
#115 getWorkflow: レスポンスの data ラッパーに対応
```
