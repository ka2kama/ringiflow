# 2026-01-15_06_ドキュメント自動作成の仕組み

## 概要

ADR・技術ノート・セッションログの自動作成を促す仕組みを導入した。

## 背景と目的

- ADR / 技術ノート / セッションログは手動で作成忘れが発生しやすい
- AI エージェントが適切なタイミングでドキュメントを作成できるよう、条件を明確化したい
- セッション終了時にリマインドを表示することで、作成忘れを防ぎたい

## 実施内容

### 1. Claude Skills の調査

Claude Code の Skills 機能について調査した。

- **Skills**: Markdown ファイルで記述された専門知識・指示セットで、Claude が自動判断して適用する機能
- **CLAUDE.md との違い**: CLAUDE.md は全会話に自動適用、Skills は状況に応じて自動選択

**結論**: 現時点では CLAUDE.md が十分整備されており、Skills の導入は見送り。

### 2. ドキュメント自動作成ルールの追加

CLAUDE.md に以下の作成条件を明記した。

| ドキュメント | 作成条件 |
|-------------|---------|
| ADR | 技術選定、実装方針の選択、設計判断、見送り判断 |
| 技術ノート | 新ツール導入、技術解説、既存ノートへの追記 |
| セッションログ | コード変更、設計判断、調査結果 |

### 3. リマインドフックの追加

`.claude/settings.json` に PreToolUse フックを追加し、git commit 実行前にリマインドを表示するようにした。

```json
"PreToolUse": [
  {
    "matcher": "Bash",
    "hooks": [
      {
        "type": "command",
        "command": "if echo \"$TOOL_INPUT\" | jq -r '.command' | grep -q 'git commit'; then echo '📝 ドキュメント作成を確認'; fi"
      }
    ]
  }
]
```

**経緯**: 当初は SessionEnd（セッション終了時）を採用したが、通常の流れが「作業 → コミット → /exit」であるため、コミット後では遅いことが判明。git commit 検出時に変更した。

## 成果物

### コミット

- `69bc6ed` ドキュメント自動作成の仕組みを追加
- `baf9a91` セッションログと技術ノートを追加
- `6db345d` ドキュメント作成リマインドをコミット前に変更

### 更新ファイル

- `CLAUDE.md`: ドキュメント自動作成ルールセクションを追加
- `.claude/settings.json`: PreToolUse フックを追加（git commit 検出時）
- `docs/05_技術ノート/ClaudeCode_Hooks.md`: 新規作成

## 設計判断と実装解説

### リマインドのタイミング選択

| イベント | 発火タイミング | 採用 | 理由 |
|---------|--------------|------|------|
| Stop | 毎回の応答完了時 | ✗ | 頻繁すぎる |
| SessionEnd | セッション終了時 | ✗ | コミット後では遅い |
| PreToolUse (git commit) | コミット直前 | ✓ | 適切なタイミング |

通常のワークフロー（作業 → コミット → /exit）を考慮し、コミット直前にリマインドを表示する方式を採用した。

## 議論の経緯

### 自動作成の仕組み検討

ADR、技術ノート、セッションログあたりは、指示がなくともある程度自動で作成されるようにしたいという要望があった。完全自動化は目指していないとのことだったため、Hooks を使ったリマインド方式を検討した。

### タイミングの調整

ドキュメント自動作成について、たいてい commit 後に /exit するのでタイミングが合わないという指摘があり、コミット直前にリマインドを表示する方式に変更した。

## 学んだこと

- Claude Code の Hooks には複数のイベントタイプがあり、用途に応じて使い分ける
  - Stop: 毎ターン終了時
  - SessionEnd: セッション終了時
  - PreToolUse: ツール実行前（matcher でツールを絞り込める）
  - PostToolUse: ツール実行後
- PreToolUse で `$TOOL_INPUT` を使ってコマンド内容を判定できる
- セッション中に設定ファイルを変更しても、次回起動まで反映されない
- リマインドのタイミングはワークフローを考慮して決める必要がある
