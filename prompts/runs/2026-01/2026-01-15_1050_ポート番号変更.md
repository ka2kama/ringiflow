# ポート番号変更

## 概要

他の開発プロジェクトとのポート競合を回避するため、ローカル開発環境で使用するポート番号をプロジェクト固有の番号に変更した。

## 背景と目的

- PostgreSQL（5432）、Redis（6379）、API サーバー（3000）は非常に一般的なポート番号
- 複数のプロジェクトを同時に開発する際に競合する可能性が高い
- プロジェクト固有のポート番号を使用することで競合リスクを低減

## 実施内容

### ポート番号の変更

| サービス | 変更前 | 変更後 |
|----------|--------|--------|
| PostgreSQL | 5432 | 15432 |
| Redis | 6379 | 16379 |
| BFF API | 3000 | 13000 |
| Core API | 3001 | 13001 |
| Vite (Frontend) | 5173 | 15173 |

### 環境変数による柔軟性の確保

docker-compose.yml で環境変数によるポート上書きを可能にした：

```yaml
ports:
  - "${POSTGRES_PORT:-15432}:5432"
```

### 更新ファイル

- 設定ファイル
  - `docker-compose.yml` - 環境変数対応
  - `.env.template`, `apps/api/.env.template` - 新ポート番号
  - `vite.config.js` - 環境変数対応
  - `apps/api/src/config.rs` - デフォルト値更新

- ドキュメント
  - 手順書（Phase0 概要、プロジェクトセットアップ）
  - 技術ノート（Vite、sqlx-cli）
  - 設計書（API 設計 MVP）

- Rust ソースコード内のコメント
  - `bff.rs`, `health.rs`

## 成果物

- コミット: ポート番号をプロジェクト固有の番号に変更

## 設計判断と実装解説

### ポート番号の選定基準

「15xxx」「16xxx」「13xxx」という番号を選んだ理由：

1. **記憶しやすさ**: 元のポート番号の先頭に「1」を付けた形式（5432 → 15432）
2. **衝突回避**: 10000 番台は他のサービスで使われることが少ない
3. **一貫性**: BFF/Core API も同様に「1」をプレフィックス（3000 → 13000）

### 環境変数でのオーバーライド

デフォルト値を変更しつつ、環境変数での上書きも可能にした理由：

- デフォルトでは競合しにくい番号を使用
- チーム内で別のポートを使いたい場合や、特定の環境で異なるポートが必要な場合に柔軟に対応可能
- 12-Factor App の原則に沿った設定管理

## 議論の経緯

使用しているポートがありきたりなものが多く、他の開発と被らないか心配という指摘があった。プロジェクト固有のポート番号に変更することにした。

## 学んだこと

- ローカル開発環境のポート番号は、プロジェクト固有のものを使用することで競合リスクを低減できる
- 環境変数でのオーバーライドを組み合わせることで、柔軟性と安全性を両立できる

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-15 | 初版作成 |
