# Auto Review 全体フィードバック送信漏れ修正

**日付:** 2026-01-19

## 背景

PR #85 で Claude Auto Review が approve のみを実行し、全体フィードバック（`gh pr comment`）が送信されなかった。PR #59 のように、問題がない場合でもレビュー結果のサマリーが投稿されるべき。

## 原因分析

### 問題のあるプロンプト

`.github/workflows/claude-auto-review.yml` のフィードバック方法セクション:

```yaml
## フィードバック方法

- コード固有の問題: インラインコメント
- 全体的なフィードバック: PRコメント
```

これは「手段の説明」であり、「いつ実行するか」が不明確。

さらに承認判断テーブルで:

```
| None | 問題なし | `gh pr review --approve` |
```

と記載されていたため、Claude は「問題なし = フィードバック不要 = approve のみ」と解釈。

### PR #59 との違い

- PR #59: 詳細な全体フィードバック → approve
- PR #85: approve のみ

同じプロンプトでも動作が異なったのは、Claude が判断の余地を持っていたため。

## 修正内容

フィードバック方法セクションを実行順序として明示:

```yaml
## フィードバック方法

以下の順序で実行する:

1. インラインコメント: コード固有の問題は該当箇所にコメント
2. 全体フィードバック（必須）: PR コメントを投稿。問題の有無に関わらずサマリーを記載
3. 承認/却下: 承認判断を実行
```

ポイント:
- 「必須」を明記
- 「問題の有無に関わらず」を追記
- 実行順序を番号付きリストで明示

## 学び

1. **「手段」と「実行条件」は別の指示** - LLM は曖昧な指示を解釈する余地があると、コンテキストに応じて異なる動作をする
2. **一貫した動作には明示的な指示が必要** - 「必ず〜する」「〜の順序で実行」と書くことで動作が安定する
3. **プロンプト内の矛盾に注意** - 表と本文で異なる指示があると、どちらを優先するか予測困難
