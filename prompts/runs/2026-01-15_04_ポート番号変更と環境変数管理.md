# ポート番号変更と環境変数管理

## 概要

ローカル開発環境のポート番号を変更し、環境変数の管理方針を整理した。

## 背景と目的

- 既存のポート番号（5432, 6379, 3000 等）は一般的すぎて他プロジェクトと競合しやすい
- ポート番号のデフォルト値がコード内に散在していた
- `.env.template` が複数箇所に存在し、一元化すべきか検討が必要だった

## 実施内容

### 1. ポート番号の変更（PR #13）

| サービス | 変更前 | 変更後 |
|----------|--------|--------|
| PostgreSQL | 5432 | 15432 |
| Redis | 6379 | 16379 |
| BFF API | 3000 | 13000 |
| Core API | 3001 | 13001 |
| Vite | 5173 | 15173 |

### 2. デフォルト値の一元化（PR #14）

コード内のデフォルト値を削除し、`.env` ファイルに一元化：

- `docker-compose.yml`: `${POSTGRES_PORT:-15432}` → `${POSTGRES_PORT}`
- `config.rs`: `BFF_PORT`, `REDIS_URL` を必須化
- `vite.config.js`: デフォルト値を削除
- `justfile`: `set dotenv-load := true` を追加

### 3. 環境変数ファイルの分離方針検討

`.env.template` を一元化すべきか検討した結果、**分離を維持**する方針を決定。

## 成果物

- PR #13: ポート番号をプロジェクト固有の番号に変更
- PR #14: ポート設定をコードから .env に一元化
- ADR-008: 環境変数ファイルの分離方針

## 設計判断と実装解説

### ポート番号の選定

「元の番号 + 10000」という規則で選定：
- 覚えやすい（5432 → 15432）
- 10000 番台は他のサービスで使われにくい

### 環境変数ファイルの分離

一元化 vs 分離を検討した結果、分離を選択した理由：

1. **責務の違い**: Docker は DB/Redis ポート、Rust は API 設定、Vite はフロントエンド設定と、それぞれ必要な情報が異なる
2. **独立性**: 各アプリが単体で動作可能
3. **モノレポの慣習**: 各アプリが独自の設定を持つのが一般的

## ユーザープロンプト（抜粋）

> 使っているポートがありきたりなものが多いので他の開発と被らないか心配です。

> デフォルト値より環境変数で指定した方が固定値がちらばらずよいのではないですか？

> .env.template が複数箇所にあるがまとめられないですか？

> Elm が Docker のポートを知る必要もないし、分離でいいのではないですか？

## 学んだこと

- ポート番号は「元の番号 + 10000」のような規則で選ぶと覚えやすい
- デフォルト値をコードに持たず設定ファイルに一元化すると、変更が容易になる
- 環境変数ファイルの一元化 vs 分離は、責務の境界で判断すべき
- 「まとめられるか」より「まとめるべきか」を問うことが重要

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-15 | 初版作成 |
