# prompts/runs/

このディレクトリには、AI エージェントとのセッション記録を保存する。

## ディレクトリ構造

月ごとのサブディレクトリに整理する。

```
prompts/runs/
├── YYYY-MM/
│   ├── YYYY-MM-DD_HHMM_<トピック>.md
│   └── ...
└── README.md
```

例: `prompts/runs/2026-01/2026-01-17_0930_Phase0_Elm構築.md`

## ファイル命名規則

```
YYYY-MM-DD_HHMM_<トピック>.md
```

- `HHMM`: セッションの最初のコミット時刻（24時間形式、例: `0930`, `1415`）
- `<トピック>`: セッションの主題（例: `Phase0_Elm構築`）

時刻の取得方法:
```bash
git log --format="%ci" --reverse <branch> --not main | head -1
# 出力例: 2026-01-22 11:08:10 +0900 → HHMM = 1108
```

コミット時刻を使う理由:
- セッション開始時刻は曖昧で推測になりがち
- コミット時刻は `git log` で正確に取得・検証できる

## セッション記録の構成

| セクション | 内容 |
|-----------|------|
| 概要 | セッションで達成したことの要約 |
| 背景と目的 | なぜこの作業が必要だったか、セッションの発端 |
| 実施内容 | 具体的な作業内容 |
| 設計上の判断 | 主要な設計判断の一覧（該当する場合） |
| 成果物 | コミット、作成/更新ファイル |
| 議論の経緯 | ユーザーとの議論・質疑応答の流れを要約 |
| 学んだこと | セッションで得た知見 |
| 発見した問題 | 未解決の問題や調査事項（該当する場合） |
| 次のステップ | 今後の作業（該当する場合） |

## 議論の経緯の記載ルール

### 目的

セッション中にどのような議論・質疑応答があったかを、後から読んでも流れが分かるように要約する。

### 形式

トピックごとに見出しを付け、議論の流れを要約する。

```markdown
## 議論の経緯

### credentials の保存先

ユーザーに保存先の選択肢を提示し、「DB 分離（auth スキーマ）」を選択。
理由として、運用のシンプルさと将来の DB 分離への移行パスの両立を挙げた。

### サーキットブレーカーのスケーラビリティ

ユーザーから、メモリに状態を持つとスケールアウト時に問題があるのではないかという懸念が出た。
3つの方式（インスタンス単位、Redis 共有、ハイブリッド）を比較検討し、
シンプルさを優先してインスタンス単位を採用。ADR-020 として文書化した。
```

### 記載するもの

- 設計判断に至った議論
- 技術的な質問と回答
- 問題の発見と解決の経緯
- ユーザーからの指摘と対応

### 省略するもの

- 単純な応答（「はい」「続けて」など）
- 定型作業の指示
- 技術的判断に関係しない雑談

## サニタイズ規則

セッションログは GitHub で公開されるため、以下の規則に従ってサニタイズする。

### 省略または伏せ字にする

| 対象 | 処理 |
|------|------|
| 認証情報（鍵、トークン、パスワード） | 完全に省略 |
| 個人を特定できる情報 | 省略または一般化 |
| 社内 URL、内部システム名 | 伏せ字（`[内部URL]`、`[システム名]`） |

### 表現を変換する

| 対象 | 処理 |
|------|------|
| カジュアルすぎる表現 | 丁寧語に整形（下記「校正例」参照） |
| 感情的・主観的な発言 | 技術的な内容に要約、または省略 |
| 文脈がないと誤解されうる発言 | 文脈を補足するか省略 |

#### 校正例

| 元の発言 | 校正後 |
|---------|-------|
| 「この辺の知見はプロダクト固有でない部分もあるとおもうので」 | 「これらの知見は一般的なものなので」 |
| 「どうとでもなる」 | 「柔軟に対応できる」 |
| 「おもう」 | 「思う」 |

### 表記を校正する

| 対象 | 処理 |
|------|------|
| 誤字・脱字 | 正しい表記に修正 |
| 漢字の誤り | 正しい漢字に修正 |
| 不要なひらがな | 漢字で書くべき箇所は漢字に修正 |
| 表記揺れ | 文書内で統一 |

### 議論の経緯の取捨選択

「省略するもの」セクションに加え、以下も省略する:

- 雑談、私的な発言
- 感情表現（不満、愚痴など）
- 技術的判断に関係しない指示

**原則:** 技術的な学びに繋がる内容のみを記載する。

