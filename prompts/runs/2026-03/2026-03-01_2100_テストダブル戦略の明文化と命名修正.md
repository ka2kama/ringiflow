# テストダブル戦略の明文化と命名不整合の修正

Issue: #988
PR: #989
ブランチ: `feature/988-test-double-strategy`

## 概要

テスト戦略における 3 つの歪みを修正した:

1. ADR-036 と実装の乖離（Handler テスト方針）
2. `mock.rs` の命名不整合（実態は Fake）
3. テスト学派（古典学派）の暗黙知

## 判断ログ

### ADR の不変性

ADR-036 の内容を直接書き換えようとしたが、ADR は不変（immutable）であることを再確認。新しい ADR-060 を作成し、ADR-036 のステータスを「置換」に変更する方式に修正した。

参照: `docs/70_ADR/README.md` の「原則: ADR は不変」

### `docs/90_実装解説/` の扱い

計画では「過去の PR の記録として対象外」としていたが、`just check` のドキュメントリンクチェック（`doc-links.sh`）がリンク切れを検出。品質ゲートをブロックするため、リンク切れに該当するファイルパス参照のみ修正した。テキスト中の構造体名参照（リンクではないもの）は歴史的記録として残した。

### `TxContext::mock()` メソッドの扱い

`TxContext::mock()` はトランザクションコンテキストのテスト用ファクトリメソッドであり、今回のモジュールリネーム（`mock.rs` → `fake.rs`）とは別のスコープ。メソッド名のリネームは行わなかった。

### sed の限界とマルチライン import

最初の `sed` パターン `ringiflow_infra::mock` は、`use ringiflow_infra::{ mock::{ ... } }` 形式のマルチライン import にマッチしなかった。`mock::{` を直接置換する追加 `sed` で解決。

## 成果物

| 種別 | ファイル |
|------|---------|
| ADR（新規） | `docs/70_ADR/060_テストダブル戦略とHandler層テスト方針.md` |
| ADR（ステータス変更） | `docs/70_ADR/036_Handler層テスト戦略.md` — 承認済み → 置換 |
| コードリネーム | `backend/crates/infra/src/mock.rs` → `fake.rs`（21 ファイル変更） |
| ドキュメント更新 | 基本設計書、テスト戦略概要、TDD 手順書、エッジケース方針、テストピラミッド、Cargo ワークスペース |
| リンク切れ修正 | `docs/90_実装解説/` の 2 ファイル |
