# #627 カラーパレット刷新（Google 標準 → Indigo/Slate 系）

## Context

Epic #445 の Story 6。Google Workspace 由来のカラーパレットから、ワークフロー管理アプリにふさわしい洗練されたパレットに移行する。#611（デザイントークン体系化）で確立した `@theme` トークン構造をそのまま活用し、**値のみを差し替える**。

変更ファイルは `frontend/src/styles.css` の1つのみ。@theme のデザイントークンアーキテクチャにより、26 ファイル / 335+ 箇所の色参照が自動で新パレットに移行する。

## 対象

- `frontend/src/styles.css` の `@theme` ブロック内カラートークン値の差し替え
- コードで使用されているが `@theme` に未定義だったシェードの追加（後述）

## 対象外

- Elm コードの変更（クラス名は変えない）
- ダークモード対応
- WCAG 2.1 AA 完全準拠（#615 で対応）

## 設計判断

### 1. Tailwind v4 デフォルトパレットをそのまま採用

Tailwind のデフォルトパレットは色彩理論に基づいて設計されており、シェード間の関係性（コントラスト、彩度の変化）が整っている。Issue の方針「execution quality で差別化」に合致する。

- Primary → **Indigo**: 信頼感 + 現代的
- Secondary → **Slate**: 青みがかったグレーで奥行き感
- Success → **Emerald**: 標準的な成功色
- Error → **Red**: エンタープライズ慣行に沿った認知しやすい赤
- Warning → **Amber**: 標準的な警告色
- Info → **Blue**: Primary（Indigo）と視覚的に区別可能、情報の普遍的表現

### 2. hex フォーマットを維持

Tailwind v4 は内部的に oklch を使用するが、`@theme` では hex を正式にサポートしている。現行コードが hex で統一されており、一貫性を優先。oklch 移行は必要になった時点で別 Issue として対応する。

### 3. 未定義シェードの追加

コードベースの grep で、`@theme` に定義されていないがコード内で使用されているシェードを 22 個発見した。完了基準「全ページで色の整合性が視覚確認されている」を満たすため、今回のパレット刷新と同時に全使用シェードを定義する。

## 新パレット値

### Primary（Indigo）

| シェード | 値 | 状態 |
|---------|-----|------|
| 50 | `#eef2ff` | 既存更新 |
| 100 | `#e0e7ff` | 既存更新 |
| 200 | `#c7d2fe` | **新規追加** |
| 500 | `#6366f1` | 既存更新 |
| 600 | `#4f46e5` | 既存更新 |
| 700 | `#4338ca` | 既存更新 |
| 800 | `#3730a3` | **新規追加** |

### Secondary（Slate）

| シェード | 値 | 状態 |
|---------|-----|------|
| 50 | `#f8fafc` | 既存更新 |
| 100 | `#f1f5f9` | 既存更新 |
| 200 | `#e2e8f0` | **新規追加** |
| 300 | `#cbd5e1` | 既存更新 |
| 400 | `#94a3b8` | **新規追加** |
| 500 | `#64748b` | 既存更新 |
| 600 | `#475569` | **新規追加** |
| 700 | `#334155` | 既存更新 |
| 800 | `#1e293b` | **新規追加** |
| 900 | `#0f172a` | 既存更新 |

### Success（Emerald）

| シェード | 値 | 状態 |
|---------|-----|------|
| 50 | `#ecfdf5` | 既存更新 |
| 100 | `#d1fae5` | **新規追加** |
| 200 | `#a7f3d0` | **新規追加** |
| 400 | `#34d399` | **新規追加** |
| 600 | `#059669` | 既存更新 |
| 700 | `#047857` | 既存更新 |
| 800 | `#065f46` | **新規追加** |
| 900 | `#064e3b` | **新規追加** |

### Error（Red）

| シェード | 値 | 状態 |
|---------|-----|------|
| 50 | `#fef2f2` | 既存更新 |
| 100 | `#fee2e2` | **新規追加** |
| 300 | `#fca5a5` | **新規追加** |
| 500 | `#ef4444` | **新規追加** |
| 600 | `#dc2626` | 既存更新 |
| 700 | `#b91c1c` | 既存更新 |
| 800 | `#991b1b` | **新規追加** |

### Warning（Amber）

| シェード | 値 | 状態 |
|---------|-----|------|
| 50 | `#fffbeb` | 既存更新 |
| 100 | `#fef3c7` | **新規追加** |
| 200 | `#fde68a` | **新規追加** |
| 600 | `#d97706` | 既存更新 |
| 700 | `#b45309` | 既存更新 |

### Info（Blue）

| シェード | 値 | 状態 |
|---------|-----|------|
| 50 | `#eff6ff` | 既存更新 |
| 100 | `#dbeafe` | **新規追加** |
| 300 | `#93c5fd` | **新規追加** |
| 600 | `#2563eb` | 既存更新 |
| 700 | `#1d4ed8` | **新規追加** |

## WCAG コントラスト比

| 組み合わせ | 比率 | AA Normal (4.5:1) | AA Large (3:1) | 現行比 → 変化 |
|-----------|------|-------------------|----------------|-------------|
| Slate-900 on white | >>7:1 | PASS | PASS | — |
| Slate-500 on white | ~4.85:1 | PASS | PASS | 4.5→4.85 改善 |
| White on Indigo-600 | ~6.18:1 | PASS | PASS | 5.4→6.18 改善 |
| White on Red-600 | ~4.77:1 | PASS | PASS | ~4.4→4.77 改善 |
| White on Emerald-600 | ~4.00:1 | FAIL | PASS | 3.24→4.00 改善 |
| White on Amber-600 | ~3.20:1 | FAIL | PASS | 2.70→3.20 改善 |

Success/Warning の白テキスト AA Normal 不足は既知の制約（現行より改善）。#615 で対応。

## Phase 1: カラーパレット刷新

### 確認事項

- [x] 型: `@theme` のトークン構造 → `frontend/src/styles.css` で hex が動作中（現行の実績で確認済み）
- [x] パターン: コードで使用される全シェードの網羅 → grep で 6 カテゴリ全て調査済み、22 個の未定義シェードを特定
- [x] ライブラリ: Tailwind v4 `@theme` の hex サポート → 現行プロジェクトが hex で動作中

### 実装手順

1. `styles.css` の `@theme` ブロック内の全カラートークンを新パレット値に置換
2. 未定義だったシェードを追加（各カテゴリ内でシェード番号昇順）
3. `just check-all` 実行
4. `just dev-all` で開発サーバーを起動し、視覚確認

### テストリスト

ユニットテスト: 該当なし（CSS-only の変更）

ハンドラテスト: 該当なし

API テスト: 該当なし

E2E テスト: 該当なし（色値の変更は既存 E2E テストに影響しない）

手動視覚検証（必須）:
- [ ] サイドバー: 背景（secondary-900）、hover（secondary-700）、アクティブ（primary-600）、テキスト色
- [ ] ボタン全種: Primary, Success, Error, Warning, Outline
- [ ] ステータスバッジ: success/error/warning/info の -100 背景 + -700/-800 テキスト
- [ ] フォーム: 通常（secondary-300 border）、エラー（error-300/500 border）
- [ ] ワークフロー詳細: 進行状況バー（success-400）、ステップバッジ（info-100/300/700）
- [ ] テーブル: border-secondary-200, divide-secondary-200
- [ ] ダッシュボード: KPI カード
- [ ] 確認ダイアログ: テキスト（secondary-600/900）
- [ ] 読み込みスピナー: border-secondary-200 border-t-primary-600

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | 初期 grep で primary/success/error/warning/info の未定義シェードのみ発見。secondary の 200/400/600/800 を見落としていた | 未定義 | secondary 全シェードの grep を追加実施。22 箇所で使用を確認し、パレット定義に含めた |
| 2回目 | success-200（User/New border）と success-900（Workflow/List hover）が未検出だった | 未定義 | 追加 grep で発見。パレットに追加 |
| 3回目 | Tailwind v4 が内部的に oklch を使用する点でフォーマットの判断が必要 | 技術的前提 | 現行プロジェクトの hex 実績と公式ドキュメントのサポートを確認。hex 維持を設計判断として記録 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 使用される全シェードが新パレットに含まれている | OK | grep で frontend/src 全 .elm ファイルを検索。6 カテゴリ × 全シェードを確認。未定義 22 シェードを含む計 37 トークンを定義 |
| 2 | 曖昧さ排除 | 全トークンの値が一意に確定 | OK | 37 トークン全てに具体的 hex 値を明記 |
| 3 | 設計判断の完結性 | パレット選択・フォーマット・各カテゴリ色の判断が記載済み | OK | 3 つの設計判断を理由付きで記載 |
| 4 | スコープ境界 | 対象と対象外が明確 | OK | 対象: styles.css @theme 値変更 + 未定義シェード追加。対象外: Elm コード変更、ダークモード、完全 WCAG 準拠 |
| 5 | 技術的前提 | Tailwind v4 @theme の hex サポートが確認済み | OK | 現行プロジェクトが hex で動作中 |
| 6 | 既存ドキュメント整合 | ADR-027、#611、#615 と矛盾しない | OK | ADR-027 は @theme でのトークン定義を承認。#611 で構造確立済み。#615 は WCAG 完全準拠の別 Issue |
