# #326 ルール・スキルファイルの文体規約

## Context

Issue: #326
ブランチ: feature/326-writing-style-guidelines
Worktree: `../ringiflow-326`

AI がルール・スキルファイルを書く/修正する際に解説調・語りかけ調になることを防ぐ文体規約を定義する。

背景: ルール・スキルファイルは「実行書」（何をすべきかの指示）だが、AI は以下の傾向がある:
- 変更経緯・理由を文書本体に散文で書き足す
- 旧方式との対比や哲学的な語りかけを含める
- 冗長な禁止事項を追加する

## 対象・対象外

| 区分 | 内容 |
|------|------|
| 対象 | `.claude/rules/*.md`, `.claude/skills/**/SKILL.md` の文体規約を新規ファイルとして定義 |
| 対象外 | 既存ファイルの文体修正（別 Issue で対応） |

## 設計判断

### 配置場所

選択: **専用ルールファイル `.claude/rules/rule-skill-writing.md`**

| 選択肢 | メリット | デメリット |
|--------|---------|-----------|
| docs.md に追加 | 規約が一箇所に集約 | frontmatter が `**/*.md` のため全 MD に適用される印象 |
| **専用ルールファイル** | frontmatter でスコープ限定可能 | ルールファイルが 1 つ増える |

理由: docs.md は全 Markdown 共通の規約。ルール・スキルファイル固有の「実行書としての文体」は別スコープで管理する方が適切。frontmatter で `.claude/rules/**`, `.claude/skills/**` に限定すれば、ルール/スキル編集時にのみロードされる。

### 「改善の経緯」リンクの扱い

既存ルールファイルには `改善の経緯: [リンク](...)` というパターンがある。

- **簡潔なリンク（1行）**: OK — トレーサビリティとして有用
- **散文的な説明**: NG — 経緯の説明自体はリンク先の改善記録に委ねる

## 実装計画

### Phase 1: 文体規約ファイルの作成

#### 確認事項
- パターン: 既存ルールファイルの frontmatter → `.claude/rules/docs.md`（確認済み: `paths: ["**/*.md"]`）
- パターン: 良い文体 → `api.md`（条件と行動を直結）, `data-store.md`（チェックリスト形式）
- パターン: 問題のある文体 → `lint.md`（理由セクション行73-79）, `latest-practices.md`（背景と目的セクション行12-18）

#### 作成するファイル

`ringiflow-326/.claude/rules/rule-skill-writing.md`

#### 規約の構成

1. **原則**: ルール・スキルファイルは「実行書」。読者はエージェント（実行者）
2. **文体ルール**: 指示的・簡潔に。解説調を避ける
3. **含めるべき内容**: 指示、条件、判断基準、例外、具体例
4. **含めるべきでない内容**: 背景の散文説明、変更経緯の本文埋め込み、旧方式との対比、哲学的解説
5. **NG/OK 具体例**: 既存ファイルから抽出した before/after

#### NG/OK 具体例（計画時点の素案）

**NG: 背景・理由を散文で説明**
```markdown
## 理由

lint ツールはコード品質を保つための重要なガードレールである。無効化による回避は:
1. **問題の先送り**: 根本的な問題を隠蔽し、技術的負債を蓄積する
2. **品質の低下**: プロジェクト理念「品質の追求」に反する
```

**OK: 指示だけを記述（理由はコミットメッセージ・改善記録に記録）**
```markdown
## 禁止事項

- lint の警告を無効化（`#[allow(...)]`, `{- nolint -}` 等）で回避すること
```

**NG: 旧方式との対比を含む**
```markdown
| 言語 | 古いスタイル | 新しいスタイル（採用） |
|------|-------------|----------------------|
| Rust | `mod.rs` でモジュール定義 | ファイル名でモジュール定義 |
```

**OK: 採用する方式だけを記載**
```markdown
| 言語 | 採用スタイル |
|------|-------------|
| Rust | ファイル名でモジュール定義（Rust 2018+） |
```

### Phase 2: Draft PR の作成

`gh pr create --draft` で Draft PR を作成。

## 検証方法

- ファイルの frontmatter が `.claude/rules/**`, `.claude/skills/**` にスコープされていること
- Issue #326 の完了基準との突合:
  - [x] ルール・スキルファイルの文体規約を定義 → 専用ルールファイルとして作成
  - [x] 規約に「含めるべきでない文面」の具体例を記載 → NG/OK 例を含む
  - [x] 対象: `.claude/rules/`, `.claude/skills/` → frontmatter で限定

## ブラッシュアップループの記録

| ループ | きっかけ | 調査内容 | 結果 |
|-------|---------|---------|------|
| 1回目 | 初版完成 → 既存パターンの分析 | 17 個のルールファイルと 5 個のスキルファイルの文体を分析 | 問題パターン（理由セクション、背景セクション、旧方式比較）と良いパターン（api.md, data-store.md のチェックリスト形式）を特定 |
| 2回目 | 「改善の経緯」リンクの扱い | 既存ルールでのリンクパターンを確認 | 簡潔なリンク（1行ポインタ）は OK、散文的な説明は NG と区別。リンクはトレーサビリティとして有用 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | Issue の完了基準が全て計画に含まれている | OK | 3 つの完了基準すべてに対応する成果物がある |
| 2 | 曖昧さ排除 | 規約の内容が具体的 | OK | NG/OK 例で判断基準を明確化。「含めるべきでない内容」を具体列挙 |
| 3 | 設計判断の完結性 | 配置場所・リンクの扱いが確定 | OK | 専用ファイル vs docs.md、リンク OK vs 散文 NG の判断済み |
| 4 | スコープ境界 | 対象と対象外が明記 | OK | 既存ファイル修正は対象外と明記 |
| 5 | 技術的前提 | frontmatter スコープの仕組みを確認 | OK | docs.md の frontmatter パターンで確認済み |
| 6 | 既存ドキュメント整合 | docs.md と矛盾しない | OK | docs.md は全 MD 共通規約、本ファイルはルール/スキル固有の文体規約で補完関係 |
