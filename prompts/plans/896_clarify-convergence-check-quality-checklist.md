# #896 収束確認（実装フェーズ）と品質チェックリスト（コード品質確認）の関係明確化

## Context

#894 の ISO 25010 マッピング分析で、zoom-rhythm.md の「収束確認チェックリスト（実装フェーズ）」7 項目と 01_Issue駆動開発.md の「品質チェックリスト（コード品質確認）」10 項目中の 7 項目が完全一致していることが判明。横断検証フェーズも 3 項目が完全一致。

#269 で責務分離（zoom-rhythm.md = Why + 背景、Issue駆動開発.md = What + 確認項目）は定義済みだが、zoom-rhythm.md 側の表の簡素化が未完了のまま残っていた。

## 問題分析

**Want**: 各メカニズムの役割と責務の境界が明確であること

**To-Be**: zoom-rhythm.md は「タイミング + To-Be 宣言」、品質 CL は「具体的な確認項目」。重複ゼロ。

**As-Is**: zoom-rhythm.md:138 で品質 CL を参照しつつ、直後に 7 項目の重複表が存在

**根本原因**: #269 で品質 CL 側への統合は完了したが、zoom-rhythm.md 側の表削除が行われなかった

## 設計判断

| フェーズ | 判断 | 理由 |
|---------|------|------|
| 実装 | 表を削除、品質 CL 参照のみ | L138 で既に参照済み。7/7 完全重複 |
| テスト | 表を維持、導入テキスト改善 | 品質 CL の 8 項目とは粒度が異なる高レベル To-Be 宣言 |
| 横断検証 | 表を削除、品質 CL 参照のみ | 3/3 完全一致。意図を説明するテキストに置換 |

## スコープ

対象:
- `.claude/rules/zoom-rhythm.md` — 実装/テスト/横断検証フェーズの再構成
- `docs/60_手順書/04_開発フロー/01_Issue駆動開発.md` — 参照テキスト更新、変更履歴追記
- `docs/80_ナレッジベース/methodology/ISO25010.md` — マッピング注記追加

対象外:
- 設計・計画フェーズの収束確認（6 項目）— 品質 CL にない独自観点
- ギャップ発見の観点 — 設計段階の指針
- 「計画ファイルへの記載」セクション — 設計・計画フェーズのテンプレートのみ。影響なし
- 「PR 本文への記載」セクション — 品質 CL カテゴリ別記載。影響なし
- 「二つの砦」モデル — 概念レベル。影響なし

---

## Phase 1: zoom-rhythm.md の実装・横断検証フェーズ再構成

### 確認事項

なし（既知のパターンのみ。変更対象の現行内容は探索で把握済み）

### 操作パス

該当なし（操作パスが存在しない）

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

### 変更内容

**1. 実装フェーズ（L134-148）**

変更前:
```markdown
### 実装フェーズ

各 TDD サイクルの Refactor で [設計原則レンズ](...) の問いに答える。

コミット前に品質チェックリストの「コード品質確認」がすべて OK であること。Phase 完了後に全体を通して検証する。→ [品質チェックリスト](...)

| # | 観点 | 理想状態（To-Be） |
|---|------|------------------|
| 1 | アーキテクチャ一貫性 | レイヤー違反がゼロ |
| ... (7項目) |
```

変更後:
```markdown
### 実装フェーズ

各 TDD サイクルの Refactor で [設計原則レンズ](...) の問いに答える。

コミット前に品質チェックリストの「コード品質確認」と「品質向上」がすべて OK であること。Phase 完了後に全体を通して検証する。→ [品質チェックリスト](...)
```

- 7 項目の表（L140-148）を削除
- L138 のテキストに「品質向上」を追加（品質 CL の「品質向上の最終確認（ゼロ→プラス）」もカバー）
- 「暫定値・ワークアラウンド」セクション（L150-155）は維持

**2. テストフェーズ（L157-167）**

変更前:
```markdown
### テストフェーズ

→ [品質チェックリスト](...)
```

変更後:
```markdown
### テストフェーズ

テストの理想状態（To-Be）。具体的な確認手順は [品質チェックリスト](...) を参照。
```

- 5 項目のテーブルは維持
- 導入テキストを変更: 表の役割（To-Be 宣言）と品質 CL の役割（確認手順）の関係を明示

**3. 横断検証フェーズ（L169-175）**

変更前:
```markdown
### 横断検証フェーズ（複数 Phase の PR で全 Phase 完了後に実施）

| # | 観点 | 理想状態（To-Be） |
|---|------|------------------|
| 1 | Phase 間データフロー整合 | 全レイヤーでデータが一致している |
| 2 | 仕様との端到端突合 | ... |
| 3 | 完了基準の E2E 検証 | ... |
```

変更後:
```markdown
### 横断検証フェーズ（複数 Phase の PR で全 Phase 完了後に実施）

各 Phase が個別に整合していても、Phase 間の接続でずれが生じることがある。全 Phase 完了後に、PR 全体を俯瞰して検証する。→ [品質チェックリスト](...)
```

- 3 項目の表を削除。品質 CL の横断検証と完全一致のため
- 横断検証の意図を説明するテキストを追加

## Phase 2: 01_Issue駆動開発.md の参照テキスト更新

### 確認事項

なし（既知のパターンのみ）

### 操作パス

該当なし（操作パスが存在しない）

### テストリスト

全層該当なし

### 変更内容

**L434 の参照テキスト更新**

変更前:
```markdown
→ 各観点の背景・出典: [俯瞰・実装リズム > 収束確認のチェックリスト](...)
```

変更後:
```markdown
→ 各フェーズの理想状態（To-Be）: [俯瞰・実装リズム > 収束確認のチェックリスト](...)
```

zoom-rhythm.md の責務（Why + To-Be）に合わせた表現に変更。

**変更履歴の追記（末尾）**

## Phase 3: ISO25010.md の注記追加

### 確認事項

なし（既知のパターンのみ）

### 操作パス

該当なし（操作パスが存在しない）

### テストリスト

全層該当なし

### 変更内容

**実装フェーズのマッピング（L360）に注記追加**

実装フェーズの見出しの直後に:
```markdown
注: 具体的な確認項目は [品質チェックリスト](...) のコード品質確認に一元化されている。以下のマッピングは品質チェックリストの対応項目と同一。詳細は [品質チェックリストとのマッピング](#品質チェックリストとのマッピング) を参照。
```

**横断検証フェーズのマッピング（L382）に同様の注記追加**

---

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | 実装フェーズの表を維持（B案）か削除（A案）かの判断 | 設計判断の完結性 | L138 で既に品質 CL を参照済み。観点名も品質 CL に記載済みのため、重複不要。実装+横断検証は A、テストのみ B |
| 2回目 | ISO25010.md のマッピングへの影響 | 既存ドキュメント整合 | Phase 3 で注記追加を計画に追加 |
| 3回目 | L434 の参照テキストが変更後と不整合 | 曖昧 | Phase 2 で参照テキストを「各フェーズの理想状態（To-Be）」に更新 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 全重複箇所が計画に含まれている | OK | 実装7項目完全重複、テスト5項目部分重複、横断検証3項目完全一致、ISO25010.md 影響、01_Issue駆動開発.md L434 すべて対応 |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | 各 Phase で変更前/変更後を具体的に記載 |
| 3 | 設計判断の完結性 | 全ての差異に判断が記載 | OK | 実装+横断検証は表削除、テストは表維持。理由を記載 |
| 4 | スコープ境界 | 対象と対象外が両方明記 | OK | 対象外5項目を明示 |
| 5 | 技術的前提 | 前提が考慮されている | OK | zoom-rhythm.md がシステムプロンプトに含まれる点を考慮 |
| 6 | 既存ドキュメント整合 | 矛盾がない | OK | #269 の責務分離方針と整合。ISO25010.md のマッピング対応済み |

## 検証方法

1. `just check-all` が通ること
2. zoom-rhythm.md の各フェーズが品質 CL への参照を持つこと
3. ISO25010.md のマッピングが一貫していること
4. ドキュメント内のリンクが有効であること
