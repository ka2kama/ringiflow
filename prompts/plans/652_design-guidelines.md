# #652 デザインガイドライン拡充

## Context

#644 で品質プロセス（UI/UX レンズ）を導入したが、レンズが参照する「正解の定義」が不足している。オーナーがデザイン領域の専門外であるため、AI がデザイン品質を主導する前提がある。AI が一貫した判断を行うには、styles.css にスペーシング・レイアウト・色使い・レスポンシブの判断基準を形式知化する必要がある。

## 対象ファイル

- `frontend/src/styles.css` — デザインガイドラインの拡充（メイン成果物）

## 対象外

- 既存ページの大規模リファクタリング
- 新規コンポーネントの追加
- ダークモード対応（CORE-06 で MAY / Epic スコープ外）

## 方針

### 既存パターンの形式知化

探索で発見した暗黙のパターンをガイドラインとして明文化する。新しいルールを発明するのではなく、既に一貫して使われているパターンを「正解」として記録する。

### 理論的裏付け

CRAP 原則（Contrast, Repetition, Alignment, Proximity）を参照フレームワークとする。ただし CRAP は背景理論であり、ガイドラインの記述自体は実践的・具体的にする（「CRAP の C に準拠」のような書き方はしない）。

### styles.css の構成

既存ガイドラインの末尾に以下の5セクションを追加する:

```
=== 既存 ===
タイポグラフィ / シャドウ / 角丸 / テーブル / バッジ / ボタン / フォーム入力 /
セクションカード / テキストカラー / アニメーション / トランジション / アクセシビリティ

=== 追加 ===
1. デザイン原則
2. スペーシング
3. レイアウト構成
4. 色の使い分け
5. レスポンシブ
```

## Phase 1: styles.css ガイドライン拡充

### 確認事項

- [x] 既存 styles.css のガイドライン構造 → L1-76, コメントブロック形式、「項目名 : 値 — 補足」の書式
- [x] 既存ページのスペーシングパターン → 探索済み（mb-6, space-y-6, p-4/p-6, px-4 py-3 等）
- [x] 既存ページのレイアウトパターン → 探索済み（flex header, max-w-lg form, grid cols 等）
- [x] 既存ページの色使いパターン → 探索済み（primary=CTA, secondary=text/border, status=badge 等）
- [x] CORE-06 デザインシステム要件 → 6色パレット、4px グリッド、768px/1024px ブレークポイント

### 追加内容の詳細

#### 1. デザイン原則

プロジェクトのビジュアルデザインの方向性を明示する。エンタープライズ SaaS として「透明で邪魔しない」デザインを志向する。

```
デザイン原則:
  1. 透明性     : UI はコンテンツを際立たせる背景であり、主役ではない
  2. 一貫性     : 同じ役割の要素は同じ見た目。パターンの反復で認知負荷を下げる
  3. 意図的な余白 : 余白は「空き」ではなく、情報のグルーピングと優先度を伝える手段
  4. 最小のコントラスト : 重要な情報だけを際立たせる。装飾的な強調は避ける
```

#### 2. スペーシング

探索で発見した一貫パターンをコンテキスト別に整理する。

```
スペーシング（Tailwind 4px グリッド準拠）:
  ページ:
    タイトル〜コンテンツ : mb-6（ヘッダー要素に付与、または flex 親に mb-6）
    セクション間         : space-y-6（標準）、space-y-8（大セクション区切り）
  カード:
    内部パディング       : p-6（標準）、p-4（コンパクト / 入れ子カード）
  テーブル:
    セル                 : px-4 py-3（th, td 共通）
    テーブル下の件数表示 : mt-4
  フォーム:
    フィールド間         : space-y-6（親コンテナ）
    ラベル〜入力         : mb-1（ラベル側）
    入力〜エラー文       : mt-1（エラー側）
    ボタングループ       : flex gap-3
    フォーム幅           : mx-auto max-w-lg（標準）、max-w-2xl（権限マトリックス等の複雑フォーム）
  フィルタ:
    フィルタ〜コンテンツ : mb-4
  パンくず:
    セパレータ           : mx-2
    コンテナ下           : mb-4

  4px グリッドの例外:
    Badge の py-0.5（2px）— 行内要素として視覚的に適切なため許容
```

#### 3. レイアウト構成

ページの骨格パターンを整理する。

```
レイアウト構成:
  ページ骨格:
    ヘッダー   : div > flex items-center justify-between mb-6
                  左: text-2xl font-bold text-secondary-900
                  右: Button（CTA）
    フィルタ   : div > mb-4（検索バー、フィルタセレクト等）
    コンテンツ : RemoteData パターンで分岐
                  NotAsked  → 空
                  Loading   → LoadingSpinner
                  Failure   → ErrorState
                  Success   → viewContent

  コンテンツ構造:
    一覧ページ   : テーブル + 件数表示（mt-4 text-sm text-secondary-500）
    詳細ページ   : space-y-6 で複数セクションカードを配置
    新規/編集     : mx-auto max-w-lg（or max-w-2xl）+ space-y-6

  グリッド:
    KPI カード    : grid gap-4 sm:grid-cols-3
    フィルタ群    : grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3
    定義リスト    : dl > grid grid-cols-[auto_1fr] gap-x-6 gap-y-2 text-sm

  インライン要素:
    ラベル + 値   : flex items-center gap-2
    ボタングループ : flex gap-3
    区切り付き     : flex gap-3 pt-4 border-t border-secondary-100
```

#### 4. 色の使い分け

セマンティックカラーの使用コンテキストを明示する。

```
色の使い分け（セマンティクス）:
  Primary（Indigo）— ブランド・インタラクション:
    CTA ボタン       : bg-primary-500 → hover:bg-primary-600
    リンクテキスト   : text-primary-600 → hover:text-primary-700
    フォーカスリング : focus-visible:ring-primary-500
    選択状態の背景   : bg-primary-50
    使わない場面     : ステータス表示（success/error/warning を使う）

  Secondary（Slate）— 構造・テキスト:
    テキスト階層     : 900（見出し）、700（ラベル）、500（ヘルパー）、400（無効）
    ボーダー         : 200（カード区切り）、300（入力フィールド）
    背景             : 50（ページ背景、テーブルヘッダー、ホバー、読み取り専用）
    中性ステータス   : 100/200（下書き、キャンセル済み）

  Success（Emerald）— 肯定・完了:
    ボタン           : bg-success-600（承認、完了アクション）
    バッジ           : bg-success-50 text-success-600 border-success-200（承認済み、アクティブ）
    アラート         : bg-success-50 text-success-700

  Error（Red）— 否定・危険:
    ボタン           : bg-error-600（却下、削除アクション）
    バッジ           : bg-error-50 text-error-600 border-error-200（却下、失敗）
    フォーム検証     : border-error-300 + text-error-600
    アラート         : bg-error-50 text-error-700

  Warning（Amber）— 注意・保留:
    ボタン           : bg-warning-600（注意を要するアクション）
    バッジ           : bg-warning-50 text-warning-600 border-warning-200（保留中、要対応）
    アラート         : bg-warning-50（注意喚起ボックス）

  Info（Blue）— 情報・中立:
    バッジ           : bg-info-50 text-info-600 border-info-300（進行中）
    情報ボックス     : bg-info-100 text-info-700

  バッジの色パターン（共通構造）:
    bg-{color}-50 text-{color}-600 border-{color}-200
    （薄い背景 + 濃いテキスト + 中間ボーダー）
```

#### 5. レスポンシブ

CORE-06 で定義されたブレークポイント戦略を文書化する。

```
レスポンシブ（モバイルファースト）:
  ブレークポイント:
    sm (640px)     : グリッドカラム展開（1列 → 2-3列）
    lg (1024px)    : サイドバー表示、3列グリッド
    md/xl/2xl      : 現在未使用（必要に応じて追加）

  パターン:
    テーブル         : overflow-x-auto で横スクロール（全ブレークポイント共通）
    グリッド         : grid-cols-1 → sm:grid-cols-2 → lg:grid-cols-3
    サイドバー       : lg 以上で表示（--spacing-sidebar: 16rem）
    フォーム         : max-w-lg で中央配置（レスポンシブ不要）

  原則:
    小画面をデフォルトとし、大画面でオプトインする
    エンタープライズ SaaS のため、デスクトップ（lg+）での完全対応を優先
```

### テストリスト

ユニットテスト（該当なし — CSS コメントのみの変更）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

検証:
- [x] 各ガイドラインが既存実装と一致するか — 探索結果（8ページ + 10コンポーネント）と突合済み
- [x] 既存ガイドラインとの矛盾がないか — テキストカラーと色の使い分けは相補的、タイポグラフィマージンとスペーシングは異なる視点で同じ値を参照
- [x] 曖昧な記述がないか — 全値が具体的な Tailwind クラスで指定、「場合による」等の表現なし
- [x] CORE-06 要件との整合性 — 4px グリッド、6色パレット、ブレークポイント（sm/lg）すべて対応
- [x] ビルド確認 — `pnpm run build` 成功（CSS コメントのみの変更だが構文エラーなし）

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | デザイン原則セクションで「エンタープライズ SaaS」の方向性が未定義 | 曖昧 | 4つのデザイン原則を具体化（透明性、一貫性、意図的な余白、最小のコントラスト） |
| 2回目 | スペーシングの「例外」が未記載 | 不完全なパス | Badge py-0.5 の例外を明示 |
| 3回目 | 色の使い分けで「使わない場面」が未定義 | 未定義 | Primary に「ステータス表示には使わない」を追加 |
| 4回目 | レスポンシブで md/xl/2xl の扱いが未記載 | 未定義 | 「現在未使用（必要に応じて追加）」を明示 |
| 5回目 | CORE-06 でブレークポイント 768px が要件にあるが sm(640px) を使用 | アーキテクチャ不整合 | Tailwind の sm(640px) は CORE-06 の 768px(tablet) の近似。md(768px) は未使用だが利用可能。レスポンシブセクションで説明 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | Issue の完了基準 5 項目すべてが計画に含まれている | OK | デザイン原則、スペーシング、レイアウト、色使い、レスポンシブの 5 セクションが計画に対応 |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | 各セクションで具体的な Tailwind クラスと使用コンテキストを明示 |
| 3 | 設計判断の完結性 | 全ての差異に判断が記載されている | OK | p-4 vs p-6, max-w-lg vs max-w-2xl, space-y-6 vs space-y-8 等の使い分け基準を明記 |
| 4 | スコープ境界 | 対象と対象外が両方明記されている | OK | 対象: styles.css ガイドライン拡充、対象外: ページリファクタリング・新コンポーネント・ダークモード |
| 5 | 技術的前提 | コードに現れない前提が考慮されている | OK | Tailwind v4 デフォルトスケール、CORE-06 ブレークポイント要件 |
| 6 | 既存ドキュメント整合 | 既存ドキュメントと矛盾がない | OK | styles.css 既存ガイドライン、CORE-06 6.5 と照合。ブレークポイント差異（640 vs 768）は説明済み |
