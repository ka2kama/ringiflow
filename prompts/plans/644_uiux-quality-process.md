# UI/UX 観点の品質プロセスへの導入

## Context

Issue #445（デザイン・UI/UX の品質をベストプラクティス水準に引き上げる）に関連し、UI/UX 品質を**プロセスレベル**で組み込む。

現状、ブラッシュアップループのギャップ発見の観点と設計原則レンズはコード/アーキテクチャ品質に特化しており、UI/UX 品質は個別 Issue（#611, #612, #613 等）として扱われている。プロセスに組み込むことで、個別 Issue を超えた継続的な UI/UX 品質改善を実現する。

## スコープ

### 対象

| ファイル | 変更内容 |
|---------|---------|
| `.claude/rules/zoom-rhythm.md` | ブラッシュアップループのギャップ発見の観点に UI/UX 観点を追加 |
| `docs/60_手順書/04_開発フロー/02_TDD開発フロー.md` | 設計原則レンズに UI/UX レンズを追加、既知手法との対応を更新 |
| `docs/60_手順書/04_開発フロー/01_Issue駆動開発.md` | 品質チェックリストに UI/UX 品質確認セクションを追加 |

### 対象外

- デザイントークンや共通コンポーネントの実装変更（#445 のサブ Issue で対応）
- WCAG 監査の実施（#615 で対応）
- styles.css のガイドライン追記（既に十分に記述されている）

## 設計判断

### 判断1: UI/UX レンズの適用条件

**決定**: フロントエンド変更を含む場合のみ適用する（条件付き適用）

理由: 既存のコードレンズ（意図の明確さ、SRP 等）は全コードに適用されるが、UI/UX レンズはビュー関数/Elm コードに特化した観点であり、バックエンド変更のみの場合はノイズになる。

### 判断2: レンズの粒度

**決定**: 既存のレンズと同じ粒度（1レンズ = 1つの問い）を維持する

理由: 設計原則レンズの価値は「具体的な問いに答える」ことにある（zoom-rhythm.md: 「抽象的に『視点を上げる』のではなく、具体的な問いに答える」）。UI/UX も同じ形式で、コード上で即座に確認できる問いにする。

### 判断3: 品質チェックリストとの連動

**決定**: 設計原則レンズの UI/UX 観点を品質チェックリストにも反映する

理由: 既存の設計原則レンズと品質チェックリストは「Refactor で作り込み、品質チェックリストで最終確認する」関係。UI/UX も同じ二段構えにする。

### 判断4: 既知手法の参照

**決定**: Nielsen's 10 Usability Heuristics（H1〜H10）と WCAG 2.1 POUR 原則を参照し、対応関係をドキュメントに記載する

理由: methodology-design.md の方針（既知手法を地図として活用し、関連を記録する）に従う。

## 変更内容

### Phase 1: zoom-rhythm.md — ブラッシュアップループのギャップ発見の観点

#### 確認事項

- [x] 既存のギャップ発見の観点テーブルの構造 → `.claude/rules/zoom-rhythm.md` L29-48, 2テーブル（欠陥6行 + 品質4行）
- [x] 「これらは代表的な観点であり〜」の注記の位置 → 同 L49, 品質テーブル直後

#### 変更箇所

「ギャップ発見の観点」セクションの 2 つのテーブルに UI/UX 行を追加する。

**欠陥の発見（マイナス → ゼロ）** に追加:

| 観点 | 探すもの |
|------|---------|
| デザイントークン乖離 | styles.css のトークン・ガイドラインに沿っていない実装 |
| アクセシビリティ欠陥 | WCAG 2.1 AA 違反（セマンティック HTML、ARIA、キーボード操作、コントラスト比） |
| 状態網羅漏れ | UI で Loading/Error/Empty の一部が未処理のもの |

**品質の向上（ゼロ → プラス）** に追加:

| 観点 | 問い |
|------|------|
| ユーザーフィードバック | 操作に対する視覚的フィードバック（loading、success/error 表示）が適切か |
| 視覚的階層 | 情報の優先度がタイポグラフィ・色・スペーシングで表現されているか |

注: 「これらは代表的な観点であり、網羅的ではない。対象の性質に応じて観点を追加する。」の注記は既存のまま維持。UI/UX 行の追加はこの設計意図に沿っている。

#### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

### Phase 2: 02_TDD開発フロー.md — 設計原則レンズに UI/UX レンズを追加

#### 確認事項

- [x] 既存の設計原則レンズの構造（毎 Refactor / モジュール完成時） → `docs/60_手順書/04_開発フロー/02_TDD開発フロー.md` L197-224, 毎Refactor 3レンズ + モジュール完成時 3レンズ
- [x] 既知手法との対応セクションの構造 → 同 L560-566, 3エントリのテーブル
- [x] 品質チェックリストの「品質向上の最終確認」との対応関係の記述 → 同 L221「Refactor で作り込み、品質チェックリストで最終確認する」

#### 変更箇所

設計原則レンズセクション（L219 の「既知手法との対応」注記の後）に、UI/UX レンズを追加する。

```markdown
#### UI/UX レンズ（フロントエンド変更時）

フロントエンド（Elm ビュー関数、Tailwind クラス）を変更する場合、コード設計レンズに加えて以下を適用する。

毎 Refactor:

| レンズ | 問い |
|--------|------|
| デザイントークン準拠 | styles.css のトークンとガイドラインを使用しているか？生の色値・未定義シェードはないか？ |
| 共有コンポーネント活用 | 既存の共有コンポーネント（Button, Badge, FormField, ErrorState, EmptyState 等）で実現できないか？ |
| 状態の網羅性 | RemoteData の全状態（NotAsked/Loading/Failure/Success）と空データにフィードバックがあるか？ |

ページ/コンポーネントの完成時:

| レンズ | 問い |
|--------|------|
| アクセシビリティ | セマンティック HTML、ARIA 属性、キーボード操作（focus-visible）、フォームの label 関連付けが適切か？ |
| エラーのユーザビリティ | エラー表示がユーザーの言語で表現され、回復手段（再読み込み等）を提供しているか？ |
| 視覚的階層 | styles.css のタイポグラフィ階層に沿い、関連要素が近接でグルーピングされているか？ |
| 破壊的操作の防御 | 削除・却下等の破壊的操作に ConfirmDialog があり、ボタン色が操作の意味と一致しているか？ |
```

コード設計レンズとの対応関係:

| コード設計レンズ | 対応する UI/UX レンズ |
|----------------|---------------------|
| 意図の明確さ | 視覚的階層 |
| 重複の排除 | 共有コンポーネント活用 |
| 要素の最小性 | （H8 ミニマルデザインとして視覚的階層に包含） |
| 型の活用 | 状態の網羅性（RemoteData + Button.Variant） |

「既知手法との対応」テーブルに以下を追加:

| 概念 | 出典 | 本ドキュメントでの対応 |
|------|------|---------------------|
| Usability Heuristics | Jakob Nielsen, *10 Usability Heuristics for User Interface Design* (1994, 2024 更新) | UI/UX レンズ（H1: 状態の網羅性、H4: デザイントークン準拠、H5/H3: 破壊的操作の防御、H8: 視覚的階層、H9: エラーのユーザビリティ） |
| POUR 原則 | W3C, *WCAG 2.1* (2018) | アクセシビリティレンズ（Perceivable + Operable） |

#### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

### Phase 3: 01_Issue駆動開発.md — 品質チェックリストに UI/UX セクション追加

#### 確認事項

- [x] 品質チェックリストの既存構造（マイナス→ゼロ / ゼロ→プラス / 横断検証） → `docs/60_手順書/04_開発フロー/01_Issue駆動開発.md` L445-468, 3セクション（コード品質9項目 + 品質向上4項目 + 横断検証3項目）
- [x] 品質向上の最終確認の内容 → 同 L457-462, シンプルさ・型の活用・責務の明確さ・ベストプラクティスの4項目

#### 変更箇所

「品質向上の最終確認（ゼロ→プラス）」セクションの後に、UI/UX 品質確認セクションを追加:

```markdown
UI/UX 品質確認（フロントエンド変更がある場合）:

- [ ] デザイントークン整合: styles.css のトークン・ガイドラインに準拠しているか
- [ ] 共有コンポーネント活用: 既存の共有コンポーネントを使用しているか（新規実装前に確認）
- [ ] アクセシビリティ: セマンティック HTML、ARIA 属性、キーボード操作（focus-visible）、フォームの label 関連付け
- [ ] 状態表示: RemoteData の全状態 + 空データが適切に処理されているか
- [ ] 視覚的階層: タイポグラフィ階層（styles.css ガイドライン）に沿っているか
```

## 既知手法との対応

| 本計画の概念 | 既知手法 | 出典 |
|-------------|---------|------|
| UI/UX レンズ全体 | 10 Usability Heuristics | Nielsen (1994, 2024 更新) |
| アクセシビリティレンズ | POUR 原則 / WCAG 2.1 AA | W3C (2018) |
| 視覚的階層レンズ | ゲシュタルト心理学の UI 適用 | Wertheimer (1923) → NN/g |
| デザイントークン準拠 | Design Tokens / Consistency and Standards (H4) | W3C Design Tokens CG / Nielsen |

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | 品質チェックリストにも反映が必要 | 不完全なパス | Phase 3 を追加。設計原則レンズと品質チェックリストの二段構えを維持 |
| 2回目 | 品質チェックリストに「エラー表示」「破壊的操作の防御」が欠落（設計原則レンズとの 1:1 対応が崩壊）、zoom-rhythm の状態網羅漏れの粒度が TDD/Issue と不整合、Issue に既知手法への参照リンクがない | 不完全なパス / 曖昧 | 品質チェックリストに 2 項目追加、zoom-rhythm の記述を詳細化、Issue に参照リンク追加 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 変更対象 3 ファイルが計画に含まれている | OK | zoom-rhythm.md, TDD開発フロー.md, Issue駆動開発.md の 3 ファイル |
| 2 | 曖昧さ排除 | 追加する内容が具体的に記述されている | OK | 各 Phase で追加するテーブル・チェックリストの具体的な内容を記載 |
| 3 | 設計判断の完結性 | 適用条件、粒度、既知手法参照の判断が記載されている | OK | 判断 1〜4 で全て記載 |
| 4 | スコープ境界 | 対象と対象外が明記されている | OK | 対象外（実装変更、WCAG 監査、styles.css 追記）を明記 |
| 5 | 技術的前提 | ドキュメント構造の前提が確認されている | OK | 各 Phase の確認事項で対象ファイルの構造を確認予定 |
| 6 | 既存ドキュメント整合 | methodology-design.md の方針と整合 | OK | 既知手法の調査→参照→記録の流れに従っている |

## 検証

1. 変更後の 3 ファイルを通読し、既存の観点との整合性を確認
2. UI/UX レンズの問いが「具体的でコード上で確認できる」ことを確認（抽象的な問いになっていないか）
3. 設計原則レンズと品質チェックリストの対応が 1:1 であることを確認
4. 既知手法との対応が TDD 開発フロー.md に記載されていることを確認
