# Issue #300: 設計書における「現状」と「将来像」の区別を明確化する

## Context

基本設計書・詳細設計書において「現在実装済み」と「将来実装予定」が区別なく混在しており、読者（AI・人間）が現状を正しく把握できない。特に `01_高度な設計.md` はほぼ全てが未実装の将来像であり、最も深刻。

## アプローチ: セクション単位の実装状態マーカー

各セクションの冒頭に blockquote 形式で実装状態を明示する。実装済みセクションにはマーカーを付けない（「現状」がデフォルト）。

**マーカーパターン:**

```markdown
> **実装状態**: 未実装（Phase N で実装予定）

> **実装状態**: 部分的に実装済み。〇〇は Phase N で対応予定。
```

**設計判断**:
- マーカーなし = 実装済み（デフォルト）。例外のみマーキングする
- ドキュメントの大部分が未実装の場合（`01_高度な設計.md`）は冒頭にも注記を追加
- Mermaid 図やコード例は残す（将来の参照価値がある）。ただし未実装であることを明示
- Phase 番号は `docs/40_詳細設計書/00_実装ロードマップ.md` に準拠

## 対象

### 1. `docs/30_基本設計書/00_アーキテクチャ概要.md`

| セクション | 状態 | 対応 |
|-----------|------|------|
| イベント駆動（CQRS + Event Sourcing） | 未実装 | マーカー追加 |
| WebSocket 通信 | 部分的 | マーカー追加 |

### 2. `docs/30_基本設計書/01_アーキテクチャ設計.md`

| セクション | 状態 | 対応 |
|-----------|------|------|
| 5.2 バッチ処理アーキテクチャ | 未実装 | マーカー追加 |
| 5.3 Elm/Ports 連携（WebSocket 再接続・再同期の詳細） | 部分的 | マーカー追加 |
| 5.3.2 Rust バックエンド安定運用要件 | 部分的 | マーカー追加 |
| 5.4 AWS Batch 採用判断 | 未実装 | マーカー追加 |
| 5.5 バッチジョブ一覧 | 未実装 | マーカー追加 |

### 3. `docs/30_基本設計書/04_運用設計.md`

| セクション | 状態 | 対応 |
|-----------|------|------|
| 9.1 監視アーキテクチャ | 未実装 | マーカー追加 |
| 9.2 監視項目 | 未実装 | マーカー追加 |
| 9.3 アラート通知 | 未実装 | マーカー追加 |
| 9.5 障害復旧（DR） | 未実装 | マーカー追加 |
| 10.x CI/CD（CodePipeline, Blue/Green 部分） | 部分的 | マーカー追加 |

### 4. `docs/40_詳細設計書/01_高度な設計.md`

ほぼ全体が未実装。**冒頭に文書レベルの注記を追加** + 各セクションにマーカー。

| セクション | 状態 | 対応 |
|-----------|------|------|
| 文書冒頭 | — | 全体注記を追加 |
| 14.x 2025年ベストプラクティス | 未実装 | マーカー追加 |
| 15.x イベント駆動アーキテクチャ全体 | 未実装（Phase 4） | マーカー追加 |

### 5. `docs/40_詳細設計書/05_実装ガイドライン.md`

| セクション | 状態 | 対応 |
|-----------|------|------|
| 外部依存の保護（サーキットブレーカ等） | 未実装 | マーカー追加 |
| correlationId 伝播 | 部分的 | マーカー追加 |
| 冪等性保証 | 部分的 | マーカー追加 |

### 6. `.claude/rules/docs.md`

実装状態マーカーの規約を追加（今後の設計書でも同じパターンを使うため）。

## 対象外

- 将来像セクションの削除や別ファイルへの分離（参照価値があるため残す）
- `00_実装ロードマップ.md` の修正（これ自体が計画文書なのでマーカー不要）
- `02_プロジェクト構造設計.md`、`03_インフラとDB設計.md`（探索の結果、現状を正確に反映しているため対応不要）

## 既存 PR とのコンフリクト回避

| 既存 PR | 修正ファイル | #300 との重複 | 対策 |
|---------|-------------|--------------|------|
| #303 (`feature/297-ci-workflow-rules`) | CLAUDE.md, prompts/improvements/ | なし | — |
| #304 (`feature/301-doc-update-trigger`) | CLAUDE.md, `00_アーキテクチャ概要.md`, `02_プロジェクト構造設計.md` | `00_アーキテクチャ概要.md` | セクションが異なる（#304=Auth Service 追加、#300=イベント駆動・WebSocket にマーカー追加）。main から分岐すれば自動マージ可能 |

作業手順:
1. `main` から `feature/300-design-doc-status` ブランチを作成（現在 `feature/301-doc-update-trigger` にいるので `main` に戻ること）
2. `00_アーキテクチャ概要.md` は main 版を基準に編集（#304 の Auth Service 変更とは別セクション）

## コミット計画

1. `#300 Add implementation status markers to design documents`
2. `#300 Add implementation status convention to docs rules`

## 検証

- 各ファイルで「未実装」「部分的」マーカーが漏れなく付与されていること
- マーカーなしのセクションが実際に実装済みであること
- Phase 番号が実装ロードマップと整合していること

### ブラッシュアップループの記録

| ループ | きっかけ | 調査内容 | 結果 |
|-------|---------|---------|------|
| 1回目 | 初版完成 → マーカー方式の選択 | 3つのアプローチ（maturity level / 分離 / マーカー）を比較 | セクション単位マーカーを採用。分離は構造変更が大きすぎ、maturity level は過剰。blockquote マーカーが最もシンプルで効果的 |
| 2回目 | 00_アーキテクチャ概要.md の対象確認 | Issue 指定の4ファイル以外にも同じ問題がないか確認 | 00 概要のイベント駆動・WebSocket セクションも未実装を含む。対象に追加 |
| 3回目 | docs.md への規約追加の是非 | Issue のスコープを確認 | Issue は「区別されている」「即座に判断できる」が完了基準。規約追加で今後の一貫性も確保 |

## 収束確認（設計・計画）

| # | 観点 | 判定 | 確認内容 |
|---|------|------|---------|
| 1 | 網羅性 | OK | 探索で発見された全対象ファイル・セクションを計画に列挙。Issue 指定の4ファイル + 00 概要 + docs.md |
| 2 | 曖昧さ排除 | OK | マーカーの具体的な書式、適用基準（未実装/部分的/実装済み=マーカーなし）を明確化 |
| 3 | 設計判断の完結性 | OK | 3つのアプローチから選択理由を記載 |
| 4 | スコープ境界 | OK | 対象（5ファイル + docs.md）と対象外（ロードマップ、構造設計、インフラ設計）を明記 |
| 5 | 技術的前提 | OK | blockquote は GitHub Markdown で正しくレンダリングされる |
| 6 | 既存ドキュメント整合 | OK | Phase 番号は実装ロードマップに準拠 |
