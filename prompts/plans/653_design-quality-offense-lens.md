# #653 デザイン品質の攻めレンズを導入する

## コンテキスト

#644 で UI/UX の「守り」（マイナス→ゼロ: Nielsen's Heuristics + WCAG による欠陥検出）を品質プロセスに導入した。しかし「攻め」（ゼロ→プラス: ビジュアルの洗練）が不足しており、コード品質（守り: 品質チェックリスト、攻め: 設計原則レンズ）と比べて体系性に欠ける。

#652 で整備したデザインガイドライン（設計原則: 透明性、一貫性、意図的な余白、最小の強調）を基盤に、CRAP 原則に基づく「攻め」レンズを追加する。

## スコープ

対象:

| ファイル | 変更内容 |
|---------|---------|
| `.claude/rules/zoom-rhythm.md` | 品質の向上テーブルにデザイン品質行を追加 |
| `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md` | UI/UX レンズに攻めレンズを追加 |
| `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` | 品質チェックリストにデザイン品質向上項目を追加 |
| `docs/06_ナレッジベース/methodology/独自フレームワークと既知手法の対応.md` | CRAP 原則セクションを追加 |

対象外: 守り（欠陥検出）の観点追加（#644 完了済み）、デザインガイドライン自体の変更（#652 完了済み）

## 設計判断

### 判断1: Repetition は攻めレンズに含めない

既存の守りレンズ「デザイントークン準拠」「共有コンポーネント活用」が Repetition（一貫性）を十分カバー済み。攻めに追加すると重複する。

→ 攻めレンズは CRAP の C（Contrast）、A（Alignment）、P（Proximity）の 3 項目。

### 判断2: 攻めレンズの適用タイミングは「ページ/コンポーネント完成時」

C/A/P は全体のビジュアルバランスを評価する観点。毎 Refactor は粒度が細かすぎる。コード設計の「SRP/DIP = モジュール完成時」と同じ位置づけ。

### 判断3: zoom-rhythm.md では C/A/P を 1 行に統合

zoom-rhythm.md のギャップ発見の観点はマクロレベルの問い。C/A/P の詳細は TDD 開発フローの設計原則レンズに委ねる。

### 判断4: 守り/攻めの区別はラベルで明示

テーブル構造は変更せず、サブ見出し・ラベルで「デザイン品質向上」として区別する。既存のコード設計レンズと同じ構造。

### CRAP とデザインガイドラインの原則の対応

| CRAP | ガイドライン原則 | ゲシュタルト原則 |
|------|----------------|----------------|
| Contrast | 最小の強調 | 図と地、類似の逆用 |
| Repetition | 一貫性 | 類似の法則 |
| Alignment | 意図的な余白 | 連続の法則、対称性 |
| Proximity | 意図的な余白 | 近接の法則 |

---

## Phase 1: zoom-rhythm.md — ギャップ発見の観点にデザイン品質行を追加

### 確認事項

- [x] 既存の品質の向上テーブルの構造 → `.claude/rules/zoom-rhythm.md` L45-52、6 行、「視覚的階層」が最終行
- [x] 既存の「ユーザーフィードバック」「視覚的階層」との重複回避 → 「ビジュアルバランス」は C/A/P の洗練（攻め）で重複なし

### 変更内容

**品質の向上（ゼロ → プラス）** テーブル（L52 の後）に 1 行追加:

```markdown
| ビジュアルバランス | 要素のコントラスト・整列・余白が[デザインガイドライン](../../docs/03_詳細設計書/13_デザインガイドライン.md)の原則（最小の強調、意図的な余白）に沿い、洗練されているか |
```

位置: 「視覚的階層」行の直後。「視覚的階層」= 情報の優先度表現（守り寄り）、「ビジュアルバランス」= ビジュアルの洗練（攻め）で隣接。

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

参照整合性:
- [ ] デザインガイドラインへのリンクパスが正しいか

---

## Phase 2: TDD開発フロー.md — UI/UX レンズに攻めレンズを追加

### 確認事項

- [x] 既存 UI/UX レンズの構造 → `02_TDD開発フロー.md` L240-258、ページ完成時テーブル 4 項目、既知手法注記 L258
- [x] 既知手法との対応テーブル → 同 L597-604、5 行（nano-cycle, CDD, GOOS, Nielsen, POUR）
- [x] 参考資料セクション → 同 L589-593、5 項目
- [x] 変更履歴 → 同 L611-621、先頭が #644 の記録

### 変更内容

#### 2a. 攻めレンズセクション追加（L247 の後）

「ページ/コンポーネントの完成時」テーブル（L247: 破壊的操作の防御行）の後に追加:

```markdown
デザイン品質向上（ページ/コンポーネントの完成時）:

| レンズ | 問い |
|--------|------|
| コントラストの効果 | 重要な要素（CTA、見出し、状態バッジ）が周囲と明確に差別化され、ユーザーの視線を適切に誘導しているか？ |
| 整列の一貫性 | 要素がスペーシンググリッド（4px 基準）に沿って整列し、視覚的な秩序を保っているか？ |
| 余白の活用 | 余白が情報のグルーピングと呼吸感を適切に生み出し、窮屈さや散漫さがないか？ |
```

#### 2b. 既知手法との対応注記更新（L258）

```
既知手法との対応: UI/UX レンズの守りは Nielsen の 10 Usability Heuristics（H1: 状態の網羅性、H4: デザイントークン準拠、H5/H3: 破壊的操作の防御、H8: 視覚的階層、H9: エラーのユーザビリティ）と WCAG 2.1 POUR 原則（アクセシビリティ）に対応。攻めは CRAP 原則（Robin Williams, 2004）の Contrast・Alignment・Proximity に対応（Repetition は守りレンズの「デザイントークン準拠」「共有コンポーネント活用」でカバー）。CRAP はデザイン実践の手法（How）、ゲシュタルト原則が理論的裏付け（Why）を提供する。
```

#### 2c. 既知手法との対応テーブル（L604 の後に 1 行追加）

```markdown
| CRAP 原則 | Robin Williams, *The Non-Designer's Design Book* (2004) | デザイン品質向上レンズ（C: コントラストの効果、A: 整列の一貫性、P: 余白の活用）。R は守りレンズでカバー |
```

#### 2d. 参考資料（L593 の後に 1 行追加）

```markdown
- Robin Williams (2004) "The Non-Designer's Design Book" (CRAP 原則)
```

#### 2e. 変更履歴（L613 の前に 1 行追加）

```markdown
| 2026-02-18 | UI/UX レンズにデザイン品質向上（攻め）レンズを追加。CRAP 原則を既知手法に記載（#653） |
```

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

参照整合性:
- [ ] 攻めレンズ 3 項目が品質チェックリスト（Phase 3）と 1:1 対応
- [ ] 既知手法テーブルの形式が既存行と統一
- [ ] 変更履歴の日付・Issue 番号が正しい

---

## Phase 3: Issue駆動開発.md — 品質チェックリストにデザイン品質向上項目を追加

### 確認事項

- [x] 既存 UI/UX 品質確認セクション → `01_Issue駆動開発.md` L464-474、守り 7 項目
- [x] 変更履歴 → 同 L941-965（「横断検証」の後）

### 変更内容

#### 3a. デザイン品質向上項目追加（L474 の後）

```markdown

デザイン品質向上（ゼロ→プラス）:

- [ ] コントラストの効果: 重要な要素（CTA、見出し、状態バッジ）が周囲と明確に差別化されているか
- [ ] 整列の一貫性: 要素がスペーシンググリッド（4px 基準）に沿って整列しているか
- [ ] 余白の活用: 余白が情報のグルーピングと呼吸感を適切に生み出しているか
```

守り 7 項目の下に「デザイン品質向上（ゼロ→プラス）:」ラベルで区切り、攻め 3 項目を配置。

#### 3b. 変更履歴（L939 の前に 1 行追加）

```markdown
| 2026-02-18 | 6.2 品質チェックリスト UI/UX セクションにデザイン品質向上（攻め）項目を追加（#653） |
```

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

参照整合性:
- [ ] 攻め 3 項目が TDD 開発フロー（Phase 2）の攻めレンズと 1:1 対応
- [ ] チェックリスト表現形式が既存 7 項目と統一（`- [ ] レンズ名: 問い`）

---

## Phase 4: 独自フレームワークと既知手法の対応.md — CRAP 原則セクションを追加

### 確認事項

- [x] Mermaid 全体図の構造 → L11-47、known サブグラフ L20-33、矢印 L35-46
- [x] ゲシュタルト心理学セクション → L251-255、「視覚的階層」との対応が記載済み
- [x] ringiflow の独自性テーブル → L257-265、5 行
- [x] 関連リソース → L298-314、14 項目
- [x] 変更履歴 → L318-325、先頭が SDD 更新

### 変更内容

#### 4a. Mermaid 全体図（L32 の後にノード追加、L45 の後に矢印追加）

既知手法サブグラフに追加:
```
CRAP["CRAP Principles (Williams)"]
```

矢印追加:
```
ID --> CRAP
```

#### 4b. CRAP 原則セクション（L255 の後に追加）

```markdown
### CRAP 原則（Robin Williams）

Robin Williams が 2004 年の著書 "The Non-Designer's Design Book" で提唱した 4 つのデザイン原則。非デザイナーがビジュアルデザインを改善するための実践的なフレームワーク。

| CRAP | 内容 | ガイドライン原則 | ゲシュタルト原則 |
|------|------|----------------|----------------|
| Contrast | 異なる要素は明確に差別化する | 最小の強調 | 図と地、類似の逆用 |
| Repetition | 同じ要素は同じ見た目にする | 一貫性 | 類似の法則 |
| Alignment | 要素を視覚的に整列させる | 意図的な余白 | 連続の法則、対称性 |
| Proximity | 関連する要素を近くに配置する | 意図的な余白 | 近接の法則 |

ringiflow の対応:
- 守り（欠陥検出）: Repetition → デザイントークン準拠、共有コンポーネント活用（毎 Refactor）
- 攻め（品質向上）: Contrast・Alignment・Proximity → デザイン品質向上レンズ（ページ/コンポーネント完成時）

CRAP とゲシュタルト原則は相補的: CRAP はデザイン実践の手法（How）、ゲシュタルトは人間の知覚心理の法則（Why）。
```

#### 4c. ringiflow の独自性テーブル（L265 の後に 2 行追加）

```markdown
| デザイン品質の攻めレンズ | CRAP 原則の C/A/P | TDD Refactor の問い形式への変換、守り/攻めの構造的区別 |
| R の分離配置 | — | Repetition を守り、C/A/P を攻めに分離。既存レンズとの重複を回避 |
```

#### 4d. 関連リソース（L314 の後に 1 行追加）

```markdown
- Williams, R. (2004) "The Non-Designer's Design Book" (CRAP 原則)
```

#### 4e. 変更履歴（L322 の前に 1 行追加）

```markdown
| 2026-02-18 | CRAP 原則セクションを追加。守り/攻めの分離構造を記載（#653） |
```

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

参照整合性:
- [ ] Mermaid ダイアグラムの構文が正しい（ノード ID 重複なし）
- [ ] 守り/攻めの説明が他 3 ファイルの記述と整合
- [ ] ゲシュタルト原則との対応が既存セクション（L251-255）と矛盾しない

---

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | zoom-rhythm.md で C/A/P を個別 3 行にすると既存テーブルの粒度と不整合 | シンプルさ | C/A/P を「ビジュアルバランス」として 1 行に統合。詳細は TDD 開発フローに委ねる |
| 2回目 | 品質チェックリストの攻め項目が守りと区別されない可読性の問題 | 曖昧さ排除 | 「デザイン品質向上（ゼロ→プラス）:」ラベルで明示的に区別 |
| 3回目 | Repetition 除外の判断理由が TDD 開発フローの読者に伝わらない | 不完全なパス | 既知手法との対応注記に「Repetition は守りレンズでカバー」を明記 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 完了基準 4 項目が計画に含まれている | OK | zoom-rhythm(完了基準1) + TDD開発フロー(2) + Issue駆動開発(3) + 既知手法対応(4) |
| 2 | 曖昧さ排除 | 追加する内容が具体的に記述されている | OK | 各 Phase で追加テーブル・項目をマークダウンで記載 |
| 3 | 設計判断の完結性 | R の除外、タイミング、区別方法に判断が記載 | OK | 判断 1-4 で記載。代替案と見送り理由を含む |
| 4 | スコープ境界 | 対象と対象外が明記 | OK | 対象外を Issue 記載と整合して明記 |
| 5 | 技術的前提 | CRAP/ゲシュタルト/ガイドライン原則の対応が確認済み | OK | 3 原則の対応テーブルで確認 |
| 6 | 既存ドキュメント整合 | #644 の構造パターンに従っている | OK | Phase 分割、確認事項、テストリスト形式を踏襲 |

## 検証方法

- 全 Phase 完了後、4 ファイル間の参照整合性を確認（攻めレンズ 3 項目の一貫性）
- `just check-all` は不要（ドキュメントのみの変更でコード変更なし）
- Mermaid ダイアグラムの構文確認
