# #542 問題解決フレームワークに「システムレベルの影響」の観点を追加

## Context

改善記録 `2026-02-15_1237_間接的な因果関係の見落とし.md` で特定された問題への恒久対策。
Issue #540 の調査で、テスト追加 → 並列実行負荷増加 → DynamoDB 接続過多という間接的な因果関係を見落とし、誤った結論を出した。

## 設計判断: 配置先

### 判断

`troubleshooting.md` に追加する。`problem-solving.md` には追加しない。

### 理由

1. `problem-solving.md` の前段分類で、技術的問題は `troubleshooting.md` に routing される
2. 改善記録 `2026-02-15_1309` が、技術的問題の対策を `problem-solving.md` に追加するのは「的外れ」と指摘している
3. 「間接的因果関係の見落とし」が発生するのは技術的問題の調査場面であり、`troubleshooting.md` がその場面をカバーすべき
4. `troubleshooting.md` の現在のスコープ（局所的な状態確認）の自然な拡張

Issue #542 は `problem-solving.md` への追加を提案しているが、Issue 作成（2026-02-15 12:37）は routing table 整備（`2026-02-15_1309`）より前のため、提案が outdated。配置先を `troubleshooting.md` に修正して実装する。

## 対象・対象外

対象:
- `.claude/rules/troubleshooting.md` — 根本原因分析の観点セクションを追加

対象外:
- `.claude/rules/problem-solving.md` — 変更なし（routing 構造を維持）
- `prompts/improvements/README.md` — 変更なし（routing table の変更は不要）

## 実装計画

### Phase 1: troubleshooting.md に「根本原因分析の観点」セクションを追加

確認事項: なし（既知のパターンのみ。対象ファイルは精査済み）

変更内容:

`troubleshooting.md` の「調査フロー」と「よくあるパターンと確認手段」の間に、新しいセクション「根本原因分析の観点」を追加する。

追加するセクション:

```markdown
## 根本原因分析の観点

調査フローのステップ 5（根本原因を特定する）で、局所的な状態確認に加えて以下の間接的な影響を分析する。

| 観点 | 確認内容 |
|------|---------|
| 直接的依存 | コードの依存関係、インポート、関数呼び出し |
| 間接的影響 | リソース競合（DB 接続、メモリ、CPU）、並列実行負荷、タイミング、システム全体への波及 |
| 環境差異 | CI と開発環境の違い（並列度、リソース制限、設定） |
| 変更の波及 | ブランチ間の差分が何に影響するか（コードの直接変更以外も含む） |

改善の経緯: [間接的な因果関係の見落とし](../../prompts/improvements/2026-02/2026-02-15_1237_間接的な因果関係の見落とし.md)
```

テストリスト:

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

検証方法: ドキュメント修正のため、内容の正確性と既存構造との整合性を確認する。

### ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | Issue が提案する配置先（problem-solving.md）と、改善記録 `2026-02-15_1309` の指摘が矛盾 | アーキテクチャ不整合 | routing 構造に従い、配置先を troubleshooting.md に変更 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 改善記録の対策チェックリスト4項目が計画に含まれている | OK | 直接的依存・間接的影響・環境差異・変更の波及の4観点を網羅 |
| 2 | 曖昧さ排除 | 追加するセクションの内容が確定している | OK | テーブルの内容、配置位置、文言が確定済み |
| 3 | 設計判断の完結性 | 配置先の判断に理由がある | OK | 3つの改善記録の関係と routing 構造から判断理由を記載 |
| 4 | スコープ境界 | 対象と対象外が明記されている | OK | 対象: troubleshooting.md、対象外: problem-solving.md, README.md |
| 5 | 技術的前提 | ドキュメント修正のため該当なし | OK | — |
| 6 | 既存ドキュメント整合 | routing 構造（技術的 → troubleshooting.md）と矛盾しない | OK | 改善記録 `2026-02-15_1309` の方針と整合 |

## 検証

1. `troubleshooting.md` の構造が壊れていないこと（見出し階層、セクション順序）
2. 改善記録 `2026-02-15_1237` の次のアクションチェックボックスを `[x]` に更新
3. Issue #542 に配置先変更の判断をコメントで記録
