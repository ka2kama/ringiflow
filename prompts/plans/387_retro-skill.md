# /retro スキル: レトロスペクティブ（振り返り）の仕組み設計

## Context

Phase 1 完了後、品質改善に注力する中で「改善システム自体が機能しているか」を定期的に検証する仕組みが必要になった。現状、個別の改善記録（`prompts/improvements/`）と定点診断（`/assess`）は存在するが、これらを横断的に分析し、改善サイクル全体の有効性を評価する仕組みがない。

`AI思考特性の分析ガイド`（`docs/80_ナレッジベース/methodology/AI思考特性の分析ガイド.md`）が分析手法を定義しているが、スキル化されておらず実行トリガーが曖昧。SRE 的な運用改善の観点（再発率、Toil、エラーバジェット）も未導入。

## 方針

`/assess` と `/retro` の役割分離を明確にする:

| スキル | 役割 | 時間軸 | 頻度 |
|-------|------|--------|------|
| `/assess` | 現在のスナップショット診断 | 点（現在） | 月次推奨 |
| `/retro` | 改善サイクルの有効性検証 + トレンド分析 | 線（過去→現在→次） | 週次推奨 |

`/retro` は `/assess` のデータも活用するが、分析の焦点が異なる:
- `/assess` = 「今どうなっているか」（状態）
- `/retro` = 「改善の取り組みは効いているか、次に何を変えるべきか」（変化と方向性）

## 対象

- `.claude/skills/retro/SKILL.md` — 新規作成
- `docs/80_ナレッジベース/methodology/SRE的アプローチ.md` — 新規作成
- `prompts/reports/README.md` — レポート種類にレトロスペクティブを追加

## 対象外

- `/assess` スキルの変更（既存の責務を維持）
- CLAUDE.md への大幅な変更（スキルは自動検出されるため不要）
- 改善記録の分類体系の変更（既存のカテゴリ・失敗タイプはそのまま活用）

## 設計判断

### 1. AI思考特性の分析ガイドとの関係

**選択**: /retro スキルが分析ガイドの手法を内部で使用する（包含関係）

**理由**: 分析ガイドは手法の定義（What/How）、/retro はその実行とSRE的観点の統合（When/Why）。分析ガイドは参照資料として維持し、/retro がその手法を実行時に活用する。

**代替案**: 分析ガイドを廃止して /retro に統合 → 却下。分析ガイドはナレッジとしての価値があり、/retro 以外の文脈でも参照される可能性がある。

### 2. SRE 概念のプロジェクト適応

SRE の概念をそのまま適用するのではなく、AI エージェント駆動の個人開発プロジェクトに合わせて適応する:

| SRE 概念 | 本プロジェクトでの適応 | 理由 |
|---------|---------------------|------|
| SLO/SLI | 品質指標（改善カテゴリ再発率、対策有効率） | サービス可用性の代わりに開発プロセスの品質を測定 |
| Error Budget | 品質逸脱の許容量（攻め vs 守りのバランス） | ダウンタイムの代わりに品質改善 vs 機能開発の配分を管理 |
| MTTR | 問題発見→対策実装→検証完了のリードタイム | サービス復旧時間の代わりにプロセス改善速度を測定 |
| Toil | 繰り返し発生する手作業（自動化候補） | 運用負荷の代わりに開発プロセスの手作業を特定 |
| Blameless Postmortem | 既存の改善記録（カテゴリ分類で構造化済み） | 既に実装済み |
| Incident → Problem Management | 個別改善記録 → レトロスペクティブでのパターン分析 | 個別対応から構造的改善への昇格 |

### 3. 週次実施の現実性

週次で全 Step を実施すると負荷が高い。引数で軽量モード（改善システムの検証のみ）とフルモード（全 Step）を選択可能にする。

| モード | 内容 | 想定時間 |
|-------|------|---------|
| 引数なし（フル） | 全 4 Step を実施 | 中〜長 |
| `quick` | Step 1（改善システムの検証）のみ | 短 |
| `sre` | Step 3（SRE 的観点）のみ | 中 |

## Phase 1: /retro スキル定義の作成

### 確認事項

- パターン: 既存スキルの SKILL.md 構造 → `.claude/skills/assess/SKILL.md`, `.claude/skills/wrap-up/SKILL.md`（確認済み）
- パターン: 改善記録の分析手法 → `docs/80_ナレッジベース/methodology/AI思考特性の分析ガイド.md`（確認済み）
- パターン: レポート出力形式 → `prompts/reports/README.md`（確認済み）

### 作成ファイル

`.claude/skills/retro/SKILL.md`

YAML frontmatter:
```yaml
---
name: retro
description: 改善サイクルの有効性を検証する。改善記録の効果測定、プロジェクト健全性のトレンド分析、SRE 的観点での運用改善を実施する。
argument-hint: "<省略可。モード: quick / sre>"
user-invocable: true
---
```

Step 構成:

**Step 1: 改善システムの検証**（AI思考特性の分析ガイドの手法を使用）
- 1-1. 分析対象期間の決定（前回レトロからの差分。初回は全期間）
- 1-2. カテゴリ別集計（改善記録の分類データ集計、前回比較）
- 1-3. 失敗タイプ別集計（知識/実行/プロセスギャップの推移）
- 1-4. 対策有効性の評価（検証セクションの集約、対策形式別の有効率）
- 1-5. 再発検出（同一カテゴリの再発パターン、対策実施後の再発有無）

**Step 2: プロジェクト健全性トレンド**
- 2-1. 前回 /assess レポートとの差分取得
- 2-2. 3 軸バランスの評価（Discovery/Delivery/Sustainability の偏り検出）
- 2-3. トレンド判定（各軸の方向: ↑改善 / →横ばい / ↓悪化）

**Step 3: SRE 的観点**
- 3a. 再発率・MTTR 分析
  - 改善記録の同一カテゴリ再発率
  - 問題発見（改善記録作成日）→ 対策実装（Issue クローズ日）のリードタイム
- 3b. Toil 分析
  - セッションログから繰り返し出現する手作業パターンを検出
  - 改善記録から「プロセスギャップ」に分類された項目の自動化可能性評価
- 3c. エラーバジェット的思考
  - 直近の Issue クローズ内訳（Feature vs Maintain vs Improve vs Fix）
  - 「攻め」（Feature + Discovery）と「守り」（Maintain + Improve + Sustainability）のバランス評価
  - 品質指標（改善記録の再発率）が閾値内なら「攻め」への配分増を推奨

**Step 4: 総合評価とアクション**
- 4-1. 改善システムの健全性サマリー
- 4-2. 3 軸バランスの現状評価
- 4-3. SRE 指標のサマリー
- 4-4. アクションアイテム（優先度付き）

出力形式:
```
## 🔄 レトロスペクティブ（YYYY-MM-DD）

### 分析期間
前回レトロ: YYYY-MM-DD / 今回: YYYY-MM-DD

---

### 1. 改善システムの検証

#### カテゴリ別推移
| カテゴリ | 前回 | 今回 | 増減 | 傾向 |
|---------|------|------|------|------|

#### 失敗タイプ別推移
| 失敗タイプ | 前回 | 今回 | 増減 |
|-----------|------|------|------|

#### 対策有効性
| 対策形式 | 実施済 | 効果あり | 再発 | 有効率 |
|---------|--------|---------|------|--------|

#### 再発パターン
[再発が検出された場合のみ記載]

---

### 2. プロジェクト健全性トレンド

#### 3 軸バランス
| 軸 | 前回 | 今回 | 方向 |
|----|------|------|------|
| Discovery | <所見> | <所見> | ↑/→/↓ |
| Delivery | <所見> | <所見> | ↑/→/↓ |
| Sustainability | <所見> | <所見> | ↑/→/↓ |

#### バランス評価
[3 軸の偏りに関する所見]

---

### 3. SRE 的観点

#### 再発率・MTTR
- 再発率: N/M 件（N%）
- 平均 MTTR: N 日

#### Toil
| Toil 候補 | 頻度 | 自動化可能性 | 推奨 |
|----------|------|------------|------|

#### エラーバジェット
| カテゴリ | 件数 | 比率 |
|---------|------|------|
| Feature（攻め） | N | N% |
| Maintain/Improve（守り） | N | N% |
| Fix | N | N% |

[バランスに関する所見と推奨]

---

### 4. アクションアイテム

| 優先度 | カテゴリ | アクション | 根拠 |
|--------|---------|---------|------|
```

## Phase 2: SRE 的アプローチのナレッジベース作成

### 確認事項

- パターン: ナレッジベースの構造 → `docs/80_ナレッジベース/methodology/` 配下の既存ファイル（確認済み）

### 作成ファイル

`docs/80_ナレッジベース/methodology/SRE的アプローチ.md`

内容:
- SRE の核心概念（SLO、Error Budget、Toil、Blameless Postmortem）
- 本プロジェクトへの適応方法（設計判断セクションの詳細版）
- 既知手法との関連（Google SRE Book, ITIL Incident/Problem Management）
- /retro スキルでの具体的な適用
- 参考文献

## Phase 3: reports README の更新

### 確認事項: なし（既知のパターンのみ）

### 変更ファイル

`prompts/reports/README.md` — レポートの種類テーブルに追加:

```markdown
| 種類 | 生成方法 | 頻度 |
|------|---------|------|
| プロジェクト健全性診断 | `/assess` スキル | 任意（月次推奨） |
| レトロスペクティブ | `/retro` スキル | 任意（週次推奨） |
```

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | AI思考特性の分析ガイドと /retro の責務が重複する可能性 | 責務の明確さ | 包含関係を明示（/retro が分析ガイドの手法を使用）。設計判断セクションに記載 |
| 2回目 | 週次実施の負荷が不明確 | 曖昧さ排除 | 引数による軽量モード（quick/sre）を追加。設計判断セクションに記載 |
| 3回目 | SRE 概念をそのまま適用するのか適応するのか不明確 | 技術的前提 | SRE概念のプロジェクト適応表を追加。MTTR の定義を明確化（サービス復旧→プロセス改善速度） |
| 4回目 | 前回レトロの基準点が初回実行時に存在しない | エッジケース | Step 1-1 に「初回は全期間」のフォールバックを明示 |
| 5回目 | /assess と /retro が同じようなデータ収集をする非効率 | 既存手段の見落とし | /retro の Step 2 は /assess の既存レポートを参照する設計に。データ収集は /assess に委ね、/retro はトレンド分析に集中 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | ユーザーの要件（改善検証、3軸バランス、SRE的観点）がすべてカバーされている | OK | 改善検証=Step 1、3軸バランス=Step 2、SRE的観点=Step 3 で網羅 |
| 2 | 曖昧さ排除 | 各 Step の入力・処理・出力が明確 | OK | 各 Step にデータソース、分析手法、出力形式を記載。「必要に応じて」等の不確定表現なし |
| 3 | 設計判断の完結性 | 既存の仕組みとの関係が明確 | OK | /assess との役割分離、AI思考特性の分析ガイドとの関係、SRE概念の適応方法を明記 |
| 4 | スコープ境界 | 対象と対象外が明記 | OK | 「対象」「対象外」セクションで明示 |
| 5 | 技術的前提 | スキルの自動検出等の前提が確認済み | OK | .claude/skills/ 配下の SKILL.md が自動検出されることを既存スキルで確認済み |
| 6 | 既存ドキュメント整合 | 既存のナレッジ・手順と矛盾なし | OK | AI思考特性の分析ガイド、改善記録README、reports README との整合性確認済み |
