# 人間向け手順書の教育資料特化

## Context

AI ディレクティブ版（`.claude/rules/dev-flow-issue.md`, `dev-flow-tdd.md`）を作成済み。手順の詳細は AI 版が Single Source of Truth になった。人間向け手順書（`docs/04_手順書/04_開発フロー/`）に残る手順記述が AI 版と重複しており、二重管理になっている。

手順書を教育資料に特化させる: 重複する手順記述を要約 + AI 版リンクに置き換え、教育コンテンツ（Why の解説、Mermaid 図、良い例/悪い例、既知手法との対応、参考資料）を維持する。

## スコープ

**対象:**
- `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md`
- `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md`

**対象外:**
- `.claude/rules/dev-flow-*.md`（変更しない）
- 他ファイルの参照（既に AI 版を指している）

## 設計判断

- **削除方針**: AI 版と実質同一の手順記述（テーブル、bash コマンド、チェックリスト）を削除し、1-2 行の要約 + AI 版へのリンクに置き換える
- **保持方針**: 教育的コンテンツ（Why の解説、図表、例、ADR リンク、改善経緯、参考資料）はすべて維持
- **アンカー維持**: 既存のセクションヘッダーは維持する（外部リンク互換性）。サブセクションの削除は可

---

## Phase 1: `01_Issue駆動開発.md` のトリミング

#### 確認事項: なし（既知のパターンのみ、テキスト編集）

#### 操作パス: 該当なし（操作パスが存在しない）

#### 変更一覧

各セクションの変更方針。「削除→置換」は重複する手順記述を要約+リンクに置き換え。「維持」は手を加えない。

| # | セクション | 行範囲 | 方針 | 理由 |
|---|-----------|--------|------|------|
| 1 | 概要〜リソース〜開発フロー Mermaid | L1-35 | 維持 | 教育コンテンツ |
| 2 | AI着手トリガー | L37-43 | 維持 | 3行のみ、改善経緯もある |
| 3 | 1. Issue を確認または作成 | L45-99 | 維持 | 完了基準の書き方は教育コンテンツ（良い例/悪い例）、AI版にない |
| 4 | 既存 Issue の精査: 手順部分 | L101-161 | 削除→置換 | 観点テーブル、As-Is検証手順、精査結果分岐、記録フォーマットが AI 版と同一 |
| 5 | 2. ブランチを作成 | L163-181 | 削除→置換 | コマンドと命名規則が AI 版と同一 |
| 6 | 3. Draft PR を作成 | L183-220 | 削除→置換 | コマンドと PR 本文ルールが AI 版と同一。Draft PR の目的・ADR リンクは維持 |
| 7 | 4. 設計 | L222-356 | 削除→置換 | 4.1-4.5 の手順が AI 版と同一。Mermaid図、収束確認フォーマット例は維持 |
| 8 | 5. 実装（TDD）| L358-416 | 削除→置換 | コミット粒度・Issue 進捗更新が AI 版と同一。教育解説（なぜ都度更新が重要か、良い/悪いコミット例）は維持 |
| 9 | 6. 品質ゲート | L418-629 | 削除→置換 | 品質チェックリスト (6.2) が最大の重複（~70行同一）。位置づけリンク・改善経緯は維持 |
| 10 | 7-8. レビュー〜マージ | L631-657 | 削除→置換 | 手順が AI 版と同一。Squash マージの効果の教育解説は維持 |
| 11 | 9. 振り返り | L659-766 | 削除→置換 | 記録フォーマット・転記基準が AI 版と同一。教育解説（「学習は振り返りから」、詳細例）・改善経緯は維持 |
| 12 | Milestone〜Label〜Project Board | L768-822 | 維持 | AI 版にない運用情報 |
| 13 | Epic/Story 運用 | L824-1025 | 削除→置換 | 品質基準テーブル・テスト責任マッピング・タスクリスト管理が AI 版と同一。教育解説（階層構造図、Mermaidフロー、Epic 作成タイミング）・改善経緯は維持 |
| 14 | 進捗の可視化〜Issue の粒度 | L1027-1048 | 維持 | AI 版にない運用情報 |
| 15 | 運用補足〜よく使うコマンド | L1049-1083 | 維持 | AI 版にない |

#### 具体的な置換パターン

各削除対象セクションで、以下のパターンで置き換える:

```markdown
### セクション名

→ 手順の詳細: [AI ディレクティブ版](../../../.claude/rules/dev-flow-issue.md#セクション)

[教育的コンテンツはそのまま残す]
```

#### セクション別の詳細

**#4 既存 Issue の精査 (L101-161)**
- 削除: 精査の観点テーブル (L105-112)、As-Is 検証手順 (L116-124)、精査結果分岐テーブル (L128-134)、記録フォーマット bash (L140-156)
- 維持: セクションヘッダー、冒頭の説明文 (L103)、改善経緯リンク (L159-161)
- 追加: AI 版リンク

**#5 ブランチ作成 (L163-181)**
- 削除: git コマンド (L167-175)、命名規則テーブル (L177-179)
- 維持: セクションヘッダー、改善経緯 (L181)
- 追加: AI 版リンク

**#6 Draft PR 作成 (L183-220)**
- 削除: git/gh コマンド (L187-191)、PR 本文ルールテーブル (L207-220)
- 維持: Draft PR の目的 (L194-197)、自動レビュー注意書き (L198)、ADR リンク (L200)
- 追加: AI 版リンク

**#7 設計 (L222-356)**
- 削除: 4.1-4.3 の手順 (L234-294)、4.5 コミットコマンド (L333-338)、簡略化条件 (L344-355)
- 維持: Mermaid 図 (L226-232)、設計と実装を分けてコミットする理由 (L340-342)、簡略化の改善経緯 (L356)、4.4 収束確認のフォーマット例 (L300-329)
- 追加: AI 版リンク

**#8 実装 TDD (L358-416)**
- 削除: コミット粒度テーブル (L370-374)、Issue 進捗更新コマンド (L398-411)
- 維持: TDD への参照 (L360)、良い/悪いコミット例 (L376-392)、「なぜ都度更新が重要か」(L413-416)
- 追加: AI 版リンク

**#9 品質ゲート (L418-629)**
- 削除: 品質チェックリスト全項目 (L439-517)、6.3 品質確認のフォーマット (L520-557)、6.4-6.9 手順 (L560-629)
- 維持: 概要説明 (L420-423)、位置づけリンク (L435-437)、改善経緯リンク (L558, L574)
- 追加: AI 版リンク

**#10 レビュー〜マージ (L631-657)**
- 削除: 手順とコマンド (L633-638, L645-648)
- 維持: レビュー方針リンク (L639)、Squash マージの効果 (L650-655)、GitHub 設定リンク (L655)

**#11 振り返り (L659-766)**
- 削除: 振り返りコメントフォーマット (L667-684)、bash コマンド (L686-705)、学びの転記基準テーブル (L709-715)、改善記録の検証手順 (L720-734)、TODO/FIXME 棚卸し手順 (L742-756)
- 維持: 教育解説「学習は記録ではなく振り返りから」(L661-663)、ADR リンク (L663)、振り返りの詳細例（bash 内の具体的な学び）は教育的価値あり → 要約形式で維持、改善経緯 (L736, L757)、振り返りスキップ条件 (L758-766)
- 追加: AI 版リンク

**#13 Epic/Story 運用 (L824-1025)**
- 削除: Story 分解品質基準テーブル (L873-880)、テスト責任マッピングテーブルと確認項目 (L900-918)、ブランチ命名 (L968-978)、PR と Issue の紐付けテーブル (L982-987)、Epic タスクリスト管理コマンド (L989-1025)、統合検証テーブル (L942-966)
- 維持: 階層構造図 (L832-844)、ADR リンク (L828)、Epic 作成タイミング (L846-861)、Story 分解の教育解説 (L863-883)、Mermaid フロー図 (L926-939)、改善経緯 (L920, L1023-1025)

---

## Phase 2: `02_TDD開発フロー.md` のトリミング

#### 確認事項: なし（既知のパターンのみ、テキスト編集）

#### 操作パス: 該当なし（操作パスが存在しない）

#### 変更一覧

| # | セクション | 行範囲 | 方針 | 理由 |
|---|-----------|--------|------|------|
| 1 | 概要〜採用理由 | L1-18 | 維持 | 教育コンテンツ |
| 2 | TDD サイクル Mermaid | L20-28 | 維持 | 教育的な図 |
| 3 | 確認事項の実施 | L30-48 | 削除→置換 | AI 版と同一。「目的」(L32-33) は維持 |
| 4 | Red: 失敗するテスト | L50-136 | 削除→置換 | テーブルが AI 版と同一。教育解説（Mermaid、nano-cycle、Rust/Elm 例、「失敗を確認せずに…」）は維持 |
| 5 | Green: 最短で通す | L141-156 | 削除→置換 | 手順が AI 版と同一。教育例（仮実装の Rust コード）は維持 |
| 6 | Refactor: 設計を改善する | L158-263 | 削除→置換 | 設計原則レンズ・UI/UXレンズのテーブルが AI 版と同一。教育解説（コードの整理リスト、既知手法との対応、コード設計レンズとの対応表）は維持 |
| 7 | テストリスト | L267-448 | 削除→置換 | テスト層テーブルが AI 版と同一。教育解説（二つの役割テーブル、詳細例ログイン機能、進め方）は維持 |
| 8 | 操作パスの列挙 | L280-349 | 削除→置換 | 適用条件・手順・分類・変換テーブルが AI 版と同一。教育解説（計画ファイル用フォーマット、テスト設計の方向性）は維持 |
| 9 | MVP 積み上げ方式 | L451-497 | 削除→置換 | 原則テーブルが AI 版と同一。Mermaid 依存関係図、実装順序例は維持 |
| 10 | テストレビュー | L499-512 | 削除→置換 | 確認観点テーブルが AI 版と同一。位置づけ解説は維持 |
| 11 | 実践的パターン | L516-581 | 維持 | AI 版にない教育コンテンツ（三角測量、AAA、テストダブル） |
| 12 | テスト規約 (sut) | L585-614 | 削除→置換 | テーブルが AI 版と同一。出典（Gerard Meszaros）は維持 |
| 13 | ワークフロー全体像 | L618-634 | 維持 | 教育的な Mermaid 図 |
| 14 | E2E テスト実行タイミング | L638-661 | 削除→置換 | テーブルが AI 版と同一。理由テーブル (L642-647) は教育的なので維持 |
| 15 | チェックリスト | L665-674 | 削除 | 品質チェックリスト (dev-flow-issue.md 6.2) と重複。教育的価値なし |
| 16 | 参考資料 | L678-689 | 維持 | AI 版にない教育コンテンツ |
| 17 | 既知手法との対応 | L691-706 | 維持 | AI 版にない教育コンテンツ |

---

## Phase 3: 検証

- `just check-all` パス
- doc-links チェック（AI 版リンクが有効）
- 教育コンテンツの保持確認: Mermaid 図、良い例/悪い例、ADR リンク、参考資料がすべて残っていること

---

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | AI着手トリガーは3行のみで削除の対価が低い | 既存手段の見落とし | 維持に変更 |
| 1回目 | 振り返りの bash 例は具体的な学びの例として教育的価値あり | 不完全なパス | 要約形式で維持に変更 |
| 1回目 | Issue 確認・作成 (L45-99) の完了基準の書き方は AI 版にない教育コンテンツ | 網羅性 | 維持として明記 |

## 収束確認（設計・計画）

| # | 観点 | 判定 | 確認内容 |
|---|------|------|---------|
| 1 | 網羅性 | OK | 両ファイルの全セクションを行番号レベルで分析し、削除/維持を判定済み |
| 2 | 曖昧さ排除 | OK | 各セクションの削除対象と維持対象を具体的な行範囲で記載 |
| 3 | 設計判断の完結性 | OK | 削除→置換パターンを定義済み。アンカー維持も決定済み |
| 4 | スコープ境界 | OK | 対象は 2 ファイルのみ。AI 版は変更しない。他ファイルの参照更新は不要 |
| 5 | 技術的前提 | OK | doc-links チェッカーが相対パスリンクを検証することを確認済み |
| 6 | 既存ドキュメント整合 | OK | AI 版が Single Source of Truth、人間版は教育資料という役割分担 |
