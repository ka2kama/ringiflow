# #368 docs/ 配下のエントリファイル命名規約の統一

## Context

`docs/` 配下のディレクトリで、エントリファイルの命名に `00_はじめに.md` と `README.md` の2種類が混在している。
暗黙のルールは存在するが明文化されていないため、新規ディレクトリ追加時の判断が暗黙知に依存している。
命名規約として `.claude/rules/docs.md` に追記し、形式知化する。

## 問題分析

### Want

ドキュメント構造の一貫性を確保し、新規ディレクトリ追加時の命名判断を自明にする（品質の追求: 保守性）

### To-Be

- エントリファイルの命名規約が `.claude/rules/docs.md` に明文化されている
- 既存の暗黙パターンが正確に反映されている
- エントリファイルがないディレクトリについて判断が記録されている

### As-Is

- 暗黙のパターンは存在するが明文化されていない
- `docs.md` の既存ルール（`docs/**` → 連番プレフィックス）がコレクション型ディレクトリの実態と矛盾
- 3ディレクトリ（02, 03, 08）にエントリファイルがない

### ギャップと根本原因

ドキュメント体系の成長に伴い、2つのパターン（連番体系/コレクション型）が自然発生したが、規約の明文化が追いついていない。

## スコープ

### 対象

1. `.claude/rules/docs.md` にエントリファイル命名規約を追加
2. `.claude/rules/docs.md` の既存「ファイル命名」ルールを実態に合わせて修正
3. エントリファイルがないディレクトリ（02, 03, 08）の扱いを決定・記録
4. #323 との関連を整理（Issue コメント）

### 対象外

- エントリファイルの新規作成（02, 03, 08 への追加は #323 と連動、本 PR では見送り → 理由は後述）
- ドキュメント番号体系の変更（#323 のスコープ）
- `prompts/` 配下のエントリファイル（docs/ のみ対象）

## 現状の分析

### エントリファイルの分類

| ディレクトリ | 体系 | エントリファイル | 状態 |
|------------|------|---------------|------|
| 01_要件定義書 | 連番 | `00_はじめに.md` | OK |
| 01_要件定義書/機能仕様書 | 連番 | `00_はじめに.md` | OK |
| 02_基本設計書 | 連番 | なし（`00_アーキテクチャ概要.md` が先頭） | GAP |
| 03_詳細設計書 | 連番 | なし（`00_実装ロードマップ.md` が先頭） | GAP |
| 04_手順書 | 連番 | `00_はじめに.md` | OK |
| 05_ADR | コレクション | `README.md` | OK |
| 06_ナレッジベース | コレクション | `README.md` | OK |
| 07_実装解説 | コレクション | `README.md` | OK |
| 08_テスト | 未成熟 | なし（ファイル1つのみ） | GAP |
| 03_詳細設計書/エンティティ影響マップ | コレクション | `README.md` | OK |

### `docs.md` の既存ルールとの矛盾

現在の記載:

```
| docs/** | 連番プレフィックス: 00_, 01_, ... |
```

実態:
- コレクション型ディレクトリ（05_ADR, 06_ナレッジベース, 07_実装解説）のファイルは連番プレフィックスを使っていない
  - 05_ADR: `001_`, `002_` 形式（3桁連番、docs 標準の `00_` 形式ではない）
  - 06_ナレッジベース: サブディレクトリ + 自由命名
  - 07_実装解説: サブディレクトリ（一部連番）+ 自由命名
- `README.md` 自体も連番プレフィックスなし

→ ルールを「連番体系ディレクトリのファイル」に限定する必要がある

### 設計判断

#### 判断1: 命名規約の定義

| 選択肢 | 説明 | 採否 |
|--------|------|------|
| A. 暗黙パターンをそのまま明文化 | 連番体系 → `00_はじめに.md`、コレクション型 → `README.md` | 採用 |
| B. すべて `README.md` に統一 | GitHub 標準に合わせる | 不採用: 連番体系での `00_はじめに.md` は先頭ファイルとして自然に並ぶ利点がある |
| C. すべて `00_はじめに.md` に統一 | プロジェクト独自の統一 | 不採用: コレクション型で連番はそぐわない |

理由: 既存パターンに一貫した論理がある。連番体系では `00_` が先頭に並ぶのが自然、コレクション型では GitHub 標準の `README.md` がプラットフォームの慣習に合致する。

#### 判断2: エントリファイルがないディレクトリの扱い

| ディレクトリ | 判断 | 理由 |
|------------|------|------|
| 02_基本設計書 | 本 PR では見送り、#323 で対応 | `00_アーキテクチャ概要.md` が既に `00_` スロットを占有。追加にはリナンバリングが必要 |
| 03_詳細設計書 | 本 PR では見送り、#323 で対応 | `00_実装ロードマップ.md` が既に `00_` スロットを占有。同上 |
| 08_テスト | 本 PR では見送り | ファイルが1つしかなく、ディレクトリ構造が未成熟。エントリファイルを作るにはまず体系が必要 |

#### 判断3: 既存ルール `docs/**` → 連番プレフィックスの修正

現在のルールは実態と矛盾しているため、ディレクトリの体系に応じた記述に修正する:
- 連番体系ディレクトリ: `00_`, `01_`, ... の連番プレフィックス
- コレクション型ディレクトリ: 各ディレクトリの README.md に記載された命名規則に従う

## 変更内容

### Phase 1: `.claude/rules/docs.md` の更新

#### 確認事項

- パターン: 既存の「ファイル命名」セクションの構造 → `.claude/rules/docs.md` L44-67（確認済み）
- パターン: docs.md の前後のセクション構造 → `.claude/rules/docs.md` 全体（確認済み）

#### 変更箇所

1. 「ファイル命名」セクション（L44-51）の `docs/**` ルールを修正
2. 新セクション「エントリファイル」を「ファイル命名」セクション内に追加

#### 具体的な変更

**ファイル命名テーブル（L46-51）の修正:**

```markdown
| 対象 | ルール |
|------|--------|
| `docs/**`（連番体系） | 連番プレフィックス: `00_`, `01_`, ... |
| `docs/**`（コレクション型） | 各ディレクトリの README.md に記載された命名規則に従う |
| `prompts/runs/**` | `YYYY-MM-DD_HHMM_<トピック>.md` |
| `prompts/improvements/**` | `YYYY-MM-DD_HHMM_<トピック>.md` |
| その他 | 自由（ただし kebab-case 推奨） |
```

**エントリファイルのサブセクションを追加（「ファイル命名」内、「命名規則のあるファイル作成時の照合」の前）:**

```markdown
### エントリファイル

`docs/` 配下のディレクトリには、ディレクトリの体系に応じたエントリファイルを配置する。

| ディレクトリの体系 | エントリファイル | 判断基準 |
|-----------------|---------------|---------|
| 連番体系 | `00_はじめに.md` | ファイル群が `00_`, `01_`, ... で連番されている |
| コレクション型 | `README.md` | サブディレクトリや独立した記事を管理、連番なし |

連番体系の例: 01_要件定義書、04_手順書
コレクション型の例: 05_ADR、06_ナレッジベース、07_実装解説

エントリファイルの役割:
- ディレクトリの目的と構成の説明
- 読む順序やナビゲーションの提供（連番体系の場合）
- カテゴリ一覧や書き方の説明（コレクション型の場合）
```

### Phase 2: #323 への情報追記

Issue #323 にコメントを追加し、エントリファイルの追加が必要なディレクトリを記録する。

```
#368 の命名規約整理で、以下のディレクトリにエントリファイルがないことを確認:

- `02_基本設計書`: `00_アーキテクチャ概要.md` が `00_` スロットを占有 → リナンバリングが必要
- `03_詳細設計書`: `00_実装ロードマップ.md` が `00_` スロットを占有 → 同上
- `08_テスト`: ファイルが1つのみ、ディレクトリ構造が未成熟

リナンバリング時にエントリファイルの追加も検討してください。
```

### Phase 3: Issue #368 の完了基準チェックと PR 作成

1. `just fmt` で整形確認
2. Draft PR 作成（`Closes #368`）
3. PR 完了フローに従う

## 変更対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `.claude/rules/docs.md` | ファイル命名ルール修正 + エントリファイル規約追加 |

## 検証方法

- `.claude/rules/docs.md` の変更後、全ディレクトリの実態と規約が矛盾しないことを目視確認
- 規約に「あれば」「必要に応じて」等の曖昧な表現がないことを確認

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | `docs.md` の既存ルール `docs/**` → 連番プレフィックスがコレクション型ディレクトリの実態と矛盾 | アーキテクチャ不整合 | ファイル命名テーブルを連番体系/コレクション型に分割する変更を追加 |
| 2回目 | ギャップなし | — | — |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 探索で発見された全対象が計画に含まれている | OK | 全8ディレクトリ + サブディレクトリ2つを分析、全エントリファイルを確認済み |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | 判断1-3で全選択肢に採否理由を記載、具体的なコード変更を提示 |
| 3 | 設計判断の完結性 | 全ての差異に判断が記載されている | OK | 命名規約の選択、エントリファイルなしの3ディレクトリ、既存ルールの矛盾、それぞれに判断あり |
| 4 | スコープ境界 | 対象と対象外が両方明記されている | OK | 対象4項目、対象外3項目を明記 |
| 5 | 技術的前提 | コードに現れない前提が考慮されている | OK | GitHub の README.md 表示挙動、連番でのソート順を考慮 |
| 6 | 既存ドキュメント整合 | 既存ドキュメントと矛盾がない | OK | CLAUDE.md のドキュメント体系表、docs.md の既存ルールを確認済み |
