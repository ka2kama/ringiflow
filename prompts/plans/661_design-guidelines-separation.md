# #661 デザインガイドラインを styles.css から詳細設計書に分離する

## コンテキスト

#652 で `styles.css` にデザインガイドライン（デザイン原則、スペーシング、レイアウト、色使い、レスポンシブ）を追加した。しかし CLAUDE.md の原則「コード内のコメントは簡潔に、詳細解説はナレッジベースに書いてコードからリンクする」に反している。現状: CSS コメント約200行 vs 実 CSS 約120行（コメントがコードの1.7倍）。

ガイドライン内容は正確かつ有用であり、コンテンツの変更は不要。配置先のみ移動する。

## 対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `docs/03_詳細設計書/13_デザインガイドライン.md` | 新規作成 — ガイドライン本体 |
| `frontend/src/styles.css` | コメント簡潔化 + ドキュメントリンク |
| `.claude/rules/zoom-rhythm.md` | 参照先更新 |
| `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md` | 参照先更新 |
| `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md` | 参照先更新 |
| `docs/06_ナレッジベース/methodology/独自フレームワークと既知手法の対応.md` | 参照先更新 |

対象外:
- `prompts/plans/` や `prompts/runs/` 内の過去の計画・セッションログ — 作成時点の記録であり、参照先の更新は不要
- `docs/05_ADR/027_Tailwind_CSS導入.md` — `styles.css` をデザイントークン定義として参照しており、ガイドラインの参照ではない。更新不要

## Phase 1: デザインガイドライン Markdown ドキュメント作成

`docs/03_詳細設計書/13_デザインガイドライン.md` を作成する。

`styles.css` L7-200 のコメント内容を Markdown に変換する。内容の追加・削除はせず、フォーマットのみ変換する。

構成:
1. 冒頭 — 概要と ADR-027 への参照
2. デザインガイドライン — コンポーネント別トークン定義（タイポグラフィ、シャドウ、角丸、テーブル、バッジ、ボタン、フォーム入力、セクションカード、テキストカラー、アニメーション、トランジション、アクセシビリティ）
3. デザイン原則 — 4つの原則
4. スペーシング — Tailwind 4px グリッド準拠
5. レイアウト構成 — ページ骨格、コンテンツ構造、グリッド、インライン要素
6. 色の使い分け — 6 パレット + バッジの色パターン
7. レスポンシブ — ブレークポイント、パターン、原則

### 確認事項

- [x] 既存の詳細設計書の連番 → 最新が `12_表示用ID設計.md`、次は `13_`
- [x] ドキュメント規約（`.claude/rules/docs.md`）→ 連番体系 `00_`, `01_`, ...、設計書の実装状態マーカーは実装済みなので不要

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

## Phase 2: styles.css コメント簡潔化

`styles.css` L1-200 のコメントを簡潔な概要 + リンクに置き換える。

置き換え後のコメント:

```css
/**
 * Tailwind CSS エントリポイント + デザイントークン
 *
 * @theme ディレクティブで CSS カスタムプロパティとしてデザイントークンを定義する。
 * 詳細: [ADR-027](../../docs/05_ADR/027_Tailwind_CSS導入.md)
 *
 * デザインガイドライン（トークンの役割、スペーシング、レイアウト、色、レスポンシブ）:
 * → docs/03_詳細設計書/13_デザインガイドライン.md
 */
```

### 確認事項

確認事項: なし（既知のパターンのみ）

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

## Phase 3: 参照先の更新

4 ファイルの `styles.css` ガイドライン参照を新ドキュメントへの参照に更新する。

### 変更箇所

1. `.claude/rules/zoom-rhythm.md` L39:
   - 旧: `styles.css のトークン・ガイドラインに沿っていない実装`
   - 新: `デザインガイドライン（docs/03_詳細設計書/13_デザインガイドライン.md）に沿っていない実装`

2. `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md`:
   - L468: `styles.css のトークン・ガイドラインに準拠しているか` → `デザインガイドライン（docs/03_詳細設計書/13_デザインガイドライン.md）に準拠しているか`
   - L473: `タイポグラフィ階層（styles.css ガイドライン）に沿っているか` → `タイポグラフィ階層（デザインガイドライン）に沿っているか`

3. `docs/04_手順書/04_開発フロー/02_TDD開発フロー.md`:
   - L229: `→ 参照: デザイントークンとガイドライン — [frontend/src/styles.css]` → `→ 参照: デザインガイドライン — [docs/03_詳細設計書/13_デザインガイドライン.md]` + トークン定義は `styles.css` にある旨を補記
   - L235: `styles.css のトークンとガイドラインを使用しているか？` → `デザインガイドラインに準拠しているか？`
   - L245: `styles.css のタイポグラフィ階層に沿い` → `デザインガイドラインのタイポグラフィ階層に沿い`

4. `docs/06_ナレッジベース/methodology/独自フレームワークと既知手法の対応.md`:
   - L255: `タイポグラフィ階層（styles.css ガイドライン）` → `タイポグラフィ階層（デザインガイドライン）`
   - L263: `styles.css のデザインガイドラインとの紐づけ` → `デザインガイドラインとの紐づけ`

### 設計判断: 参照の粒度

「デザイントークン」（`styles.css` の `@theme` で定義される CSS カスタムプロパティ）と「デザインガイドライン」（トークンの使い方・組み合わせのルール）は区別する。

- トークン定義（色の値、アニメーション定義）→ 引き続き `styles.css` を参照
- ガイドライン（使い方のルール）→ 新ドキュメントを参照

`02_TDD開発フロー.md` L229 は元々両方を一つの参照で案内していたため、以下のように分離する:
```
→ 参照: デザインガイドライン — [docs/03_詳細設計書/13_デザインガイドライン.md]
→ 参照: デザイントークン定義 — [frontend/src/styles.css]
```

### 確認事項

確認事項: なし（既知のパターンのみ）

### テストリスト

ユニットテスト（該当なし）
ハンドラテスト（該当なし）
API テスト（該当なし）
E2E テスト（該当なし）

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | `02_TDD開発フロー.md` L229 がトークンとガイドラインを一つの参照で案内している | 曖昧 | トークン定義（styles.css）とガイドライン（新ドキュメント）を分離して参照する方針を追加 |
| 2回目 | prompts/ 配下の過去ファイルや ADR-027 を更新対象に含めるべきか | スコープ境界 | prompts/ は作成時点の記録、ADR-027 はトークン定義の参照であり対象外と明記 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | Grep で発見された全参照が計画に含まれている | OK | `styles.css` ガイドライン参照の Grep 結果から、品質プロセスに関連する4ファイル6箇所を特定。prompts/ 配下は対象外として除外理由を記載 |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | 各変更箇所の旧→新を具体的に記載。トークンとガイドラインの区別を明示 |
| 3 | 設計判断の完結性 | 全ての差異に判断が記載されている | OK | トークン vs ガイドラインの参照分離を判断として記載 |
| 4 | スコープ境界 | 対象と対象外が両方明記されている | OK | 対象: 6ファイル、対象外: prompts/ 過去ファイル、ADR-027 |
| 5 | 技術的前提 | コードに現れない前提が考慮されている | OK | ドキュメント規約（連番体系、実装状態マーカー不要）を確認 |
| 6 | 既存ドキュメント整合 | 既存ドキュメントと矛盾がない | OK | CLAUDE.md「コード内のコメントは簡潔に、詳細解説はナレッジベースに書いてコードからリンクする」に合致 |

## 検証

- ドキュメント内のリンクが有効か確認（相対パスの正確性）
- `just check` でフロントエンドビルドが通ることを確認（CSS コメントの変更が影響しないことの確認）
