# 計画: 改善記録の効果追跡（検証セクション）を運用に組み込む

Issue: #375
改善記録: `prompts/improvements/2026-02/2026-02-10_0337_改善記録の効果追跡が機能していない.md`

## Context

改善記録は44件あるが、検証セクションが追記されているのは2件のみ（追記率 4.5%）。テンプレートは定義済みだが、追記をトリガーする仕組みがないため形骸化している。

このプロジェクト自身が発見した法則「行動規範は機能しない、成果物要件化すれば機能する」がそのまま当てはまる。検証の追記を成果物要件化し、フィードバックループを閉じる。

## 問題解決フレームワーク

- **Want**: 改善プロセスのフィードバックループを閉じ、対策の有効性を追跡可能にする（品質の追求 + 学習効果の最大化）
- **To-Be**: 対策実行後に検証セクションが確実に追記される仕組みが存在する
- **As-Is**: 検証テンプレートは定義済みだが、Issue クローズ時に改善記録を見返す仕組みがない
- **Root cause**: フィードバックループの後半（検証）が設計されたが成果物要件化されていなかった

## Issue 対策案の精査

### Proposal 1: Issue クローズ時のチェックリストに追加 → 採用（メイン対策）

振り返りステップ（Step 9）に改善記録の検証サブセクションを追加する。

- 配置: 振り返りコメントとは**別のサブセクション**として追加
- 理由: 振り返りコメントは Issue 上の一時的コメント、検証セクションはローカルファイルへの永続的追記。アクションの性質が異なる

### Proposal 2: 定期的な棚卸し（月次） → 不採用

構造的強制力が弱い（行動規範のまま）。Proposal 1 で Issue クローズ時のフローに組み込めば不要。今後は「恒久対策の Issue 化（必須）」ルールにより、改善記録には必ず Issue 番号が記載されるため、Issue クローズ時に捕捉できる。

### Proposal 3: 既存記録のバックフィル → 採用（スコープ限定）

全44件の調査ではなく、ルールファイル・手順書・CLAUDE.md から「改善の経緯」として参照されている記録（対策実行済みの確実な証拠がある）のみを対象にする。

## スコープ

- **対象**: Issue 駆動開発 Step 9 への検証フロー追加 + README 検証ワークフロー明確化 + バックフィル18件
- **対象外**: 全44件の網羅的調査、月次棚卸しプロセスの導入

## Phase 構成

### Phase 1: 振り返りステップへの検証フロー追加

**ファイル**: `docs/04_手順書/04_開発フロー/01_Issue駆動開発.md`

**変更内容**: Step 9 に「改善記録の検証」サブセクションを追加

- 挿入位置: L559（学びの転記基準）の後、L560（振り返りのスキップ）の前
- 内容:
  - Issue 番号で `prompts/improvements/` を grep し、関連する改善記録を検索
  - 関連記録があれば検証セクションを追記（なければ不要）
  - フォーマットは README へリンク
- 「振り返りのスキップ」に注記追加: 振り返りをスキップする場合でも改善記録の検証は省略しない

**変更履歴**: L750 以降に行を追加

#### 確認事項

なし（既知のパターン。既存の Step 9 サブセクション構造に合わせる）

### Phase 2: README.md の検証ワークフロー明確化

**ファイル**: `prompts/improvements/README.md`

**変更内容**: L117-121 の検証セクションを拡充

- 「対策実行後（対応 Issue のクローズ時など）に追記する」→ 追記タイミングを明確化
- 手順書（Issue 駆動開発 > 改善記録の検証）へのリンクを追加
- 既存フォーマット（L123-132）は維持

#### 確認事項

なし（既存のドキュメント構造に合わせた追記）

### Phase 3: バックフィル（対策実行済み17件に検証セクション追記）

**対象**: ルールファイル等から「改善の経緯」として参照されている記録のうち、検証セクション未追記のもの

2026-01（3件）:
1. `E2E視点の完了基準欠如.md`
2. `命名規則を読んだが従わなかった.md`
3. `Phase5実装時のOpenAPI仕様突合漏れ.md`

2026-02（15件）:
4. `Hurl仕様未確認のまま機能を推奨.md`
5. `YAGNI-KISSの拡大解釈による設計品質低下.md`
6. `計画段階での置換対象と設計決定の網羅性不足.md`
7. `ローカルとCIのテストスコープ差異による検証漏れ.md`
8. `自己検証ループの自動実行欠如.md`
9. `PRをDraftで作成しなかった.md`
10. `ユーザー確認なしにPRをReadyにした.md`
11. `目先の対策に飛びつく傾向.md`
12. `設計フェーズにおける理想駆動の省略.md`
13. `実装フェーズにおける自己検証の自動実行欠如.md`
14. `Issueを正として扱う暗黙の前提.md`
15. `廃止済みRFC番号の採用.md`
16. `WantとHowの混同.md`
17. `設計ブラッシュアップループの形式知化.md`
18. `往復のリズムが機能しない構造的原因.md`

注: 以下は検証セクション追記済みのため対象外:
- `wrap-up前にPRをReadyにした.md`（検証済み: 再発）
- `wrap-up前にReadyを提案する再発.md`（検証済み: 未検証状態）

**作業方法**: 各記録について:
1. 対策の実行状態を確認（ルールファイルへの反映、Issue 状態）
2. 再発の有無を確認（後の改善記録に同種の問題が記録されていないか）
3. 検証セクションを追記

#### 確認事項

- 各改善記録の Issue 番号 → `gh issue view` で状態確認
- 再発有無 → 後の改善記録に同種の問題が報告されていないか

### Phase 4: 本 Issue の改善記録に検証セクション追記

**ファイル**: `prompts/improvements/2026-02/2026-02-10_0337_改善記録の効果追跡が機能していない.md`

Issue クローズ時に検証セクションを追記する（セルフリファレンス）。

## 検証方法

1. Issue 駆動開発 Step 9 に改善記録の検証サブセクションが存在すること
2. README.md の検証セクションに手順書へのリンクが存在すること
3. バックフィル対象の改善記録すべてに検証セクションが追記されていること
4. `just fmt` でフォーマットが崩れていないこと

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | Proposal 1 の配置場所が曖昧（振り返りコメントに統合 vs 別セクション） | 曖昧 | 別セクションに確定。理由: アクションの性質が異なる（一時コメント vs 永続ファイル追記） |
| 2回目 | バックフィル対象が「ルールファイルのみ」だと手順書・CLAUDE.md からの参照を漏らす | 既存手段の見落とし | スコープ基準を「ルールファイル OR 手順書 OR CLAUDE.md から参照」に拡張 |
| 3回目 | 振り返りスキップ時に改善記録の検証もスキップされるリスク | 不完全なパス | 「改善記録の検証は省略しない」注記を追加 |
| 4回目 | `往復のリズムが機能しない構造的原因.md` がバックフィルリストから漏れていた | 網羅性 | 2026-02 リストに追加（計18件） |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 3つの Proposal すべてが精査され、修正対象が特定されている | OK | Proposal 1(採用), 2(不採用), 3(採用)。修正ファイル: Issue駆動開発.md, README.md, バックフィル18件 + 本Issue改善記録1件 |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | 配置場所、バックフィル基準、検証パターンすべてに具体的な判断基準を記載 |
| 3 | 設計判断の完結性 | 全ての選択肢に判断が記載されている | OK | Proposal 1 の配置、Proposal 2 の不採用理由、Proposal 3 のスコープ基準に理由を記載 |
| 4 | スコープ境界 | 対象と対象外が両方明記されている | OK | 対象: Step 9 + README + バックフィル18件。対象外: 全44件調査、月次棚卸し |
| 5 | 技術的前提 | コードに現れない前提が考慮されている | OK | ドキュメント変更のみ。grep で Issue 番号検索可能 |
| 6 | 既存ドキュメント整合 | 既存ドキュメントと矛盾がない | OK | README の既存フォーマット、Step 9 構造、CLAUDE.md と照合 |
