# Issue #380: `/assess` スキルの実装計画

## Context

Issue #380「AI に PO 的視点を導入し、開発・保守・Discovery をバランスよく推進する仕組み」の第一弾として、`/assess` スキルを新設する。

現状の `/next` は GitHub Issues のみを入力ソースとし、Issue に記録されていない作業（未着手の機能候補、技術的負債、ドキュメント陳腐化）が構造的に見落とされる。`/assess` はプロジェクト全体を 3 軸（Discovery / Delivery / Sustainability）で診断し、バランスの取れた開発推進を支援する。

### スコープ

- **対象**: `.claude/skills/assess/SKILL.md` の新設
- **対象外**: `/next` の拡張、Classes of Service の導入（後続 Issue で対応）

### 既知手法との関連

| プロジェクトの課題 | 参照する既知手法 |
|---|---|
| Discovery と Delivery の分離 | Dual Track Agile（Marty Cagan） |
| プロジェクト健全性の可視化 | Spotify Health Check Model |
| 技術的負債の管理 | Fowler の Technical Debt Quadrant |
| バックログの多面的管理 | Scrum PO のバックログリファインメント |

## 設計

### スキル定義

```yaml
name: assess
description: プロジェクト健全性を 3 軸で診断する。Discovery（未着手機能）、Delivery（バックログ状況）、Sustainability（技術的健全性）を評価し、改善提案を提示する。
argument-hint: "<省略可。診断対象: discovery / delivery / sustainability>"
user-invocable: true
```

### 引数

| 引数 | 動作 |
|------|------|
| なし | 全 3 軸を診断 |
| `discovery` | Discovery 軸のみ |
| `delivery` | Delivery 軸のみ |
| `sustainability` | Sustainability 軸のみ |

### 3 軸の設計

#### 軸 1: Discovery（攻め）

要件定義書・ロードマップから未実装機能を特定し、学習価値・プロダクト完成度を評価する。

**データソース:**

| ソース | パス | 取得方法 |
|--------|------|---------|
| 実装ロードマップ | `docs/40_詳細設計書/00_実装ロードマップ.md` | Read |
| 機能仕様書 | `docs/20_機能仕様書/` | Glob + Read |
| コア要件 | `docs/10_要件定義書/01_コア要件.md` | Read |
| 設計書の実装状態マーカー | `docs/30_基本設計書/`, `docs/40_詳細設計書/` | Grep `実装状態` |
| ADR | `docs/70_ADR/` | Glob（件数と最新を確認） |

**評価手順:**

1. ロードマップから現在の Phase と完了状況を把握する
2. 設計書の実装状態マーカー（`> **実装状態**:`）を Grep し、未実装セクションを一覧化する
3. 機能仕様書の一覧と実装済み機能を突合する
4. 次に実装すべき機能候補を特定する

**評価観点:**

| 観点 | 評価基準 |
|------|---------|
| ロードマップ進捗 | 現在 Phase の完了率、次 Phase の前提条件 |
| 機能カバレッジ | 要件定義済み機能のうち実装済みの割合 |
| 学習価値 | 新しい技術パターン・アーキテクチャの学習機会 |
| 依存関係 | 他機能のブロッカーになっている未実装機能 |

#### 軸 2: Delivery（実行）

GitHub Issues のバックログ状況を分析し、消化の健全性を評価する。

**データソース:**

| ソース | 取得方法 |
|--------|---------|
| オープン Issue 一覧 | `gh issue list --state open --json number,title,labels,createdAt,updatedAt --limit 50` |
| クローズ済み Issue（直近） | `gh issue list --state closed --json number,title,labels,closedAt --limit 20` |

**評価手順:**

1. オープン Issue を取得し、ラベル別に分類する
2. 停滞 Issue を特定する（30 日以上更新なし）
3. 直近のクローズ数から消化ペースを把握する
4. ブロック関係を可視化する

**評価観点:**

| 観点 | 評価基準 |
|------|---------|
| バックログサイズ | オープン Issue 数とラベル別内訳 |
| 停滞 Issue | 30 日以上更新なしの Issue 数 |
| 消化ペース | 直近 30 日のクローズ数 |
| ブロック状況 | `Blocked by` で着手不可の Issue 数 |

#### 軸 3: Sustainability（守り）

コード健全性、ドキュメント整合性、依存関係の鮮度、テスト品質、プロセス遵守を評価する。

**ディメンション別データソースと手順:**

##### 3a. コード健全性

| チェック | コマンド/手法 | 閾値 |
|---------|-------------|------|
| 大型ファイル | `just check-file-size` | 500 行超（テストファイル除く） |
| TODO/FIXME | Grep `TODO\|FIXME\|XXX\|HACK` in `backend/`, `frontend/src/` | 存在自体をリスト |
| 未使用依存 | `just check-unused-deps` | 1 件以上 |

##### 3b. ドキュメント整合性

| チェック | 手法 | 基準 |
|---------|------|------|
| 設計書の実装状態マーカー | Grep `実装状態` in `docs/` | 未実装マーカーの一覧 |
| ADR 記録状況 | Glob `docs/70_ADR/*.md` の件数 | 情報提供のみ |
| 改善記録の未検証対策 | Grep `検証.*未` or 後述の手法で確認 | 未検証件数 |

##### 3c. 依存関係の鮮度

| チェック | コマンド | 基準 |
|---------|---------|------|
| Rust 依存の更新 | `cd backend && cargo outdated --root-deps-only 2>/dev/null` | outdated 件数 |
| フロントエンド依存の更新 | `cd frontend && pnpm outdated 2>/dev/null` | outdated 件数 |
| セキュリティ監査 | `cd backend && cargo audit 2>/dev/null` | 脆弱性件数 |

注: `cargo outdated`, `cargo audit` がインストールされていない場合はスキップし、その旨を報告する。

##### 3d. テスト品質

| チェック | 手法 | 基準 |
|---------|------|------|
| テストファイル分布 | Glob `backend/**/tests/**/*.rs`, `backend/**/*_test.rs` | ソースファイル比 |
| API テスト | Glob `backend/apps/bff/tests/**/*.hurl` | エンドポイント網羅 |

##### 3e. プロセス遵守

| チェック | 手法 | 基準 |
|---------|------|------|
| 改善記録の件数推移 | Glob `prompts/improvements/YYYY-MM/` 内のファイル数 | 月次トレンド |
| セッションログの記録状況 | Glob `prompts/runs/YYYY-MM/` 内のファイル数 | 情報提供のみ |

### 出力形式

```markdown
## 📋 プロジェクト健全性診断

### 🔭 Discovery（攻め）

**現在の Phase**: Phase N（<名称>）
**Phase 進捗**: <完了率の見積もり>

#### 未実装の主要機能
| 機能 | Phase | 要件 ID | 学習価値 | 備考 |
|------|-------|---------|---------|------|
| <機能名> | N | <ID> | <高/中/低> | <依存関係等> |

#### 推奨: 次に取り組む機能候補
1. <機能名> — <理由>
2. <機能名> — <理由>

---

### 📊 Delivery（実行）

**バックログ**: オープン N 件（high: X, medium: Y, low: Z, ラベルなし: W）
**消化ペース**: 直近 30 日で N 件クローズ
**停滞**: N 件（30 日以上未更新）

#### 注意が必要な Issue
| Issue | 状態 | 理由 |
|-------|------|------|
| #<番号> <タイトル> | 停滞 | <日数>日間未更新 |
| #<番号> <タイトル> | ブロック中 | Blocked by #<番号> |

---

### 🛡️ Sustainability（守り）

#### コード健全性
- 大型ファイル（500 行超）: N 件
  <該当ファイルのリスト（上位のみ）>
- TODO/FIXME: N 件
- 未使用依存: N 件

#### ドキュメント整合性
- 未実装マーカー: N 箇所
- ADR 総数: N 件
- 改善記録（未検証）: N 件

#### 依存関係
- Rust outdated: N 件
- Frontend outdated: N 件
- セキュリティ脆弱性: N 件

#### テスト
- テストファイル数: N 件
- API テストファイル数: N 件

#### プロセス
- 改善記録（今月）: N 件
- セッションログ（今月）: N 件

---

### 🎯 推奨アクション

| 優先度 | カテゴリ | アクション | 根拠 |
|--------|---------|---------|------|
| High | <Category> | <具体的アクション> | <理由> |
| Medium | <Category> | <具体的アクション> | <理由> |
| Low | <Category> | <具体的アクション> | <理由> |

高インパクトの発見は Issue 作成を提案する。低インパクトはレポートに留める。
```

### `/next` との関係

| スキル | 役割 | 入力 | 出力 |
|--------|------|------|------|
| `/assess` | プロジェクト全体の診断 | ドキュメント、コード、Issues | 健全性レポート + 推奨アクション |
| `/next` | 次の 1 タスクの選定 | Issues（+ 将来: assess 結果） | 次の作業推奨 |

現時点では `/assess` と `/next` は独立して動作する。`/next` の拡張（assess 結果を入力に加える）は後続 Issue で対応。

## 対象ファイル

| ファイル | 操作 | 説明 |
|---------|------|------|
| `.claude/skills/assess/SKILL.md` | 新規作成 | assess スキル定義 |

## 検証方法

1. `/assess` を実行し、3 軸すべての診断結果が出力されることを確認
2. `/assess discovery` で Discovery 軸のみの結果が出力されることを確認
3. 出力形式が設計通りであることを確認
4. 各チェックコマンドのエラーハンドリング（ツール未インストール時のスキップ）が機能することを確認

## ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | Sustainability のディメンション別データソースが曖昧 | 未定義 | 各ディメンション（3a〜3e）にチェック・コマンド・閾値テーブルを追加 |
| 2回目 | `cargo outdated`, `cargo audit` がインストールされていない場合の挙動が未定義 | 不完全なパス | 未インストール時はスキップし報告する旨を明記 |
| 3回目 | Discovery 軸の「学習価値」評価が主観的 | 曖昧 | 学習価値は「新しい技術パターン・アーキテクチャの学習機会」と具体化。完全な客観化は困難なため、AI の判断に委ねる旨を許容 |
| 4回目 | 出力形式と各軸の手順が分離していて一貫性の確認が困難 | アーキテクチャ不整合 | 出力テンプレートの各セクションが手順の評価観点と 1:1 対応することを確認 |
| 5回目 | 計画 3b の「改善記録の未検証対策（`Grep 検証.*未`）」を SKILL.md では「改善記録の件数」に簡素化したが、乖離を記録していなかった | 未定義 | 改善記録に検証状態の統一フィールドがなく Grep 検出の精度が低いため、件数のみの客観的指標に意図的に簡素化。レビュー指摘を受けて本記録を追加 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | Issue #380 の assess 関連要素が計画に含まれている | OK | 3 軸（Discovery/Delivery/Sustainability）、評価ディメンション（Issue 記載の 6 項目すべて）、出力形式を網羅。Classes of Service と `/next` 拡張は対象外として明記 |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | 各チェックにコマンド/手法と閾値を明記。「学習価値」のみ AI 判断だが、観点を具体化済み |
| 3 | 設計判断の完結性 | 全ての差異に判断が記載されている | OK | 引数設計、出力形式、ツール未インストール時のフォールバック、`/next` との役割分担を明記 |
| 4 | スコープ境界 | 対象と対象外が両方明記されている | OK | 対象: SKILL.md 新設。対象外: `/next` 拡張、Classes of Service |
| 5 | 技術的前提 | コードに現れない前提が考慮されている | OK | `cargo outdated`/`cargo audit` の可用性、`just check-file-size`/`just check-unused-deps` の存在を確認済み |
| 6 | 既存ドキュメント整合 | 既存ドキュメントと矛盾がない | OK | 既存スキルパターン（frontmatter 形式、Step 構成）に準拠。`rule-skill-writing.md` の文体規約を遵守する設計 |
