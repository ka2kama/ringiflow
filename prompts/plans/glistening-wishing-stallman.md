# #612 見出し階層とタイポグラフィの統一

## Context

Epic #445 の Story 2。Issue 精査で実測した結果、3 つの問題を特定した:

1. **HTML 要素の不統一**: ページタイトルに h1（4 ページ）と h2（8 ページ）が混在
2. **マージンのばらつき**: セクション見出しで mb-3（10 箇所）と mb-4（5 箇所）が混在
3. **セマンティクスとスタイルの不一致**: Workflow/Detail「進行状況」が h2 にサブセクションスタイル（`text-sm`）を使用

例外パターン（404 ページ、成功メッセージ）は意図的な設計と判断し、修正不要。

## 設計判断

### 1. ページタイトルの HTML 要素: h1 に統一

ページのメインタイトルは h1 が HTML セマンティクスの標準。SPA のメインコンテンツ領域内では h1 が適切。

- 変更: 8 ページの h2 → h1
- 据え置き: 4 ページの h1（Workflow/List, Workflow/Detail, Task/List, Task/Detail）

ConfirmDialog の h2 はダイアログ内コンテキストのため変更しない。

### 2. セクション見出しマージン: mb-4 に統一

| 候補 | 値 | メリット | デメリット |
|------|-----|---------|-----------|
| mb-3 | 12px | 変更量が少ない（5 箇所のみ変更） | 0.75rem は 4px グリッドの 3 単位で中途半端 |
| **mb-4** | **16px（1rem）** | **4px グリッドの 4 単位、標準的なスペーシング** | **変更量が多い（10 箇所変更）** |

→ mb-4 を採用。1rem は基本スペーシング単位として業界標準。変更量は多いが機械的な置換で低リスク。

### 3. ページタイトルマージン: mb-6 を維持

既存パターンの分析結果:

| パターン | 構造 | mb-6 の配置 |
|---------|------|------------|
| ヘッダー + ボタン | `div.flex.mb-6 > [h1, button]` | 親 div |
| 単独タイトル | `h1.mb-6` | h1 自身 |

いずれも結果的に mb-6（24px）の間隔を実現している。この構造は維持し、mb-6 が欠けているページに追加する。

### 4. Workflow/Detail「進行状況」: h2 のまま、スタイルを h2 標準に変更

| 選択肢 | 変更内容 | 評価 |
|--------|---------|------|
| **A: h2 + セクション見出しスタイル** | **スタイルを `text-lg font-semibold text-secondary-900` に変更** | **セマンティクス維持、h2 のスキップなし** |
| B: h3 + 現状スタイル維持 | 要素を h3 に変更 | h2 レベルをスキップし WCAG 違反 |

→ 選択肢 A を採用。h2 のまま他のセクション見出しとスタイルを統一する。

## 対象 / 対象外

対象:
- ページタイトルの h2 → h1 変更（8 ページ）
- セクション見出しマージンの mb-3/mb-4 統一（15 箇所）
- ページタイトルマージンの mb-6 統一
- Workflow/Detail「進行状況」スタイル修正
- styles.css ガイドラインにマージン規約を追記

対象外:
- 404 ページの例外スタイル（意図的な設計）
- User/New.elm 成功メッセージの例外スタイル（意図的な設計）
- User/Detail.elm のページタイトル不在（別 Issue のスコープ）
- 見出しヘルパー関数の抽出（リファクタリングは別 Issue）
- ConfirmDialog.elm のダイアログ内見出し

## 実装計画

TDD（Red → Green → Refactor）で MVP を積み上げる。

この変更は純粋な View レイヤーの CSS クラスと HTML 要素の変更であり、新しい振る舞いは追加しない。Elm コンパイラの型チェックと既存テストスイートが正当性を保証する。

### Phase 1: ページタイトル正規化（h2 → h1 + mb-6 統一）

#### 確認事項
- [x] 型: Elm の Html.h1 / Html.h2 のシグネチャ → 同一（`List (Attribute msg) -> List (Html msg) -> Html msg`）。単純な関数名の変更で済む
- [x] パターン: 既存 h1 ページ（Workflow/List, Detail, Task/List, Detail）は parent div に mb-6 or space-y-6 で間隔を確保
- [x] パターン: mb-6 の管理方法はページにより異なる:
  - 親 div に mb-6: User/List, Role/List, AuditLog/List, Workflow/List, Task/List
  - h2 自身に mb-6: Home.elm
  - space-y-6 コンテナ: User/New, User/Edit, Role/New, Role/Edit, Workflow/Detail, Task/Detail
  - なし（追加必要）: Workflow/New.elm

#### 変更ファイル（8 ページ）

| ファイル | 行（目安） | 変更内容 |
|---------|-----------|---------|
| `Page/Home.elm` | L88 | h2 → h1（mb-6 維持） |
| `Page/User/New.elm` | L310 | h2 → h1（成功メッセージの h2 は据え置き） |
| `Page/User/List.elm` | L118 | h2 → h1（親 div の mb-6 維持） |
| `Page/User/Edit.elm` | L311 | h2 → h1 |
| `Page/Role/New.elm` | L250 | h2 → h1 |
| `Page/Role/List.elm` | L165 | h2 → h1（セクション h3 は据え置き） |
| `Page/Role/Edit.elm` | L312, L345 | h2 → h1（条件分岐の両方） |
| `Page/AuditLog/List.elm` | L206 | h2 → h1 |

各ページで mb-6 の有無を確認し、欠けている場合は追加する。

#### テストリスト

ユニットテスト（該当なし）: View の CSS クラス変更であり、振る舞いの変更はない

ハンドラテスト（該当なし）

API テスト（該当なし）

E2E テスト（該当なし）

検証: `cd frontend && pnpm run build` でコンパイル通過を確認

### Phase 2: セクション見出しマージン統一 + 「進行状況」修正 + ガイドライン更新

#### 確認事項
- [x] パターン: Workflow/Detail「進行状況」→ L781、`rounded-lg border border-secondary-100 p-4` カード内。h2 に subsection スタイル使用
- [x] パターン: mb-3 セクション見出し → Workflow/Detail 5箇所、Task/Detail 3箇所、Role/List 1箇所 = 計 9 箇所
- [x] パターン: mb-4 セクション見出し → Workflow/New 3箇所（h3）、User/Detail 1箇所（h3）= 計 4 箇所
- [x] 追加発見: User/Detail L261「基本情報」にマージンなし → mb-4 追加が必要

#### 変更ファイル

セクション見出しマージン統一（mb-3 → mb-4）:

| ファイル | 箇所 | 変更内容 |
|---------|------|---------|
| `Page/Workflow/Detail.elm` | 複数箇所 | mb-3 → mb-4（基本情報, フォームデータ, コメント, 承認ステップ等） |
| `Page/Task/Detail.elm` | 複数箇所 | mb-3 → mb-4（基本情報, フォームデータ, 承認ステップ） |
| `Page/Role/List.elm` | L226 | mb-3 → mb-4 |

Workflow/Detail「進行状況」スタイル修正:

| ファイル | 行（目安） | 変更内容 |
|---------|-----------|---------|
| `Page/Workflow/Detail.elm` | L781 | `text-sm font-semibold text-secondary-700` → `text-lg font-semibold text-secondary-900`（+ mb-4） |

styles.css ガイドライン更新:

| ファイル | 変更内容 |
|---------|---------|
| `styles.css` | タイポグラフィセクションにマージン規約を追記 |

追記内容:
```
*   ページタイトル   : text-2xl font-bold text-secondary-900 — mb-6
*   セクション見出し : text-lg font-semibold text-secondary-900 — mb-4
*   サブセクション   : text-sm font-semibold text-secondary-700 — mb-4
```

#### テストリスト

ユニットテスト（該当なし）: View の CSS クラス変更であり、振る舞いの変更はない

ハンドラテスト（該当なし）

API テスト（該当なし）

E2E テスト（該当なし）

検証: `just check-all` で全テスト通過を確認

### ブラッシュアップループの記録

| ループ | 検出したギャップ | 観点 | 対応 |
|-------|----------------|------|------|
| 1回目 | 「進行状況」を h3 に変更すると h2 レベルをスキップし WCAG 違反 | 不完全なパス | h2 のまま維持しスタイルを統一する方針に変更 |
| 2回目 | ページタイトルの mb-6 が構造的に異なる（親 div vs heading 自身） | 既存手段の見落とし | 両パターンとも結果的に mb-6 を実現しており、構造を維持する方針を明記 |
| 3回目 | ConfirmDialog の h2 を見落としていた | 未定義 | ダイアログ内コンテキストのため対象外と明記 |

## 収束確認（設計・計画）

| # | 観点 | 理想状態（To-Be） | 判定 | 確認内容 |
|---|------|------------------|------|---------|
| 1 | 網羅性 | 探索で発見された全対象が計画に含まれている | OK | 全 17 ページの見出しを探索済み。変更対象 8 ページ + セクション見出し変更 + 対象外 5 項目を明記 |
| 2 | 曖昧さ排除 | 不確定な記述がゼロ | OK | マージン値（mb-4, mb-6）、HTML 要素（h1）、スタイル変更内容がすべて具体的に記載 |
| 3 | 設計判断の完結性 | 全ての差異に判断が記載されている | OK | h1/h2 選択、mb-3/mb-4 選択、「進行状況」対応の 3 つの判断に理由とトレードオフを記載 |
| 4 | スコープ境界 | 対象と対象外が両方明記されている | OK | 「対象 / 対象外」セクションで明示 |
| 5 | 技術的前提 | コードに現れない前提が考慮されている | OK | SPA の見出しセマンティクス、WCAG 見出しレベルスキップ禁止を考慮 |
| 6 | 既存ドキュメント整合 | 既存ドキュメントと矛盾がない | OK | #611 デザイントークンガイドライン、CORE-06 要件と照合 |
