# AI エージェント運用改善記録

AI エージェントとの協働で発生した問題と対策を記録する。

## 目的

- 問題の原因分析と対策を記録し、再発を防止する
- CLAUDE.md や手順書の改善につなげる
- 同様の問題が発生した際の参照資料とする

## 作成トリガー

**具体的な問題事象を起点とする**改善は、改善記録を作成する:

- ユーザーの指摘が正当だった場合（AI が見落とした問題をユーザーが検出した）
- AI の出力に誤りや品質問題があった場合
- プロセスの不備により手戻りが発生した場合
- CI/CD やワークフローの問題を発見した場合

AI エージェント運用に限らず、開発プロセス全般の問題が対象。

### 判定基準: 改善記録が必要か？

| 起点 | 改善記録 | 理由 | 例 |
|------|---------|------|-----|
| 問題起点（具体的な問題事象がある） | 必要 → Issue 化 | 原因分析なしの対策は表層的になりやすい | CI 失敗、レビュー漏れ、手戻り、プロセスの欠陥発見 |
| idea 起点（問題事象なし、前向きな施策） | 不要 → 直接 Issue 化 | 分析すべき「問題」が存在しない | 新スキル追加、新ツール導入、既存機能の拡張 |

判定テスト: 「具体的に何が起きたか（事象）」を説明できるか？
- Yes → 問題起点。改善記録を作成する
- No → idea 起点。直接 Issue 化してよい

改善の経緯: [問題起点の Issue に改善記録が欠如](2026-02/2026-02-11_2104_問題起点のIssueに改善記録が欠如.md)

## ディレクトリ構造

月ごとのサブディレクトリに整理する。

```
prompts/improvements/
├── YYYY-MM/
│   ├── YYYY-MM-DD_HHMM_<トピック>.md
│   └── ...
└── README.md
```

例: `prompts/improvements/2026-01/2026-01-27_2303_Issue駆動開発フロー未遵守.md`

## ファイル命名規則

```
YYYY-MM-DD_HHMM_<トピック>.md
```

- `HHMM`: 最初のコミット時刻（24時間形式、例: `0930`, `1415`）
- `<トピック>`: 問題の概要（例: `Issue駆動開発フロー未遵守`）

時刻の取得方法:

```bash
git log --format="%ci" --reverse <branch> --not main | head -1
# 出力例: 2026-01-22 11:08:10 +0900 → HHMM = 1108
```

## 記載内容

1. 事象: 何が起きたか
2. 原因分析: なぜ起きたか
3. 対策: どう改善するか
4. 次のアクション: 具体的な作業項目
5. 分類（必須）: カテゴリと失敗タイプ（後述）

## 対策セクションの性質

対策セクションは「そのとき考えた対策案」であり、確定した方針ではない。Issue と同様に、実行時には [問題解決フレームワーク](../../.claude/rules/problem-solving.md) で精査してから実装に入る。

改善記録を書く時点では原因分析に集中し、対策は「その時点での最善の仮説」として記録する。

## 対策形式の検証（必須）

対策を記載する際、対策形式を意識し、行動規範形式のままにしない。

| 対策形式 | 定義 | 有効性 | 例 |
|---------|------|--------|-----|
| 行動規範 | 「〜すること」「〜を確認する」 | 低（再発リスク高） | 「確認してからコミットする」 |
| 成果物要件 | 「〜が存在すること」「〜が記載されていること」 | 高 | 「チェックリストに項目が存在し、確認結果が記載されていること」 |
| フロー組み込み | hooks / CI / スキル内チェック | 最高 | lefthook で自動検証、CI で lint 実行 |

行動規範形式の対策を記載した場合、以下を検討する:

1. 成果物要件に転換できないか — 検証可能な成果物（チェックリスト項目、必須セクション、テンプレート）で代替
2. フロー組み込みに転換できないか — hooks、CI、スキルのステップに組み込んで自動化
3. いずれも困難な場合 — 転換困難な理由を対策セクションに明記する

**禁止:** 行動規範形式の対策を、転換の検討なしに記載すること

改善の経緯: [行動規範形式の改善対策を成果物要件・フロー組み込みに転換する](https://github.com/ka2kama/ringiflow/issues/392)

## 恒久対策の Issue 化（必須）

改善記録に恒久対策（未実行の作業項目）を記載した場合、**必ず GitHub Issue を作成**し、改善記録に Issue 番号を記載する。

理由: 改善記録はナレッジベースであり、タスク追跡の仕組みではない。未実行の作業項目が改善記録の中に埋もれて忘れられるリスクがある。タスク追跡は GitHub Issues に一元化する。

手順:

1. 恒久対策を改善記録に記載
2. 対応する GitHub Issue を作成
3. 改善記録の対策セクションに `Issue #番号` を記載

例外: 「任意」「推奨」と明記されたアクション項目は Issue 作成を省略してよい。

## 分類

改善記録には以下の分類を**必ず**付与する。蓄積された記録のパターン分析・傾向把握に使用する。

**禁止:** カテゴリと失敗タイプが未付与の状態で改善記録をコミットすること

→ 分析の方法: [AI 思考特性の分析ガイド](../../docs/06_ナレッジベース/methodology/AI思考特性の分析ガイド.md)

### カテゴリ（AI 構造的特性）

改善記録33件の分析（#315）で特定した、AI エージェントの思考の構造的特性。

| カテゴリ | 説明 | 例 |
|---------|------|-----|
| 参照漏れ | ドキュメント/手順が存在するが参照されなかった | Issue駆動フロー未遵守 |
| 単一パス検証 | 1回の確認で完全と考え、複数ループを省略 | 計画段階での網羅性不足 |
| 即座の対策 | 深く考えずに対策を提示 | 目先の対策に飛びつく傾向 |
| 視点不足 | 複数視点の同時把握ができていない | E2E視点の完了基準欠如 |
| コンテキスト引きずり | 前の会話/作業の文脈を不適切に持ち越し | 会話コンテキストのドキュメント混入 |
| 知識-実行乖離 | 情報は存在するが使用フローに組み込まれていない | CI Action許可設定漏れ |

カテゴリは固定ではない。新しいパターンが発見された場合は追加する。

### 失敗タイプ

根本原因がどの層にあるかを分類する。

| タイプ | 説明 |
|-------|------|
| 知識ギャップ | 情報自体を知らなかった |
| 実行ギャップ | 知っていたが実行しなかった |
| プロセスギャップ | プロセス自体が不十分だった |

### 記載例

```markdown
## 分類

- カテゴリ: 参照漏れ
- 失敗タイプ: 実行ギャップ
```

## 検証

対策を実行した後、効果を追記する。フィードバックループを閉じることで、対策の有効性を確認する。

検証セクションは改善記録作成時には記載しない。対策実行後に追記する。

### 追記タイミング

対応 Issue のクローズ時に、振り返りステップの一環として追記する。

→ 手順: [Issue 駆動開発 > 改善記録の検証](../../docs/04_手順書/04_開発フロー/01_Issue駆動開発.md#改善記録の検証)

### フォーマット

```markdown
## 検証（対策実行後に追記）

- 実施日: YYYY-MM-DD
- 対策の実行状況: [実行済み / 部分的 / 未実行]
- 効果: [同種の問題が再発していないか]
- 備考: [対策の調整が必要な場合]
```
