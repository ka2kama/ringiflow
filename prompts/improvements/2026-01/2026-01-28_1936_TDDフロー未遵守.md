# TDD フロー未遵守

## 事象

#36 ワークフロー承認/却下機能の実装において、設計フェーズ完了後、TDD のフローを無視していきなりプロダクションコードを書き始めた。

具体的には、`WorkflowInstance` と `WorkflowStep` に `version` フィールドを追加するコードを、テストを書かずに実装し始めた。

## 原因分析

1. **設計完了の勢い**: 詳細設計書と OpenAPI を作成し、Issue に実装計画を追記した直後だったため、「次は実装」という流れでテストを飛ばしてしまった

2. **TDD への意識不足**: 手順書に「TDD（Red → Green → Refactor）で実装を進める」と明記されているが、実装計画を書いた後にその原則を再確認しなかった

3. **Phase 1 の内容が「ドメインモデル拡張」だった**: テストより先にモデル変更が必要という錯覚があったが、実際は「version フィールドが存在することをテストで確認 → 実装」の順序が正しい

## 対策

### 即時対応

1. 書き始めたプロダクションコードを一旦戻す（git checkout）
2. テストファーストで実装し直す

### 再発防止

1. **実装フェーズ開始時のチェックポイント追加**: 設計フェーズ完了後、実装に入る前に「まずテストを書く」ことを確認するリマインダーを設ける

2. **CLAUDE.md への明記検討**: 「設計フェーズ完了後、実装フェーズに入る際は必ず TDD 開発フローを参照する」というガイドラインを追加

## 次のアクション

- [x] 改善記録を作成（本ファイル）
- [x] プロダクションコードの変更を戻す
- [x] TDD に従ってテストから書き直す
- [x] CLAUDE.md に「テストを書かずにプロダクションコードを書き始めることを禁止」を追記

## 分類

- カテゴリ: 参照漏れ
- 失敗タイプ: 実行ギャップ
