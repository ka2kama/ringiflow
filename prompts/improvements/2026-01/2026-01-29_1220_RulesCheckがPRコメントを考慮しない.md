# Rules Check が PR コメントを考慮しない

## 事象

PR #152 で Rules Check の指摘に対してコメントで理由を説明して据え置きを宣言したが、2回目の Rules Check 実行時にそのコメントが考慮されず、新しい `CHANGES_REQUESTED` が投稿された。

1. 1回目: ファイル名の時刻欠落 → 修正してプッシュ
2. プッシュ後にコメントで「ASCII art はセッションログの可読性を優先し据え置きます」と返信
3. 2回目: ファイル名は修正済みと認識されたが、ASCII art の新しい違反を検出 → `CHANGES_REQUESTED`
4. こちらのコメントは完全に無視された

## 原因分析

`claude-rules-check.yaml` のプロンプト（93-136行）を確認すると:

```yaml
prompt: |
  ## 手順
  1. `gh pr diff` で変更されたファイルパスを取得
  2. `.claude/rules/` 内の各ルールファイルを読み...
  3. マッチしたルールに基づいてチェック
```

PR のコメントや既存のレビュー会話を読む指示が一切ない。diff とルールファイルだけを見て機械的に判定する設計になっている。

### 構造的な問題

これは YAGNI コードベース分析セッションで議論した「Claude Code のセッション境界の壁」の具体例:

- Rules Check の各実行は独立したセッション
- 前回の実行結果やその後のコメントのコンテキストを持たない
- 「この指摘には理由があって対応しない」という会話の文脈が失われる

## 対策

### 短期: dismiss で対処（実施済み）

`CHANGES_REQUESTED` を理由付きで dismiss した。

### 中期: プロンプトの改善

Rules Check のプロンプトに以下を追加する:

1. `gh pr view --comments` で既存のコメントを読む手順を追加
2. 指摘に対して「理由付きで据え置き」の返信がある場合は、その指摘を繰り返さない
3. dismiss された過去のレビューの理由を確認する

## 次のアクション

1. [x] 改善記録を作成（本ファイル）
2. [x] GitHub Issue: Rules Check のプロンプト改善 → [#153](https://github.com/ka2kama/ringiflow/issues/153)
