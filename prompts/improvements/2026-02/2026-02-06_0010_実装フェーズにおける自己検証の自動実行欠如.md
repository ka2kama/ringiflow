# 実装フェーズにおける自己検証の自動実行欠如

**発生日時**: 2026-02-06
**重大度**: 中
**カテゴリ**: 検証プロセス

## 問題

Issue #247 の実装で 4 つの Phase（Core Service → BFF → Frontend → OpenAPI/テスト）を完了しコミットした後、ユーザーから「自己検証は充分？」と問われて初めて自己検証を実施した。

自己検証プロトコルでは「成果物を提示・コミットする前に自己検証を実施する」と定められているが、これが自動的に作動しなかった。

## 原因分析

### 直接原因

各 Phase 完了後、コミット前に自己検証チェックリストを確認しなかった。

```
Phase 1 実装 → コミット → Phase 2 実装 → コミット → ... → [自己検証なし] → ユーザー指摘 → 事後検証
```

### 根本原因

**設計フェーズと実装フェーズで自己検証のトリガー構造が異なる**

| フェーズ | トリガー構造 | 強制力 |
|---------|-------------|--------|
| 設計フェーズ | 計画ファイルに自己検証セクションを記載（成果物要件） | 高 |
| 実装フェーズ | 「コミット前に検証すること」という行動規範 | 低 |

設計フェーズでは 2026-02-05 の改善で「計画ファイルに自己検証セクションを必須化」したが、実装フェーズには同様の構造的な強制力がない。

### 悪化要因

- **コンテキスト compaction**: 会話が要約された後、自己検証プロトコルの意識が薄れた
- **タスク集中**: 実装完了に集中し、メタレベルのチェックポイントを見落とした

## 対策

### 恒久対策: TDD Refactor ステップに自己検証を統合

TDD 開発フローの Refactor ステップは「改善→確認→改善→...→指摘ゼロ」の検証ループである。ここに自己検証チェックリストを統合する。

self-review.md への追記:

```markdown
## 既存の検証プロセスとの関係

| 既存プロセス | 役割 | 自己検証との関係 |
|-------------|------|----------------|
| TDD Refactor ステップ | コード内部品質の改善 | Refactor 自体が検証ループ。実装チェックリストはその収束基準として機能する |
```

この統合により:

1. Refactor ステップで「チェックリストの全項目が OK になるまで繰り返す」ことが明確になる
2. 「コミット前に検証」ではなく「Refactor で検証」という自然なフローになる
3. TDD サイクルの一部として自己検証が組み込まれる

### 補足: 横断検証の明示化

複数 Phase にまたがる PR では、全 Phase 完了後に「横断検証フェーズ」を実施することを明確化する。これは Phase 間のデータフロー整合を確認するためのチェックポイントである。

## 次のアクション

- [ ] self-review.md に「既存の検証プロセスとの関係」セクションを追加
- [ ] TDD 開発フローに自己検証チェックリストへの参照を追加

## 関連

- Issue: #247 タスク API の URL パスパラメータに表示用番号を使用する
- PR: #248
- 自己検証プロトコル: [`.claude/rules/self-review.md`](../../.claude/rules/self-review.md)
- 前日の改善記録（設計フェーズ）: [自己検証ループの自動実行欠如](2026-02-05_2100_自己検証ループの自動実行欠如.md)
- TDD 開発フロー: [`docs/04_手順書/04_開発フロー/02_TDD開発フロー.md`](../../docs/04_手順書/04_開発フロー/02_TDD開発フロー.md)
