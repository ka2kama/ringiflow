# Hurl 仕様未確認の再発と改善記録の形骸化

**発生日時**: 2026-02-02
**重大度**: 高

## 問題

2 つの問題が連鎖して発生した。

### 問題 1: Hurl バージョン不一致の放置

CI の API テストが flaky になった。原因は Hurl 6.0 以降 `--test` モードがデフォルトでパラレル実行に変わったことで、同一テナントへの並行ワークフロー作成がユニーク制約に衝突した。

ローカル（Hurl 7.1.0）と CI（Hurl 6.1.1）のバージョン不一致は、2026-02-01 の改善記録（[Hurl 仕様未確認のまま機能を推奨](2026-02-01_0003_Hurl仕様未確認のまま機能を推奨.md)）で既に認識されていた。しかし「次のアクション: なし」で終わり、バージョン統一も挙動差異の調査も実施されなかった。

### 問題 2: `--sequential` フラグの仕様未確認

対策として `--sequential` フラグを提案・コミット・プッシュしたが、Hurl にそのようなオプションは存在しなかった（正しくは `--jobs 1`）。CI が `unexpected argument '--sequential'` で失敗した。

これは 2026-02-01 の改善記録が指摘した「仕様を確認せずに推奨した」パターンの完全な再発である。

## 原因分析

### 直接原因

| 問題 | 直接原因 |
|------|---------|
| パラレル実行衝突 | CI Hurl バージョンが古く、パラレル実行がデフォルトであることを把握していなかった |
| `--sequential` | `hurl --help` でオプションの存在を確認せずにコミット・プッシュした |

### 根本原因

**改善記録が「認識」で止まり「行動」に至っていない。**

2026-02-01 の改善記録には以下の対策が記載されていた:

> 1. 公式ドキュメントでサポート状況を確認する
> 2. ローカルで動作確認してからコミットする
> 3. CI と ローカルのバージョン差異を認識し、両方で動作する書き方を選択する

しかし「次のアクション: なし」「行動規範レベルの改善」と結論づけた。具体的なアクションが設定されなかったため:

- バージョン差異は放置された（対策 3 の未実施）
- 今回の `--sequential` でも仕様確認を怠った（対策 1, 2 の未実施）

**改善記録を書くこと自体が目的化し、行動変容に繋がっていない。**

### 再発パターンの構造

```
問題発生 → 改善記録を書く → 「行動規範レベル」で終了 → 具体的アクションなし → 再発
```

自己検証チェックリスト項目 7「ツール・ライブラリの仕様を公式ドキュメントで確認したか」は既に存在するが、遵守されていない。チェックリストの存在だけでは行動変容を担保できない。

## 対策

### 1. CI の Hurl バージョンを local と統一（即時対応・本セッションで実施済み）

`.github/workflows/ci.yaml` の `HURL_VERSION` を `6.1.1` → `7.1.0` に更新。

### 2. API テストを `--jobs 1` で直列実行（即時対応・本セッションで実施済み）

API テストは同一テナントのシードデータに対して実行するため、パラレル実行すると状態が干渉する。`--jobs 1` を CI（`ci.yaml`）とローカル（`scripts/run-api-tests.sh`）の両方に追加。

### 3. `--sequential` → `--jobs 1` に修正（即時対応・本セッションで実施済み）

`hurl --help` で確認し、正しいオプションが `--jobs 1` であることを確認した。

### 4. 改善記録の「次のアクション: なし」を禁止

改善記録の README に以下のルールが既にある:

> 改善記録に恒久対策（未実行の作業項目）を記載した場合、必ず GitHub Issue を作成し、改善記録に Issue 番号を記載する。

2026-02-01 の改善記録はこのルールに反して「次のアクション: なし」で終了していた。

対策: 改善記録を書く際、「次のアクション: なし」とする場合は、本当にアクション不要かを以下で検証する:

- 問題の原因が完全に除去されたか（暫定対策ではなく恒久対策が実施済みか）
- 同じパターンが再発する構造的な余地が残っていないか

Issue #216（自己検証チェックリスト改善）に本項目を追加する。

## 次のアクション

- [x] CI Hurl バージョンを 7.1.0 に更新（本セッション内で対応済み）
- [x] `--jobs 1` を CI + ローカルに追加（本セッション内で対応済み）
- [ ] 改善記録の「次のアクション: なし」ルールを明確化（Issue #216）

## 関連

- Issue: #205 表示用 ID: DB スキーマ変更（Phase A-1）
- PR: #215
- 前回の改善記録: [Hurl 仕様未確認のまま機能を推奨](2026-02-01_0003_Hurl仕様未確認のまま機能を推奨.md) — 同じパターンの初発
- 同日の改善記録: [ローカルと CI のテストスコープ差異による検証漏れ](2026-02-02_1636_ローカルとCIのテストスコープ差異による検証漏れ.md) — 同一ブランチでの関連問題
- 自己検証プロトコル: [`.claude/rules/self-review.md`](../../.claude/rules/self-review.md) — 項目 7「技術的前提の確認」

## 分類

- カテゴリ: 知識-実行乖離
- 失敗タイプ: 実行ギャップ
