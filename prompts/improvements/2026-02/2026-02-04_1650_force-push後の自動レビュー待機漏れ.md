# force push 後の自動レビュー待機漏れ

**発生日時**: 2026-02-04
**重大度**: 低

## 問題

PR #218 をリベース後に force push し、CI チェック（Rust / Integration / API Test）の完了を確認してすぐにマージを試みた。しかし、ブランチ保護ルールで `Claude Auto Review` と `Claude Rules Check` も必須チェックに含まれており、これらが `pending` の状態でマージが拒否された。

## 原因分析

### 直接原因

force push 後に再実行される **全ての必須チェック** を把握していなかった。CI ワークフロー（`ci.yaml`）のチェックのみを待機し、自動レビューワークフロー（`claude-auto-review.yaml`）の再実行を見落とした。

### 根本原因

マージ前の待機対象チェックを「CI テスト」に限定して認識していた。ブランチ保護ルールで必須とされているチェックの全体像を把握していなかった。

## 対策

### Ready for Review チェックリストへの組み込み

マージ前に `gh pr checks <PR番号>` で **全チェック** が `pass` であることを確認する。特に force push 後は全チェックが再実行されるため、CI だけでなく自動レビューの完了も待つ。

```bash
# 全チェック完了を待機
gh pr checks <PR番号> --watch

# 全て pass を確認してからマージ
gh pr merge <PR番号> --squash --delete-branch
```

### AI エージェントへの指示

PR マージ前に `gh pr checks` で全チェックのステータスを確認する。`pending` のチェックが残っている場合はマージを試みない。force push 後は CI チェックだけでなく、自動レビューワークフロー等も再実行されることを認識する。

## 影響

- マージの遅延（数分程度）。コードやプロダクトへの影響なし。
- 不要なマージ試行エラーによる操作の無駄。

## 参照

- PR: #218
- 自動レビュー設定: `.github/workflows/claude-auto-review.yaml`

## 分類

- カテゴリ: 視点不足
- 失敗タイプ: 知識ギャップ

## 検証（対策実行後に追記）

- 実施日: 2026-02-11
- 対策の実行状況: 実行済み
- 効果: PR マージ前に `gh pr checks` で全チェックを確認する運用が定着。CLAUDE.md の PR 完了フローにも手順が明記されている。同種の待機漏れは再発していない
- 備考: なし
