# セッション復元時のレビューコメント検証省略

## 事象

`/review-and-merge` の途中でセッションが切れ、復元後に再開した際、前セッションの結論（「APPROVED、全指摘対応済み」）をそのまま引き継ぎ、マージを提案した。実際には Rules Check の指摘（計画ファイルと実装の乖離）が未対応だった。ユーザーがコメント URL を提示して初めて見落としに気づいた。

## 原因分析

### 直接原因

セッション復元時、前セッションのサマリーに含まれる結論（「reviewDecision: APPROVED、全チェック SUCCESS」）を信頼し、`/review-and-merge` の Step 3（全コメント取得・分析）を再実行しなかった。

### 構造的原因

セッション復元後のスキル再開に関する手順が未定義。`/review-and-merge` スキルは1セッション内で完結することを前提に設計されており、途中で中断・復元した場合の再検証ステップがない。

前セッションのサマリーは「その時点での状態」のスナップショットであり、その後に投稿されたレビューコメントは反映されない。しかし、サマリーの結論をそのまま「現在の状態」として扱ってしまった。

## 対策

### 対策案

`/review-and-merge` スキルの冒頭に、セッション復元時の注意を追記する。

ただし、これは行動規範形式（「再検証すること」）であり、フロー組み込みへの転換が望ましい。スキルの Step 1 で常に全コメントの状態を取得する構造にすれば、セッション復元かどうかに関わらず最新状態を検証できる。

### 転換の検討

| 形式 | 案 | 実現性 |
|------|-----|--------|
| 行動規範 | 「セッション復元時は Step 3 から再開すること」 | 低（忘れるリスク） |
| 成果物要件 | 「マージ提案時に全コメントの対応状況一覧が提示されていること」 | 中 |
| フロー組み込み | Step 5（マージ）の前提条件として「未対応コメントがゼロであること」の検証を追加 | 高（推奨） |

## 次のアクション

- [ ] `/review-and-merge` スキルの Step 5 に、未対応レビューコメントのゼロ検証を追加する（Issue #497）

## 分類

- カテゴリ: コンテキスト引きずり（前セッションの結論を現在の状態として不適切に引き継いだ）
- 失敗タイプ: プロセスギャップ（スキルにセッション復元時の再検証ステップがない）

## 関連

- [APPROVED レビューコメントの見落とし](2026-02-09_2200_APPROVEDレビューコメントの見落とし.md) — 同じスキルの Step 3 に関する問題だが、原因が異なる（取得ロジック vs セッション復元）
