# 間接的な因果関係の見落とし

## 事象

Issue #540（audit_log テストの並列実行時の失敗）の調査で、Phase 1 のテスト追加が並列実行負荷に影響するという間接的な因果関係を見落とし、「環境依存の問題であり、Phase 1 とは無関係」という誤った結論を出した。

### 実際の因果関係

```
Phase 1 のテスト追加（comment_integration_test.rs）
  ↓
並列実行時の総テスト数増加
  ↓
DynamoDB への同時接続数増加
  ↓
臨界点を超える
  ↓
audit_log テストで dispatch failure
```

### 誤った調査プロセス

| ステップ | 私の判断 | 問題点 |
|---------|---------|--------|
| 1 | Phase 1 は Mock のみ → 無関係 | コードの直接依存のみを確認 |
| 2 | 4回連続失敗 → 環境依存 | なぜ私の環境だけ失敗するのかを深掘りしなかった |
| 3 | CI 成功 → 問題なし | CI と私の環境の違い（並列度、リソース）を分析しなかった |

### ユーザーの重要な指摘を軽視

ユーザーは「540の調査結果からして今のブランチ、worktreeの変更はあやしいのでは？」と指摘していたが、「コードの直接依存がない」という理由で、ブランチの変更（テスト追加）による間接的な影響を検討しなかった。

## 原因分析

### 1. システム思考の欠如

コードの依存関係だけでなく、以下も考慮すべきだった:
- リソース競合（DynamoDB への同時接続）
- 並列実行の影響（テスト数増加による負荷）
- タイミングの問題（臨界点の存在）

### 2. 仮説検証の不十分さ

「環境依存」という仮説を立てたが、以下を検証しなかった:
- なぜ私の環境だけ失敗するのか
- CI と私の環境で並列度やリソース状況がどう違うのか
- main ブランチと PR ブランチで何が変わったのか（テスト数）

### 3. ユーザーの洞察の軽視

ユーザーの「あやしい」という直感を、論理的な根拠がないと判断して流してしまった。直感は検証対象として扱うべきだった。

## 対策

### 成果物要件への転換

問題調査時のチェックリストに「間接的な因果関係」の観点を追加する:

| 観点 | 確認内容 |
|------|---------|
| 直接的依存 | コードの依存関係、インポート、関数呼び出し |
| 間接的影響 | リソース競合、並列実行負荷、タイミング、システム全体への影響 |
| 環境差異 | CI と開発環境の違い（並列度、リソース、設定） |
| 差分の影響 | ブランチ間の変更が何に影響するか（コード以外も） |

### フロー組み込み

問題解決フレームワークに「システムレベルの影響」の観点を追加することを検討する。

対策形式の検討:
- ❌ 行動規範: 「間接的な因果関係も考慮すること」（再発リスク高）
- ⚠️ 成果物要件: 調査チェックリストに項目を追加（検証可能）
- ✅ フロー組み込み: 問題解決フレームワークへの統合（最も効果的）

## 次のアクション

- [ ] 問題解決フレームワーク（`.claude/rules/problem-solving.md`）に「システムレベルの影響」の観点を追加する（Issue #542）

## 分類

- カテゴリ: 視点不足
- 失敗タイプ: プロセスギャップ
