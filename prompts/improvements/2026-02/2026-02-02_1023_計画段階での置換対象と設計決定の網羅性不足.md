# 計画段階での置換対象と設計決定の網羅性不足

**発生日時**: 2026-02-02
**重大度**: 中

## 問題

Issue #173（Tailwind CSS デザインシステム）の残り Story 完了計画を作成した際、3つの Explore エージェントで詳細な調査を行ったにもかかわらず、初期計画に **8 件の穴・漏れ** があった。

### 漏れの一覧

| # | 種別 | 内容 |
|---|------|------|
| 1 | ファイル漏れ | `Page/Task/List.elm` のボタンが置換対象から漏れ |
| 2 | 曖昧な記述 | Badge の Detail ページの箇所が「あれば」と未確定のまま |
| 3 | ファイル漏れ | Detail ページのエラー表示内の再読み込みボタンが漏れ |
| 4 | 未解決の設計判断 | サイズ不統一（px-4 py-2 vs px-6 py-3）の扱いが未決定 |
| 5 | 未解決の設計判断 | `rounded` vs `rounded-lg` の統一が未記載 |
| 6 | 未解決の設計判断 | Outline variant の border 色（secondary-100 vs 300）が未統一 |
| 7 | スコープ境界の曖昧さ | ハンバーガーボタン・×ボタンの除外が明記されていない |
| 8 | 技術的考慮漏れ | `type_ "button"` のデフォルト設定が未考慮 |

## 原因分析

### 直接原因

**探索結果の合成時に、体系的な突合を行わなかった。**

3つの Explore エージェントは各々が十分に詳細なレポートを返したが、計画文書への合成時に以下が起きた:

1. **ファイルの網羅チェックをしていない**: 探索で言及された全ファイルを、計画の置換対象リストと突合しなかった
2. **「あれば」で曖昧さを残した**: 探索フェーズで確認可能な事実を、計画段階で未確定のまま放置した
3. **スタイルの差異を認識したが判断を保留した**: サイズ・角丸・border 色の違いが探索レポートに記載されていたが、計画で「統一する」とだけ書き、具体的な影響や選択を記載しなかった
4. **スコープ境界を暗黙にした**: Button.elm に含めない要素の判断を、計画に明記しなかった

### 根本原因

**計画の自己検証プロセスが欠如していた。**

計画を作成した後、ユーザーに提示する前に「この計画に穴はないか」を自分で検証するステップを踏まなかった。探索 → 計画作成 → ユーザーに提示、と一直線に進んでしまい、**指摘がなくなるまで自己検証を繰り返す**という当然のプロセスが抜けていた。

今回の 8 件の漏れは、計画作成後に探索結果と突合する自己レビューを 1 回でも行えば、すべて事前に発見できたものだった。

## 対策

### 計画の自己検証ループ（必須）

計画をユーザーに提示する前に、以下の自己検証を**指摘がなくなるまで**繰り返す:

```
探索 → 計画作成 → 自己検証 → 修正 → 自己検証 → ... → 指摘ゼロ → ユーザーに提示
```

自己検証の観点:

1. **網羅性**: 探索で発見された全パターン・全ファイルが、計画の対象リストに含まれているか（含まないものは「対象外」に理由付きで記載されているか）
2. **曖昧さの排除**: 「あれば」「必要に応じて」等の不確定な記述が残っていないか。探索で確認可能な事実はすべて確定させたか
3. **設計判断の完結性**: 探索で見つかった差異・バリエーション（サイズ、色、角丸等）に対して、すべて具体的な判断と影響が記載されているか
4. **スコープ境界の明示**: 対象と対象外の両方が明記されているか。暗黙の除外がないか
5. **技術的前提の検証**: HTML の仕様、フレームワークの挙動など、コードに現れない前提も考慮したか

### CLAUDE.md への追記

Issue 駆動開発の設計フェーズ（4.3 実装計画作成）に、計画の自己検証プロセスを追加する。Issue #199（CLAUDE.md 改善）と合わせて対応する。

## 次のアクション

- [x] 初期計画を修正（8件の漏れを反映）
- [x] 改善記録を作成（本ファイル）
- [x] CLAUDE.md に計画の自己検証プロセスを追記（Issue #199 と合わせて対応）

## 関連

- Issue: #209 共有 UI コンポーネント（Button + Badge）を構築する
- Epic: #173 Tailwind CSS デザインシステム導入
- 類似: [E2E 視点の完了基準欠如](../2026-01/2026-01-29_1304_E2E視点の完了基準欠如.md) — 計画段階での網羅性不足が共通課題

## 分類

- カテゴリ: 単一パス検証
- 失敗タイプ: プロセスギャップ

## 検証（対策実行後に追記）

- 実施日: 2026-02-03
- 対策の実行状況: 実行済み
- 効果: `.claude/rules/zoom-rhythm.md` に「収束確認のチェックリスト（設計・計画フェーズ）」を追加。計画作成後に網羅性・曖昧さ排除・設計判断の完結性・スコープ境界・技術的前提・既存ドキュメント整合の6観点で自己検証を行うプロセスが確立された。また、設計ブラッシュアップループの記録も必須化され、計画段階での穴・漏れを事前に発見できるようになった。計画段階での網羅性不足のパターンは再発していない。
- 備考: なし
