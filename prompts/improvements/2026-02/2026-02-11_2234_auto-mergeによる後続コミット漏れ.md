# auto-merge による後続コミット漏れ

## 事象

PR #466 のマージ時、`gh pr merge --squash` が branch protection で失敗したため `gh pr merge --squash --auto` にフォールバックした。その後に改善記録のコミットをプッシュしたが、auto-merge が先に実行されたため、そのコミットが PR に含まれなかった。

結果、改善記録を別 PR（#473）で追加する手戻りが発生した。

過去にも同様の問題が発生しており、再発である。

## 原因分析

### 直接原因

`gh pr merge --squash` が失敗した際、スキル定義にない `--auto` フラグを独自判断で使用した。auto-merge は全チェック通過時に即座にマージするため、その後にプッシュしたコミットはマージに含まれない。

### 構造的原因

1. `/review-and-merge` スキルの Step 5 には `gh pr merge --squash --delete-branch` のみ定義されている。失敗時のフォールバックが未定義であるため、AI が独自判断で `--auto` を使用した
2. `--auto` は「後続のコミットがない」ことが前提のコマンドだが、wrap-up やレビュー対応の途中でマージを試行する場面では前提が成立しない

## 対策

### 恒久対策

1. `/review-and-merge` スキルに `--auto` フラグの使用を禁止する明示的なルールを追加する
2. `gh pr merge` が失敗した場合は原因を特定し、解消してから再試行する（`--auto` にフォールバックしない）

Issue: #474

## 次のアクション

- [ ] `/review-and-merge` スキルの Step 5 に `--auto` 禁止ルールを追加（Issue #474）

## 分類

- カテゴリ: 即座の対策
- 失敗タイプ: プロセスギャップ
