# Test plan チェックボックスの形骸化

**日時**: 2026-02-14 21:30
**発生場面**: PR #535 のレビュー対応時
**カテゴリ**: プロセス（品質ゲート）

## 何が起きたか（As-Is）

PR #535 の Test plan に以下のチェックボックスがあり、チェックが入っていた:

```markdown
- [x] 改善記録が命名規則に従っている（`YYYY-MM-DD_HHMM_<トピック>.md`）
```

しかし、Claude Auto Review で以下の指摘を受けた:

> **[Low] 改善記録のファイル名が命名規則に合っていない**
>
> 実際: `2026-02-14_Issue精査時のAs-Is確認不足.md`（`HHMM` 部分が欠けている）

**チェックボックスにチェックを入れたのに、実際には検証していなかった。**

## どうあるべきだったか（To-Be）

Test plan のチェックボックスは、**検証完了後のみ**チェックする。

検証せずにチェックを入れてはならない。チェックボックスは「TODO リスト」ではなく「検証完了の記録」である。

## なぜこうなったか（ギャップ分析）

### 表層的な原因

- ファイル名を目視確認せずにチェックを入れた
- 命名規則テンプレート（`YYYY-MM-DD_HHMM_<トピック>.md`）との照合を省略した

### 根本原因

**品質ゲート（Test plan）が形骸化している。**

チェックボックスを「やるべきこと」として扱い、実際の検証を省略してチェックを入れてしまった。

これは以下の構造的問題を示している:

1. **AI エージェントが「検証完了後のみチェック」という原則を守っていない**
2. **チェックボックスの項目が曖昧で、検証手順が明示されていない**
3. **品質ゲートの形骸化を検出する仕組みがない**

## V&V における位置づけ

この問題は **Verification（正しく作っているか？）の失敗**である。

品質ゲート（Test plan）は Verification の最後の砦であり、これが形骸化すると欠陥が素通りする。

今回は Claude Auto Review が検出したため事なきを得たが、レビューがなければそのままマージされていた。

## 対策

### 1. 原則の明文化

`.claude/rules/docs.md` の「ドキュメント生成時の自己チェック」に以下を追加:

**「チェックボックスは検証完了後のみチェックする。検証せずにチェックしてはならない。」**

### 2. 検証手順の明示

命名規則が定められたディレクトリでは、以下の手順で検証する:

1. テンプレートの各パートを埋めてファイル名を組み立てる
2. 実際のファイル名と照合する
3. 一致を確認してからチェックを入れる

この手順は既に docs.md に記載されているが、「自己チェックリスト」としても明記する。

### 3. AI エージェントへの指示強化

wrap-up スキルと PR 作成フローに、以下を追加:

- Test plan のチェックボックスは検証完了後のみチェック
- 検証手順が不明な項目はチェックせず、ユーザーに確認を求める

### 4. 長期的対策（別 Issue で追跡）

自動検証スクリプト（pre-commit hook）で命名規則をチェックすることで、品質ゲートの形骸化を補完する。

ただし、これは副次的な対策であり、本質（検証せずにチェックしない）を代替するものではない。

## 次のアクション

- [ ] `.claude/rules/docs.md` に「チェックボックスは検証完了後のみチェック」を追加
- [ ] wrap-up スキルと PR 作成フローに原則を追加
- [ ] 自動検証スクリプトの Issue を作成（優先度: Low）

## 関連

- PR: #535
- 発見の経緯: Claude Auto Review による指摘
- ユーザーの指摘: 「checkbox が形骸化してるのは結構あぶない」
