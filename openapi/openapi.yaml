openapi: 3.1.0
info:
  title: RingiFlow API
  description: ワークフロー管理システム RingiFlow の BFF API
  license:
    name: MIT
    identifier: MIT
  version: 0.1.0
paths:
  /api/v1/auth/csrf:
    get:
      tags:
      - auth
      summary: GET /api/v1/auth/csrf
      description: |-
        CSRF トークンを取得する。
        セッションが存在しない場合は新規作成し、存在する場合は既存のトークンを返す。
      operationId: csrf
      responses:
        '200':
          description: CSRF トークン
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_CsrfResponseData'
        '401':
          description: 未認証
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/auth/login:
    post:
      tags:
      - auth
      summary: POST /api/v1/auth/login
      description: |-
        メール/パスワードでログインし、セッションを確立する。

        ## 認証フロー

        1. Core API でユーザーを検索（`GET /internal/users/by-email`）
        2. Auth Service でパスワードを検証（`POST /internal/auth/verify`）
        3. セッションを作成し Cookie を設定

        ## タイミング攻撃対策

        ユーザーが存在しない場合も Auth Service にダミーリクエストを送信し、
        処理時間を均一化してユーザー存在確認攻撃を防ぐ。

        ## ヘッダー

        - `X-Tenant-ID`: テナント ID（必須）

        ## リクエストボディ

        ```json
        {
          "email": "user@example.com",
          "password": "password123"
        }
        ```
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
        required: true
      responses:
        '200':
          description: ログイン成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_LoginResponseData'
        '401':
          description: 認証失敗
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '503':
          description: サービス利用不可
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  /api/v1/auth/logout:
    post:
      tags:
      - auth
      summary: POST /api/v1/auth/logout
      description: セッションを無効化してログアウトする。
      operationId: logout
      responses:
        '204':
          description: ログアウト成功
        '401':
          description: 未認証
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/auth/me:
    get:
      tags:
      - auth
      summary: GET /api/v1/auth/me
      description: 現在のユーザー情報と権限を取得する。
      operationId: me
      responses:
        '200':
          description: ユーザー情報
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MeResponseData'
        '401':
          description: 未認証
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/dashboard/stats:
    get:
      tags:
      - dashboard
      summary: GET /api/v1/dashboard/stats
      description: ダッシュボード統計情報を取得する
      operationId: get_dashboard_stats
      responses:
        '200':
          description: ダッシュボード統計
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_DashboardStatsData'
      security:
      - session_auth: []
  /api/v1/tasks/my:
    get:
      tags:
      - tasks
      summary: GET /api/v1/tasks/my
      description: 自分のタスク一覧を取得する
      operationId: list_my_tasks
      responses:
        '200':
          description: タスク一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_Vec_TaskItemData'
      security:
      - session_auth: []
  /api/v1/users:
    get:
      tags:
      - users
      summary: GET /api/v1/users
      description: |-
        テナント内のユーザー一覧を取得する。
        ステータスフィルタに対応（省略時は deleted 以外すべて）。
      operationId: list_users
      parameters:
      - name: status
        in: query
        required: false
        schema:
          type: string
      responses:
        '200':
          description: ユーザー一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_Vec_UserItemData'
      security:
      - session_auth: []
    post:
      tags:
      - users
      summary: POST /api/v1/users
      description: |-
        ユーザーを作成する。

        ## フロー

        1. 入力バリデーション
        2. 初期パスワード生成
        3. Core Service でユーザー作成
        4. Auth Service で認証情報作成
        5. 初期パスワード付きレスポンス返却
      operationId: create_user
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
        required: true
      responses:
        '201':
          description: ユーザー作成
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_CreateUserResponseData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '409':
          description: メールアドレス重複
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/users/{display_number}:
    get:
      tags:
      - users
      summary: GET /api/v1/users/{display_number}
      description: 表示用連番でユーザー詳細を取得する。
      operationId: get_user_detail
      parameters:
      - name: display_number
        in: path
        description: ユーザー表示番号
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: ユーザー詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_UserDetailData'
        '404':
          description: ユーザーが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
    patch:
      tags:
      - users
      summary: PATCH /api/v1/users/{display_number}
      description: ユーザー情報を更新する（名前、ロール）。
      operationId: update_user
      parameters:
      - name: display_number
        in: path
        description: ユーザー表示番号
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
        required: true
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_UserResponseData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: ユーザーが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/users/{display_number}/status:
    patch:
      tags:
      - users
      summary: PATCH /api/v1/users/{display_number}/status
      description: |-
        ユーザーステータスを変更する。
        セッションから自身の user_id を取得し、Core Service に渡す。
      operationId: update_user_status
      parameters:
      - name: display_number
        in: path
        description: ユーザー表示番号
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserStatusRequest'
        required: true
      responses:
        '200':
          description: ステータス変更成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_UserResponseData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: ユーザーが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflow-definitions:
    get:
      tags:
      - workflows
      summary: GET /api/v1/workflow-definitions
      description: |-
        ワークフロー定義一覧を取得する

        ## 処理フロー

        1. セッションから `tenant_id` を取得
        2. Core Service の `GET /internal/workflow-definitions` を呼び出し
        3. レスポンスを返す
      operationId: list_workflow_definitions
      responses:
        '200':
          description: ワークフロー定義一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_Vec_WorkflowDefinitionData'
      security:
      - session_auth: []
  /api/v1/workflow-definitions/{id}:
    get:
      tags:
      - workflows
      summary: GET /api/v1/workflow-definitions/{id}
      description: |-
        ワークフロー定義の詳細を取得する

        ## 処理フロー

        1. セッションから `tenant_id` を取得
        2. Core Service の `GET /internal/workflow-definitions/{id}` を呼び出し
        3. レスポンスを返す
      operationId: get_workflow_definition
      parameters:
      - name: id
        in: path
        description: ワークフロー定義 ID
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: ワークフロー定義詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_WorkflowDefinitionData'
        '404':
          description: 定義が見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflows:
    get:
      tags:
      - workflows
      summary: GET /api/v1/workflows
      description: |-
        自分のワークフロー一覧を取得する

        ## 処理フロー

        1. セッションから `tenant_id`, `user_id` を取得
        2. Core Service の `GET /internal/workflows` を呼び出し
        3. レスポンスを返す
      operationId: list_my_workflows
      responses:
        '200':
          description: 自分のワークフロー一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_Vec_WorkflowData'
      security:
      - session_auth: []
    post:
      tags:
      - workflows
      summary: POST /api/v1/workflows
      description: |-
        ワークフローを作成する（下書き）

        ## 処理フロー

        1. セッションから `tenant_id`, `user_id` を取得
        2. Core Service の `POST /internal/workflows` を呼び出し
        3. レスポンスを返す
      operationId: create_workflow
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkflowRequest'
        required: true
      responses:
        '201':
          description: ワークフロー作成
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_WorkflowData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: 定義が見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflows/{display_number}:
    get:
      tags:
      - workflows
      summary: GET /api/v1/workflows/{display_number}
      description: |-
        ワークフローの詳細を取得する

        ## 処理フロー

        1. セッションから `tenant_id` を取得
        2. Core Service の `GET /internal/workflows/by-display-number/{display_number}` を呼び出し
        3. レスポンスを返す
      operationId: get_workflow
      parameters:
      - name: display_number
        in: path
        description: ワークフロー表示番号
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: ワークフロー詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_WorkflowData'
        '404':
          description: ワークフローが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflows/{display_number}/steps/{step_display_number}/approve:
    post:
      tags:
      - workflows
      summary: POST /api/v1/workflows/{display_number}/steps/{step_display_number}/approve
      description: |-
        ワークフローステップを承認する

        ## 処理フロー

        1. セッションから `tenant_id`, `user_id` を取得
        2. Core Service の `POST /internal/workflows/by-display-number/{dn}/steps/by-display-number/{step_dn}/approve` を呼び出し
        3. 200 OK + 更新されたワークフローを返す
      operationId: approve_step
      parameters:
      - name: display_number
        in: path
        description: ワークフローの表示用連番
        required: true
        schema:
          type: integer
          format: int64
      - name: step_display_number
        in: path
        description: ステップの表示用連番
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApproveRejectRequest'
        required: true
      responses:
        '200':
          description: 承認成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_WorkflowData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: ステップが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '409':
          description: 競合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflows/{display_number}/steps/{step_display_number}/reject:
    post:
      tags:
      - workflows
      summary: POST /api/v1/workflows/{display_number}/steps/{step_display_number}/reject
      description: |-
        ワークフローステップを却下する

        ## 処理フロー

        1. セッションから `tenant_id`, `user_id` を取得
        2. Core Service の `POST /internal/workflows/by-display-number/{dn}/steps/by-display-number/{step_dn}/reject` を呼び出し
        3. 200 OK + 更新されたワークフローを返す
      operationId: reject_step
      parameters:
      - name: display_number
        in: path
        description: ワークフローの表示用連番
        required: true
        schema:
          type: integer
          format: int64
      - name: step_display_number
        in: path
        description: ステップの表示用連番
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApproveRejectRequest'
        required: true
      responses:
        '200':
          description: 却下成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_WorkflowData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '403':
          description: 権限なし
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: ステップが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '409':
          description: 競合
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflows/{display_number}/submit:
    post:
      tags:
      - workflows
      summary: POST /api/v1/workflows/{display_number}/submit
      description: |-
        ワークフローを申請する

        ## 処理フロー

        1. セッションから `tenant_id` を取得
        2. Core Service の `POST /internal/workflows/by-display-number/{display_number}/submit` を呼び出し
        3. レスポンスを返す
      operationId: submit_workflow
      parameters:
      - name: display_number
        in: path
        description: ワークフロー表示番号
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitWorkflowRequest'
        required: true
      responses:
        '200':
          description: 申請成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_WorkflowData'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '404':
          description: ワークフローが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /api/v1/workflows/{display_number}/tasks/{step_display_number}:
    get:
      tags:
      - tasks
      summary: GET /api/v1/workflows/{display_number}/tasks/{step_display_number}
      description: display_number でタスク詳細を取得する
      operationId: get_task_by_display_numbers
      parameters:
      - name: display_number
        in: path
        description: ワークフローの表示用連番
        required: true
        schema:
          type: integer
          format: int64
      - name: step_display_number
        in: path
        description: ステップの表示用連番
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: タスク詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_TaskDetailData'
        '404':
          description: タスクが見つからない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
      security:
      - session_auth: []
  /health:
    get:
      tags:
      - health
      summary: ヘルスチェックエンドポイント
      description: サーバーが正常に稼働していることを確認するためのエンドポイント。
      operationId: health_check
      responses:
        '200':
          description: サーバー稼働中
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
components:
  schemas:
    ApiResponse_CreateUserResponseData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ユーザー作成レスポンス（初期パスワード付き）
          required:
          - id
          - display_id
          - display_number
          - name
          - email
          - role
          - initial_password
          properties:
            id:
              type: string
            display_id:
              type: string
            display_number:
              type: integer
              format: int64
            name:
              type: string
            email:
              type: string
            role:
              type: string
            initial_password:
              type: string
    ApiResponse_CsrfResponseData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: CSRF トークンデータ
          required:
          - token
          properties:
            token:
              type: string
    ApiResponse_DashboardStatsData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ダッシュボード統計データ
          required:
          - pending_tasks
          - my_workflows_in_progress
          - completed_today
          properties:
            pending_tasks:
              type: integer
              format: int64
            my_workflows_in_progress:
              type: integer
              format: int64
            completed_today:
              type: integer
              format: int64
    ApiResponse_LoginResponseData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ログインレスポンスデータ
          required:
          - user
          properties:
            user:
              $ref: '#/components/schemas/LoginUserResponse'
    ApiResponse_MeResponseData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: 現在のユーザー情報データ
          required:
          - id
          - email
          - name
          - tenant_id
          - tenant_name
          - roles
          - permissions
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string
            name:
              type: string
            tenant_id:
              type: string
              format: uuid
            tenant_name:
              type: string
            roles:
              type: array
              items:
                type: string
            permissions:
              type: array
              items:
                type: string
    ApiResponse_TaskDetailData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: タスク詳細データ
          required:
          - step
          - workflow
          properties:
            step:
              $ref: '#/components/schemas/WorkflowStepData'
            workflow:
              $ref: '#/components/schemas/WorkflowData'
    ApiResponse_UserDetailData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ユーザー詳細レスポンス
          required:
          - id
          - display_id
          - display_number
          - name
          - email
          - status
          - roles
          - permissions
          - tenant_name
          properties:
            id:
              type: string
            display_id:
              type: string
            display_number:
              type: integer
              format: int64
            name:
              type: string
            email:
              type: string
            status:
              type: string
            roles:
              type: array
              items:
                type: string
            permissions:
              type: array
              items:
                type: string
            tenant_name:
              type: string
    ApiResponse_UserResponseData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ユーザー簡易レスポンス（更新・ステータス変更用）
          required:
          - id
          - name
          - email
          - status
          properties:
            id:
              type: string
            name:
              type: string
            email:
              type: string
            status:
              type: string
    ApiResponse_Vec_TaskItemData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: array
          items:
            type: object
            description: タスク一覧の要素データ
            required:
            - id
            - display_number
            - step_name
            - status
            - version
            - created_at
            - workflow
            properties:
              id:
                type: string
              display_number:
                type: integer
                format: int64
              step_name:
                type: string
              status:
                type: string
              version:
                type: integer
                format: int32
              assigned_to:
                oneOf:
                - type: 'null'
                - $ref: '#/components/schemas/UserRefData'
              due_date:
                type:
                - string
                - 'null'
              started_at:
                type:
                - string
                - 'null'
              created_at:
                type: string
              workflow:
                $ref: '#/components/schemas/TaskWorkflowSummaryData'
    ApiResponse_Vec_UserItemData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: array
          items:
            type: object
            description: ユーザー一覧の要素データ
            required:
            - id
            - display_id
            - display_number
            - name
            - email
            - status
            - roles
            properties:
              id:
                type: string
              display_id:
                type: string
              display_number:
                type: integer
                format: int64
              name:
                type: string
              email:
                type: string
              status:
                type: string
              roles:
                type: array
                items:
                  type: string
    ApiResponse_Vec_WorkflowData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: array
          items:
            type: object
            description: ワークフローデータ
            required:
            - id
            - display_id
            - display_number
            - title
            - definition_id
            - status
            - version
            - form_data
            - initiated_by
            - steps
            - created_at
            - updated_at
            properties:
              id:
                type: string
              display_id:
                type: string
              display_number:
                type: integer
                format: int64
              title:
                type: string
              definition_id:
                type: string
              status:
                type: string
              version:
                type: integer
                format: int32
              form_data: {}
              initiated_by:
                $ref: '#/components/schemas/UserRefData'
              current_step_id:
                type:
                - string
                - 'null'
              steps:
                type: array
                items:
                  $ref: '#/components/schemas/WorkflowStepData'
              submitted_at:
                type:
                - string
                - 'null'
              completed_at:
                type:
                - string
                - 'null'
              created_at:
                type: string
              updated_at:
                type: string
    ApiResponse_Vec_WorkflowDefinitionData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: array
          items:
            type: object
            description: ワークフロー定義データ
            required:
            - id
            - name
            - version
            - definition
            - status
            - created_by
            - created_at
            - updated_at
            properties:
              id:
                type: string
              name:
                type: string
              description:
                type:
                - string
                - 'null'
              version:
                type: integer
                format: int32
              definition: {}
              status:
                type: string
              created_by:
                type: string
              created_at:
                type: string
              updated_at:
                type: string
    ApiResponse_WorkflowData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ワークフローデータ
          required:
          - id
          - display_id
          - display_number
          - title
          - definition_id
          - status
          - version
          - form_data
          - initiated_by
          - steps
          - created_at
          - updated_at
          properties:
            id:
              type: string
            display_id:
              type: string
            display_number:
              type: integer
              format: int64
            title:
              type: string
            definition_id:
              type: string
            status:
              type: string
            version:
              type: integer
              format: int32
            form_data: {}
            initiated_by:
              $ref: '#/components/schemas/UserRefData'
            current_step_id:
              type:
              - string
              - 'null'
            steps:
              type: array
              items:
                $ref: '#/components/schemas/WorkflowStepData'
            submitted_at:
              type:
              - string
              - 'null'
            completed_at:
              type:
              - string
              - 'null'
            created_at:
              type: string
            updated_at:
              type: string
    ApiResponse_WorkflowDefinitionData:
      type: object
      description: |-
        公開 API の統一レスポンス型

        すべての公開 API エンドポイントは `{ "data": T }` 形式でレスポンスを返す。
        この型は以下の場所で使用される:
        - Core Service ハンドラ（Serialize でレスポンスを返す）
        - BFF ハンドラ（Serialize でクライアントにレスポンスを返す）
        - BFF クライアント（Deserialize で Core Service のレスポンスを受け取る）

        ## 使用例

        ```
        use ringiflow_shared::ApiResponse;

        let response = ApiResponse::new("hello");
        assert_eq!(response.data, "hello");
        ```
      required:
      - data
      properties:
        data:
          type: object
          description: ワークフロー定義データ
          required:
          - id
          - name
          - version
          - definition
          - status
          - created_by
          - created_at
          - updated_at
          properties:
            id:
              type: string
            name:
              type: string
            description:
              type:
              - string
              - 'null'
            version:
              type: integer
              format: int32
            definition: {}
            status:
              type: string
            created_by:
              type: string
            created_at:
              type: string
            updated_at:
              type: string
    ApproveRejectRequest:
      type: object
      description: ステップ承認/却下リクエスト（BFF 公開 API）
      required:
      - version
      properties:
        version:
          type: integer
          format: int32
          description: 楽観的ロック用バージョン
        comment:
          type:
          - string
          - 'null'
          description: コメント（任意）
    CreateUserRequest:
      type: object
      description: ユーザー作成リクエスト
      required:
      - email
      - name
      - role_name
      properties:
        email:
          type: string
        name:
          type: string
        role_name:
          type: string
    CreateUserResponseData:
      type: object
      description: ユーザー作成レスポンス（初期パスワード付き）
      required:
      - id
      - display_id
      - display_number
      - name
      - email
      - role
      - initial_password
      properties:
        id:
          type: string
        display_id:
          type: string
        display_number:
          type: integer
          format: int64
        name:
          type: string
        email:
          type: string
        role:
          type: string
        initial_password:
          type: string
    CreateWorkflowRequest:
      type: object
      description: ワークフロー作成リクエスト（BFF 公開 API）
      required:
      - definition_id
      - title
      - form_data
      properties:
        definition_id:
          type: string
          format: uuid
          description: ワークフロー定義 ID
        title:
          type: string
          description: ワークフロータイトル
        form_data:
          description: フォームデータ
    CsrfResponseData:
      type: object
      description: CSRF トークンデータ
      required:
      - token
      properties:
        token:
          type: string
    DashboardStatsData:
      type: object
      description: ダッシュボード統計データ
      required:
      - pending_tasks
      - my_workflows_in_progress
      - completed_today
      properties:
        pending_tasks:
          type: integer
          format: int64
        my_workflows_in_progress:
          type: integer
          format: int64
        completed_today:
          type: integer
          format: int64
    HealthResponse:
      type: object
      description: ヘルスチェックレスポンス
      required:
      - status
      - version
      properties:
        status:
          type: string
          description: 稼働状態（`"healthy"` または `"unhealthy"`）
        version:
          type: string
          description: アプリケーションバージョン（Cargo.toml から取得）
    LoginRequest:
      type: object
      description: ログインリクエスト
      required:
      - email
      - password
      properties:
        email:
          type: string
        password:
          type: string
    LoginResponseData:
      type: object
      description: ログインレスポンスデータ
      required:
      - user
      properties:
        user:
          $ref: '#/components/schemas/LoginUserResponse'
    LoginUserResponse:
      type: object
      description: ログインユーザー情報
      required:
      - id
      - email
      - name
      - tenant_id
      - roles
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        tenant_id:
          type: string
          format: uuid
        roles:
          type: array
          items:
            type: string
    MeResponseData:
      type: object
      description: 現在のユーザー情報データ
      required:
      - id
      - email
      - name
      - tenant_id
      - tenant_name
      - roles
      - permissions
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        tenant_id:
          type: string
          format: uuid
        tenant_name:
          type: string
        roles:
          type: array
          items:
            type: string
        permissions:
          type: array
          items:
            type: string
    ProblemDetails:
      type: object
      description: |-
        エラーレスポンス（RFC 9457 Problem Details）

        すべてのサービスで統一されたエラーレスポンス形式。
        `type` フィールドは URI で問題の種類を識別する。
      required:
      - type
      - title
      - status
      - detail
      properties:
        type:
          type: string
        title:
          type: string
        status:
          type: integer
          format: int32
          minimum: 0
        detail:
          type: string
    SubmitWorkflowRequest:
      type: object
      description: ワークフロー申請リクエスト（BFF 公開 API）
      required:
      - assigned_to
      properties:
        assigned_to:
          type: string
          format: uuid
          description: 承認者のユーザー ID
    TaskDetailData:
      type: object
      description: タスク詳細データ
      required:
      - step
      - workflow
      properties:
        step:
          $ref: '#/components/schemas/WorkflowStepData'
        workflow:
          $ref: '#/components/schemas/WorkflowData'
    TaskItemData:
      type: object
      description: タスク一覧の要素データ
      required:
      - id
      - display_number
      - step_name
      - status
      - version
      - created_at
      - workflow
      properties:
        id:
          type: string
        display_number:
          type: integer
          format: int64
        step_name:
          type: string
        status:
          type: string
        version:
          type: integer
          format: int32
        assigned_to:
          oneOf:
          - type: 'null'
          - $ref: '#/components/schemas/UserRefData'
        due_date:
          type:
          - string
          - 'null'
        started_at:
          type:
          - string
          - 'null'
        created_at:
          type: string
        workflow:
          $ref: '#/components/schemas/TaskWorkflowSummaryData'
    TaskWorkflowSummaryData:
      type: object
      description: ワークフロー概要データ（タスク一覧用）
      required:
      - id
      - display_id
      - display_number
      - title
      - status
      - initiated_by
      properties:
        id:
          type: string
        display_id:
          type: string
        display_number:
          type: integer
          format: int64
        title:
          type: string
        status:
          type: string
        initiated_by:
          $ref: '#/components/schemas/UserRefData'
        submitted_at:
          type:
          - string
          - 'null'
    UpdateUserRequest:
      type: object
      description: ユーザー更新リクエスト
      properties:
        name:
          type:
          - string
          - 'null'
        role_name:
          type:
          - string
          - 'null'
    UpdateUserStatusRequest:
      type: object
      description: ユーザーステータス変更リクエスト
      required:
      - status
      properties:
        status:
          type: string
    UserDetailData:
      type: object
      description: ユーザー詳細レスポンス
      required:
      - id
      - display_id
      - display_number
      - name
      - email
      - status
      - roles
      - permissions
      - tenant_name
      properties:
        id:
          type: string
        display_id:
          type: string
        display_number:
          type: integer
          format: int64
        name:
          type: string
        email:
          type: string
        status:
          type: string
        roles:
          type: array
          items:
            type: string
        permissions:
          type: array
          items:
            type: string
        tenant_name:
          type: string
    UserItemData:
      type: object
      description: ユーザー一覧の要素データ
      required:
      - id
      - display_id
      - display_number
      - name
      - email
      - status
      - roles
      properties:
        id:
          type: string
        display_id:
          type: string
        display_number:
          type: integer
          format: int64
        name:
          type: string
        email:
          type: string
        status:
          type: string
        roles:
          type: array
          items:
            type: string
    UserRefData:
      type: object
      description: ユーザー参照データ（フロントエンドへの Serialize 用）
      required:
      - id
      - name
      properties:
        id:
          type: string
        name:
          type: string
    UserResponseData:
      type: object
      description: ユーザー簡易レスポンス（更新・ステータス変更用）
      required:
      - id
      - name
      - email
      - status
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
        status:
          type: string
    WorkflowData:
      type: object
      description: ワークフローデータ
      required:
      - id
      - display_id
      - display_number
      - title
      - definition_id
      - status
      - version
      - form_data
      - initiated_by
      - steps
      - created_at
      - updated_at
      properties:
        id:
          type: string
        display_id:
          type: string
        display_number:
          type: integer
          format: int64
        title:
          type: string
        definition_id:
          type: string
        status:
          type: string
        version:
          type: integer
          format: int32
        form_data: {}
        initiated_by:
          $ref: '#/components/schemas/UserRefData'
        current_step_id:
          type:
          - string
          - 'null'
        steps:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowStepData'
        submitted_at:
          type:
          - string
          - 'null'
        completed_at:
          type:
          - string
          - 'null'
        created_at:
          type: string
        updated_at:
          type: string
    WorkflowDefinitionData:
      type: object
      description: ワークフロー定義データ
      required:
      - id
      - name
      - version
      - definition
      - status
      - created_by
      - created_at
      - updated_at
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type:
          - string
          - 'null'
        version:
          type: integer
          format: int32
        definition: {}
        status:
          type: string
        created_by:
          type: string
        created_at:
          type: string
        updated_at:
          type: string
    WorkflowStepData:
      type: object
      description: ワークフローステップデータ
      required:
      - id
      - display_id
      - display_number
      - step_id
      - step_name
      - step_type
      - status
      - version
      - created_at
      - updated_at
      properties:
        id:
          type: string
        display_id:
          type: string
        display_number:
          type: integer
          format: int64
        step_id:
          type: string
        step_name:
          type: string
        step_type:
          type: string
        status:
          type: string
        version:
          type: integer
          format: int32
        assigned_to:
          oneOf:
          - type: 'null'
          - $ref: '#/components/schemas/UserRefData'
        decision:
          type:
          - string
          - 'null'
        comment:
          type:
          - string
          - 'null'
        due_date:
          type:
          - string
          - 'null'
        started_at:
          type:
          - string
          - 'null'
        completed_at:
          type:
          - string
          - 'null'
        created_at:
          type: string
        updated_at:
          type: string
  securitySchemes:
    session_auth:
      type: apiKey
      in: cookie
      name: session_id
tags:
- name: health
  description: ヘルスチェック
- name: auth
  description: 認証
- name: workflows
  description: ワークフロー管理
- name: tasks
  description: タスク管理
- name: users
  description: ユーザー管理
- name: dashboard
  description: ダッシュボード
