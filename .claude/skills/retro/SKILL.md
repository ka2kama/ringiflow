---
name: retro
description: 改善サイクルの有効性を検証する。改善記録の効果測定、プロジェクト健全性のトレンド分析、SRE 的観点での運用改善を実施する。
argument-hint: "<省略可。モード: quick / sre>"
user-invocable: true
---

# レトロスペクティブ（振り返り）

改善サイクル全体の有効性を検証し、プロジェクト健全性のトレンドを分析する。SRE 的観点で運用改善の方向性を示す。

## /assess との役割分離

| スキル | 役割 | 時間軸 | 頻度 |
|-------|------|--------|------|
| `/assess` | 現在のスナップショット診断 | 点（現在） | 月次推奨 |
| `/retro` | 改善サイクルの有効性検証 + トレンド分析 | 線（過去→現在→次） | 週次推奨 |

- `/assess` = 「今どうなっているか」（状態）
- `/retro` = 「改善の取り組みは効いているか、次に何を変えるべきか」（変化と方向性）

## 引数

$ARGUMENTS

| 引数 | 動作 |
|------|------|
| なし | 全 4 Step を実施（フルモード） |
| `quick` | Step 1（改善システムの検証）のみ |
| `sre` | Step 3（SRE 的観点）のみ |

## 手順

引数に応じて該当する Step を実行する。引数なしの場合は全 Step を順に実行する。

---

### Step 1: 改善システムの検証

改善記録の分析を通じて、改善サイクルが機能しているかを検証する。

→ 分析手法の詳細: [AI 思考特性の分析ガイド](../../../docs/06_ナレッジベース/methodology/AI思考特性の分析ガイド.md)

#### 1-1. 分析対象期間の決定

前回のレトロスペクティブレポートを探す:

→ Glob: `process/reports/*レトロスペクティブ*`

| 状態 | 分析期間 |
|------|---------|
| 前回レポートあり | 前回レポート日〜今日 |
| 前回レポートなし（初回） | 全期間（改善記録の最初のファイルから） |

#### 1-2. カテゴリ別集計

分析対象期間の改善記録から「分類」セクションのカテゴリを抽出・集計する:

→ Grep: `カテゴリ:` in `process/improvements/`

カテゴリ一覧（[改善記録 README](../../../process/improvements/README.md#カテゴリai-構造的特性) 参照）:

| カテゴリ | 説明 |
|---------|------|
| 参照漏れ | ドキュメント/手順が存在するが参照されなかった |
| 単一パス検証 | 1回の確認で完全と考え、複数ループを省略 |
| 即座の対策 | 深く考えずに対策を提示 |
| 視点不足 | 複数視点の同時把握ができていない |
| コンテキスト引きずり | 前の会話/作業の文脈を不適切に持ち越し |
| 知識-実行乖離 | 情報は存在するが使用フローに組み込まれていない |

出力:

```markdown
#### カテゴリ別推移
| カテゴリ | 前回 | 今回 | 増減 | 傾向 |
|---------|------|------|------|------|
```

確認するポイント:
- 特定のカテゴリに集中していないか
- 前回の分析から改善したカテゴリはあるか
- 新しいカテゴリの追加が必要か

#### 1-3. 失敗タイプ別集計

分析対象期間の改善記録から「失敗タイプ」を抽出・集計する:

→ Grep: `失敗タイプ:` in `process/improvements/`

出力:

```markdown
#### 失敗タイプ別推移
| 失敗タイプ | 前回 | 今回 | 増減 |
|-----------|------|------|------|
| 知識ギャップ | | | |
| 実行ギャップ | | | |
| プロセスギャップ | | | |
```

確認するポイント:
- 知識ギャップが多い → ドキュメント/ナレッジベースの拡充が必要
- 実行ギャップが多い → 行動規範の成果物要件化が必要
- プロセスギャップが多い → プロセス自体の見直しが必要

#### 1-4. 対策有効性の評価

改善記録の「検証」セクションを集約し、対策形式別の有効性を評価する:

→ Grep: `## 検証` in `process/improvements/`（検証セクションの有無を確認）

対策の形式を分類（改善記録の対策セクションから判定）:

| 対策形式 | 判定基準 | 例 |
|---------|---------|-----|
| 行動規範 | 「〜すること」「〜すべき」 | 「確認すること」 |
| 成果物要件 | 「〜が記載されていること」「〜セクション必須」 | 計画ファイルに検証セクション必須化 |
| フロー組み込み | hooks、CI、自動チェック | pre-commit hook に追加 |
| 判定テスト | 具体的な基準・条件の明示 | 「3回使用 → 手順書に昇格」 |

出力:

```markdown
#### 対策有効性
| 対策形式 | 実施済 | 効果あり | 再発 | 有効率 |
|---------|--------|---------|------|--------|
| 行動規範 | | | | |
| 成果物要件 | | | | |
| フロー組み込み | | | | |
| 判定テスト | | | | |
```

#### 1-5. 再発検出

同一カテゴリの改善記録が、対策実施後に再発しているかを検出する:

手順:
1. 各改善記録の「検証」セクションで「再発」に言及があるか確認
2. 同一カテゴリの改善記録を時系列に並べ、対策実施後に同カテゴリが再出現しているか確認
3. 再発パターンがある場合、その構造的原因を分析

出力（再発が検出された場合のみ）:

```markdown
#### 再発パターン
| 元の記録 | 再発記録 | カテゴリ | 対策形式 | 分析 |
|---------|---------|---------|---------|------|
```

---

### Step 2: プロジェクト健全性トレンド

`/assess` のレポートデータを活用し、3 軸のトレンドを分析する。

#### 2-1. 前回レポートとの差分取得

最新と前回の `/assess` レポートを取得する:

→ Glob: `process/reports/*健全性診断*`

| 状態 | 対応 |
|------|------|
| レポートが 2 件以上ある | 最新と前回を比較 |
| レポートが 1 件のみ | その 1 件の内容を基準として報告（トレンドは「比較不可」） |
| レポートなし | Step 2 をスキップし、`/assess` の実行を推奨 |

#### 2-2. 3 軸バランスの評価

各軸の主要指標を前回と比較する:

| 軸 | 主要指標 |
|----|---------|
| Discovery | Phase 進捗、未実装機能数、次候補の明確さ |
| Delivery | オープン Issue 数、消化ペース、停滞 Issue 数 |
| Sustainability | 大型ファイル数、TODO 数、テストファイル数、改善記録数 |

#### 2-3. トレンド判定

各軸に方向性を付与する:

| 記号 | 意味 | 判定基準 |
|------|------|---------|
| ↑ | 改善 | 指標が前回より良化 |
| → | 横ばい | 指標に大きな変化なし |
| ↓ | 悪化 | 指標が前回より劣化 |

出力:

```markdown
#### 3 軸バランス
| 軸 | 前回 | 今回 | 方向 |
|----|------|------|------|
| Discovery | <所見> | <所見> | ↑/→/↓ |
| Delivery | <所見> | <所見> | ↑/→/↓ |
| Sustainability | <所見> | <所見> | ↑/→/↓ |

#### バランス評価
[3 軸の偏りに関する所見。例: 「Sustainability に偏重、Discovery が停滞」]
```

---

### Step 3: SRE 的観点

→ 概念の詳細: [SRE 的アプローチ](../../../docs/06_ナレッジベース/methodology/SRE的アプローチ.md)

#### 3a. 再発率・MTTR 分析

**再発率**: 改善記録の総数に対し、同一カテゴリで再発した件数の割合。Step 1-5 の再発検出結果を再利用する。

計算手順（Step 1-5 の結果から算出）:
1. Step 1-5 で検出した再発件数を使用する
2. 再発率 = 再発件数 / 全件数

**MTTR（Mean Time To Resolve）**: 問題発見から対策完了までの平均日数。

計算手順:
1. 改善記録の作成日（問題発見）を取得
2. 対応 Issue のクローズ日（対策完了）を取得:
   ```bash
   # 改善記録から Issue 番号を抽出し、クローズ日を確認
   gh issue list --state closed --json number,closedAt --limit 100
   ```
3. 各改善記録の（クローズ日 - 作成日）を算出し、平均を取る
4. 対応 Issue がない、または未クローズの改善記録はスキップ

出力:

```markdown
#### 再発率・MTTR
- 再発率: N/M 件（N%）
- 平均 MTTR: N 日
- [前回比較がある場合: 前回比 +/-N%、+/-N 日]
```

#### 3b. Toil 分析

繰り返し発生する手作業（自動化候補）を特定する。

データソース:
1. セッションログの実施内容から、繰り返し出現するパターンを抽出:
   → Grep: `##` in `prompts/runs/` の直近月（セクション見出しでパターンを把握）
2. 改善記録で「プロセスギャップ」に分類された項目の対策を確認:
   → Grep: `プロセスギャップ` in `process/improvements/`

自動化可能性の判定基準:

| 可能性 | 基準 | 例 |
|--------|------|-----|
| 高 | 既存ツール（just, hooks）で即座に対応可能 | 定型チェックの自動化 |
| 中 | スクリプト作成で対応可能 | データ集計の自動化 |
| 低 | 判断を伴うため完全自動化は困難 | 設計レビュー |

出力:

```markdown
#### Toil
| Toil 候補 | 頻度 | 自動化可能性 | 推奨 |
|----------|------|------------|------|
```

#### 3c. エラーバジェット的思考

「攻め」（新機能開発）と「守り」（品質改善・メンテナンス）のバランスを評価する。

データソース:
```bash
# 直近 30 日のクローズ済み Issue のラベル別内訳
gh issue list --state closed --json number,title,labels,closedAt --limit 50
```

Issue のラベルをカテゴリに分類:

| カテゴリ | 対応ラベル | 位置づけ |
|---------|----------|---------|
| Feature（攻め） | `enhancement`, `feature` | 新機能・価値追加 |
| Maintain（守り） | `refactor`, `dependencies`, `performance` | 技術的負債・保守 |
| Improve（守り） | `documentation`, `process`, `idea` | プロセス改善 |
| Fix | `bug` | バグ修正 |
| ラベルなし | — | 内容から判断 |

バランスの判定基準:

| 攻めの比率 | 評価 | 推奨 |
|-----------|------|------|
| 0-20% | 守りに偏重 | 品質が安定しているなら Feature 比率を上げる |
| 20-50% | バランス良好 | 現状維持 |
| 50-80% | 攻めに偏重 | 品質指標（再発率等）が悪化していないか確認 |
| 80-100% | 品質リスク | 改善・メンテナンスの時間を確保すべき |

ただし、プロジェクトのフェーズにより適切なバランスは変わる:
- Phase 間の品質改善期 → 守り寄りでも適切
- Phase 開始直後 → 攻め寄りが自然

出力:

```markdown
#### エラーバジェット
| カテゴリ | 件数 | 比率 |
|---------|------|------|
| Feature（攻め） | N | N% |
| Maintain/Improve（守り） | N | N% |
| Fix | N | N% |

[バランスに関する所見と推奨]
```

---

### Step 4: セルフレビュー・統合レポートの出力

#### 4-1. セルフレビュー（1-2回）

Step 1-3 の分析結果に対し、以下の観点でセルフレビューを実施する。設計計画のブラッシュアップループとは異なり、**定数回（1-2回）のループ**とし、収束は求めない。

| 観点 | チェック内容 |
|------|------------|
| データの正確性 | 集計値に誤りがないか。件数の合計が整合するか |
| 解釈の妥当性 | データから結論への飛躍がないか。代替解釈を検討したか |
| アクションの根拠 | 各アクションアイテムがデータに紐づいているか |

設計計画との違い:
- 設計計画: 誤りが実装に波及するため「収束するまで」ループする
- レトロレポート: 次回レトロで自己修正できるため「定数回」で十分

修正があった場合は、修正箇所をレポート末尾の「セルフレビュー記録」に記載する。

#### 4-2. 統合レポートの出力

収集したデータを以下の形式で出力する。引数でモードが絞られている場合は該当セクションのみ出力する。

```
## 🔄 レトロスペクティブ（YYYY-MM-DD）

### 分析期間
前回レトロ: YYYY-MM-DD / 今回: YYYY-MM-DD

---

### 1. 改善システムの検証

#### カテゴリ別推移
| カテゴリ | 前回 | 今回 | 増減 | 傾向 |
|---------|------|------|------|------|

#### 失敗タイプ別推移
| 失敗タイプ | 前回 | 今回 | 増減 |
|-----------|------|------|------|

#### 対策有効性
| 対策形式 | 実施済 | 効果あり | 再発 | 有効率 |
|---------|--------|---------|------|--------|

#### 再発パターン
[再発が検出された場合のみ記載]

---

### 2. プロジェクト健全性トレンド

#### 3 軸バランス
| 軸 | 前回 | 今回 | 方向 |
|----|------|------|------|
| Discovery | <所見> | <所見> | ↑/→/↓ |
| Delivery | <所見> | <所見> | ↑/→/↓ |
| Sustainability | <所見> | <所見> | ↑/→/↓ |

#### バランス評価
[3 軸の偏りに関する所見]

---

### 3. SRE 的観点

#### 再発率・MTTR
- 再発率: N/M 件（N%）
- 平均 MTTR: N 日

#### Toil
| Toil 候補 | 頻度 | 自動化可能性 | 推奨 |
|----------|------|------------|------|

#### エラーバジェット
| カテゴリ | 件数 | 比率 |
|---------|------|------|
| Feature（攻め） | N | N% |
| Maintain/Improve（守り） | N | N% |
| Fix | N | N% |

[バランスに関する所見と推奨]

---

### 4. アクションアイテム

| 優先度 | カテゴリ | アクション | 根拠 |
|--------|---------|---------|------|
| High | <Category> | <具体的アクション> | <理由> |
| Medium | <Category> | <具体的アクション> | <理由> |
| Low | <Category> | <具体的アクション> | <理由> |

---

### セルフレビュー記録
| ループ | 観点 | 修正内容 |
|-------|------|---------|
| 1回目 | [データ正確性/解釈妥当性/アクション根拠] | [修正した内容。修正なしなら「なし」] |
```

#### アクションアイテムの優先度判定

| 優先度 | 基準 |
|--------|------|
| High | 再発率の上昇、同一カテゴリの3回以上の再発、攻め/守りバランスの大幅な偏り |
| Medium | 新しい再発パターンの検出、MTTR の悪化、自動化可能性の高い Toil |
| Low | 緩やかなトレンド変化、自動化可能性が低い Toil |

## レポートの保存

レトロスペクティブレポートは [`process/reports/`](../../../process/reports/) に保存する。分析完了後に保存を提案する。

→ 命名規則: [`process/reports/README.md`](../../../process/reports/README.md)

ファイル名: `YYYY-MM-DD_HHMM_レトロスペクティブ.md`

## アクションアイテムの Issue 化

レポート保存後、Step 4 のアクションアイテムを Issue 化する。

手順:

1. アクションアイテムの一覧をユーザーに提示し、Issue 化の確認を取る
2. 確認後、各アクションアイテムに対して Issue を作成する:
   ```bash
   gh issue create --title "<アクション>" --body "<根拠と優先度>" --label "priority:<優先度>,<カテゴリラベル>"
   ```
3. ラベルはレポートの優先度に対応させる: `priority:high` / `priority:medium` / `priority:low`（`/next` が優先度を参照するため）
4. Issue 作成完了後、改善記録に対応 Issue がある場合は「次のアクション」セクションのチェックリストに Issue 番号を追記する

<!-- 改善: process/improvements/2026-02/2026-02-23_1902_レトロスペクティブ完了後のアクションアイテムIssue化漏れ.md -->

## 既知手法との関連

| /retro の要素 | 対応する既知手法 |
|--------------|----------------|
| 改善有効性の評価 | PDCA サイクルの Check フェーズ |
| カテゴリ別集計・トレンド | SPC（統計的工程管理）|
| 再発率・MTTR | SRE のインシデント管理指標 |
| Toil 分析 | SRE の Toil Management（Google SRE Book Ch.5） |
| エラーバジェット的思考 | SRE の Error Budget（Google SRE Book Ch.3） |
| レトロスペクティブ全体 | Sprint Retrospective（Scrum）、Kaizen |
| セルフレビュー（定数回ループ） | Bounded Iteration（設計品質と実行コストのトレードオフ） |

→ 詳細: [SRE 的アプローチ](../../../docs/06_ナレッジベース/methodology/SRE的アプローチ.md)
→ 関連: [独自フレームワークと既知手法の対応](../../../docs/06_ナレッジベース/methodology/独自フレームワークと既知手法の対応.md)

## 補足

- `/retro` のフローはレポート生成からアクションアイテムの Issue 化まで。Issue 化はユーザー確認後に実行する
- Step 2 のトレンド分析は `/assess` のレポートを参照する。`/assess` が未実行の場合は `/assess` の先行実施を推奨する
- 週次で `quick` モード、月次でフルモードの運用を推奨。頻度はプロジェクトのペースに合わせて調整
