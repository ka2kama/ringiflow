---
name: assess
description: プロジェクト健全性を 3 軸で診断する。Discovery（未着手機能）、Delivery（バックログ状況）、Sustainability（技術的健全性）を評価し、改善提案を提示する。
argument-hint: "<省略可。診断対象: discovery / delivery / sustainability>"
user-invocable: true
---

# プロジェクト健全性を診断

プロジェクトを 3 軸（Discovery / Delivery / Sustainability）で診断し、バランスの取れた開発推進を支援する。

## 引数

$ARGUMENTS

| 引数 | 動作 |
|------|------|
| なし | 全 3 軸を診断 |
| `discovery` | Discovery 軸のみ |
| `delivery` | Delivery 軸のみ |
| `sustainability` | Sustainability 軸のみ |

## 手順

引数に応じて該当する軸の Step を実行する。引数なしの場合は全 Step を順に実行する。

各 Step ではデータを収集・分析し、最終 Step で統合レポートを出力する。

---

### Step 1: Discovery（攻め）

要件定義書・ロードマップから未実装機能を特定し、学習価値・プロダクト完成度を評価する。

#### 1-1. ロードマップの現状把握

実装ロードマップを読み、現在の Phase と完了状況を把握する:

→ Read: `docs/03_詳細設計書/00_実装ロードマップ.md`

#### 1-2. 未実装セクションの特定

設計書の実装状態マーカーを検索する:

→ Grep: `実装状態` in `docs/02_基本設計書/`, `docs/03_詳細設計書/`

#### 1-3. 機能仕様書の突合

定義済み機能仕様と実装状況を照合する:

→ Glob: `docs/01_要件定義書/機能仕様書/*.md`

各仕様書の内容を確認し、実装済みかどうかをロードマップの完了基準と突合する。

#### 1-4. 次の機能候補の特定

以下の観点で次に取り組むべき機能候補を評価する:

| 観点 | 評価基準 |
|------|---------|
| ロードマップ進捗 | 現在 Phase の完了率、次 Phase の前提条件 |
| 機能カバレッジ | 要件定義済み機能のうち実装済みの割合 |
| 学習価値 | 新しい技術パターン・アーキテクチャの学習機会（高/中/低） |
| 依存関係 | 他機能のブロッカーになっている未実装機能 |

---

### Step 2: Delivery（実行）

GitHub Issues のバックログ状況を分析し、消化の健全性を評価する。

#### 2-1. バックログの取得

```bash
# オープン Issue
gh issue list --state open --json number,title,labels,createdAt,updatedAt --limit 50

# 直近のクローズ済み Issue
gh issue list --state closed --json number,title,labels,closedAt --limit 20
```

#### 2-2. 分析

| 観点 | 評価基準 |
|------|---------|
| バックログサイズ | オープン Issue 数とラベル別内訳 |
| 停滞 Issue | 30 日以上更新なしの Issue 数 |
| 消化ペース | 直近 30 日のクローズ数 |
| ブロック状況 | Issue 本文の `Blocked by` で着手不可の Issue 数 |

停滞 Issue の判定: `updatedAt` が現在日時から 30 日以上前の Issue。

---

### Step 3: Sustainability（守り）

コード健全性、ドキュメント整合性、依存関係の鮮度、テスト品質、プロセス遵守を評価する。

#### 3a. コード健全性

| チェック | 手法 | 閾値 |
|---------|------|------|
| 大型ファイル | `just check-file-size` | 500 行超（テストファイル除く） |
| TODO/FIXME | Grep `TODO|FIXME|XXX|HACK` in `backend/`, `frontend/src/` | 存在自体をリスト |
| 未使用依存 | `just check-unused-deps` | 1 件以上 |

#### 3b. ドキュメント整合性

| チェック | 手法 | 基準 |
|---------|------|------|
| 未実装マーカー | Grep `実装状態` in `docs/` | 未実装マーカーの一覧（Discovery の 1-2 と共有可） |
| ADR 記録状況 | Glob `docs/05_ADR/*.md` の件数 | 情報提供 |
| 改善記録の状況 | Glob `process/improvements/` 直近月の件数 | 情報提供 |

#### 3c. 依存関係の鮮度

| チェック | コマンド | 基準 |
|---------|---------|------|
| Rust outdated | `cd backend && cargo outdated --root-deps-only 2>/dev/null` | outdated 件数 |
| Frontend outdated | `cd frontend && pnpm outdated 2>/dev/null` | outdated 件数 |
| セキュリティ監査 | `cd backend && cargo deny check advisories 2>/dev/null` | 脆弱性件数 |

`cargo-outdated` がインストールされていない場合はスキップし、その旨を報告する。`cargo-deny` は必須ツール（`just check-tools` で確認済み）のため常に利用可能。

#### 3d. テスト品質

| チェック | 手法 | 基準 |
|---------|------|------|
| テストファイル分布 | Glob `backend/**/tests/**/*.rs`, `backend/**/*_test.rs` | ファイル数 |
| API テスト | Glob `tests/api/hurl/**/*.hurl` | ファイル数 |

#### 3e. プロセス遵守

| チェック | 手法 | 基準 |
|---------|------|------|
| 改善記録 | Glob `process/improvements/YYYY-MM/` のファイル数 | 前回診断時点との差分 |
| セッションログ | Glob `prompts/runs/YYYY-MM/` のファイル数 | 前回診断時点との差分 |

比較基準: 前回の診断レポート（`process/reports/` の直近ファイル）の値と比較する。初回実行時は月次累計のみ報告する。

---

### Step 4: セルフレビュー・統合レポートの出力

#### 4-1. セルフレビュー（1-2回）

Step 1-3 の診断結果に対し、以下の観点でセルフレビューを実施する。**定数回（1-2回）のループ**とし、収束は求めない。

| 観点 | チェック内容 |
|------|------------|
| データの正確性 | ファイル数・行数・Issue 数などの実数に誤りがないか |
| 診断の偏り | 3 軸の評価が特定の軸に偏っていないか。データが不十分な軸はないか |
| 推奨の根拠 | 各推奨アクションが診断結果のデータに紐づいているか |

`/retro` との違い: `/assess` は月次実行であり、次の修正機会まで 1 ヶ月空く。また `/retro` の Step 2 がこのレポートを参照するため、データの正確性がより重要。

修正があった場合は、修正箇所をレポート末尾の「セルフレビュー記録」に記載する。

#### 4-2. 統合レポートの出力

収集したデータを以下の形式で出力する。引数で軸が絞られている場合は該当セクションのみ出力する。

```
## 📋 プロジェクト健全性診断

### 🔭 Discovery（攻め）

**現在の Phase**: Phase N（<名称>）
**Phase 進捗**: <完了率の見積もり>

#### 未実装の主要機能
| 機能 | Phase | 要件 ID | 学習価値 | 備考 |
|------|-------|---------|---------|------|
| <機能名> | N | <ID> | <高/中/低> | <依存関係等> |

#### 推奨: 次に取り組む機能候補
1. <機能名> — <理由>
2. <機能名> — <理由>

---

### 📊 Delivery（実行）

**バックログ**: オープン N 件（high: X, medium: Y, low: Z, ラベルなし: W）
**消化ペース**: 直近 30 日で N 件クローズ
**停滞**: N 件（30 日以上未更新）

#### 注意が必要な Issue
| Issue | 状態 | 理由 |
|-------|------|------|
| #<番号> <タイトル> | 停滞 | <日数>日間未更新 |
| #<番号> <タイトル> | ブロック中 | Blocked by #<番号> |

---

### 🛡️ Sustainability（守り）

#### コード健全性
- 大型ファイル（500 行超）: N 件
  <該当ファイルのリスト（上位のみ）>
- TODO/FIXME: N 件
- 未使用依存: N 件

#### ドキュメント整合性
- 未実装マーカー: N 箇所
- ADR 総数: N 件
- 改善記録（今月）: N 件

#### 依存関係
- Rust outdated: N 件
- Frontend outdated: N 件
- セキュリティ脆弱性: N 件

#### テスト
- テストファイル数: N 件
- API テストファイル数: N 件

#### プロセス
- 改善記録: N 件（前回比 +X）
- セッションログ: N 件（前回比 +X）

---

### 🎯 推奨アクション

| 優先度 | カテゴリ | アクション | 根拠 |
|--------|---------|---------|------|
| High | <Category> | <具体的アクション> | <理由> |
| Medium | <Category> | <具体的アクション> | <理由> |
| Low | <Category> | <具体的アクション> | <理由> |

高インパクトの発見は Issue 作成を提案する。低インパクトはレポートに留める。

---

### セルフレビュー記録
| ループ | 観点 | 修正内容 |
|-------|------|---------|
| 1回目 | [データ正確性/診断の偏り/推奨の根拠] | [修正した内容。修正なしなら「なし」] |
```

#### 推奨アクションの優先度判定

| 優先度 | 基準 |
|--------|------|
| High | セキュリティ脆弱性、ブロッカーとなる未実装機能、30 日以上停滞の高優先度 Issue |
| Medium | outdated 依存（メジャーバージョン遅れ）、500 行超の責務混在ファイル、未実装マーカーが多い領域 |
| Low | outdated 依存（マイナー/パッチ）、TODO コメント、情報提供レベルの指摘 |

#### カテゴリ

推奨アクションには以下のカテゴリを付与する:

| カテゴリ | 内容 |
|---------|------|
| Feature | 新機能開発（Discovery 由来） |
| Fix | バグ修正 |
| Maintain | 技術的負債、依存更新、リファクタリング |
| Improve | プロセス改善、ドキュメント整備 |

## レポートの保存

診断レポートは [`process/reports/`](../../../process/reports/) に保存する。ユーザーからスナップショットの保存を求められた場合、または診断完了後に保存を提案する。

→ 命名規則・ディレクトリ構造: [`process/reports/README.md`](../../../process/reports/README.md)

過去の診断レポートが存在する場合は、前回との差分（トレンド）にも言及する。

## 補足

- `/assess` は診断レポートの提示が役割。次の 1 タスク選定は `/next` で行う
- 診断結果に基づく Issue 作成は提案のみ行い、ユーザー確認後に実行する
- 推奨アクションを Issue 化する際は、レポートの優先度に対応する `priority:high` / `priority:medium` / `priority:low` ラベルを付与する（`/next` が優先度を参照するため）
- 依存関係鮮度チェック（`cargo outdated`）はツールのインストール状態に依存する。未インストール時はスキップし「未インストールのためスキップ」と報告する。セキュリティ監査（`cargo deny`）は必須ツールのため常に利用可能
