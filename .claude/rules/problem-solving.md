# 問題解決のアプローチ

問題や指摘を受けたとき、修正案を出す前に以下のフレームワークで分析する。

## 適用場面

- 問題や指摘を受けたとき
- Issue に着手するとき — Issue 自体を「仮説」として検証する
- 改善記録の対策を実行するとき — 対策案も「仮説」として検証する
- 設計判断を行うとき

→ Issue の精査: [Issue 駆動開発 > Issue 精査](dev-flow-issue.md#1-issue-精査)
→ 対策の性質: [改善記録 > 対策セクションの性質](../../process/improvements/README.md#対策セクションの性質)

### 問題の性質による前段分類

| 性質 | 適用するフレームワーク |
|------|---------------------|
| 技術的（CI エラー、ビルドエラー、実行時エラー、ツール仕様） | [troubleshooting.md](troubleshooting.md) の調査フローに従う |
| プロセス的（手順スキップ、品質ゲート漏れ、フロー不備） | 本フレームワーク（Want/To-Be/As-Is）で分析する |
| 思考的（判断の誤り、分析不足、視点の欠如） | 本フレームワーク（Want/To-Be/As-Is）で分析する |

→ 問題の性質の定義と routing table: [改善記録 > 問題の性質分類](../../process/improvements/README.md#対策設計の前提-問題の性質分類必須)

### Issue 精査時の As-Is 確認

Issue 本文の現状分析は「作成時点の仮説」。着手時に最新の As-Is で検証する。

| リスク | 内容 |
|--------|------|
| 時間的妥当性 | Issue 作成後に状況が変わっている |
| 事実的妥当性 | Issue 作成時点でも現状分析が間違っている |

確認手順:

前提: コード実測の前に `git fetch origin main` で `origin/main` を最新化する。

1. Issue 作成日時を確認（`gh issue view <number> --json createdAt`）
2. 作成後の関連 PR を検索（`gh pr list --search "#<Issue番号>"`）
3. 最新の As-Is を `origin/main` 基準で実測・確認（可能な限り実測で検証）
4. Issue の前提が現在も有効か判断
   - 既に改善済み → Want との突合で改善を評価し、残る課題を特定、Issue クローズを提案
   - まだ未改善 → Issue の現状分析を信頼して進める
   - 現状分析が間違っている → 正しい As-Is で再評価
5. 変化があった場合、Want との突合を実施する — 変化が検出された = 問題が解消されたとは限らない。変化の方向性が Want に適合するかを評価する

### 精査結果の記録（成果物要件）

Issue 精査を実施した際は、結果を Issue コメントとして記録する。記録がない場合、精査が実施されたと見なさない。

```markdown
## Issue 精査

**Want**: [この Issue が解決しようとしている本質的なニーズ]

**As-Is 検証**:
- Issue 作成日: YYYY-MM-DD
- 関連 PR: #XXX, #YYY（または なし）
- 最新の As-Is: [実測結果]

**Want 突合**: [As-Is に変化があった場合、その変化が Want を満たしているかの評価。変化なしの場合は「変化なし」]

**精査結果**: 続行 / 修正して続行 / 再構成 / 破棄

**理由**: [精査結果の判断理由]
```

記録のタイミング:
- 精査完了後、ブランチ作成前に Issue にコメントを追加する
- 破棄の場合は、Issue クローズ前にコメントを追加する

## Want と How

Want は [プロジェクト理念](../../CLAUDE.md#プロジェクト理念) レベルに固定する。手段（How）を Want に昇格させない。

- Want: 品質の追求（ISO/IEC 25010）、学習効果の最大化
- How: 完了基準の客観化、形式知化、テスト、ドキュメント整備 — これらは手段

対策は常に「Want を満たすか？」で検証する。

## フレームワーク

1. **Want（本質）**: ユーザーが本当に望んでいることは何か？
2. **To-Be（理想状態）**: どうあるべきだったか？
3. **As-Is（現状）**: 実際に何が起きたか？
4. **ギャップ分析**: なぜ理想と現実にずれが生じたか？
5. **根本原因**: 表層的な原因の奥にある構造的な問題は何か？
6. **対策設計**: 根本原因を解消し、Want を満たす対策は何か？

## 禁止事項

- フレームワークを経ずに対策を提示すること
- 「とりあえず」の修正を繰り返すこと
- 指摘を受けてから考え始めること

## 自己チェック

対策を提示する前に:

- この対策は表層的ではないか？
- 理想状態を定義したか？
- 根本原因まで掘り下げたか？
