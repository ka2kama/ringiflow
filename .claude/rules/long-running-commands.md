# 長時間コマンドの実行ルール

`just check-all` 等の長時間コマンドを Bash ツールで実行する際のルール。

## 1. バックグラウンド実行時はパイプを使わない

`command | tail` や `command | grep` をバックグラウンドで実行してはならない。`tail` や `grep` はパイプの全入力を受け取るまで出力を保留するため、出力ファイルが空のままハングする。

```bash
# 禁止: バックグラウンド + パイプ
just check-all 2>&1 | tail -30     # tail が全入力を待ち、出力が空のまま

# 正しい: バックグラウンドで直接実行し、後から Read/tail で確認
just check-all                      # run_in_background: true で実行
# → 完了後に Read ツールで出力ファイルを確認
```

## 2. TaskOutput の timeout は短く設定する

`TaskOutput` で `block=true` を使う場合、`timeout` は **30000ms（30秒）以下**に設定する。

完了していなければ `block=false` に切り替えて状態だけ確認し、ユーザーに進捗を報告する。

**禁止:** `timeout=600000`（10分）等の長時間ブロッキング

## 3. 出力切り詰め時の exit code を疑う

Bash ツールの出力が 30000 文字で切り詰められた場合、表示された exit code が正確でない可能性がある。

- 失敗と断定する前に、再実行で確認する
- 切り詰めにより失敗メッセージが見えていない可能性もあるため、末尾を確認する手段を先に検討する
