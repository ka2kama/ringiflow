# 技術的トラブルシューティングの基本原則

CI エラー、ビルドエラー、実行時エラー等の技術的問題を調査する際の原則。

## 原則

### 1. エラーメッセージは仮説であり、真実ではない

エラーメッセージは以下の可能性がある:

- 古い情報（キャッシュ、タイムラグ）
- 誤った情報（バグ、不正確な判定）
- 文脈依存（特定条件下でのみ真）

エラーメッセージを「仮説」として扱い、ソースデータで検証する。

### 2. 推測（「〜のはずだ」）は検証が必要なサイン

「〜のはずだ」と思ったら、それを確認するコマンド・API を実行する。確認手段が存在するなら、必ず使用する。

### 3. 実際の状態をソースデータで確認する

エラーメッセージが指摘する対象の実際の値・設定を取得する。推測ではなく、コマンド・API で取得した事実を根拠にする。

## 調査フロー

1. エラーメッセージを確認する（仮説として扱う）
2. 実際の状態をソースデータで確認する
3. エラーメッセージと実際の状態を照合する
4. 差異があれば、なぜ差異が生じたかを分析する
5. 根本原因を特定する
6. 対策を設計する

## 根本原因分析の観点

調査フローのステップ 5（根本原因を特定する）で、局所的な状態確認に加えて以下の間接的な影響を分析する。

| 観点 | 確認内容 |
|------|---------|
| 直接的依存 | コードの依存関係、インポート、関数呼び出し |
| 間接的影響 | リソース競合（DB 接続、メモリ、CPU）、並列実行負荷、タイミング、システム全体への波及 |
| 環境差異 | CI と開発環境の違い（並列度、リソース制限、設定） |
| 変更の波及 | ブランチ間の差分が何に影響するか（コードの直接変更以外も含む） |

改善の経緯: [間接的な因果関係の見落とし](../../prompts/improvements/2026-02/2026-02-15_1237_間接的な因果関係の見落とし.md)

## よくあるパターンと確認手段

| 問題 | エラーメッセージの例 | 確認手段 |
|------|---------------------|---------|
| GitHub Actions 許可設定 | "action is not allowed" | `gh api /repos/{owner}/{repo}/actions/permissions/selected-actions` |
| 環境変数の不足 | "environment variable not set" | `env`, `printenv`, コンテナ内で直接確認 |
| ファイルの不存在 | "file not found" | `ls`, Read ツール |
| 依存関係の不足 | "package not found" | `cargo tree`, `pnpm list` |
| ポートの競合 | "address already in use" | `lsof -i :PORT`, `ss -tlnp` |
| 権限の不足 | "permission denied" | `ls -la`, `stat` |

## 禁止事項

- エラーメッセージのみを根拠に原因を断定すること
- 確認手段が存在するのに使用せず推測で判断すること
- 「〜のはずだ」を検証せずに対策を提案すること
